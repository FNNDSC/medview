/*!

JSZip - A Javascript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2014 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
*/

/**
 * The following functions come from pako, from pako/lib/utils/strings
 * released under the MIT license, see pako https://github.com/nodeca/pako/
 */

/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 * 
 *      "Free software" is a matter of liberty, not price.
 *      "Free" as in "free speech", not as in "free beer".
 *                                         - Richard M. Stallman
 * 
 * FUELED BY:
 *  - the wonderful Constructive Solid Geometry library by Evan Wallace (http://madebyevan.com)
 *    LICENSE: https://raw.github.com/xtk/X/master/lib/csg/LICENSE
 *
 *  - parts of the Google Closure Library (http://code.google.com/closure/library)
 *    LICENSE: https://raw.github.com/xtk/google-closure-library/master/LICENSE
 *
 *  - zlib.js, the ultimate gzip/zlib javascript implementation (https://github.com/imaya/zlib.js)
 *    LICENSE: https://raw.github.com/imaya/zlib.js/master/LICENSE
 *
 * MORE CREDITS: https://raw.github.com/xtk/X/master/LICENSE
 *
 */

/*! dicom-parser - v1.0.2 - 2015-05-30 | (c) 2014 Chris Hafey | https://github.com/chafey/dicomParser */

function m(e){throw e}function aa(){return function(){}}function ba(e){return function(t){this[e]=t}}function v(e){return function(){return this[e]}}function ga(){}function ha(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var n=Object.prototype.toString.call(e);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t}function ia(e){return e!==p}function ja(e){return"array"==ha(e)}function la(e){var t=ha(e);return"array"==t||"object"==t&&"number"==typeof e.length}function ma(e){return"string"==typeof e}function na(e){return"number"==typeof e}function oa(e){return"function"==ha(e)}function pa(e){var n=typeof e;return"object"==n&&e!=t||"function"==n}function qa(e){return e[ra]||(e[ra]=++sa)}function ta(e,t,n){return e.call.apply(e.bind,arguments)}function ua(e,t,n){e||m(Error());if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function va(e,n,r){return va=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ta:ua,va.apply(t,arguments)}function wa(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=Array.prototype.slice.call(arguments);return t.unshift.apply(t,n),e.apply(this,t)}}function x(e,t){var n=e.split("."),r=ca;!(n[0]in r)&&r.execScript&&r.execScript("var "+n[0]);for(var i;n.length&&(i=n.shift());)!n.length&&ia(t)?r[i]=t:r=r[i]?r[i]:r[i]={}}function A(e,t){function n(){}n.prototype=t.prototype,e.u=t.prototype,e.prototype=new n,e.prototype.constructor=e}function ya(e,t,n){this.Za=this.Ya=this.Xa=0,3==arguments.length?(this.Xa=Number(e),this.Ya=Number(t),this.Za=Number(n)):e instanceof ya?(this.Xa=Number(e.x()),this.Ya=Number(e.y()),this.Za=Number(e.d())):(this.Xa=Number(e[0]),this.Ya=Number(e[1]),this.Za=Number(e[2]))}function Ea(e){var t=e.length();return new ya(e.Xa/t,e.Ya/t,e.Za/t)}function Aa(e,t){return new ya(e.Xa*t,e.Ya*t,e.Za*t)}function Ca(e,t){return new ya(e.Xa-t.x(),e.Ya-t.y(),e.Za-t.d())}function za(e,t){return new ya(e.Xa+t.x(),e.Ya+t.y(),e.Za+t.d())}function Fa(e){return new ya(-e.Xa,-e.Ya,-e.Za)}function Ga(e,t){for(var n in t){var r=t.__lookupGetter__(n),i=t.__lookupSetter__(n);n in e||(r||i?(r&&e.__defineGetter__(n,r),i&&e.__defineSetter__(n,i)):e[n]=t[n])}}function Ma(){}function Na(e,t){for(var n in e)t.call(p,e[n],n,e)}function Oa(e){var t=[],n=0,r;for(r in e)t[n++]=e[r];return t}function Qa(e,t){for(var n,r,i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(var s=0;s<Pa.length;s++)n=Pa[s],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Ra(e){return Sa.test(e)?(-1!=e.indexOf("&")&&(e=e.replace(Ta,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(Ua,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(Va,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(Wa,"&quot;")),e):e}function eb(){return ca.navigator?ca.navigator.userAgent:t}function fb(){return ca.navigator}function sb(){var e=ca.document;return e?e.documentMode:p}function Db(e){var t;if(!(t=Cb[e])){t=0;for(var n=String(wb).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),r=String(e).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),i=Math.max(n.length,r.length),s=0;0==t&&s<i;s++){var o=n[s]||"",u=r[s]||"",a=RegExp("(\\d*)(\\D*)","g"),f=RegExp("(\\d*)(\\D*)","g");do{var l=a.exec(o)||["","",""],c=f.exec(u)||["","",""];if(0==l[0].length&&0==c[0].length)break;t=((0==l[1].length?0:parseInt(l[1],10))<(0==c[1].length?0:parseInt(c[1],10))?-1:(0==l[1].length?0:parseInt(l[1],10))>(0==c[1].length?0:parseInt(c[1],10))?1:0)||((0==l[2].length)<(0==c[2].length)?-1:(0==l[2].length)>(0==c[2].length)?1:0)||(l[2]<c[2]?-1:l[2]>c[2]?1:0)}while(0==t)}t=Cb[e]=0<=t}return t}function Ob(e,t){var n=Jb(e,t);0<=n&&Ib.splice.call(e,n,1)}function Pb(e,t,n){return 2>=arguments.length?Ib.slice.call(e,t):Ib.slice.call(e,t,n)}function Qb(){0!=Rb&&(this.Dl=Error().stack,qa(this))}function Sb(e,t){this.type=e,this.currentTarget=this.target=t}function Tb(e){return Tb[" "](e),e}function Ub(e,t){e&&this.Ba(e,t)}function D(e,n,r,i,s){if(ja(n)){for(var o=0;o<n.length;o++)D(e,n[o],r,i,s);return t}return e=Zb(e,n,r,u,i,s),n=e.key,Vb[n]=e,n}function Zb(e,t,n,r,i,s){t||m(Error("Invalid event type")),i=!!i;var o=Wb;t in o||(o[t]={ma:0,Na:0}),o=o[t],i in o||(o[i]={ma:0,Na:0},o.ma++);var o=o[i],a=qa(e),f;o.Na++;if(o[a]){f=o[a];for(var l=0;l<f.length;l++)if(o=f[l],o.dc==n&&o.yf==s){if(o.Cc)break;return r||(f[l].ke=u),f[l]}}else f=o[a]=[],o.ma++;var c=$b,h=Gb?function(e){return c.call(h.src,h.dc,e)}:function(e){e=c.call(h.src,h.dc,e);if(!e)return e},l=h,o=new Ma;return o.Ba(n,l,e,t,i,s),o.ke=r,l.src=e,l.dc=o,f.push(o),Xb[a]||(Xb[a]=[]),Xb[a].push(o),e.addEventListener?(e==ca||!e.customEvent_)&&e.addEventListener(t,l,i):e.attachEvent(t in Yb?Yb[t]:Yb[t]="on"+t,l),o}function ac(e,t,n,r,i){if(ja(t))for(var s=0;s<t.length;s++)ac(e,t[s],n,r,i);else e=Zb(e,t,n,q,r,i),Vb[e.key]=e}function bc(e,n,r,i,s){if(ja(n))for(var o=0;o<n.length;o++)bc(e,n[o],r,i,s);else{i=!!i;e:{o=Wb;if(n in o&&(o=o[n],i in o&&(o=o[i],e=qa(e),o[e]))){e=o[e];break e}e=t}if(e)for(o=0;o<e.length;o++)if(e[o].dc==r&&e[o].capture==i&&e[o].yf==s){cc(e[o].key);break}}}function cc(e){var t=Vb[e];if(!t||t.Cc)return u;var n=t.src,r=t.type,i=t.th,s=t.capture;n.removeEventListener?(n==ca||!n.customEvent_)&&n.removeEventListener(r,i,s):n.detachEvent&&n.detachEvent(r in Yb?Yb[r]:Yb[r]="on"+r,i),n=qa(n),Xb[n]&&(i=Xb[n],Ob(i,t),0==i.length&&delete Xb[n]),t.Cc=q;if(t=Wb[r][s][n])t.kh=q,dc(r,s,n,t);return delete Vb[e],q}function dc(e,n,r,i){if(!i.ve&&i.kh){for(var s=0,o=0;s<i.length;s++)i[s].Cc?i[s].th.src=t:(s!=o&&(i[o]=i[s]),o++);i.length=o,i.kh=u,0==o&&(delete Wb[e][n][r],Wb[e][n].ma--,0==Wb[e][n].ma&&(delete Wb[e][n],Wb[e].ma--),0==Wb[e].ma&&delete Wb[e])}}function ec(e){var n=0;if(e!=t){if(e=qa(e),Xb[e]){e=Xb[e];for(var r=e.length-1;0<=r;r--)cc(e[r].key),n++}}else Na(Vb,function(e,t){cc(t),n++})}function fc(e,t){var n=qa(e),r=Xb[n];if(r){var i=ia(t),s=ia(p);return i&&s?(r=Wb[t],!!r&&!!r[p]&&n in r[p]):!i&&!s?q:Nb(r,function(e){return i&&e.type==t||s&&e.capture==p})}return u}function gc(e,t,n,r,i){var s=1;t=qa(t);if(e[t]){var o=--e.Na,a=e[t];a.ve?a.ve++:a.ve=1;try{for(var f=a.length,l=0;l<f;l++){var c=a[l];c&&!c.Cc&&(s&=hc(c,i)!==u)}}finally{e.Na=Math.max(o,e.Na),a.ve--,dc(n,r,t,a)}}return Boolean(s)}function hc(e,t){return e.ke&&cc(e.key),e.handleEvent(t)}function $b(e,n){if(e.Cc)return q;var r=e.type,i=Wb;if(r in i){var i=i[r],s,o;if(!Gb){var a;if(!(a=n))e:{a=["window","event"];for(var f=ca;s=a.shift();){if(f[s]==t){a=t;break e}f=f[s]}a=f}s=a,a=q in i,f=u in i;if(a){if(0>s.keyCode||s.returnValue!=p)return q;e:{var l=u;if(0==s.keyCode)try{s.keyCode=-1;break e}catch(c){l=q}if(l||s.returnValue==p)s.returnValue=q}}l=new Ub,l.Ba(s,this),s=q;try{if(a){for(var h=[],d=l.currentTarget;d;d=d.parentNode)h.push(d);o=i[q],o.Na=o.ma;for(var v=h.length-1;!l.Bc&&0<=v&&o.Na;v--)l.currentTarget=h[v],s&=gc(o,h[v],r,q,l);if(f){o=i[u],o.Na=o.ma;for(v=0;!l.Bc&&v<h.length&&o.Na;v++)l.currentTarget=h[v],s&=gc(o,h[v],r,u,l)}}else s=hc(e,l)}finally{h&&(h.length=0)}return s}return r=new Ub(n,this),s=hc(e,r)}return q}function jc(e){return e+"_"+ic++}function kc(){Qb.call(this),this.Hl={},this.Al=this}function M(){kc.call(this),this.f="base",this.pa=window["X.counter"].vk(),this.j=u}function lc(e,t){this.Wa=new ya(e),this.ta=new ya(t)}function mc(e,t){this.ta=e,this.Qd=t}function nc(e,t){this.Mb=e,this.Fe=t;var n=e[0].Wa,r=e[2].Wa,r=Ea(Ca(e[1].Wa,n).xc(Ca(r,n)));this.Va=new mc(r,r.cc(n))}function oc(e,t,n,r,i,s){for(var o=0,u=[],a=0;a<e.Mb.length;a++){var f=t.ta.cc(e.Mb[a].Wa)-t.Qd,f=-0.00001>f?2:1e-5<f?1:0,o=o|f;u.push(f)}switch(o){case 0:(0<t.ta.cc(e.Va.ta)?n:r).push(e);break;case 1:i.push(e);break;case 2:s.push(e);break;case 3:n=[],r=[];for(a=0;a<e.Mb.length;a++){var l=(a+1)%e.Mb.length,f=u[a],c=u[l],o=e.Mb[a],l=e.Mb[l];2!=f&&n.push(o),1!=f&&r.push(2!=f?o.l():o),3==(f|c)&&(f=(t.Qd-t.ta.cc(o.Wa))/t.ta.cc(Ca(l.Wa,o.Wa)),f=new lc(o.Wa.ue(l.Wa,f),o.ta.ue(l.ta,f)),n.push(f),r.push(f.l()))}3<=n.length&&i.push(new nc(n,e.Fe)),3<=r.length&&s.push(new nc(r,e.Fe))}}function pc(e){this.za=this.Aa=this.Va=t,this.X=[],e&&qc(this,e)}function qc(e,t){if(t.length){e.Va||(e.Va=t[0].Va.l());for(var n=[],r=[],i=0;i<t.length;i++)oc(t[i],e.Va,e.X,e.X,n,r);n.length&&(e.Aa||(e.Aa=new pc),qc(e.Aa,n)),r.length&&(e.za||(e.za=new pc),qc(e.za,r))}}function rc(e){var t=e.X.slice();return e.Aa&&(t=t.concat(rc(e.Aa))),e.za&&(t=t.concat(rc(e.za))),t}function sc(e,t){e.X=tc(t,e.X),e.Aa&&sc(e.Aa,t),e.za&&sc(e.za,t)}function tc(e,t){if(!e.Va)return t.slice();for(var n=[],r=[],i=0;i<t.length;i++)oc(t[i],e.Va,n,r,n,r);return e.Aa&&(n=tc(e.Aa,n)),r=e.za?tc(e.za,r):[],n.concat(r)}function uc(){this.X=[]}function vc(e){var t=new uc;return t.Ee(e),t}function wc(){M.call(this),this.f="indexer",this.gf=[],this.ul=[],this.Ia={}}function xc(e){M.call(this),this.f="file",this.be=e,this.j=q}function yc(){this.$a=this.r=t}function zc(e){if("function"==typeof e.Ed)return e.Ed();if(ma(e))return e.split("");if(la(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}return Oa(e)}function Ac(e,t){this.da={},this.S=[];var n=arguments.length;if(1<n){n%2&&m(Error("Uneven number of arguments"));for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else e&&this.jf(e)}function Cc(e){for(var t=0;t<e.S.length;t++){var n=e.S[t];if(Dc(e.da,n)&&e.da[n]==u)return q}return u}function Bc(e){if(e.ma!=e.S.length){for(var t=0,n=0;t<e.S.length;){var r=e.S[t];Dc(e.da,r)&&(e.S[n++]=r),t++}e.S.length=n}if(e.ma!=e.S.length){for(var i={},n=t=0;t<e.S.length;)r=e.S[t],Dc(i,r)||(e.S[n++]=r,i[r]=1),t++;e.S.length=n}}function Dc(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ec(){M.call(this),this.f="colortable",this.Ia=new Ac,Ga(this,new yc)}function Fc(e,t,n){this.x=ia(e)?e:0,this.y=ia(t)?t:0,this.d=ia(n)?n:0}function O(e,t,n){this.x=e,this.y=t,this.d=n}function Gc(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.d-t.d;return Math.sqrt(n*n+r*r+i*i)}function Hc(e,t){var n=e.x-t.x,r=e.y-t.y,i=e.d-t.d;return n*n+r*r+i*i}function Ic(e,t){return new O(e.x+t.x,e.y+t.y,e.d+t.d)}function Jc(e,t){return new O(e.y*t.d-e.d*t.y,e.d*t.x-e.x*t.d,e.x*t.y-e.y*t.x)}function Kc(e){this.length=e.length||e;for(var t=0;t<this.length;t++)this[t]=e[t]||0}function Mc(e){this.length=e.length||e;for(var t=0;t<this.length;t++)this[t]=e[t]||0}function Nc(){return new Float32Array(3)}function Oc(e,t,n){var r=Nc();return r[0]=e,r[1]=t,r[2]=n,r}function Pc(e,t){var n=e[0],r=e[1],i=e[2],n=1/Math.sqrt(n*n+r*r+i*i);t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}function Qc(){return new Float32Array(4)}function Rc(e,t,n,r){var i=Qc();return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function Sc(){return new Float32Array(16)}function Tc(){var e=Sc();return e[0]=e[5]=e[10]=e[15]=1,e}function Uc(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=s,e[5]=o,e[6]=u,e[7]=a,e[8]=f,e[9]=l,e[10]=c,e[11]=h,e[12]=p,e[13]=d,e[14]=v,e[15]=m,e}function Vc(e,t,n,r,i){return e[12]=t,e[13]=n,e[14]=r,e[15]=i,e}function Wc(e,t,n){t*=4,e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3]}function Xc(e,t,n){t*=4,n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3]}function Q(e,t,n,r,i,s){e[t]=n,e[t+4]=r,e[t+8]=i,e[t+12]=s}function Yc(e,t,n){e[t]=n[0],e[t+4]=n[1],e[t+8]=n[2],e[t+12]=n[3]}function $c(e,t,n){n[0]=e[t],n[1]=e[t+4],n[2]=e[t+8],n[3]=e[t+12]}function ad(e,t,n){var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14];e=e[15];var y=t[0],b=t[1],w=t[2],E=t[3],S=t[4],x=t[5],T=t[6],N=t[7],C=t[8],k=t[9],L=t[10],A=t[11],O=t[12],M=t[13],_=t[14];return t=t[15],n[0]=r*y+u*b+c*w+v*E,n[1]=i*y+a*b+h*w+m*E,n[2]=s*y+f*b+p*w+g*E,n[3]=o*y+l*b+d*w+e*E,n[4]=r*S+u*x+c*T+v*N,n[5]=i*S+a*x+h*T+m*N,n[6]=s*S+f*x+p*T+g*N,n[7]=o*S+l*x+d*T+e*N,n[8]=r*C+u*k+c*L+v*A,n[9]=i*C+a*k+h*L+m*A,n[10]=s*C+f*k+p*L+g*A,n[11]=o*C+l*k+d*L+e*A,n[12]=r*O+u*M+c*_+v*t,n[13]=i*O+a*M+h*_+m*t,n[14]=s*O+f*M+p*_+g*t,n[15]=o*O+l*M+d*_+e*t,n}function bd(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],f=e[6],l=e[7],c=e[8],h=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],b=n*a-r*o,w=n*f-i*o,E=n*l-s*o,S=r*f-i*a,x=r*l-s*a,T=i*l-s*f,N=c*m-h*v,C=c*g-p*v,k=c*y-d*v,L=h*g-p*m,A=h*y-d*m,O=p*y-d*g,M=b*O-w*A+E*L+S*k-x*C+T*N;return 0==M?u:(M=1/M,t[0]=(a*O-f*A+l*L)*M,t[1]=(-r*O+i*A-s*L)*M,t[2]=(m*T-g*x+y*S)*M,t[3]=(-h*T+p*x-d*S)*M,t[4]=(-o*O+f*k-l*C)*M,t[5]=(n*O-i*k+s*C)*M,t[6]=(-v*T+g*E-y*w)*M,t[7]=(c*T-p*E+d*w)*M,t[8]=(o*A-a*k+l*N)*M,t[9]=(-n*A+r*k-s*N)*M,t[10]=(v*x-m*E+y*b)*M,t[11]=(-c*x+h*E-d*b)*M,t[12]=(-o*L+a*C-f*N)*M,t[13]=(n*L-r*C+i*N)*M,t[14]=(-v*S+m*w-g*b)*M,t[15]=(c*S-h*w+p*b)*M,q)}function cd(e,t,n){var r=t[0],i=t[1];t=t[2],n[0]=r*e[0]+i*e[4]+t*e[8]+e[12],n[1]=r*e[1]+i*e[5]+t*e[9]+e[13],n[2]=r*e[2]+i*e[6]+t*e[10]+e[14]}function dd(e,t,n){var r=t[0],i=t[1],s=t[2];return t=t[3],n[0]=r*e[0]+i*e[4]+s*e[8]+t*e[12],n[1]=r*e[1]+i*e[5]+s*e[9]+t*e[13],n[2]=r*e[2]+i*e[6]+s*e[10]+t*e[14],n[3]=r*e[3]+i*e[7]+s*e[11]+t*e[15],n}function ed(e,t,n,r){return Vc(e,e[0]*t+e[4]*n+e[8]*r+e[12],e[1]*t+e[5]*n+e[9]*r+e[13],e[2]*t+e[6]*n+e[10]*r+e[14],e[3]*t+e[7]*n+e[11]*r+e[15])}function fd(){M.call(this),this.f="transform",this.P=C.g.Fd()}function gd(e,t,n){e.P[t+4*n]*=-1,e.q()}function hd(){M.call(this),this.f="texture",this.Wb=this.jb=this.r=t,this.af=this.bf=0,this.mg=u,Ga(this,new yc)}function S(e,n){M.call(this),this.f="triplets",this.pb=Infinity,this.mb=-Infinity,this.qb=Infinity,this.nb=-Infinity,this.rb=Infinity,this.ob=-Infinity,this.Sd=[0,0,0],this.lg=q,this.C=0,this.aa=new Float32Array(e),n!=t&&(this.aa=n.aa.subarray(0,n.aa.length),this.C=this.aa.length,this.pb=n.pb,this.mb=n.mb,this.qb=n.qb,this.nb=n.nb,this.rb=n.rb,this.ob=n.ob,this.Sd=n.Sd.slice(),this.lg=u)}function id(){this.Ga=jd,this.ga=new fd,this.w=[1,1,1],this.sc=this.G=this.oa=this.n=this.h=t,this.Sc=[],this.N=q,this.Pc=this.td=1,this.Ic=t,this.jd=u,this.xa=1,this.wa=0,this.sd=q}function kd(){this.qa=Infinity,this.T=this.fa=-Infinity,this.U=Infinity,this.Sb=[0,0,0],this.Qb=[1,1,1]}function ld(){M.call(this),this.f="scalars",this.dd=this.I=t,this.zg=q,this.Pe=0,Ga(this,new yc),Ga(this,new kd),this.Sb=[0,1,0],this.Qb=[1,0,0]}function T(e){M.call(this),this.f="object",this.c=[],this.F=this.va=t,Ga(this,new id),e!=t&&this.wc(e)}function od(e,n){return(e==t||n==t||!(e instanceof T)||!(n instanceof T))&&m(Error("Fatal: Two valid X.objects are required for comparison.")),1==e.xa?-1:1==n.xa?1:e.wa!=t&&n.wa!=t&&e.wa>n.wa?-1:1}function pd(){}function qd(e){for(var t=e.h.count,n=[],r=0,r=0;r<t;r+=3){var i=e.h.get(r),s=e.h.get(r+1),o=e.h.get(r+2),u=e.n.get(r),a=e.n.get(r+1),f=e.n.get(r+2),l=e.w;e.oa&&0<e.oa.length&&(l=e.oa.get(r));var c=[];c.push(new lc(i,u)),c.push(new lc(s,a)),c.push(new lc(o,f)),n.push(new nc(c,l))}return vc(n)}function rd(e,n){(n==t||!(n instanceof uc))&&m(Error("Invalid CSG object."));var r=new wc,i=[];Mb(n.X,function(e){var t=[],n=e.Fe,t=Mb(e.Mb,function(e){return e.color=n,r.add(e)});for(e=e=2;e<t.length;e++)i.push([t[0],t[e-1],t[e]])}.bind(e)),e.$h=Mb(r.unique(),function(e){return[e.Wa.x(),e.Wa.y(),e.Wa.d()]}),e.Zh=Mb(r.unique(),function(e){return[e.ta.x(),e.ta.y(),e.ta.d()]}),e.Yh=Mb(r.unique(),function(e){return e.color?[e.color[0],e.color[1],e.color[2]]:t}),e.h=new S(9*i.length),e.n=new S(9*i.length),e.oa=new S(9*i.length),Mb(i,function(e){var t=e[0],n=e[1];e=e[2];var r=this.$h,i=this.Zh,s=this.Yh;this.h.add(r[t][0],r[t][1],r[t][2]),this.h.add(r[n][0],r[n][1],r[n][2]),this.h.add(r[e][0],r[e][1],r[e][2]),this.n.add(i[t][0],i[t][1],i[t][2]),this.n.add(i[n][0],i[n][1],i[n][2]),this.n.add(i[e][0],i[e][1],i[e][2]),s[t]&&this.oa.add(s[t][0],s[t][1],s[t][2]),s[n]&&this.oa.add(s[n][0],s[n][1],s[n][2]),s[e]&&this.oa.add(s[e][0],s[e][1],s[e][2])}.bind(e)),0==e.oa.C&&(e.oa=t),e.Ga=jd}function sd(e){Sb.call(this,e),this.f="event"}function Hd(){sd.call(this,yd),this.Ve=this.hf=0}function Id(){sd.call(this,td),this.wa=new C.m(0,0,0)}function Jd(){sd.call(this,ud),this.wa=new C.m(0,0,0)}function Kd(){sd.call(this,vd),this.hb=this.yb=u}function Ld(){sd.call(this,wd),this.up=u}function Md(){sd.call(this,Cd),this.ie=this.he=0}function Nd(){sd.call(this,Dd)}function Od(){sd.call(this,xd)}function md(){sd.call(this,zd),this.v=this.D=t}function nd(){sd.call(this,Ad),this.v=this.D=t}function Pd(){sd.call(this,Bd),this.Bd=0}function Qd(){sd.call(this,Ed),this.D=t}function Rd(){sd.call(this,Gd),this.Bd=0}function Sd(){sd.call(this,Fd),this.D=t}function Td(e,n,r){e==t&&m(Error("Invalid GL Buffer.")),n==t&&m(Error("Invalid number of items.")),r==t&&m(Error("Invalid item size.")),M.call(this),this.f="buffer",this.O=e,this.ed=n,this.Pb=r}function Vd(e,t){var n;n=e.className,n=ma(n)&&n.match(/\S+/g)||[];for(var r=Pb(arguments,1),i=n.length+r.length,s=n,o=0;o<r.length;o++)0<=Jb(s,r[o])||s.push(r[o]);return e.className=n.join(" "),n.length==i}function Wd(e,t){this.width=e,this.height=t}function Yd(e,t){this.x=ia(e)?e:0,this.y=ia(t)?t:0}function Zd(e,t){return new Yd(e.x-t.x,e.y-t.y)}function $d(e){return e?new ae(be(e)):Ud||(Ud=new ae)}function ce(e){return ma(e)?document.getElementById(e):e}function ee(e,t,n){return fe(document,arguments)}function fe(e,n){var r=n[0],i=n[1];if(!Xd&&i&&(i.name||i.type)){r=["<",r],i.name&&r.push(' name="',Ra(i.name),'"');if(i.type){r.push(' type="',Ra(i.type),'"');var s={};Qa(s,i),delete s.type,i=s}r.push(">"),r=r.join("")}var o=e.createElement(r);i&&(ma(i)?o.className=i:ja(i)?Vd.apply(t,[o].concat(i)):Na(i,function(e,t){"style"==t?o.style.cssText=e:"class"==t?o.className=e:"for"==t?o.htmlFor=e:t in de?o.setAttribute(de[t],e):0==t.lastIndexOf("aria-",0)||0==t.lastIndexOf("data-",0)?o.setAttribute(t,e):o[t]=e}));if(2<n.length){i=function(t){t&&o.appendChild(ma(t)?e.createTextNode(t):t)};for(r=2;r<n.length;r++){var a=n[r];if(la(a)&&!(pa(a)&&0<a.nodeType)){var s=Lb,f;e:{if((f=a)&&"number"==typeof f.length){if(pa(f)){f="function"==typeof f.item||"string"==typeof f.item;break e}if(oa(f)){f="function"==typeof f.item;break e}}f=u}if(f)if(f=a.length,0<f){for(var l=Array(f),c=0;c<f;c++)l[c]=a[c];a=l}else a=[];s(a,i)}else i(a)}}return o}function ge(e){return"CSS1Compat"==e.compatMode}function he(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function ie(e){for(;e&&1!=e.nodeType;)e=e.nextSibling;return e}function je(e,t){if(e.contains&&1==t.nodeType)return e==t||e.contains(t);if("undefined"!=typeof e.compareDocumentPosition)return e==t||Boolean(e.compareDocumentPosition(t)&16);for(;t&&e!=t;)t=t.parentNode;return t==e}function be(e){return 9==e.nodeType?e:e.ownerDocument||e.document}function ae(e){this.ia=e||ca.document||document}function ke(e){return ge(e.ia)}function le(e){var t=e.ia;return e=!mb&&ge(t)?t.documentElement:t.body,t=t.parentWindow||t.defaultView,jb&&Db("10")&&t.pageYOffset!=e.scrollTop?new Yd(e.scrollLeft,e.scrollTop):new Yd(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)}function me(e,t,n,r){this.top=e,this.right=t,this.bottom=n,this.left=r}function ne(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}function oe(e,t){var n=t.x<e.left?e.left-t.x:Math.max(t.x-(e.left+e.width),0),r=t.y<e.top?e.top-t.y:Math.max(t.y-(e.top+e.height),0);return n*n+r*r}function pe(e,n){var r=be(e);return r.defaultView&&r.defaultView.getComputedStyle&&(r=r.defaultView.getComputedStyle(e,t))?r[n]||r.getPropertyValue(n)||"":""}function qe(e,n){return pe(e,n)||(e.currentStyle?e.currentStyle[n]:t)||e.style&&e.style[n]}function re(e){return e=e?be(e):document,jb&&!(jb&&9<=Fb)&&!ke($d(e))?e.body:e.documentElement}function se(e){var t=e.getBoundingClientRect();return jb&&(e=e.ownerDocument,t.left-=e.documentElement.clientLeft+e.body.clientLeft,t.top-=e.documentElement.clientTop+e.body.clientTop),t}function te(e){if(jb&&!(jb&&8<=Fb))return e.offsetParent;var n=be(e),r=qe(e,"position"),i="fixed"==r||"absolute"==r;for(e=e.parentNode;e&&e!=n;e=e.parentNode)if(r=qe(e,"position"),i=i&&"static"==r&&e!=n.documentElement&&e!=n.body,!i&&(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight||"fixed"==r||"absolute"==r||"relative"==r))return e;return t}function ue(e){for(var n=new me(0,Infinity,Infinity,0),r=$d(e),i=r.ia.body,s=r.ia.documentElement,o=!mb&&ge(r.ia)?r.ia.documentElement:r.ia.body;e=te(e);)if((!jb||0!=e.clientWidth)&&(!mb||0!=e.clientHeight||e!=i)&&e!=i&&e!=s&&"visible"!=qe(e,"overflow")){var u=ve(e),a;a=e;if(lb&&!Db("1.9")){var f=parseFloat(pe(a,"borderLeftWidth"));if(we(a))var l=a.offsetWidth-a.clientWidth-f-parseFloat(pe(a,"borderRightWidth")),f=f+l;a=new Yd(f,parseFloat(pe(a,"borderTopWidth")))}else a=new Yd(a.clientLeft,a.clientTop);u.x+=a.x,u.y+=a.y,n.top=Math.max(n.top,u.y),n.right=Math.min(n.right,u.x+e.clientWidth),n.bottom=Math.min(n.bottom,u.y+e.clientHeight),n.left=Math.max(n.left,u.x)}return i=o.scrollLeft,o=o.scrollTop,n.left=Math.max(n.left,i),n.top=Math.max(n.top,o),r=(r.ia.parentWindow||r.ia.defaultView||window).document,r=ge(r)?r.documentElement:r.body,r=new Wd(r.clientWidth,r.clientHeight),n.right=Math.min(n.right,i+r.width),n.bottom=Math.min(n.bottom,o+r.height),0<=n.top&&0<=n.left&&n.bottom>n.top&&n.right>n.left?n:t}function ve(e){var t,n=be(e),r=qe(e,"position"),i=lb&&n.getBoxObjectFor&&!e.getBoundingClientRect&&"absolute"==r&&(t=n.getBoxObjectFor(e))&&(0>t.screenX||0>t.screenY),s=new Yd(0,0),o=re(n);if(e==o)return s;if(e.getBoundingClientRect)t=se(e),e=le($d(n)),s.x=t.left+e.x,s.y=t.top+e.y;else if(n.getBoxObjectFor&&!i)t=n.getBoxObjectFor(e),e=n.getBoxObjectFor(o),s.x=t.screenX-e.screenX,s.y=t.screenY-e.screenY;else{t=e;do{s.x+=t.offsetLeft,s.y+=t.offsetTop,t!=e&&(s.x+=t.clientLeft||0,s.y+=t.clientTop||0);if(mb&&"fixed"==qe(t,"position")){s.x+=n.body.scrollLeft,s.y+=n.body.scrollTop;break}t=t.offsetParent}while(t&&t!=e);if(ib||mb&&"absolute"==r)s.y-=n.body.offsetTop;for(t=e;(t=te(t))&&t!=n.body&&t!=o;)if(s.x-=t.scrollLeft,!ib||"TR"!=t.tagName)s.y-=t.scrollTop}return s}function xe(e){var t=new Yd;if(1==e.nodeType){if(e.getBoundingClientRect){var n=se(e);t.x=n.left,t.y=n.top}else{var n=le($d(e)),r=ve(e);t.x=r.x-n.x,t.y=r.y-n.y}if(lb&&!Db(12)){var i;jb?i="-ms-transform":mb?i="-webkit-transform":ib?i="-o-transform":lb&&(i="-moz-transform");var s;i&&(s=qe(e,i)),s||(s=qe(e,"transform")),s?(e=s.match(ye),e=e?new Yd(parseFloat(e[1]),parseFloat(e[2])):new Yd(0,0)):e=new Yd(0,0),t=new Yd(t.x+e.x,t.y+e.y)}}else i=oa(e.Li),s=e,e.targetTouches?s=e.targetTouches[0]:i&&e.vb.targetTouches&&(s=e.vb.targetTouches[0]),t.x=s.clientX,t.y=s.clientY;return t}function ze(e,t){return"number"==typeof e&&(e=(t?Math.round(e):e)+"px"),e}function Ae(e){if("none"!=qe(e,"display"))return Be(e);var t=e.style,n=t.display,r=t.visibility,i=t.position;return t.visibility="hidden",t.position="absolute",t.display="inline",e=Be(e),t.display=n,t.position=i,t.visibility=r,e}function Be(e){var t=e.offsetWidth,n=e.offsetHeight,r=mb&&!t&&!n;return(!ia(t)||r)&&e.getBoundingClientRect?(e=se(e),new Wd(e.right-e.left,e.bottom-e.top)):new Wd(t,n)}function Ce(e,t){e.style.display=t?"":"none"}function we(e){return"rtl"==qe(e,"direction")}function De(e,t){if(/^\d+px?$/.test(t))return parseInt(t,10);var n=e.style.left,r=e.runtimeStyle.left;e.runtimeStyle.left=e.currentStyle.left,e.style.left=t;var i=e.style.pixelLeft;return e.style.left=n,e.runtimeStyle.left=r,i}function Ee(e,n){var r=e.currentStyle?e.currentStyle[n]:t;return r?De(e,r):0}function Ge(e,n){if("none"==(e.currentStyle?e.currentStyle[n+"Style"]:t))return 0;var r=e.currentStyle?e.currentStyle[n+"Width"]:t;return r in Fe?Fe[r]:De(e,r)}function He(e,n){kc.call(this),this.H=e;var r=pa(this.H)&&1==this.H.nodeType?this.H:this.H?this.H.body:t;this.fj=!!r&&we(r),this.Pl=D(this.H,lb?"DOMMouseScroll":"mousewheel",this,n)}function Ie(e,t){return mb&&(ab||db)&&0!=e%t?e:e/t}function Je(e,t,n,r){t&&this.Ba(t,p),this.type="mousewheel",this.detail=e,this.El=n,this.Yc=r}function Ke(e){M.call(this),this.f="interactor",this.Oa=e,this.We=this.tg=this.sg=this.ug=this.rg=this.vg=t,this.$d=q,this.Xb=this.Rb=this.lb=u,this.qd=[0,0],this.Re=new C.m(0,0,0),this.gd=new C.m(0,0,0),this.$g=0,this.Cg=this.Yd=t,this.Bg=u,this.ib={x:0,y:0,d:0},this.R={MOUSEWHEEL_ENABLED:q,MOUSECLICKS_ENABLED:q,KEYBOARD_ENABLED:q,HOVERING_ENABLED:q,CONTEXTMENU_ENABLED:u,TOUCH_ENABLED:q,TOUCH_BOUNCING_ENABLED:u}}function Ne(e){clearTimeout(e.Cg);if(e.de){var t=new Kd;t.yb=u,t.hb=e instanceof Me,e.dispatchEvent(t)}e.de=u}function Le(e){e.Yd&&clearTimeout(e.Yd),e.dispatchEvent(new Nd)}function Oe(e){Ke.call(this,e),this.f="interactor2D"}function Pe(e,t){(!na(e)||!na(t))&&m(Error("A camera needs valid width and height values.")),M.call(this),this.f="camera",this.lc=new C.m(0,100,0),this.Kc=new C.m(0,0,0),this.ha=new C.m(0,0,1),this.K=e,this.A=t,this.o=this.we(this.lc,this.Kc)}function Qe(e,t){Pe.call(this,e,t),this.f="camera3D",this.jg=45,this.$e=C.g.Df(C.g.Fd(),this.jg,e/t,1,1e4)}function Re(e,t,n,r){var i=new Float32Array(4),s=new Float32Array(4),o=new Float32Array(16),u=new Float32Array(16);return new Float32Array(16),C.g.multiply(e.$e,e.o,u),C.g.W(u,o),i[0]=t,i[1]=n,i[2]=2*r-1,i[3]=1,C.g.gh(o,i,s),s[3]=1/s[3],s[0]*=s[3],s[1]*=s[3],s[2]*=s[3],s}function Se(){M.call(this),this.f="parser",this.J=t,this.C=0,this.di=0<(new Int8Array((new Int16Array([1])).buffer))[0],this.Qc=q,this.xl=-Infinity,this.wl=Infinity}function Te(e){for(var t=Infinity,n=-Infinity,r=e.length,i=0,i=0;i<r;i++)if(!isNaN(e[i]))var s=e[i],t=Math.min(t,s),n=Math.max(n,s);return[t,n]}function Ue(e,t,n){t===p&&(t=0),n===p&&(n=e.length);for(var r="",i=0,i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function V(e,n,r){r!=t||(r=1);var i=1,s=Uint8Array;switch(n){case"schar":s=Int8Array;break;case"ushort":s=Uint16Array,i=2;break;case"sshort":s=Int16Array,i=2;break;case"uint":s=Uint32Array,i=4;break;case"sint":s=Int32Array,i=4;break;case"float":s=Float32Array,i=4;break;case"complex":s=Float64Array,i=8;break;case"double":s=Float64Array,i=8}n=new s(e.J.slice(e.C,e.C+=r*i));if(e.di!=e.Qc){e=n,n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(s=0;s<e.byteLength;s+=i)for(var o=s+i-1,u=s;o>u;o--,u++){var a=n[u];n[u]=n[o],n[o]=a}n=e}return 1==r?n[0]:n}function Ve(e,t){var n=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE],r=Rc(0,0,0,1),i=Qc();return dd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Rc(0,0,t[2]-1,1),dd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Rc(0,t[1]-1,0,1),dd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Rc(t[0]-1,0,0,1),dd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Rc(t[0]-1,t[1]-1,0,1),dd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Rc(t[0]-1,0,t[2]-1,1),dd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Rc(0,t[1]-1,t[2]-1,1),dd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],r=Rc(t[0]-1,t[1]-1,t[2]-1,1),dd(e,r,i),n[0]=i[0]<n[0]?i[0]:n[0],n[1]=i[0]>n[1]?i[0]:n[1],n[2]=i[1]<n[2]?i[1]:n[2],n[3]=i[1]>n[3]?i[1]:n[3],n[4]=i[2]<n[4]?i[2]:n[4],n[5]=i[2]>n[5]?i[2]:n[5],n}function We(e,t){var n=Tc();if(e.length!=t.length||e[0]!=t[0]||e[1]!=t[1]||e[2]!=t[2]){var r=Math.acos(e[2]),i=Nc(),s=e[0],o=e[1],u=e[2],a=t[0],f=t[1],l=t[2];i[0]=o*l-u*f,i[1]=u*a-s*l,i[2]=s*f-o*a,Pc(i,i),s=Math.cos(r/2),o=Math.sin(r/2)*i[0],u=Math.sin(r/2)*i[1],r=Math.sin(r/2)*i[2],Q(n,0,s*s+o*o-u*u-r*r,2*(o*u-s*r),2*(o*r+s*u),0),Q(n,1,2*(o*u+s*r),s*s+u*u-o*o-r*r,2*(u*r-s*o),0),Q(n,2,2*(o*r-s*u),2*(u*r+s*o),s*s+r*r-u*u-o*o,0)}return r=Sc(),bd(n,r),[n,r]}function Xe(e,n,r,i,s,o,a,f,l){var c=new Ye;Pc(r,r);for(var h=[],p=[],d=0;6>d;d++)for(var v=Math.floor(d/2),m=(v+1)%3,g=(v+2)%3,y=(4+2*v)%6,b=0;2>b;b++){var w=(2+b+2*v)%6,E=-(r[v]*(s[d]-e[v])+r[m]*(s[w]-e[m]))/r[g]+e[g];if(E>=s[y]&&E<=s[y+1]||E<=s[y]&&E>=s[y+1]){var S=[];S[v]=s[d],S[m]=s[w],S[g]=E,h.push(S)}else S=[],S[v]=s[d],S[m]=s[w],S[g]=E,p.push(S)}e=Oc(0,0,1),e=We(r,e),s=e[0],e=e[1],v=[];for(p=0;p<h.length;++p)d=Rc(h[p][0],h[p][1],h[p][2],1),m=Qc(),dd(s,d,m),v.push([m[0],m[1],m[2]]);s=Oc(1,0,0),h=Nc(),cd(e,s,h),p=Oc(0,1,0),s=Nc(),cd(e,p,s),d=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];for(p=p=0;p<v.length;++p)v[p][0]<d[0]&&(d[0]=v[p][0]),v[p][0]>d[1]&&(d[1]=v[p][0]),v[p][1]<d[2]&&(d[2]=v[p][1]),v[p][1]>d[3]&&(d[3]=v[p][1]),v[p][2]<d[4]&&(d[4]=v[p][2]),v[p][2]>d[5]&&(d[5]=v[p][2]);p=Rc(d[0]+(d[1]-d[0])/2,d[2]+(d[3]-d[2])/2,d[4]+(d[5]-d[4])/2,0),v=Qc(),ad(e,p,v),m=Math.floor(d[0]),g=Math.ceil(d[1]),m==g&&g++,y=g-m,b=Math.floor(d[2]),w=Math.ceil(d[3]),b==w&&w++,E=w-b,S=n[0],n=n[1];var p=Math.ceil(y/S),x=Math.ceil(E/n),T=new Uint8Array(4*p*x),N=new hd;N.bf=p,N.af=x;var x=Qc(),C=Rc(0,0,d[4],1),k=Sc();ad(a.Vh,e,k);for(var L=w-1e-7,A=g-1e-7,O=0,M=0,_=0,D=b,D=b;D<=L;D+=n){_++,M=0,C[1]=D;for(p=m;p<=A;p+=S){M++,C[0]=p,dd(k,C,x);var P=4*O,H=Math.floor(x[2]),B=Math.floor(x[1]),j=Math.floor(x[0]);if(0<=j&&j<a.$[0]&&0<=B&&B<a.$[1]&&0<=H&&H<a.$[2]){var F=o[H][B][j],I=j=B=H=0;l?((F=l.get(F))||(F=[0,.61,0,0,1]),H=255*F[1],B=255*F[2],j=255*F[3],I=255*F[4]):(H=B=j=255*((F-a.qa)/(a.fa-a.qa)),I=255),T[P]=H,T[++P]=B,T[++P]=j,T[++P]=I}else T[P]=0,T[++P]=0,T[++P]=0,T[++P]=0;O++}}return N.Wb=T,c.G=N,c.ji=d,c.Xh=e,c.Wh=k,c.ci=b,c.tl=w,c.ii=m,c.zl=g,c.og=M,c.ng=_,c.Wc=S,c.K=y,c.Lc=n,c.A=E,c.z=[v[0],v[1],v[2]],c.ic=[r[0],r[1],r[2]],c.Tc=[h[0],h[1],h[2]],c.ha=[s[0],s[1],s[2]],c.N=u,c.zb=a,c.Cb=a.zb!=t&&!f?u:q,c.gc=i,c.Hb(),c.N=u,c}function af(e,t,n,r){var i;i=r.ka;for(var s=[],o=[],u=0;6>u;u++){var a=Math.floor(u/2),f=(a+1)%3,l=(a+2)%3,c=(2+2*a)%6,h=(4+2*a)%6,p=(i[u]-t[a])*(1/n[a]);if(Infinity!=p&&-Infinity!=p){var d=t[f]+n[f]*p,p=t[l]+n[l]*p;d>=i[c]&&d<=i[c+1]&&p>=i[h]&&p<=i[h+1]?(c=[],c[a]=i[u],c[f]=d,c[l]=p,s.push(c)):(c=[],c[a]=i[u],c[f]=d,c[l]=p,o.push(c))}}i=[s,o],t=i[0],r.b[e].k=i,i=Gc(new O(t[0][0],t[0][1],t[0][2]),new O(t[1][0],t[1][1],t[1][2])),r.b[e].sl=i,s=Oc(0,0,1),o=We(n,s)[0],u=Rc(r.bd[0],r.bd[1],r.bd[2],0),s=Qc(),dd(o,u,s),o=Qc(),u=s[2],o[0]=n[0]*u,o[1]=n[1]*u,o[2]=n[2]*u,o[3]=n[3]*u,.1>Math.abs(s[0])&&(s[0]=.1),.1>Math.abs(s[1])&&(s[1]=.1),s[0]/=r.ce,s[1]/=r.ce,r.b[e].Ea=[Math.abs(s[0]),Math.abs(s[1])],r.b[e].Vc=s[2],r.b[e].B=o,i=Math.floor(Math.abs(i/s[2])),r.vd[e]=i+1,r.b[e].p=i+1,r.b[e].k[0][0][0]>r.b[e].k[0][1][0]?0<o[0]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][0]<r.b[e].k[0][1][0]?0>o[0]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][1]>r.b[e].k[0][1][1]?0<o[1]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][1]<r.b[e].k[0][1][1]?0>o[1]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][2]>r.b[e].k[0][1][2]?0<o[2]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i):r.b[e].k[0][0][2]<r.b[e].k[0][1][2]&&0>o[2]&&(i=r.b[e].k[0][0],r.b[e].k[0][0]=r.b[e].k[0][1],r.b[e].k[0][1]=i),r.b[e].Ye=-(n[0]*t[0][0]+n[1]*t[0][1]+n[2]*t[0][2])}function bf(e,n){var r;r=n.J;for(var i=n.$,s=n.fa,o=n.qa,u=Array(i[2]),a=Array(i[2]),f=i[1]*i[0],l=0,c=0,h=0,p=0,d=0,p=0;p<i[2];p++){var v=r.subarray(p*f,(p+1)*f),d=0;a[p]=Array(i[1]),u[p]=Array(i[1]);for(h=0;h<i[1];h++){a[p][h]=new r.constructor(i[0]),u[p][h]=new r.constructor(i[0]);for(c=0;c<i[0];c++)l=v[d],a[p][h][c]=255*((l-o)/(s-o)),u[p][h][c]=l,d++}}return r=[u,a],n.na=r[0],n.gg=r[1],C.Ha(e.f+".reslice"),n.Q=n.e!=t,n.va&&(n.Le=n.va.Ia),n.Yl=[0,0,0],n.s=[n.Da[0]+(n.gb[0]-1)/2,n.Da[1]+(n.gb[1]-1)/2,n.Da[2]+(n.gb[2]-1)/2],n.ka=[Math.min(n.Da[0],n.Da[0]+n.gb[0]-1),Math.max(n.Da[0],n.Da[0]+n.gb[0]-1),Math.min(n.Da[1],n.Da[1]+n.gb[1]-1),Math.max(n.Da[1],n.Da[1]+n.gb[1]-1),Math.min(n.Da[2],n.Da[2]+n.gb[2]-1),Math.max(n.Da[2],n.Da[2]+n.gb[2]-1)],n.b=[{},{},{}],r=Oc(n.s[0],n.s[1],n.s[2]),n.b[0].wd=r,i=Oc(1,0,0),Pc(i,i),n.b[0].i=i,s=[1,0,0],n.b[0].w=s,af(0,r,i,n),n.c[0].c=Array(n.b[0].p),r[0]=n.b[0].k[0][0][0]+n.b[0].B[0]*Math.floor(n.b[0].p/2),r[1]=n.b[0].k[0][0][1]+n.b[0].B[1]*Math.floor(n.b[0].p/2),r[2]=n.b[0].k[0][0][2]+n.b[0].B[2]*Math.floor(n.b[0].p/2),r=Xe(r,n.b[0].Ea,n.b[0].i,n.b[0].w,n.ka,n.na,n,n.Q,n.Le),n.Q&&(r.e=n.e.c[0].c[Math.floor(n.b[0].p/2)].G),n.c[0].c[Math.floor(n.b[0].p/2)]=r,n.Db=Math.floor(n.b[0].p/2),n.Mc=Math.floor(n.b[0].p/2),r=Oc(n.s[0],n.s[1],n.s[2]),n.b[1].wd=r,i=Oc(0,1,0),Pc(i,i),n.b[1].i=i,s=[0,1,0],n.b[1].w=s,af(1,r,i,n),n.c[1].c=Array(n.b[1].p),r[0]=n.b[1].k[0][0][0]+n.b[1].B[0]*Math.floor(n.b[1].p/2),r[1]=n.b[1].k[0][0][1]+n.b[1].B[1]*Math.floor(n.b[1].p/2),r[2]=n.b[1].k[0][0][2]+n.b[1].B[2]*Math.floor(n.b[1].p/2),r=Xe(r,n.b[1].Ea,n.b[1].i,n.b[1].w,n.ka,n.na,n,n.Q,n.Le),n.Q&&(r.e=n.e.c[1].c[Math.floor(n.b[1].p/2)].G),n.c[1].c[Math.floor(n.b[1].p/2)]=r,n.Eb=Math.floor(n.b[1].p/2),n.Nc=Math.floor(n.b[1].p/2),r=Oc(n.s[0],n.s[1],n.s[2]),n.b[2].wd=r,i=Oc(0,0,1),Pc(i,i),n.b[2].i=i,s=[0,.392,.804],n.b[2].w=s,af(2,r,i,n),n.c[2].c=Array(n.b[2].p),r[0]=n.b[2].k[0][0][0]+n.b[2].B[0]*Math.floor(n.b[2].p/2),r[1]=n.b[2].k[0][0][1]+n.b[2].B[1]*Math.floor(n.b[2].p/2),r[2]=n.b[2].k[0][0][2]+n.b[2].B[2]*Math.floor(n.b[2].p/2),r=Xe(r,n.b[2].Ea,n.b[2].i,n.b[2].w,n.ka,n.na,n,n.Q,n.Le),n.Q&&(r.e=n.e.c[2].c[Math.floor(n.b[2].p/2)].G),n.c[2].c[Math.floor(n.b[2].p/2)]=r,n.Fb=Math.floor(n.b[2].p/2),n.Oc=Math.floor(n.b[2].p/2),C.Ca(e.f+".reslice"),n.na}function cf(){Se.call(this),this.f="parserIMAGE"}function df(e,t){Pe.call(this,e,t),this.f="camera2D"}function ef(){M.call(this),this.f="shaders",this.ee="";var e;e="precision mediump float;\n\n",e+="attribute vec3 vertexPosition;\n",e+="attribute vec3 vertexNormal;\n",e+="attribute vec3 vertexColor;\n",e+="attribute vec2 vertexTexturePos;\n",e+="attribute float vertexScalar;\n",e+="\n",e+="uniform mat4 view;\n",e+="uniform mat4 perspective;\n",e+="uniform vec3 center;\n",e+="uniform mat4 objectTransform;\n",e+="uniform bool useObjectColor;\n",e+="uniform bool useScalars;\n",e+="uniform bool scalarsReplaceMode;\n",e+="uniform float scalarsMin;\n",e+="uniform float scalarsMax;\n",e+="uniform vec3 scalarsMinColor;\n",e+="uniform vec3 scalarsMaxColor;\n",e+="uniform float scalarsMinThreshold;\n",e+="uniform float scalarsMaxThreshold;\n",e+="uniform int scalarsInterpolation;\n",e+="uniform vec3 objectColor;\n",e+="uniform float pointSize;\n",e+="\n",e+="varying float fDiscardNow;\n",e+="varying vec4 fVertexPosition;\n",e+="varying vec3 fragmentColor;\n",e+="varying vec2 fragmentTexturePos;\n",e+="varying vec3 fVertexNormal;\n",e+="varying vec3 fTransformedVertexNormal;\n",e+="\n",e+="void main(void) {\n",e+="  fTransformedVertexNormal = mat3(view[0].xyz,view[1].xyz,view[2].xyz) * ",e+="mat3(objectTransform[0].xyz,objectTransform[1].xyz,objectTransform[2].xyz) * ",e+="vertexNormal;\n",e+="  fVertexNormal = vertexNormal;\n",e+="  fDiscardNow = 0.0;\n",e+="  vec3 vertexPosition2 = vertexPosition - center;\n",e+="  fVertexPosition = view * objectTransform * vec4(vertexPosition2, 1.0);\n",e+="  fragmentTexturePos = vertexTexturePos;\n",e+="  if (useScalars) {\n",e+="    float scalarValue = vertexScalar;\n",e+="    if (scalarValue < scalarsMinThreshold || scalarValue > scalarsMaxThreshold) {\n",e+="      if (scalarsReplaceMode) {\n",e+="        fragmentColor = objectColor;\n",e+="      } else {\n",e+="        fDiscardNow = 1.0;\n",e+="      }\n",e+="    } else {\n",e+="      if (scalarsReplaceMode) {\n",e+="        if (scalarsInterpolation == 1) {\n",e+="            vec3 zeroMaxColor;\n",e+="            vec3 zeroMinColor;\n",e+="            zeroMaxColor[0] = scalarsMaxColor[0]*0.33;\n",e+="            zeroMaxColor[1] = scalarsMaxColor[1]*0.33;\n",e+="            zeroMaxColor[2] = scalarsMaxColor[2]*0.33;\n",e+="            zeroMinColor[0] = scalarsMinColor[0]*0.33;\n",e+="            zeroMinColor[1] = scalarsMinColor[1]*0.33;\n",e+="            zeroMinColor[2] = scalarsMinColor[2]*0.33;\n",e+="            if(scalarValue < 0.0) {fragmentColor = scalarValue/(scalarsMin) * scalarsMinColor + (1.0 - scalarValue/(scalarsMin)) * (zeroMinColor);}\n",e+="            else {fragmentColor = scalarValue/(scalarsMax) * scalarsMaxColor + (1.0 - scalarValue/(scalarsMax)) * (zeroMaxColor);}\n",e+="        } else {\n",e+="            fragmentColor = scalarValue * scalarsMaxColor + (1.0 - scalarValue) * scalarsMinColor;\n",e+="          }\n",e+="      } else {\n",e+="        fragmentColor = vertexColor;\n",e+="      }\n",e+="    }\n",e+="  } else if (useObjectColor) {\n",e+="    fragmentColor = objectColor;\n",e+="  } else {\n",e+="    fragmentColor = vertexColor;\n",e+="  }\n",e+="  gl_PointSize = pointSize;\n",e+="  gl_Position = perspective * fVertexPosition;\n",this.ee=e+="}\n",this.Wd="",e="precision mediump float;\n\n",e+="uniform bool usePicking;\n",e+="uniform bool useTexture;\n",e+="uniform bool volumeTexture;\n",e+="uniform bool useLabelMapTexture;\n",e+="uniform sampler2D textureSampler;\n",e+="uniform sampler2D textureSampler2;\n",e+="uniform float objectOpacity;\n",e+="uniform float labelmapOpacity;\n",e+="uniform vec4 labelmapColor;\n",e+="uniform float volumeLowerThreshold;\n",e+="uniform float volumeUpperThreshold;\n",e+="uniform float volumeScalarMin;\n",e+="uniform float volumeScalarMax;\n",e+="uniform vec3 volumeScalarMinColor;\n",e+="uniform vec3 volumeScalarMaxColor;\n",e+="uniform float volumeWindowLow;\n",e+="uniform float volumeWindowHigh;\n",e+="\n",e+="varying float fDiscardNow;\n",e+="varying vec4 fVertexPosition;\n",e+="varying vec3 fragmentColor;\n",e+="varying vec2 fragmentTexturePos;\n",e+="varying vec3 fVertexNormal;\n",e+="varying vec3 fTransformedVertexNormal;\n",e+="\n",e+="void main(void) {\n",e+=" if (fDiscardNow > 0.0) {\n",e+="   discard;\n",e+=" }\n",e+=" if (usePicking) {\n",e+="   gl_FragColor = vec4(fragmentColor, 1.0);\n",e+=" } else if (useTexture) {\n",e+="   vec4 texture1 = texture2D(textureSampler,fragmentTexturePos);\n",e+="   vec4 textureSum = texture1;\n",e+="   if (volumeTexture) {\n",e+="     float _windowLow = ((volumeWindowLow - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin));\n",e+="     float _windowHigh = ((volumeWindowHigh - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin));\n",e+="     vec3 _minrange = vec3(_windowLow,_windowLow,_windowLow);\n",e+="     vec3 _maxrange = vec3(_windowHigh,_windowHigh,_windowHigh);\n",e+="     vec3 fac = _maxrange - _minrange;\n",e+="     textureSum = vec4((textureSum.r - _minrange)/fac,1);\n",e+="     textureSum = textureSum.r * vec4(volumeScalarMaxColor,1) + (1.0 - textureSum.r) * vec4(volumeScalarMinColor,1);\n",e+="   }\n",e+="   if (useLabelMapTexture) {\n",e+="     vec4 texture2 = texture2D(textureSampler2,fragmentTexturePos);\n",e+="     if (texture2.a > 0.0) {\n",e+="         if (labelmapColor.a != -255.0) {\n",e+="           if (all(equal(floor(texture2 * vec4(255)), labelmapColor))) {\n",e+="             if (labelmapOpacity < 1.0) {\n",e+="               textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n",e+="             } else {\n",e+="               textureSum = texture2;\n",e+="             }\n",e+="           }\n",e+="         } else {\n",e+="           if (labelmapOpacity < 1.0) {\n",e+="             textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n",e+="           } else {\n",e+="             textureSum = texture2;\n",e+="           }\n",e+="         }\n",e+="     }\n",e+="   }\n",e+="   if (volumeTexture) {\n",e+="     float _volumeLowerThreshold = (volumeLowerThreshold - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin);\n",e+="     float _volumeUpperThreshold = (volumeUpperThreshold - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin);\n",e+="     if (texture1.r < _volumeLowerThreshold ||\n",e+="         texture1.r > _volumeUpperThreshold ||\n",e+="         texture1.a == 0.0 ) {\n",e+="       discard;\n",e+="     };\n",e+="   };\n",e+="   gl_FragColor = textureSum;\n",e+="   gl_FragColor.a = objectOpacity;\n",e+=" } else {\n",e+="   vec3 nNormal = normalize(fTransformedVertexNormal);\n",e+="   if (fVertexNormal == vec3(0.0,0.0,0.0)) {\n",e+="     gl_FragColor = vec4(fragmentColor,1.0);\n",e+="     return;\n",e+="   }\n",e+="   vec3 light = vec3(0.0, 0.0, 1.0);\n",e+="   vec3 lightDirection = vec3(0,0,-10);\n",e+="   lightDirection = normalize(lightDirection);\n",e+="   vec3 eyeDirection = normalize(-fVertexPosition.xyz);\n",e+="   vec3 reflectionDirection = reflect(-lightDirection, nNormal);\n",e+="   float specular = pow(max(dot(reflectionDirection, eyeDirection), 0.0), 10.0);\n",e+="   float diffuse = 0.8 * max(dot(nNormal, light), 0.0);\n",e+="   float ambient = 0.3;\n",e+="   gl_FragColor = vec4(fragmentColor * ambient +\n",e+="                       fragmentColor * diffuse +\n",e+="                       vec3(0.2, 0.2, 0.2) * specular,\n",e+="                       objectOpacity);\n",e+=" }\n",this.Wd=e+="}\n"}function Ye(e){T.call(this),this.f="slice",this.z=[0,0,0],this.ic=[0,0,1],this.ha=[0,1,0],this.Tc=[1,0,0],this.A=this.K=10,this.sc=[0,1,0,0,1,1,1,1,1,0,0,0],this.e=this.zb=t,this.Cb=q,this.gc=[1,1,1],e!=t&&this.wc(e)}function N(e){T.call(this),this.f="volume",this.z=[0,0,0],this.$=[10,10,10],this.ka=[1,1,1],this.vd=[10,10,10],this.tb=[1,1,1],this.jb=[],this.Oc=this.Fb=this.Nc=this.Eb=this.Mc=this.Db=0,this.pc=new T,this.qc=new T,this.rc=new T,this.ge=this.Ra=u,this.V=-1,this.fe=[],this.e=t,this.Cb=q,this.ca=Infinity,this.ba=-Infinity,this.Ag=q,this.ce=1,this.fa=0,this.J=t,this.b=[],this.s=[0,0,0],this.gb=[0,0,0],this.bd=[0,0,0],this.na=[],this.gg=[],this.$a=t,Ga(this,new yc),Ga(this,new kd),e!=t&&this.wc(e)}function hf(e,n){if(!e.Td)if(!e.Ra||!e.j&&n==e.V)e.V=n;else if(-1==e.fe.indexOf(n)){e.fe.push(n),e.Td=q;var r=new Qd;r.D=e,e.dispatchEvent(r),e.onComputing(n),setTimeout(function(){var e=t;0<=this.V&&(e=this.c[this.V],e.visible=u);var e=this.c[n],r=e.c.length,i=Math.floor(r/4),s;for(s=0;s<1*i;s++){if(e.c[s]==t){var o=Nc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*s,o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*s,o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*s;if(this.Q){var a=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.e.na,this.e,this.e.Q,this.e.va.Ia);this.e.c[n].c[s]=a,this.e.c[n].q(q)}o=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.na,this,q,t),o.c[0].N=u,this.Q&&(o.e=o.G,o.e=this.e.c[n].c[s].G),e.c[s]=o}e.c[s].N=q}kf(this,.25),setTimeout(function(){for(;s<2*i;s++){if(e.c[s]==t){var o=Nc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*s,o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*s,o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*s;if(this.Q){var a=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.e.na,this.e,this.e.Q,this.e.va.Ia);this.e.c[n].c[s]=a,this.e.c[n].q(q)}o=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.na,this,q,t),o.c[0].N=u,this.Q&&(o.e=o.G,o.e=this.e.c[n].c[s].G),e.c[s]=o}e.c[s].N=q}kf(this,.5),setTimeout(function(){for(;s<3*i;s++){if(e.c[s]==t){var o=Nc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*s,o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*s,o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*s;if(this.Q){var a=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.e.na,this.e,this.e.Q,this.e.va.Ia);this.e.c[n].c[s]=a,this.e.c[n].q(q)}o=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.na,this,q,t),o.c[0].N=u,this.Q&&(o.e=o.G,o.e=this.e.c[n].c[s].G),e.c[s]=o}e.c[s].N=q}kf(this,.75),setTimeout(function(){for(s=3*i;s<r;s++){if(e.c[s]==t){var o=Nc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*s,o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*s,o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*s;if(this.Q){var a=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.e.na,this.e,this.e.Q,this.e.va.Ia);this.e.c[n].c[s]=a,this.e.c[n].q(q)}o=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.na,this,q,t),o.c[0].N=u,this.Q&&(o.e=o.G,o.e=this.e.c[n].c[s].G),e.c[s]=o}e.c[s].N=q}kf(this,1),setTimeout(function(){this.Td&&this.c[n].q(q),this.V=n,this.j=u;if(this.Td){var e=new Sd;e.D=this,this.dispatchEvent(e),this.onComputingEnd(n)}this.Td=u}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(e),10)}else{r=e.c[e.V],r.visible=u;var r=e.c[n],i=r.c.length,s;for(s=0;s<i;s++)r.c[s].N=q;e.V=n,e.j=u}}function kf(e,t){var n=new Rd;n.Bd=t,e.dispatchEvent(n),e.onComputingProgress(100*t)}function lf(){Se.call(this),this.f="parserOFF"}function mf(){Se.call(this),this.f="parserDCM"}function nf(e,t,n,r){switch(n){case 16975:case 20819:case 20053:case 22351:n=function(e){for(var t="",n=128;1<=n;n/=2)t+=e&n?"1":"0";return t},r=e[t++],e=e[t++],r=parseInt(n((e&65280)>>8)+n(e&255)+(n((r&65280)>>8)+n(r&255)),2),4294967295==r&&(r=0),t+=r/2;break;default:t+=r/2}return t}function of(){Se.call(this),this.f="parserVTK"}function pf(e,t){t=t.replace(/^\s+|\s+$/g,"");var n=t.split(" "),r=n.length,i=n[0];switch(i){case"POINTS":e.Ub=q,e.Ob=u,e.Tb=u,n=parseInt(n[1],10),e.Ad=new S(3*n),e.zd=new S(3*n);return;case"VERTICES":e.Ob=q,e.Ub=u,e.Tb=u,n=parseInt(n[1],10),3<=n?e.Pa=jd:1==n?e.Pa="POINTS":m(Error("This VTK file is not supported!")),e.jc=[];return;case"TRIANGLE_STRIPS":e.Ob=q,e.Ub=u,e.Tb=u,e.Pa="TRIANGLE_STRIPS",e.jc=[];return;case"LINES":e.Ob=q,e.Ub=u,e.Tb=u,e.Pa="LINES",e.jc=[];return;case"POLYGONS":e.Ob=q,e.Ub=u,e.Tb=u,e.Pa="POLYGONS",e.jc=[];return;case"POINT_DATA":e.Tb=q,e.Ub=u,e.Ob=u;return}if(e.Ub)if(1==r||isNaN(parseFloat(i)))e.Ub=u;else{if(3<=r){var i=parseFloat(n[0]),s=parseFloat(n[1]),o=parseFloat(n[2]);e.Ad.add(i,s,o)}6<=r&&(i=parseFloat(n[3]),s=parseFloat(n[4]),o=parseFloat(n[5]),e.Ad.add(i,s,o)),9<=r&&(r=parseFloat(n[6]),i=parseFloat(n[7]),n=parseFloat(n[8]),e.Ad.add(r,i,n))}else e.Ob?1==r||isNaN(parseFloat(i))?e.Ob=u:(n=n.slice(1),e.jc.push(n)):e.Tb&&("NORMALS"==i?e.Xe=q:1==r||isNaN(parseFloat(i))?(e.Tb=u,e.Xe=u):e.Xe&&(3<=r&&(i=parseFloat(n[0]),s=parseFloat(n[1]),o=parseFloat(n[2]),e.zd.add(i,s,o)),6<=r&&(i=parseFloat(n[3]),s=parseFloat(n[4]),o=parseFloat(n[5]),e.zd.add(i,s,o)),9<=r&&(r=parseFloat(n[6]),i=parseFloat(n[7]),n=parseFloat(n[8]),e.zd.add(r,i,n))))}function qf(){Se.call(this),this.f="parserFSM",this.Qc=u}function sf(e){var t=e.length,n=0,r=Number.POSITIVE_INFINITY,i,s,o,u,a,f,l,c,h;for(c=0;c<t;++c)e[c]>n&&(n=e[c]),e[c]<r&&(r=e[c]);i=1<<n,s=new Uint32Array(i),o=1,u=0;for(a=2;o<=n;){for(c=0;c<t;++c)if(e[c]===o){f=0,l=u;for(h=0;h<o;++h)f=f<<1|l&1,l>>=1;for(h=f;h<i;h+=a)s[h]=o<<16|c;++u}++o,u<<=1,a<<=1}return[s,n,r]}function tf(e,t){this.mf=[],this.nf=32768,this.ub=this.Cd=this.L=this.$f=0,this.input=new Uint8Array(e),this.Fg=u,this.of=uf,this.Kb=u;if(t||!(t={}))t.index&&(this.L=t.index),t.bufferSize&&(this.nf=t.bufferSize),t.bufferType&&(this.of=t.bufferType),t.resize&&(this.Kb=t.resize);switch(this.of){case vf:this.ja=32768,this.Ua=new Uint8Array(32768+this.nf+258);break;case uf:this.ja=0,this.Ua=new Uint8Array(this.nf),this.yc=this.Ci,this.Ig=this.ri,this.vf=this.wi;break;default:m(Error("invalid inflate mode"))}}function wf(e,t){for(var n=e.Cd,r=e.ub,i=e.input,s=e.L,o;r<t;)o=i[s++],o===p&&m(Error("input buffer is broken")),n|=o<<r,r+=8;return o=n&(1<<t)-1,e.Cd=n>>>t,e.ub=r-t,e.L=s,o}function Lf(e,t){for(var n=e.Cd,r=e.ub,i=e.input,s=e.L,o=t[0],u=t[1],a;r<u;)a=i[s++],a===p&&m(Error("input buffer is broken")),n|=a<<r,r+=8;return i=o[n&(1<<u)-1],o=i>>>16,e.Cd=n>>o,e.ub=r-o,e.L=s,i&65535}function zf(e){function t(e,t,n){var r,i,s;for(s=0;s<e;)switch(r=Lf(this,t),r){case 16:for(r=3+wf(this,2);r--;)n[s++]=i;break;case 17:for(r=3+wf(this,3);r--;)n[s++]=0;i=0;break;case 18:for(r=11+wf(this,7);r--;)n[s++]=0;i=0;break;default:i=n[s++]=r}return n}var n=wf(e,5)+257,r=wf(e,5)+1,i=wf(e,4)+4,s=new Uint8Array(Af.length),o;for(o=0;o<i;++o)s[Af[o]]=wf(e,3);i=sf(s),s=new Uint8Array(n),o=new Uint8Array(r),e.vf(sf(t.call(e,n,i,s)),sf(t.call(e,r,i,o)))}function Rf(){var e=Sf;switch(q){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:m("invalid length: "+e)}}function Vf(){}function Wf(e){this.input=e,this.L=0,this.member=[]}function Xf(){Se.call(this),this.f="parserMGZ",this.Qc=u}function Yf(){Se.call(this),this.f="parserLBL"}function Zf(){Se.call(this),this.f="parserCRV",this.Qc=u}function $f(e,t){var n,r;this.input=e,this.L=0;if(t||!(t={}))t.index&&(this.L=t.index),t.verify&&(this.yk=t.verify);n=e[this.L++],r=e[this.L++];switch(n&15){case 8:this.method=8;break;default:m(Error("unsupported compression method"))}0!==((n<<8)+r)%31&&m(Error("invalid fcheck flag:"+((n<<8)+r)%31)),r&32&&m(Error("fdict flag is not supported")),this.Bh=new tf(e,{index:this.L,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}function ag(){Se.call(this),this.f="parserRAW"}function bg(){Se.call(this),this.f="parserLUT"}function cg(){Se.call(this),this.f="parserMRC"}function dg(){Se.call(this),this.f="parserNRRD"}function eg(){Se.call(this),this.f="parserSTL"}function fg(){Se.call(this),this.f="parserNII"}function gg(e){var t=-1,t="undefined"==typeof DataView?(new Int32Array(e,0,1))[0]:(new DataView(e,0)).getInt32(0,q);return 348==t?q:u}function hg(){Se.call(this),this.f="parserTRK"}function ig(){Se.call(this),this.f="parserOBJ"}function jg(){M.call(this),this.f="loader",this.kc=new Ac,this.ud=0}function kg(e,t){e.ud+=t/e.kc.xf()/3,e.ud=Math.min(1,e.ud);var n=new Pd;n.Bd=e.ud,e.dispatchEvent(n)}function lg(e){e=e.r.be;var t=e.split(".").pop().toUpperCase();if(t==e.toUpperCase()||/^\d+$/.test(t))t="";return t in mg||m(Error("The "+t+" file format is not supported.")),[e,t,mg[t][0],mg[t][1],mg[t][2]]}function ng(e){function t(e,t,r){return t=2*t*Math.PI,t=za(Aa(a,Math.cos(t)),Aa(f,Math.sin(t))),e=za(za(n,Aa(i,e)),Aa(t,s)),r=za(Aa(t,1-Math.abs(r)),Aa(o,r)),new lc(e,r)}this.X=[],e=e||{};var n=new ya(e.start||[0,-1,0]),r=new ya(e.end||[0,1,0]),i=Ca(r,n),s=e.Ab||1;e=e.sa||16;for(var o=Ea(i),u=.5<Math.abs(o.y()),a=Ea((new ya(u,!u,0)).xc(o)),f=Ea(a.xc(o)),u=new lc(n,Fa(o)),r=new lc(r,Ea(o)),l=[],c=0;c<e;c++){var h=c/e,p=(c+1)/e;l.push(new nc([u,t(0,h,-1),t(0,p,-1)])),l.push(new nc([t(0,p,0),t(0,h,0),t(1,h,0),t(1,p,0)])),l.push(new nc([r,t(1,p,1),t(1,h,1)]))}return vc(l)}function og(){T.call(this),this.f="cylinder",this.ff=[-10,-10,-10],this.Ne=[10,10,10],this.mc=10,this.bb=32,Ga(this,new pd)}function pg(e){function t(e,t){e*=2*Math.PI,t*=Math.PI;var i=new ya(Math.cos(e)*Math.sin(t),Math.cos(t),Math.sin(e)*Math.sin(t));o.push(new lc(za(n,Aa(i,r)),i))}this.X=[],e=e||{};var n=new ya(e.qf||[0,0,0]),r=e.Ab||1,i=e.sa||16;e=e.qk||8;for(var s=[],o=[],u=0;u<i;u++)for(var a=0;a<e;a++)o=[],t(u/i,a/e),0<a&&t((u+1)/i,a/e),a<e-1&&t((u+1)/i,(a+1)/e),t(u/i,(a+1)/e),s.push(new nc(o));return vc(s)}function qg(){T.call(this),this.f="sphere",this.z=[0,0,0],this.mc=5,this.bb=32,this.ei=16,Ga(this,new pd)}function jf(e){N.call(this),this.f="labelmap",this.zb=e,this.ef=new Float32Array([-255,-255,-255,-255])}function rg(e){this.X=[],e=e||{};var t=new ya(e.qf||[0,0,0]),n=e.Ab?e.Ab.length?e.Ab:[e.Ab,e.Ab,e.Ab]:[1,1,1];return vc([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(e){return new nc(e[0].map(function(r){return r=new ya(t.x()+n[0]*(2*!!(r&1)-1),t.y()+n[1]*(2*!!(r&2)-1),t.d()+n[2]*(2*!!(r&4)-1)),new lc(r,new ya(e[1]))}))}))}function sg(){T.call(this),this.f="cube",this.z=[0,0,0],this.Ue=this.Te=this.Se=20,this.sc=[0,1,1,1,1,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0],Ga(this,new pd)}function Me(e){Ke.call(this,e),this.f="interactor3D",this.rl=u}function tg(e){M.call(this),this.f="array",this.I=[],this.hg=e}function ug(e,t,n){for(var r=0;4>r;r++)if(e[r+0]!==t[r+n])return u;return q}function vg(e,t,n){var r=n-t;if(!(2>r)){r=t+Math.floor(r/2),vg(e,t,r);for(vg(e,r,n);t<r;++t)if(0<e.hg(e.I[t],e.I[r])){var i=e.I[t];e.I[t]=e.I[r];for(var s=e,o=r,u=n;o+1<u&&0>s.hg(s.I[o+1],i);){var a=s,f=o+1,l=a.I[o];a.I[o]=a.I[f],a.I[f]=l,++o}s.I[o]=i}}}function wg(e){Qb.call(this),this.Ib=e,this.S=[]}function yg(e,t,n,r,i){ja(n)||(xg[0]=n,n=xg);for(var s=0;s<n.length;s++){var o=D(t,n[s],r||e,i||u,e.Ib||e);e.S.push(o)}}function zg(){}function Ag(e){kc.call(this),this.bc=e||$d(),this.ek=Cg}function Dg(){kc.call(this)}function Eg(e,n){return e.Zf==t?n:e.Hd+Math.round((n-e.Hd)/e.Zf)*e.Zf}function Fg(e){Ag.call(this,e),this.Nd=new Dg,D(this.Nd,"change",this.Pi,u,this)}function Hg(e){var t=e.se();e.t().setAttribute("aria-valuenow",t)}function Ig(e,n){e==t&&m(Error("No valid parent element.")),n==t&&m(Error("Invalid initial value.")),Fg.call(this),this.f="progressbar",this.ab=e,this.Ze="",this.Ud=this.Gb=t,this.hc=[];var r;r=".progress-bar-horizontal {\n  position: relative;\n  border: 1px solid #949dad;\n",r+="  background: white;\n",r+="  padding: 1px;\n",r+="  overflow: hidden;\n",r+="  margin: 2px;\n",r+="  width: 100px;\n",r+="  height: 5px;\n",r+="}";var i;i=".progress-bar-thumb {\n  position: relative;\n  background: #F62217;\n",i+="  overflow: hidden;\n",i+="  width: 0%;\n",i+="  height: 100%;\n",i+="}";var s;s=".progress-bar-thumb-done {\n  background: #57E964;\n}",this.hc=[r,i,s],this.Pd(n),this.zf()}function Jg(e){var t=e.t().style.top,n=e.t().style.left;he(e.t());var r=new Ig(e.ab,100),i=r.t();i.style.position="absolute",i.style.top=t,i.style.left=n,i.classList.add("xtk-progress-bar"),(i.firstElementChild!=p?i.firstElementChild:ie(i.firstChild)).classList.add("progress-bar-thumb-done"),e.Ud=r}function Kg(e,t,n){return oa(e)?n&&(e=va(e,n)):e&&"function"==typeof e.handleEvent?e=va(e.handleEvent,e):m(Error("Invalid listener argument")),2147483647<t?-1:ca.setTimeout(e,t||0)}function Lg(){M.call(this),this.f="renderer",this.v=window.document.body,this.K=this.v.clientWidth,this.A=this.v.clientHeight,this.kb=this.M=this.la=t,this.sb=new tg(od),this.Fa=[],this.Y=t,this.ae=this.hd=this.Zd=u,this.a=this.Vb=this.La=t,this.R={PROGRESSBAR_ENABLED:q,INTERMEDIATE_RENDERING:u,SLICENAVIGATORS:q},this.Je=-1,window.console.log("XTK release 10 -- 2015-12-14 17:07:45 -- http://www.goXTK.com -- @goXTK")}function Mg(e,t,n,r,i,s,o,u){var a,f;if(a=n.offsetParent){var l="HTML"==a.tagName||"BODY"==a.tagName;if(!l||"static"!=qe(a,"position"))f=ve(a),l||(l=(l=we(a))&&lb?-a.scrollLeft:l&&(!jb||!Db("8"))&&"visible"!=qe(a,"overflowX")?a.scrollWidth-a.clientWidth-a.scrollLeft:a.scrollLeft,f=Zd(f,new Yd(l,a.scrollTop)))}a=f||new Yd,f=ve(e),l=Ae(e),f=new ne(f.x,f.y,l.width,l.height),(l=ue(e))&&f.Yg(new ne(l.left,l.top,l.right-l.left,l.bottom-l.top));var l=$d(e),c=$d(n);if(l.ia!=c.ia){var h=l.ia.body,c=c.ia.parentWindow||c.ia.defaultView,p=new Yd(0,0),d=be(h)?be(h).parentWindow||be(h).defaultView:window,v=h;do{var m=d==c?ve(v):xe(v);p.x+=m.x,p.y+=m.y}while(d&&d!=c&&(v=d.frameElement)&&(d=d.parent));h=Zd(p,ve(h)),jb&&!ke(l)&&(h=Zd(h,le(l))),f.left+=h.x,f.top+=h.y}e=(t&4&&we(e)?t^2:t)&-5,t=new Yd(e&2?f.left+f.width:f.left,e&1?f.top+f.height:f.top),t=Zd(t,a),i&&(t.x+=(e&2?-1:1)*i.x,t.y+=(e&1?-1:1)*i.y);var g;return o&&(g=ue(n))&&(g.top-=a.y,g.right-=a.x,g.bottom-=a.y,g.left-=a.x),Ng(t,n,r,s,g,o,u)}function Ng(e,t,n,r,i,s,o){e=e.l();var u=0,a=(n&4&&we(t)?n^2:n)&-5;n=Ae(t),o=o?o.l():n.l();if(r||0!=a)a&2?e.x-=o.width+(r?r.right:0):r&&(e.x+=r.left),a&1?e.y-=o.height+(r?r.bottom:0):r&&(e.y+=r.top);if(s){i?(u=e,r=0,65==(s&65)&&(u.x<i.left||u.x>=i.right)&&(s&=-2),132==(s&132)&&(u.y<i.top||u.y>=i.bottom)&&(s&=-5),u.x<i.left&&s&1&&(u.x=i.left,r|=1),u.x<i.left&&u.x+o.width>i.right&&s&16&&(o.width=Math.max(o.width-(u.x+o.width-i.right),0),r|=4),u.x+o.width>i.right&&s&1&&(u.x=Math.max(i.right-o.width,i.left),r|=1),s&2&&(r|=(u.x<i.left?16:0)|(u.x+o.width>i.right?32:0)),u.y<i.top&&s&4&&(u.y=i.top,r|=2),u.y<=i.top&&u.y+o.height<i.bottom&&s&32&&(o.height=Math.max(o.height-(i.top-u.y),0),u.y=0,r|=8),u.y>=i.top&&u.y+o.height>i.bottom&&s&32&&(o.height=Math.max(o.height-(u.y+o.height-i.bottom),0),r|=8),u.y+o.height>i.bottom&&s&4&&(u.y=Math.max(i.bottom-o.height,i.top),r|=2),s&8&&(r|=(u.y<i.top?64:0)|(u.y+o.height>i.bottom?128:0)),u=r):u=256;if(u&496)return u}return s=e,i=lb&&(ab||rb)&&Db("1.9"),s instanceof Yd?(e=s.x,s=s.y):(e=s,s=p),t.style.left=ze(e,i),t.style.top=ze(s,i),n!=o&&(!n||!o?!0:n.width!=o.width||n.height!=o.height)&&(e=ke($d(be(t))),jb&&(!e||!Db("8"))?(n=t.style,e?(jb?(e=Ee(t,"paddingLeft"),i=Ee(t,"paddingRight"),s=Ee(t,"paddingTop"),r=Ee(t,"paddingBottom"),e=new me(s,i,r,e)):(e=pe(t,"paddingLeft"),i=pe(t,"paddingRight"),s=pe(t,"paddingTop"),r=pe(t,"paddingBottom"),e=new me(parseFloat(s),parseFloat(i),parseFloat(r),parseFloat(e))),jb?(i=Ge(t,"borderLeft"),s=Ge(t,"borderRight"),r=Ge(t,"borderTop"),t=Ge(t,"borderBottom"),t=new me(r,s,t,i)):(i=pe(t,"borderLeftWidth"),s=pe(t,"borderRightWidth"),r=pe(t,"borderTopWidth"),t=pe(t,"borderBottomWidth"),t=new me(parseFloat(r),parseFloat(s),parseFloat(t),parseFloat(i))),n.pixelWidth=o.width-t.left-e.left-e.right-t.right,n.pixelHeight=o.height-t.top-e.top-e.bottom-t.bottom):(n.pixelWidth=o.width,n.pixelHeight=o.height)):(t=t.style,lb?t.MozBoxSizing="border-box":mb?t.WebkitBoxSizing="border-box":t.boxSizing="border-box",t.width=Math.max(o.width,0)+"px",t.height=Math.max(o.height,0)+"px")),u}function Og(){}function Pg(e,t){this.sf=e instanceof Yd?e:new Yd(e,t)}function Qg(e,t,n){this.element=e,this.Kg=t,this.Yj=n}function Rg(e,n){kc.call(this),this.Ib=new wg(this),this.Uf(e||t),n&&(this.ad=n)}function Sg(e,t){e.Ge&&e.Ge.stop(),e.te&&e.te.stop();if(t){if(!e.Ma&&e.If()){e.H||m(Error("Caller must call setElement before trying to show the popup")),e.wb();var n=be(e.H);e.Ui&&yg(e.Ib,n,"keydown",e.wj,q);if(e.li)if(yg(e.Ib,n,"mousedown",e.mh,q),jb){var r;try{r=n.activeElement}catch(i){}for(;r&&"IFRAME"==r.nodeName;){try{var s=r.contentDocument||r.contentWindow.document}catch(o){break}n=s,r=n.activeElement}yg(e.Ib,n,"mousedown",e.mh,q),yg(e.Ib,n,"deactivate",e.lh)}else yg(e.Ib,n,"blur",e.lh);"toggle_display"==e.ad?(e.H.style.visibility="visible",Ce(e.H,q)):"move_offscreen"==e.ad&&e.wb(),e.Ma=q,e.Ge?(ac(e.Ge,"end",e.ph,u,e),e.Ge.play()):e.ph()}}else Tg(e)}function Tg(e,t){return!e.Ma||!e.dispatchEvent({type:"beforehide",target:t})?u:(e.Ib&&e.Ib.Tf(),e.Ma=u,e.ah=xa(),e.te?(ac(e.te,"end",wa(e.Jg,t),u,e),e.te.play()):e.Jg(t),q)}function Ug(e,t){this.bk=4,this.ye=t||p,Rg.call(this,e)}function Vg(e){this.da=new Ac,e&&this.jf(e)}function Wg(e){var t=typeof e;return"object"==t&&e||"function"==t?"o"+qa(e):t.substr(0,1)+e}function Xg(e,n,r){this.bc=r||(e?$d(ce(e)):$d()),Ug.call(this,this.bc.Xc("div",{style:"position:absolute;display:none;"})),this.tf=new Yd(1,1),this.le=new Vg,e&&Yg(this,e);if(n!=t)if(e=this.t(),"textContent"in e)e.textContent=n;else if(e.firstChild&&3==e.firstChild.nodeType){for(;e.lastChild!=e.firstChild;)e.removeChild(e.lastChild);e.firstChild.data=n}else{for(;r=e.firstChild;)e.removeChild(r);e.appendChild(be(e).createTextNode(String(n)))}}function Yg(e,t){t=ce(t),e.le.add(t),D(t,"mouseover",e.Si,u,e),D(t,"mouseout",e.Qg,u,e),D(t,"mousemove",e.Ri,u,e),D(t,"focus",e.Qi,u,e),D(t,"blur",e.Qg,u,e)}function dh(e,t){var n=le(e.bc);e.tf.x=t.clientX+n.x,e.tf.y=t.clientY+n.y}function eh(e,n){try{for(;n&&!e.le.contains(n);)n=n.parentNode;return n}catch(r){return t}}function ch(e,t){if(0==t){var n=e.tf.l();return new gh(n)}return new hh(e.Sa)}function fh(e){if(e.anchor)for(var t,n=0;t=Zg[n];n++)je(t.t(),e.anchor)&&(t.Gg=e,e.sh=t)}function ah(e){e.Lb&&(ca.clearTimeout(e.Lb),e.Lb=p)}function bh(e){2==(e.Lb?e.Ma?4:1:e.Zc?3:e.Ma?2:0)&&(e.Zc=Kg(va(e.nj,e,e.anchor),e.Ti))}function $g(e){e.Zc&&(ca.clearTimeout(e.Zc),e.Zc=p)}function gh(e,t){Pg.call(this,e,t)}function hh(e){Qg.call(this,e,3)}function ih(e,n,r,i){e==t&&m(Error("No valid parent element.")),(!na(n)||!na(r))&&m(Error("Invalid coordinates.")),(i==t||!(i instanceof Ke))&&m(Error("Invalid interactor.")),Xg.call(this),this.f="caption",this.ab=e,this.he=n,this.ie=r,this.kb=i,this.Gb=t,this.hc=[],e=".x-tooltip {\n  background: #C0C0FF;\n  color: #000000;\n",e+="  border: 1px solid infotext;\n",e+="  padding: 1px;\n",e+="  font-family: sans-serif;\n",e+="}",this.hc=[e],ac(i,Dd,this.Gd.bind(this)),this.zf()}function jh(){Lg.call(this),this.f="renderer3D",this.md=this.pd=this.ld=this.od=this.kd=this.nd=this.cf=this.df=t,this.z=[0,0,0],this.cd=[0,0,0],this.wg=t,this.Ke=new Ac,this.yd=new Ac,this.uc=new Ac,this.rd=new Ac,this.Jc=new Ac,this.Uc=new Ac,this.tc=new Ac,this.xd=new Ac,this.R={PROGRESSBAR_ENABLED:q,PICKING_ENABLED:q,ORDERING_ENABLED:q,STATISTICS_ENABLED:u,INTERMEDIATE_RENDERING:u}}function kh(){T.call(this),this.f="mesh",Ga(this,new yc)}function lh(){T.call(this),this.f="fibers",Ga(this,new yc)}function Y(){Lg.call(this),this.f="renderer2D",this.Qa=t,this.ya=-1,this.Rc=[],this.pg=this.fd=this.kg=this.Xd=t,this.nc=this.oc=this.Yb=this.Zb=0,this.ba=this.ca=this.U=this.T=this.Me=-1,this.qg=new Float32Array([-255,-255,-255,-255]),this.xg=q,this.Ja=1,this.Ka=[-1,-1,-1,-1,-1,-1,-1],this.Vd=this.Oe=q,this.vl=u}function ph(e){var t=Math.min(e.K/(e.Zb*e.oc),e.A/(e.Yb*e.nc));e.M.o[14]=t}define("utiljs",[],function(){var e=e||{};return e.ab2str=function(e){var t=new Uint8Array(e),n=String.fromCharCode(t[0]);for(var r=1;r<t.byteLength;r++)n+=String.fromCharCode(t[r]);return n},e.str2ab=function(e){var t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(var r=0,i=e.length;r<i;r++)n[r]=e.charCodeAt(r);return t},e.dataURItoJPGBlob=function(e){var t=atob(e.split(",")[1]),n=[];for(var r=0;r<t.length;r++)n.push(t.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})},e.urlToBlob=function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){t(n.response)},n.send()},e.setDropzone=function(e,t){var n;typeof e=="string"?n=document.getElementById(e):n=e,n.ondragenter=function(e){e.preventDefault()},n.ondragover=function(e){e.preventDefault()},n.ondrop=function(e){e.preventDefault();var n=[],r=[];if(!e.dataTransfer.items){if(e.dataTransfer.files){n=e.dataTransfer.files;for(var i=0;i<n.length;i++)!n[i].size&&!n[i].type?alert('It seems that a folder has been dropped: "'+n[i].name+'". Only the Chrome bowser supports dropping of folders. Files inside will be ignored!'):("fullPath"in n[i]||(n[i].fullPath=n[i].name),r.push({url:n[i].fullPath,file:n[i]}));t(r)}return}var s=[],o=function(e){function a(){s[i]=1;for(var e=0;e<s.length;e++)if(s[e]===0)break;if(e>=s.length){for(var o=0;o<n.length;o++)r.push({url:n[o].fullPath,file:n[o]});t(r)}}function f(e){e.readEntries(function(t){if(t.length)u=u.concat(t),f(e);else{var n=u.length;while(n--)o(u[n]);a()}})}var i=s.length,u=[];s[i]=0;if(e.isFile)e.file(function(t){t.fullPath=e.fullPath,n.push(t),a()});else if(e.isDirectory){var l=e.createReader();f(l)}};for(var u=0;u<e.dataTransfer.items.length;u++)o(e.dataTransfer.items[u].webkitGetAsEntry())}},e.documentRepaint=function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},e.strEndsWith=function(e,t){var n;for(var r=0;r<t.length;r++){n=e.lastIndexOf(t[r]);if(n!==-1&&e.length-n===t[r].length)return!0}return!1},e.sortObjArr=function(e,t){return e.sort(function(e,n){var r=[e[t],n[t]].sort();return r[0]===r[1]?0:r[0]===e[t]?-1:1})},e.path2array=function(e){var t=e.split("/");if(t[0]==="."||t[0]==="")t=t.slice(1);return t},e}),define("fmjs",["utiljs","gapi"],function(e){var t=t||{};return t.abstractmethod=function(){throw new Error("abstract method")},t.AbstractFileManager=function(){throw new Error("Can not instantiate abstract classes")},t.AbstractFileManager.prototype.requestFileSystem=t.abstractmethod,t.AbstractFileManager.prototype.isFile=t.abstractmethod,t.AbstractFileManager.prototype.getFileBlob=t.abstractmethod,t.AbstractFileManager.prototype.readFile=t.abstractmethod,t.AbstractFileManager.prototype.writeFile=t.abstractmethod,t.AbstractFileManager.prototype.createPath=t.abstractmethod,t.LocalFileManager=function(){this.fs=null},t.LocalFileManager.prototype=Object.create(t.AbstractFileManager.prototype),t.LocalFileManager.prototype.constructor=t.LocalFileManager,t.LocalFileManager.prototype.requestFileSystem=function(e){var t=this;window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem&&window.requestFileSystem(window.TEMPORARY,5368709120,function(n){t.fs=n,e()},function(e){throw new Error("Could not grant filesystem. Error code: "+e.code)})},t.LocalFileManager.prototype.createPath=function(t,n){function i(){function i(e,t){function r(e){window.console.log("Could not create path. Error code: "+e.code),n&&n(null)}e.getDirectory(t[0],{create:!0,exclusive:!1},function(e){t=t.slice(1),t.length?i(e,t):n&&n(e)},r)}var s=e.path2array(t);i(r.fs,s)}var r=this;this.fs?i():this.requestFileSystem(i)},t.LocalFileManager.prototype.isFile=function(e,t){function r(){function r(e){window.console.log("File not found. Error code: "+e.code),t(null)}n.fs.root.getFile(e,{create:!1},function(e){e.file(function(e){t(e)},r)},r)}var n=this;this.fs?r():this.requestFileSystem(r)},t.LocalFileManager.prototype.readFile=function(e,t){this.getFileBlob(e,function(e){var n=new FileReader;n.onload=function(){t(this.result)},e?n.readAsArrayBuffer(e):t(null)})},t.LocalFileManager.prototype.getFileBlob=function(e,t){function r(){function r(e){window.console.log("Could not retrieve file object. Error code: "+e.code),t(null)}n.fs.root.getFile(e,{create:!1},function(e){e.file(function(e){t(e)},r)},r)}var n=this;this.fs?r():this.requestFileSystem(r)},t.LocalFileManager.prototype.writeFile=function(e,t,n){function i(){function i(e){window.console.log("Could not write file. Error code: "+e.code),n&&n(null)}function s(){r.fs.root.getFile(e,{create:!0},function(e){e.createWriter(function(r){r.onwrite=function(){n&&e.file(function(e){n(e)},i)},r.onerror=function(e){window.console.log("Could not write file. Error code: "+e.toString()),n&&n(null)};var s=new BlobBuilder;s.append(t);var o=s.getBlob();r.write(o)},i)},i)}var o=e.substring(0,e.lastIndexOf("/"));r.fs.getDirectory(o,{create:!1},function(){s()},function(e){e.code===FileError.NOT_FOUND_ERR?r.createPath(o,s):i(e)})}var r=this;this.fs?i():this.requestFileSystem(i)},t.GDriveFileManager=function(e){this.CLIENT_ID=e,this.SCOPES=["https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive.readonly"],this.clientOAuthAPILoaded=!1,this.driveAPILoaded=!1,this.userInfo=null},t.GDriveFileManager.prototype=Object.create(t.AbstractFileManager.prototype),t.GDriveFileManager.prototype.constructor=t.GDriveFileManager,t.GDriveFileManager.prototype.requestFileSystem=function(e,t){function r(){t(!0)}function i(){n.authorize(e,function(e){e?n.loadApi(r):t(!1)})}var n=this;n.clientOAuthAPILoaded?i():gapi.load("auth:client",function(){n.clientOAuthAPILoaded=!0,i()})},t.GDriveFileManager.prototype.authorize=function(e,t){var n=this;n.clientOAuthAPILoaded&&gapi.auth.authorize({client_id:n.CLIENT_ID,scope:n.SCOPES,immediate:e},function(e){e&&!e.error?t(!0):t(!1)})},t.GDriveFileManager.prototype.loadApi=function(e){var t=this;this.clientOAuthAPILoaded&&(this.driveAPILoaded?e():gapi.client.load("drive","v2",function(){t.driveAPILoaded=!0,e()}))},t.GDriveFileManager.prototype.execGDriveRequest=function(e,t){function i(){e.execute(function(s){s.error?(++r,s.error.code===401?n.authorize(!0,function(n){n?e.execute(function(e){t(e)}):(console.error("Authorization failed. No access token could be retrieved!"),t(s))}):r<=5?window.setTimeout(i,Math.floor(1e3*Math.pow(2,r-1)+Math.random()*100)):(console.error(s.error.message),t(s))):t(s)})}var n=this,r=0;i()},t.GDriveFileManager.prototype.createPath=function(t,n){function i(e,t){var s=gapi.client.drive.children.list({folderId:e.id,q:"mimeType='application/vnd.google-apps.folder' and title='"+t[0]+"'"});r.execGDriveRequest(s,function(s){if(!s.error)if(s.items.length===0){var o=gapi.client.drive.files.insert({resource:{title:t[0],mimeType:"application/vnd.google-apps.folder",parents:[{id:e.id}]}});r.execGDriveRequest(o,function(e){e.error?(console.log("Error: ",e.error),n&&n(null)):(t=t.slice(1),t.length?i(e,t):n&&n(e))})}else t=t.slice(1),t.length?i(s.items[0],t):n&&n(s.items[0]);else console.log("Error: ",s.error),n&&n(null)})}var r=this;if(this.driveAPILoaded){var s=e.path2array(t);s.length?i({id:"root"},s):n&&n(null)}else console.error("GDrive Api not loaded")},t.GDriveFileManager.prototype.isFile=function(t,n){function i(e,s){var o;s.length===1?o=gapi.client.drive.children.list({folderId:e.id,q:"mimeType!='application/vnd.google-apps.folder' and title='"+s[0]+"'"}):o=gapi.client.drive.children.list({folderId:e.id,q:"mimeType='application/vnd.google-apps.folder' and title='"+s[0]+"'"}),r.execGDriveRequest(o,function(e){e.error?(console.log("Error: ",e.error),n(null)):e.items.length===0?(console.log("File "+t+" not found!"),n(null)):(s=s.slice(1),s.length?i(e.items[0],s):r.getFileMeta(e.items[0].id,function(e){n(e)}))})}var r=this;if(this.driveAPILoaded){var s=e.path2array(t);s.length?i({id:"root"},s):n(null)}else console.error("GDrive Api not loaded")},t.GDriveFileManager.prototype.getFileMeta=function(e,t){if(this.driveAPILoaded){var n=gapi.client.drive.files.get({fileId:e});this.execGDriveRequest(n,function(n){n.error?(console.error("Could not retrive file with id "+e),t(null)):t(n)})}else console.error("GDrive Api not loaded")},t.GDriveFileManager.prototype.readFile=function(e,t){var n=this;this.isFile(e,function(e){e&&!e.error?n.readFileByID(e.id,t):t(null)})},t.GDriveFileManager.prototype.readFileByID=function(e,t){var n=new FileReader;n.onload=function(){t(n.result)},this.getFileBlob(e,function(e){e?n.readAsArrayBuffer(e):t(null)})},t.GDriveFileManager.prototype.getFileBlob=function(e,t){function i(){r.getFileMeta(e,function(e){var r=gapi.auth.getToken().access_token,s=new XMLHttpRequest;s.open("GET",e.downloadUrl),s.setRequestHeader("Authorization","Bearer "+r),s.responseType="blob",s.onload=function(){t(s.response)},s.onerror=function(){++n,n<=5?window.setTimeout(i,Math.floor(1e3*Math.pow(2,n-1)+Math.random()*100)):(window.console.log("Could not read file: "+e.title+" with id: "+e.id),t(null))},s.send()})}var n=0,r=this;i()},t.GDriveFileManager.prototype.writeFile=function(t,n,r){function s(s){if(s&&!s.error){var o="-------314159265358979323846",u="\r\n--"+o+"\r\n",a="\r\n--"+o+"--",f=n.type||"application/octet-stream",l=n.name||t.substring(t.lastIndexOf("/")+1),c={title:l,mimeType:f,parents:[{id:s.id}]},h=btoa(e.ab2str(n)),p=u+"Content-Type: application/json\r\n\r\n"+JSON.stringify(c)+u+"Content-Type: "+f+"\r\n"+"Content-Transfer-Encoding: base64\r\n"+"\r\n"+h+a,d=gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+o+'"'},body:p});i.execGDriveRequest(d,function(e){r&&r(e)})}}var i=this,o=t.substring(0,t.lastIndexOf("/"));this.createPath(o,s)},t.GDriveFileManager.prototype.createFile=function(e,t,n){var r=e.lastIndexOf("/"),i=e.substring(0,r),s=e.substring(r+1),o=this;this.createPath(i,function(e){if(e&&!e.error){var r=gapi.client.drive.files.insert({resource:{mimeType:t,title:s,parents:[{id:e.id}]}});o.execGDriveRequest(r,function(e){n&&n(e)})}})},t.GDriveFileManager.prototype.shareFile=function(e,t,n){var r=this;this.isFile(e,function(i){i&&!i.error?r.shareFileById(i.id,t,n):console.error("File "+e+" not found")})},t.GDriveFileManager.prototype.shareFileById=function(e,t,n){if(this.driveAPILoaded){var r=gapi.client.drive.permissions.insert({fileId:e,resource:{value:t.value,type:t.type,role:t.role}});this.execGDriveRequest(r,function(t){t.error?(console.error("Could not share file with id "+e),n&&n(null)):n&&n(t)})}else console.error("GDrive Api not loaded")},t.GDriveFileManager.prototype.getUserInfo=function(e){var t=this;if(this.userInfo)e(this.userInfo);else if(this.driveAPILoaded){var n=gapi.client.drive.about.get();this.execGDriveRequest(n,function(n){if(!n.error){var r={id:n.permissionId,name:n.name,mail:n.user.emailAddress};t.userInfo=r,e(r)}else console.error("Could not retrieve current user info"),e(null)})}else console.error("GDrive Api not loaded")},t}),define("gcjs",["fmjs"],function(e){var t=t||{};return t.GDriveCollab=function(t){this.realtimeFileId="",this.realtimeFilePath="/realtimeviewer/model/collab.realtime",this.REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk",this.dataFilesBaseDir="/realtimeviewer/data",this.fileManager=new e.GDriveFileManager(t),this.fileManager.SCOPES.push("https://www.googleapis.com/auth/gmail.send"),this.model=null,this.doc=null,this.collabIsOn=!1,this.collabOwner=!1,this.collaboratorInfo={id:"",name:"",mail:""}},t.GDriveCollab.prototype.authorizeAndLoadApi=function(e,t){this.fileManager.requestFileSystem(e,function(e){e?gapi.load("drive-realtime",function(){gapi.client.load("gmail","v1",function(){t(!0)})}):t(!1)})},t.GDriveCollab.prototype.createRealtimeFile=function(e,t){this.fileManager.createFile(e,this.REALTIME_MIMETYPE,function(e){t&&t(e)})},t.GDriveCollab.prototype.startRealtimeCollaboration=function(e){function n(e){t._onFileLoaded(e)}function r(n){t._initializeModel(n),n.getRoot().get("collabMap").set("collabObj",e)}function i(e){t._handleErrors(e)}var t=this;e&&t.createRealtimeFile(t.realtimeFilePath,function(e){var s={value:"",type:"anyone",role:"writer"};t.collabOwner=!0,t.fileManager.shareFileById(e.id,s,function(){t.realtimeFileId=e.id,gapi.drive.realtime.load(e.id,n,r,i)})})},t.GDriveCollab.prototype.joinRealtimeCollaboration=function(e){function n(e){t._onFileLoaded(e)}function r(e){t._initializeModel(e)}function i(e){t._handleErrors(e)}var t=this;e&&(t.realtimeFileId=e,gapi.drive.realtime.load(e,n,r,i))},t.GDriveCollab.prototype.leaveRealtimeCollaboration=function(){this.doc&&(this.doc.close(),this.realtimeFileId="",this.doc=null,this.model=null,this.collabIsOn=!1,this.collabOwner=!1)},t.GDriveCollab.prototype.sendRealtimeFileId=function(e,t){if(this.collabOwner&&this.collabIsOn&&e.length){var n="to: ";for(var r=0;r<e.length-1;r++)n+=e[r]+", ";n+=e[e.length-1]+"\n",n+="subject: Collaboration room id: "+this.realtimeFileId+"\n\n",n+="Collaboration room id: "+this.realtimeFileId+"\n\nSee you there!";var i=btoa(n),s=gapi.client.gmail.users.messages.send({userId:"me",resource:{raw:i}});this.fileManager.execGDriveRequest(s,function(e){t&&t(e)})}},t.GDriveCollab.prototype.setCollabObj=function(e){this.model&&e&&this.model.getRoot().get("collabMap").set("collabObj",e)},t.GDriveCollab.prototype.getCollabObj=function(){if(this.model)return this.model.getRoot().get("collabMap").get("collabObj")},t.GDriveCollab.prototype.getCollaboratorList=function(){if(this.model)return this.model.getRoot().get("collaboratorList").asArray()},t.GDriveCollab.prototype.setDataFileList=function(e){if(this.model&&this.collabOwner){this.model.getRoot().get("collabDataFileList").pushAll(e);var t=this.model.getRoot().get("collaboratorList");for(var n=0;n<t.length;n++)this.shareDataFiles(t.get(n))}},t.GDriveCollab.prototype.shareDataFiles=function(e){if(this.model&&this.collabOwner){var t=0,n={value:e.mail,type:"user",role:"reader"},r,i=this.model.getRoot().get("collabDataFileList"),s=this.model.getRoot().get("collaboratorList"),o,u=function(){++t===i.length&&s.set(a,{id:e.id,name:e.name,mail:e.mail,hasDataFilesAccess:!0})};for(var a=0;a<s.length;a++){o=s.get(a);if(o.id===e.id&&!o.hasDataFilesAccess)break}if(a<=s.length)for(var f=0;f<i.length;f++)r=i.get(f).id,this.fileManager.shareFileById(r,n,u)}},t.GDriveCollab.prototype.sendChatMsg=function(e){this.model&&e&&this.model.getRoot().get("chatList").push({user:this.collaboratorInfo.name,msg:e})},t.GDriveCollab.prototype.onConnect=function(e){console.log("onConnect NOT overwritten. "+e.name+": has connected!")},t.GDriveCollab.prototype.onDisconnect=function(e){console.log("onDisconnect NOT overwritten. "+e.name+": has disconnected!")},t.GDriveCollab.prototype.onCollabObjChanged=function(e){console.log("onCollabObjChanged NOT overwritten. Collaboration object:",e)},t.GDriveCollab.prototype.onDataFilesShared=function(e,t){console.log("onDataFilesShared NOT overwritten."),console.log("Shared collaborator info:",e),console.log("Shared file array:",t)},t.GDriveCollab.prototype.onNewChatMessage=function(e){console.log("onNewChatMessage NOT overwritten. New chat msg object:",e)},t.GDriveCollab.prototype._initializeModel=function(e){var t=e.createMap(),n=e.createList(),r=e.createList(),i=e.createList();e.getRoot().set("collabMap",t),e.getRoot().set("collabDataFileList",n),e.getRoot().set("collaboratorList",r),e.getRoot().set("chatList",i)},t.GDriveCollab.prototype._onFileLoaded=function(e){var t=this,n=e.getModel(),r=n.getRoot().get("collabMap"),i=n.getRoot().get("collabDataFileList"),s=n.getRoot().get("collaboratorList"),o=n.getRoot().get("chatList");s.addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED,function(e){t.shareDataFiles(e.values[0]),e.isLocal&&(t.collabIsOn=!0),t.onConnect(e.values[0])}),s.addEventListener(gapi.drive.realtime.EventType.VALUES_SET,function(e){var n=[];for(var r=0;r<i.length;r++)n.push(i.get(r));t.onDataFilesShared(e.newValues[0],n)}),s.addEventListener(gapi.drive.realtime.EventType.VALUES_REMOVED,function(e){t.onDisconnect(e.values[0])}),e.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_LEFT,function(e){var t=e.collaborator.sessionId,n;for(var r=0;r<s.length;r++){n=s.get(r);if(n.id===t){s.remove(r);break}}}),r.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,function(e){e.isLocal||t.onCollabObjChanged(r.get("collabObj"))}),o.addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED,function(e){e.isLocal||t.onNewChatMessage(e.values[0])}),t.model=n,t.doc=e,t.fileManager.getUserInfo(function(n){var r={id:"",name:n.name,mail:n.mail,hasDataFilesAccess:!1},i=e.getCollaborators();for(var o=0;o<i.length;o++)i[o].isMe&&(r.id=i[o].sessionId);t.collabOwner&&(r.hasDataFilesAccess=!0),t.collaboratorInfo=r,s.push(r)})},t.GDriveCollab.prototype._handleErrors=function(e){var t=this;e.type===gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED?t.fileManager.authorize(!0,function(e){e?console.log("Auth token successfuly refreshed!"):console.error("Could not refresh auth token!")}):e.type===gapi.drive.realtime.ErrorType.CLIENT_ERROR?(alert("An Error happened: "+e.message),window.location.href="/"):e.type===gapi.drive.realtime.ErrorType.NOT_FOUND&&(alert("The file was not found. It does not exist or you do not have read access to the file."),window.location.href="/")},t}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("jszip",[],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.JSZip=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=t[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){"use strict";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e,t){var n="",i,s,o,u,a,f,l,c=0;while(c<e.length)i=e.charCodeAt(c++),s=e.charCodeAt(c++),o=e.charCodeAt(c++),u=i>>2,a=(i&3)<<4|s>>4,f=(s&15)<<2|o>>6,l=o&63,isNaN(s)?f=l=64:isNaN(o)&&(l=64),n=n+r.charAt(u)+r.charAt(a)+r.charAt(f)+r.charAt(l);return n},n.decode=function(e,t){var n="",i,s,o,u,a,f,l,c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length)u=r.indexOf(e.charAt(c++)),a=r.indexOf(e.charAt(c++)),f=r.indexOf(e.charAt(c++)),l=r.indexOf(e.charAt(c++)),i=u<<2|a>>4,s=(a&15)<<4|f>>2,o=(f&3)<<6|l,n+=String.fromCharCode(i),f!=64&&(n+=String.fromCharCode(s)),l!=64&&(n+=String.fromCharCode(o));return n}},{}],2:[function(e,t,n){"use strict";function r(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}r.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=r},{}],3:[function(e,t,n){"use strict";n.STORE={magic:"\0\0",compress:function(e,t){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},n.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t,n){"use strict";var r=e("./utils"),i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(t,n){if(typeof t=="undefined"||!t.length)return 0;var s=r.getTypeOf(t)!=="string";typeof n=="undefined"&&(n=0);var o=0,u=0,a=0;n^=-1;for(var f=0,l=t.length;f<l;f++)a=s?t[f]:t.charCodeAt(f),u=(n^a)&255,o=i[u],n=n>>>8^o;return n^-1}},{"./utils":21}],5:[function(e,t,n){"use strict";function i(e){this.data=null,this.length=0,this.index=0}var r=e("./utils");i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,n;this.checkOffset(e);for(n=this.index+e-1;n>=this.index;n--)t=(t<<8)+this.byteAt(n);return this.index+=e,t},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date((e>>25&127)+1980,(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(e&31)<<1)}},t.exports=i},{"./utils":21}],6:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!1,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],7:[function(e,t,n){"use strict";var r=e("./utils");n.string2binary=function(e){return r.string2binary(e)},n.string2Uint8Array=function(e){return r.transformTo("uint8array",e)},n.uint8Array2String=function(e){return r.transformTo("string",e)},n.string2Blob=function(e){var t=r.transformTo("arraybuffer",e);return r.arrayBuffer2Blob(t)},n.arrayBuffer2Blob=function(e){return r.arrayBuffer2Blob(e)},n.transformTo=function(e,t){return r.transformTo(e,t)},n.getTypeOf=function(e){return r.getTypeOf(e)},n.checkSupport=function(e){return r.checkSupport(e)},n.MAX_VALUE_16BITS=r.MAX_VALUE_16BITS,n.MAX_VALUE_32BITS=r.MAX_VALUE_32BITS,n.pretty=function(e){return r.pretty(e)},n.findCompression=function(e){return r.findCompression(e)},n.isRegExp=function(e){return r.isRegExp(e)}},{"./utils":21}],8:[function(e,t,n){"use strict";var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Uint32Array!="undefined",i=e("pako");n.uncompressInputType=r?"uint8array":"array",n.compressInputType=r?"uint8array":"array",n.magic="\b\0",n.compress=function(e,t){return i.deflateRaw(e,{level:t.level||-1})},n.uncompress=function(e){return i.inflateRaw(e)}},{pako:24}],9:[function(e,t,n){"use strict";function i(e,t){if(!(this instanceof i))return new i(e,t);this.files={},this.comment=null,this.root="",e&&this.load(e,t),this.clone=function(){var e=new i;for(var t in this)typeof this[t]!="function"&&(e[t]=this[t]);return e}}var r=e("./base64");i.prototype=e("./object"),i.prototype.load=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.utils=e("./deprecatedPublicUtils"),i.base64={encode:function(e){return r.encode(e)},decode:function(e){return r.decode(e)}},i.compressions=e("./compressions"),t.exports=i},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t,n){"use strict";var r=e("./base64"),i=e("./zipEntries");t.exports=function(e,t){var n,s,o,u;t=t||{},t.base64&&(e=r.decode(e)),s=new i(e,t),n=s.files;for(o=0;o<n.length;o++)u=n[o],this.file(u.fileName,u.decompressed,{binary:!0,optimizedBinaryString:!0,date:u.date,dir:u.dir,comment:u.fileComment.length?u.fileComment:null,unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions,createFolders:t.createFolders});return s.zipComment.length&&(this.comment=s.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,t,n){(function(e){"use strict";t.exports=function(t,n){return new e(t,n)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,typeof Buffer!="undefined"?Buffer:undefined)},{}],12:[function(e,t,n){"use strict";function i(e){this.data=e,this.length=this.data.length,this.index=0}var r=e("./uint8ArrayReader");i.prototype=new r,i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=i},{"./uint8ArrayReader":18}],13:[function(e,t,n){"use strict";var r=e("./support"),i=e("./utils"),s=e("./crc32"),o=e("./signature"),u=e("./defaults"),a=e("./base64"),f=e("./compressions"),l=e("./compressedObject"),c=e("./nodeBuffer"),h=e("./utf8"),p=e("./stringWriter"),d=e("./uint8ArrayWriter"),v=function(e){if(e._data instanceof l){e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1;if(i.getTypeOf(e._data)==="uint8array"){var t=e._data;e._data=new Uint8Array(t.length),t.length!==0&&e._data.set(t,0)}}return e._data},m=function(e){var t=v(e),n=i.getTypeOf(t);if(n==="string")return!e.options.binary&&r.nodebuffer?c(t,"utf-8"):e.asBinary();return t},g=function(e){var t=v(this);return t===null||typeof t=="undefined"?"":(this.options.base64&&(t=a.decode(t)),e&&this.options.binary?t=O.utf8decode(t):t=i.transformTo("string",t),!e&&!this.options.binary&&(t=i.transformTo("string",O.utf8encode(t))),t)},y=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this.options=n,this._initialMetadata={dir:n.dir,date:n.date}};y.prototype={asText:function(){return g.call(this,!0)},asBinary:function(){return g.call(this,!1)},asNodeBuffer:function(){var e=m(this);return i.transformTo("nodebuffer",e)},asUint8Array:function(){var e=m(this);return i.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var b=function(e,t){var n="",r;for(r=0;r<t;r++)n+=String.fromCharCode(e&255),e>>>=8;return n},w=function(){var e={},t,n;for(t=0;t<arguments.length;t++)for(n in arguments[t])arguments[t].hasOwnProperty(n)&&typeof e[n]=="undefined"&&(e[n]=arguments[t][n]);return e},E=function(e){return e=e||{},e.base64===!0&&(e.binary===null||e.binary===undefined)&&(e.binary=!0),e=w(e,u),e.date=e.date||new Date,e.compression!==null&&(e.compression=e.compression.toUpperCase()),e},S=function(e,t,n){var r=i.getTypeOf(t),s;n=E(n),typeof n.unixPermissions=="string"&&(n.unixPermissions=parseInt(n.unixPermissions,8)),n.unixPermissions&&n.unixPermissions&16384&&(n.dir=!0),n.dosPermissions&&n.dosPermissions&16&&(n.dir=!0),n.dir&&(e=T(e)),n.createFolders&&(s=x(e))&&N.call(this,s,!0);if(n.dir||t===null||typeof t=="undefined")n.base64=!1,n.binary=!1,t=null,r=null;else if(r==="string")n.binary&&!n.base64&&n.optimizedBinaryString!==!0&&(t=i.string2binary(t));else{n.base64=!1,n.binary=!0;if(!r&&!(t instanceof l))throw new Error("The data of '"+e+"' is in an unsupported format !");r==="arraybuffer"&&(t=i.transformTo("uint8array",t))}var o=new y(e,t,n);return this.files[e]=o,o},x=function(e){e.slice(-1)=="/"&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},T=function(e){return e.slice(-1)!="/"&&(e+="/"),e},N=function(e,t){return t=typeof t!="undefined"?t:!1,e=T(e),this.files[e]||S.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},C=function(e,t,n){var r=new l,o;if(e._data instanceof l)r.uncompressedSize=e._data.uncompressedSize,r.crc32=e._data.crc32,r.uncompressedSize===0||e.dir?(t=f.STORE,r.compressedContent="",r.crc32=0):e._data.compressionMethod===t.magic?r.compressedContent=e._data.getCompressedContent():(o=e._data.getContent(),r.compressedContent=t.compress(i.transformTo(t.compressInputType,o),n));else{o=m(e);if(!o||o.length===0||e.dir)t=f.STORE,o="";r.uncompressedSize=o.length,r.crc32=s(o),r.compressedContent=t.compress(i.transformTo(t.compressInputType,o),n)}return r.compressedSize=r.compressedContent.length,r.compressionMethod=t.magic,r},k=function(e,t){var n=e;return e||(n=t?16893:33204),(n&65535)<<16},L=function(e,t){return(e||0)&63},A=function(e,t,n,r,u){var a=n.compressedContent,f=i.transformTo("string",h.utf8encode(t.name)),l=t.comment||"",c=i.transformTo("string",h.utf8encode(l)),p=f.length!==t.name.length,d=c.length!==l.length,v=t.options,m,g,y="",w="",E="",S,x;t._initialMetadata.dir!==t.dir?S=t.dir:S=v.dir,t._initialMetadata.date!==t.date?x=t.date:x=v.date;var T=0,N=0;S&&(T|=16),u==="UNIX"?(N=798,T|=k(t.unixPermissions,S)):(N=20,T|=L(t.dosPermissions,S)),m=x.getHours(),m<<=6,m|=x.getMinutes(),m<<=5,m|=x.getSeconds()/2,g=x.getFullYear()-1980,g<<=4,g|=x.getMonth()+1,g<<=5,g|=x.getDate(),p&&(w=b(1,1)+b(s(f),4)+f,y+="up"+b(w.length,2)+w),d&&(E=b(1,1)+b(this.crc32(c),4)+c,y+="uc"+b(E.length,2)+E);var C="";C+="\n\0",C+=p||d?"\0\b":"\0\0",C+=n.compressionMethod,C+=b(m,2),C+=b(g,2),C+=b(n.crc32,4),C+=b(n.compressedSize,4),C+=b(n.uncompressedSize,4),C+=b(f.length,2),C+=b(y.length,2);var A=o.LOCAL_FILE_HEADER+C+f+y,O=o.CENTRAL_FILE_HEADER+b(N,2)+C+b(c.length,2)+"\0\0"+"\0\0"+b(T,4)+b(r,4)+f+y+c;return{fileRecord:A,dirRecord:O,compressedObject:n}},O={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t=[],n,r,i,s;for(n in this.files){if(!this.files.hasOwnProperty(n))continue;i=this.files[n],s=new y(i.name,i._data,w(i.options)),r=n.slice(this.root.length,n.length),n.slice(0,this.root.length)===this.root&&e(r,s)&&t.push(s)}return t},file:function(e,t,n){if(arguments.length===1){if(i.isRegExp(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}return this.filter(function(t,n){return!n.dir&&t===e})[0]||null}return e=this.root+e,S.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(i.isRegExp(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=N.call(this,t),r=this.clone();return r.root=n.name,r},remove:function(e){e=this.root+e;var t=this.files[e];t||(e.slice(-1)!="/"&&(e+="/"),t=this.files[e]);if(t&&!t.dir)delete this.files[e];else{var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e});for(var r=0;r<n.length;r++)delete this.files[n[r].name]}return this},generate:function(e){e=w(e||{},{base64:!0,compression:"STORE",compressionOptions:null,type:"base64",platform:"DOS",comment:null,mimeType:"application/zip"}),i.checkSupport(e.type);if(e.platform==="darwin"||e.platform==="freebsd"||e.platform==="linux"||e.platform==="sunos")e.platform="UNIX";e.platform==="win32"&&(e.platform="DOS");var t=[],n=0,r=0,s,u,l=i.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var c in this.files){if(!this.files.hasOwnProperty(c))continue;var h=this.files[c],v=h.options.compression||e.compression.toUpperCase(),m=f[v];if(!m)throw new Error(v+" is not a valid compression method !");var g=h.options.compressionOptions||e.compressionOptions||{},y=C.call(this,h,m,g),E=A.call(this,c,h,y,n,e.platform);n+=E.fileRecord.length+y.compressedSize,r+=E.dirRecord.length,t.push(E)}var S="";S=o.CENTRAL_DIRECTORY_END+"\0\0"+"\0\0"+b(t.length,2)+b(t.length,2)+b(r,4)+b(n,4)+b(l.length,2)+l;var x=e.type.toLowerCase();x==="uint8array"||x==="arraybuffer"||x==="blob"||x==="nodebuffer"?s=new d(n+r+S.length):s=new p(n+r+S.length);for(u=0;u<t.length;u++)s.append(t[u].fileRecord),s.append(t[u].compressedObject.compressedContent);for(u=0;u<t.length;u++)s.append(t[u].dirRecord);s.append(S);var T=s.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return i.transformTo(e.type.toLowerCase(),T);case"blob":return i.arrayBuffer2Blob(i.transformTo("arraybuffer",T),e.mimeType);case"base64":return e.base64?a.encode(T):T;default:return T}},crc32:function(e,t){return s(e,t)},utf8encode:function(e){return i.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=O},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},{}],15:[function(e,t,n){"use strict";function s(e,t){this.data=e,t||(this.data=i.string2binary(this.data)),this.length=this.data.length,this.index=0}var r=e("./dataReader"),i=e("./utils");s.prototype=new r,s.prototype.byteAt=function(e){return this.data.charCodeAt(e)},s.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},s.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=s},{"./dataReader":5,"./utils":21}],16:[function(e,t,n){"use strict";var r=e("./utils"),i=function(){this.data=[]};i.prototype={append:function(e){e=r.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=i},{"./utils":21}],17:[function(e,t,n){(function(e){"use strict";n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined",n.nodebuffer=typeof e!="undefined",n.uint8array=typeof Uint8Array!="undefined";if(typeof ArrayBuffer=="undefined")n.blob=!1;else{var t=new ArrayBuffer(0);try{n.blob=(new Blob([t],{type:"application/zip"})).size===0}catch(r){try{var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,s=new i;s.append(t),n.blob=s.getBlob("application/zip").size===0}catch(r){n.blob=!1}}}}).call(this,typeof Buffer!="undefined"?Buffer:undefined)},{}],18:[function(e,t,n){"use strict";function i(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}var r=e("./dataReader");i.prototype=new r,i.prototype.byteAt=function(e){return this.data[e]},i.prototype.lastIndexOfSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),r=e.charCodeAt(2),i=e.charCodeAt(3);for(var s=this.length-4;s>=0;--s)if(this.data[s]===t&&this.data[s+1]===n&&this.data[s+2]===r&&this.data[s+3]===i)return s;return-1},i.prototype.readData=function(e){this.checkOffset(e);if(e===0)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=i},{"./dataReader":5}],19:[function(e,t,n){"use strict";var r=e("./utils"),i=function(e){this.data=new Uint8Array(e),this.index=0};i.prototype={append:function(e){e.length!==0&&(e=r.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=i},{"./utils":21}],20:[function(e,t,n){"use strict";var r=e("./utils"),i=e("./support"),s=e("./nodeBuffer"),o=new Array(256);for(var u=0;u<256;u++)o[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;o[254]=o[254]=1;var a=function(e){var t,n,r,s,o,u=e.length,a=0;for(s=0;s<u;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<u&&(r=e.charCodeAt(s+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),s++)),a+=n<128?1:n<2048?2:n<65536?3:4;i.uint8array?t=new Uint8Array(a):t=new Array(a);for(o=0,s=0;o<a;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<u&&(r=e.charCodeAt(s+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),s++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|n&63):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|n&63):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|n&63);return t},f=function(e,t){var n;t=t||e.length,t>e.length&&(t=e.length),n=t-1;while(n>=0&&(e[n]&192)===128)n--;return n<0?t:n===0?t:n+o[e[n]]>t?n:t},l=function(e){var t,n,i,s,u,a=e.length,f=new Array(a*2);for(i=0,n=0;n<a;){s=e[n++];if(s<128){f[i++]=s;continue}u=o[s];if(u>4){f[i++]=65533,n+=u-1;continue}s&=u===2?31:u===3?15:7;while(u>1&&n<a)s=s<<6|e[n++]&63,u--;if(u>1){f[i++]=65533;continue}s<65536?f[i++]=s:(s-=65536,f[i++]=55296|s>>10&1023,f[i++]=56320|s&1023)}return f.length!==i&&(f.subarray?f=f.subarray(0,i):f.length=i),r.applyFromCharCode(f)};n.utf8encode=function(t){return i.nodebuffer?s(t,"utf-8"):a(t)},n.utf8decode=function(t){if(i.nodebuffer)return r.transformTo("nodebuffer",t).toString("utf-8");t=r.transformTo(i.uint8array?"uint8array":"array",t);var n=[],s=0,o=t.length,u=65536;while(s<o){var a=f(t,Math.min(s+u,o));i.uint8array?n.push(l(t.subarray(s,a))):n.push(l(t.slice(s,a))),s=a}return n.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,n){"use strict";function o(e){return e}function u(e,t){for(var n=0;n<e.length;++n)t[n]=e.charCodeAt(n)&255;return t}function a(e){var t=65536,r=[],i=e.length,o=n.getTypeOf(e),u=0,a=!0;try{switch(o){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,s(0))}}catch(f){a=!1}if(!a){var l="";for(var c=0;c<e.length;c++)l+=String.fromCharCode(e[c]);return l}while(u<i&&t>1)try{o==="array"||o==="nodebuffer"?r.push(String.fromCharCode.apply(null,e.slice(u,Math.min(u+t,i)))):r.push(String.fromCharCode.apply(null,e.subarray(u,Math.min(u+t,i)))),u+=t}catch(f){t=Math.floor(t/2)}return r.join("")}function f(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}var r=e("./support"),i=e("./compressions"),s=e("./nodeBuffer");n.string2binary=function(e){var t="";for(var n=0;n<e.length;n++)t+=String.fromCharCode(e.charCodeAt(n)&255);return t},n.arrayBuffer2Blob=function(e,t){n.checkSupport("blob"),t=t||"application/zip";try{return new Blob([e],{type:t})}catch(r){try{var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,s=new i;return s.append(e),s.getBlob(t)}catch(r){throw new Error("Bug : can't construct the Blob.")}}},n.applyFromCharCode=a;var l={};l.string={string:o,array:function(e){return u(e,new Array(e.length))},arraybuffer:function(e){return l.string.uint8array(e).buffer},uint8array:function(e){return u(e,new Uint8Array(e.length))},nodebuffer:function(e){return u(e,s(e.length))}},l.array={string:a,array:o,arraybuffer:function(e){return(new Uint8Array(e)).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s(e)}},l.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return f(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:o,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return s(new Uint8Array(e))}},l.uint8array={string:a,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:o,nodebuffer:function(e){return s(e)}},l.nodebuffer={string:a,array:function(e){return f(e,new Array(e.length))},arraybuffer:function(e){return l.nodebuffer.uint8array(e).buffer},uint8array:function(e){return f(e,new Uint8Array(e.length))},nodebuffer:o},n.transformTo=function(e,t){t||(t="");if(!e)return t;n.checkSupport(e);var r=n.getTypeOf(t),i=l[r][e](t);return i},n.getTypeOf=function(e){if(typeof e=="string")return"string";if(Object.prototype.toString.call(e)==="[object Array]")return"array";if(r.nodebuffer&&s.test(e))return"nodebuffer";if(r.uint8array&&e instanceof Uint8Array)return"uint8array";if(r.arraybuffer&&e instanceof ArrayBuffer)return"arraybuffer"},n.checkSupport=function(e){var t=r[e.toLowerCase()];if(!t)throw new Error(e+" is not supported by this browser")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t="",n,r;for(r=0;r<(e||"").length;r++)n=e.charCodeAt(r),t+="\\x"+(n<16?"0":"")+n.toString(16).toUpperCase();return t},n.findCompression=function(e){for(var t in i){if(!i.hasOwnProperty(t))continue;if(i[t].magic===e)return i[t]}return null},n.isRegExp=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t,n){"use strict";function c(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}var r=e("./stringReader"),i=e("./nodeBufferReader"),s=e("./uint8ArrayReader"),o=e("./utils"),u=e("./signature"),a=e("./zipEntry"),f=e("./support"),l=e("./object");c.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=l.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};var e=this.zip64EndOfCentralSize-44,t=0,n,r,i;while(t<e)n=this.reader.readInt(2),r=this.reader.readInt(4),i=this.reader.readString(r),this.zip64ExtensibleData[n]={id:n,length:r,value:i}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4);if(this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(u.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;this.reader.setIndex(this.centralDirOffset);while(this.reader.readString(4)===u.CENTRAL_FILE_HEADER)e=new a({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(u.CENTRAL_DIRECTORY_END);if(e===-1){var t=!0;try{this.reader.setIndex(0),this.checkSignature(u.LOCAL_FILE_HEADER),t=!1}catch(n){}throw t?new Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip : can't find end of central directory")}this.reader.setIndex(e),this.checkSignature(u.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral();if(this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){this.zip64=!0,e=this.reader.lastIndexOfSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(e===-1)throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(u.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=o.getTypeOf(e);t==="string"&&!f.uint8array?this.reader=new r(e,this.loadOptions.optimizedBinaryString):t==="nodebuffer"?this.reader=new i(e):this.reader=new s(o.transformTo("uint8array",e))},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=c},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t,n){"use strict";function f(e,t){this.options=e,this.loadOptions=t}var r=e("./stringReader"),i=e("./utils"),s=e("./compressedObject"),o=e("./object"),u=0,a=3;f.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},prepareCompressedContent:function(e,t,n){return function(){var r=e.index;e.setIndex(t);var i=e.readData(n);return e.setIndex(r),i}},prepareContent:function(e,t,n,r,s){return function(){var e=i.transformTo(r.uncompressInputType,this.getCompressedContent()),t=r.uncompress(e);if(t.length!==s)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,n;e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(n);if(this.compressedSize==-1||this.uncompressedSize==-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");t=i.findCompression(this.compressionMethod);if(t===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");this.decompressed=new s,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize);if(this.loadOptions.checkCRC32){this.decompressed=i.transformTo("string",this.decompressed.getContent());if(o.crc32(this.decompressed)!==this.crc32)throw new Error("Corrupted zip : CRC32 mismatch")}},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4);if(this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=this.externalFileAttributes&16?!0:!1,e===u&&(this.dosPermissions=this.externalFileAttributes&63),e===a&&(this.unixPermissions=this.externalFileAttributes>>16&65535),!this.dir&&this.fileName.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(e){if(!this.extraFields[1])return;var t=new r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))},readExtraFields:function(e){var t=e.index,n,r,i;this.extraFields=this.extraFields||{};while(e.index<t+this.extraFieldsLength)n=e.readInt(2),r=e.readInt(2),i=e.readString(r),this.extraFields[n]={id:n,length:r,value:i}},handleUTF8:function(){if(this.useUTF8())this.fileName=o.utf8decode(this.fileName),this.fileComment=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();e!==null&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();t!==null&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new r(e.value);return t.readInt(1)!==1?null:o.crc32(this.fileName)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new r(e.value);return t.readInt(1)!==1?null:o.crc32(this.fileComment)!==t.readInt(4)?null:o.utf8decode(t.readString(e.length-5))}return null}},t.exports=f},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t,n){var r=e("./lib/utils/common").assign,i=e("./lib/deflate"),s=e("./lib/inflate"),o=e("./lib/zlib/constants"),u={};r(u,i,s,o),t.exports=u},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,n){"use strict";function m(e,t){var n=new v(t);n.push(e,!0);if(n.err)throw n.msg;return n.result}function g(e,t){return t=t||{},t.raw=!0,m(e,t)}function y(e,t){return t=t||{},t.gzip=!0,m(e,t)}var r=e("./zlib/deflate.js"),i=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/messages"),u=e("./zlib/zstream"),a=0,f=4,l=0,c=1,h=-1,p=0,d=8,v=function(e){this.options=i.assign({level:h,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==l)throw new Error(o[n]);t.header&&r.deflateSetHeader(this.strm,t.header)};v.prototype.push=function(e,t){var n=this.strm,o=this.options.chunkSize,u,h;if(this.ended)return!1;h=t===~~t?t:t===!0?f:a,typeof e=="string"?n.input=s.string2buf(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{n.avail_out===0&&(n.output=new i.Buf8(o),n.next_out=0,n.avail_out=o),u=r.deflate(n,h);if(u!==c&&u!==l)return this.onEnd(u),this.ended=!0,!1;if(n.avail_out===0||n.avail_in===0&&h===f)this.options.to==="string"?this.onData(s.buf2binstring(i.shrinkBuf(n.output,n.next_out))):this.onData(i.shrinkBuf(n.output,n.next_out))}while((n.avail_in>0||n.avail_out===0)&&u!==c);return h===f?(u=r.deflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===l):!0},v.prototype.onData=function(e){this.chunks.push(e)},v.prototype.onEnd=function(e){e===l&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=v,n.deflate=m,n.deflateRaw=g,n.gzip=y},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,n){"use strict";function c(e,t){var n=new l(t);n.push(e,!0);if(n.err)throw n.msg;return n.result}function h(e,t){return t=t||{},t.raw=!0,c(e,t)}var r=e("./zlib/inflate.js"),i=e("./utils/common"),s=e("./utils/strings"),o=e("./zlib/constants"),u=e("./zlib/messages"),a=e("./zlib/zstream"),f=e("./zlib/gzheader"),l=function(e){this.options=i.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&(!e||!e.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,t.windowBits);if(n!==o.Z_OK)throw new Error(u[n]);this.header=new f,r.inflateGetHeader(this.strm,this.header)};l.prototype.push=function(e,t){var n=this.strm,u=this.options.chunkSize,a,f,l,c,h;if(this.ended)return!1;f=t===~~t?t:t===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof e=="string"?n.input=s.binstring2buf(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{n.avail_out===0&&(n.output=new i.Buf8(u),n.next_out=0,n.avail_out=u),a=r.inflate(n,o.Z_NO_FLUSH);if(a!==o.Z_STREAM_END&&a!==o.Z_OK)return this.onEnd(a),this.ended=!0,!1;n.next_out&&(n.avail_out===0||a===o.Z_STREAM_END||n.avail_in===0&&f===o.Z_FINISH)&&(this.options.to==="string"?(l=s.utf8border(n.output,n.next_out),c=n.next_out-l,h=s.buf2string(n.output,l),n.next_out=c,n.avail_out=u-c,c&&i.arraySet(n.output,n.output,l,c,0),this.onData(h)):this.onData(i.shrinkBuf(n.output,n.next_out)))}while(n.avail_in>0&&a!==o.Z_STREAM_END);return a===o.Z_STREAM_END&&(f=o.Z_FINISH),f===o.Z_FINISH?(a=r.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===o.Z_OK):!0},l.prototype.onData=function(e){this.chunks.push(e)},l.prototype.onEnd=function(e){e===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=l,n.inflate=c,n.inflateRaw=h,n.ungzip=c},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,n){"use strict";var r=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";n.assign=function(e){var t=Array.prototype.slice.call(arguments,1);while(t.length){var n=t.shift();if(!n)continue;if(typeof n!="object")throw new TypeError(n+"must be non-object");for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray){e.set(t.subarray(n,n+r),i);return}for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){var t,n,r,i,s,o;r=0;for(t=0,n=e.length;t<n;t++)r+=e[t].length;o=new Uint8Array(r),i=0;for(t=0,n=e.length;t<n;t++)s=e[t],o.set(s,i),i+=s.length;return o}},s={arraySet:function(e,t,n,r,i){for(var s=0;s<r;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],28:[function(e,t,n){function f(e,t){if(t<65537)if(e.subarray&&s||!e.subarray&&i)return String.fromCharCode.apply(null,r.shrinkBuf(e,t));var n="";for(var o=0;o<t;o++)n+=String.fromCharCode(e[o]);return n}var r=e("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(o){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(o){s=!1}var u=new r.Buf8(256);for(var a=0;a<256;a++)u[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;u[254]=u[254]=1,n.string2buf=function(e){var t,n,i,s,o,u=e.length,a=0;for(s=0;s<u;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<u&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),a+=n<128?1:n<2048?2:n<65536?3:4;t=new r.Buf8(a);for(o=0,s=0;o<a;s++)n=e.charCodeAt(s),(n&64512)===55296&&s+1<u&&(i=e.charCodeAt(s+1),(i&64512)===56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|n&63):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|n&63):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|n&63);return t},n.buf2binstring=function(e){return f(e,e.length)},n.binstring2buf=function(e){var t=new r.Buf8(e.length);for(var n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,i,s,o=t||e.length,a=new Array(o*2);for(r=0,n=0;n<o;){i=e[n++];if(i<128){a[r++]=i;continue}s=u[i];if(s>4){a[r++]=65533,n+=s-1;continue}i&=s===2?31:s===3?15:7;while(s>1&&n<o)i=i<<6|e[n++]&63,s--;if(s>1){a[r++]=65533;continue}i<65536?a[r++]=i:(i-=65536,a[r++]=55296|i>>10&1023,a[r++]=56320|i&1023)}return f(a,r)},n.utf8border=function(e,t){var n;t=t||e.length,t>e.length&&(t=e.length),n=t-1;while(n>=0&&(e[n]&192)===128)n--;return n<0?t:n===0?t:n+u[e[n]]>t?n:t}},{"./common":27}],29:[function(e,t,n){"use strict";function r(e,t,n,r){var i=e&65535|0,s=e>>>16&65535|0,o=0;while(n!==0){o=n>2e3?2e3:n,n-=o;do i=i+t[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0}t.exports=r},{}],30:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t,n){"use strict";function r(){var e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=e&1?3988292384^e>>>1:e>>>1;t[n]=e}return t}function s(e,t,n,r){var s=i,o=r+n;e^=-1;for(var u=r;u<o;u++)e=e>>>8^s[(e^t[u])&255];return e^-1}var i=r();t.exports=s},{}],32:[function(e,t,n){"use strict";function Y(e,t){return e.msg=u[t],t}function Z(e){return(e<<1)-(e>4?9:0)}function et(e){var t=e.length;while(--t>=0)e[t]=0}function tt(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out);if(n===0)return;r.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0)}function nt(e,t){i._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,tt(e.strm)}function rt(e,t){e.pending_buf[e.pending++]=t}function it(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=t&255}function st(e,t,n,i){var u=e.avail_in;return u>i&&(u=i),u===0?0:(e.avail_in-=u,r.arraySet(t,e.input,e.next_in,u,n),e.state.wrap===1?e.adler=s(e.adler,t,u,n):e.state.wrap===2&&(e.adler=o(e.adler,t,u,n)),e.next_in+=u,e.total_in+=u,u)}function ot(e,t){var n=e.max_chain_length,r=e.strstart,i,s,o=e.prev_length,u=e.nice_match,a=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0,f=e.window,l=e.w_mask,c=e.prev,h=e.strstart+j,p=f[r+o-1],d=f[r+o];e.prev_length>=e.good_match&&(n>>=2),u>e.lookahead&&(u=e.lookahead);do{i=t;if(f[i+o]!==d||f[i+o-1]!==p||f[i]!==f[r]||f[++i]!==f[r+1])continue;r+=2,i++;do;while(f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&f[++r]===f[++i]&&r<h);s=j-(h-r),r=h-j;if(s>o){e.match_start=t,o=s;if(s>=u)break;p=f[r+o-1],d=f[r+o]}}while((t=c[t&l])>a&&--n!==0);return o<=e.lookahead?o:e.lookahead}function ut(e){var t=e.w_size,n,i,s,o,u;do{o=e.window_size-e.lookahead-e.strstart;if(e.strstart>=t+(t-F)){r.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,n=i;do s=e.head[--n],e.head[n]=s>=t?s-t:0;while(--i);i=t,n=i;do s=e.prev[--n],e.prev[n]=s>=t?s-t:0;while(--i);o+=t}if(e.strm.avail_in===0)break;i=st(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i;if(e.lookahead+e.insert>=B){u=e.strstart-e.insert,e.ins_h=e.window[u],e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+1])&e.hash_mask;while(e.insert){e.ins_h=(e.ins_h<<e.hash_shift^e.window[u+B-1])&e.hash_mask,e.prev[u&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=u,u++,e.insert--;if(e.lookahead+e.insert<B)break}}}while(e.lookahead<F&&e.strm.avail_in!==0)}function at(e,t){var n=65535;n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);for(;;){if(e.lookahead<=1){ut(e);if(e.lookahead===0&&t===a)return $;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if(e.strstart===0||e.strstart>=r){e.lookahead=e.strstart-r,e.strstart=r,nt(e,!1);if(e.strm.avail_out===0)return $}if(e.strstart-e.block_start>=e.w_size-F){nt(e,!1);if(e.strm.avail_out===0)return $}}e.insert=0;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.strstart>e.block_start){nt(e,!1);if(e.strm.avail_out===0)return $}return $}function ft(e,t){var n,r;for(;;){if(e.lookahead<F){ut(e);if(e.lookahead<F&&t===a)return $;if(e.lookahead===0)break}n=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-F&&(e.match_length=ot(e,n));if(e.match_length>=B){r=i._tr_tally(e,e.strstart-e.match_start,e.match_length-B),e.lookahead-=e.match_length;if(e.match_length<=e.max_lazy_match&&e.lookahead>=B){e.match_length--;do e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask}else r=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r){nt(e,!1);if(e.strm.avail_out===0)return $}}e.insert=e.strstart<B-1?e.strstart:B-1;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.last_lit){nt(e,!1);if(e.strm.avail_out===0)return $}return J}function lt(e,t){var n,r,s;for(;;){if(e.lookahead<F){ut(e);if(e.lookahead<F&&t===a)return $;if(e.lookahead===0)break}n=0,e.lookahead>=B&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=B-1,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-F&&(e.match_length=ot(e,n),e.match_length<=5&&(e.strategy===b||e.match_length===B&&e.strstart-e.match_start>4096)&&(e.match_length=B-1));if(e.prev_length>=B&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-B,r=i._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-B),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+B-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);e.match_available=0,e.match_length=B-1,e.strstart++;if(r){nt(e,!1);if(e.strm.avail_out===0)return $}}else if(e.match_available){r=i._tr_tally(e,0,e.window[e.strstart-1]),r&&nt(e,!1),e.strstart++,e.lookahead--;if(e.strm.avail_out===0)return $}else e.match_available=1,e.strstart++,e.lookahead--}e.match_available&&(r=i._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<B-1?e.strstart:B-1;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.last_lit){nt(e,!1);if(e.strm.avail_out===0)return $}return J}function ct(e,t){var n,r,s,o,u=e.window;for(;;){if(e.lookahead<=j){ut(e);if(e.lookahead<=j&&t===a)return $;if(e.lookahead===0)break}e.match_length=0;if(e.lookahead>=B&&e.strstart>0){s=e.strstart-1,r=u[s];if(r===u[++s]&&r===u[++s]&&r===u[++s]){o=e.strstart+j;do;while(r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&r===u[++s]&&s<o);e.match_length=j-(o-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}}e.match_length>=B?(n=i._tr_tally(e,1,e.match_length-B),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++);if(n){nt(e,!1);if(e.strm.avail_out===0)return $}}e.insert=0;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.last_lit){nt(e,!1);if(e.strm.avail_out===0)return $}return J}function ht(e,t){var n;for(;;){if(e.lookahead===0){ut(e);if(e.lookahead===0){if(t===a)return $;break}}e.match_length=0,n=i._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n){nt(e,!1);if(e.strm.avail_out===0)return $}}e.insert=0;if(t===c)return nt(e,!0),e.strm.avail_out===0?K:Q;if(e.last_lit){nt(e,!1);if(e.strm.avail_out===0)return $}return J}function vt(e){e.window_size=2*e.w_size,et(e.head),e.max_lazy_match=dt[e.level].max_lazy,e.good_match=dt[e.level].good_length,e.nice_match=dt[e.level].nice_length,e.max_chain_length=dt[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=B-1,e.match_available=0,e.ins_h=0}function mt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=N,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(P*2),this.dyn_dtree=new r.Buf16((2*_+1)*2),this.bl_tree=new r.Buf16((2*D+1)*2),et(this.dyn_ltree),et(this.dyn_dtree),et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(H+1),this.heap=new r.Buf16(2*M+1),et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*M+1),et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function gt(e){var t;return!e||!e.state?Y(e,v):(e.total_in=e.total_out=0,e.data_type=T,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?q:X,e.adler=t.wrap===2?0:1,t.last_flush=a,i._tr_init(t),p)}function yt(e){var t=gt(e);return t===p&&vt(e.state),t}function bt(e,t){return!e||!e.state?v:e.state.wrap!==2?v:(e.state.gzhead=t,p)}function wt(e,t,n,i,s,o){if(!e)return v;var u=1;t===y&&(t=6),i<0?(u=0,i=-i):i>15&&(u=2,i-=16);if(s<1||s>C||n!==N||i<8||i>15||t<0||t>9||o<0||o>S)return Y(e,v);i===8&&(i=9);var a=new mt;return e.state=a,a.strm=e,a.wrap=u,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+B-1)/B),a.window=new r.Buf8(a.w_size*2),a.head=new r.Buf16(a.hash_size),a.prev=new r.Buf16(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new r.Buf8(a.pending_buf_size),a.d_buf=a.lit_bufsize>>1,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=o,a.method=n,yt(e)}function Et(e,t){return wt(e,t,N,k,L,x)}function St(e,t){var n,r,s,u;if(!e||!e.state||t>h||t<0)return e?Y(e,v):v;r=e.state;if(!e.output||!e.input&&e.avail_in!==0||r.status===V&&t!==c)return Y(e,e.avail_out===0?g:v);r.strm=e,n=r.last_flush,r.last_flush=t;if(r.status===q)if(r.wrap===2)e.adler=0,rt(r,31),rt(r,139),rt(r,8),r.gzhead?(rt(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),rt(r,r.gzhead.time&255),rt(r,r.gzhead.time>>8&255),rt(r,r.gzhead.time>>16&255),rt(r,r.gzhead.time>>24&255),rt(r,r.level===9?2:r.strategy>=w||r.level<2?4:0),rt(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(rt(r,r.gzhead.extra.length&255),rt(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=o(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=R):(rt(r,0),rt(r,0),rt(r,0),rt(r,0),rt(r,0),rt(r,r.level===9?2:r.strategy>=w||r.level<2?4:0),rt(r,G),r.status=X);else{var m=N+(r.w_bits-8<<4)<<8,y=-1;r.strategy>=w||r.level<2?y=0:r.level<6?y=1:r.level===6?y=2:y=3,m|=y<<6,r.strstart!==0&&(m|=I),m+=31-m%31,r.status=X,it(r,m),r.strstart!==0&&(it(r,e.adler>>>16),it(r,e.adler&65535)),e.adler=1}if(r.status===R)if(r.gzhead.extra){s=r.pending;while(r.gzindex<(r.gzhead.extra.length&65535)){if(r.pending===r.pending_buf_size){r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),tt(e),s=r.pending;if(r.pending===r.pending_buf_size)break}rt(r,r.gzhead.extra[r.gzindex]&255),r.gzindex++}r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=U)}else r.status=U;if(r.status===U)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size){r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),tt(e),s=r.pending;if(r.pending===r.pending_buf_size){u=1;break}}r.gzindex<r.gzhead.name.length?u=r.gzhead.name.charCodeAt(r.gzindex++)&255:u=0,rt(r,u)}while(u!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),u===0&&(r.gzindex=0,r.status=z)}else r.status=z;if(r.status===z)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size){r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),tt(e),s=r.pending;if(r.pending===r.pending_buf_size){u=1;break}}r.gzindex<r.gzhead.comment.length?u=r.gzhead.comment.charCodeAt(r.gzindex++)&255:u=0,rt(r,u)}while(u!==0);r.gzhead.hcrc&&r.pending>s&&(e.adler=o(e.adler,r.pending_buf,r.pending-s,s)),u===0&&(r.status=W)}else r.status=W;r.status===W&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&tt(e),r.pending+2<=r.pending_buf_size&&(rt(r,e.adler&255),rt(r,e.adler>>8&255),e.adler=0,r.status=X)):r.status=X);if(r.pending!==0){tt(e);if(e.avail_out===0)return r.last_flush=-1,p}else if(e.avail_in===0&&Z(t)<=Z(n)&&t!==c)return Y(e,g);if(r.status===V&&e.avail_in!==0)return Y(e,g);if(e.avail_in!==0||r.lookahead!==0||t!==a&&r.status!==V){var b=r.strategy===w?ht(r,t):r.strategy===E?ct(r,t):dt[r.level].func(r,t);if(b===K||b===Q)r.status=V;if(b===$||b===K)return e.avail_out===0&&(r.last_flush=-1),p;if(b===J){t===f?i._tr_align(r):t!==h&&(i._tr_stored_block(r,0,0,!1),t===l&&(et(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),tt(e);if(e.avail_out===0)return r.last_flush=-1,p}}return t!==c?p:r.wrap<=0?d:(r.wrap===2?(rt(r,e.adler&255),rt(r,e.adler>>8&255),rt(r,e.adler>>16&255),rt(r,e.adler>>24&255),rt(r,e.total_in&255),rt(r,e.total_in>>8&255),rt(r,e.total_in>>16&255),rt(r,e.total_in>>24&255)):(it(r,e.adler>>>16),it(r,e.adler&65535)),tt(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?p:d)}function xt(e){var t;return!e||!e.state?v:(t=e.state.status,t!==q&&t!==R&&t!==U&&t!==z&&t!==W&&t!==X&&t!==V?Y(e,v):(e.state=null,t===X?Y(e,m):p))}var r=e("../utils/common"),i=e("./trees"),s=e("./adler32"),o=e("./crc32"),u=e("./messages"),a=0,f=1,l=3,c=4,h=5,p=0,d=1,v=-2,m=-3,g=-5,y=-1,b=1,w=2,E=3,S=4,x=0,T=2,N=8,C=9,k=15,L=8,A=29,O=256,M=O+1+A,_=30,D=19,P=2*M+1,H=15,B=3,j=258,F=j+B+1,I=32,q=42,R=69,U=73,z=91,W=103,X=113,V=666,$=1,J=2,K=3,Q=4,G=3,pt=function(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i},dt;dt=[new pt(0,0,0,0,at),new pt(4,4,8,4,ft),new pt(4,5,16,8,ft),new pt(4,6,32,32,ft),new pt(4,4,16,16,lt),new pt(8,16,32,32,lt),new pt(8,16,128,128,lt),new pt(8,32,128,256,lt),new pt(32,128,258,1024,lt),new pt(32,258,258,4096,lt)],n.deflateInit=Et,n.deflateInit2=wt,n.deflateReset=yt,n.deflateResetKeep=gt,n.deflateSetHeader=bt,n.deflate=St,n.deflateEnd=xt,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t,n){"use strict";function r(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=r},{}],34:[function(e,t,n){"use strict";var r=30,i=12;t.exports=function(t,n){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;s=t.state,o=t.next_in,L=t.input,u=o+(t.avail_in-5),a=t.next_out,A=t.output,f=a-(n-t.avail_out),l=a+(t.avail_out-257),c=s.dmax,h=s.wsize,p=s.whave,d=s.wnext,v=s.window,m=s.hold,g=s.bits,y=s.lencode,b=s.distcode,w=(1<<s.lenbits)-1,E=(1<<s.distbits)-1;e:do{g<15&&(m+=L[o++]<<g,g+=8,m+=L[o++]<<g,g+=8),S=y[m&w];t:for(;;){x=S>>>24,m>>>=x,g-=x,x=S>>>16&255;if(x===0)A[a++]=S&65535;else{if(!(x&16)){if((x&64)===0){S=y[(S&65535)+(m&(1<<x)-1)];continue t}if(x&32){s.mode=i;break e}t.msg="invalid literal/length code",s.mode=r;break e}T=S&65535,x&=15,x&&(g<x&&(m+=L[o++]<<g,g+=8),T+=m&(1<<x)-1,m>>>=x,g-=x),g<15&&(m+=L[o++]<<g,g+=8,m+=L[o++]<<g,g+=8),S=b[m&E];n:for(;;){x=S>>>24,m>>>=x,g-=x,x=S>>>16&255;if(!(x&16)){if((x&64)===0){S=b[(S&65535)+(m&(1<<x)-1)];continue n}t.msg="invalid distance code",s.mode=r;break e}N=S&65535,x&=15,g<x&&(m+=L[o++]<<g,g+=8,g<x&&(m+=L[o++]<<g,g+=8)),N+=m&(1<<x)-1;if(N>c){t.msg="invalid distance too far back",s.mode=r;break e}m>>>=x,g-=x,x=a-f;if(N>x){x=N-x;if(x>p&&s.sane){t.msg="invalid distance too far back",s.mode=r;break e}C=0,k=v;if(d===0){C+=h-x;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}else if(d<x){C+=h+d-x,x-=d;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=0;if(d<T){x=d,T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}}else{C+=d-x;if(x<T){T-=x;do A[a++]=v[C++];while(--x);C=a-N,k=A}}while(T>2)A[a++]=k[C++],A[a++]=k[C++],A[a++]=k[C++],T-=3;T&&(A[a++]=k[C++],T>1&&(A[a++]=k[C++]))}else{C=a-N;do A[a++]=A[C++],A[a++]=A[C++],A[a++]=A[C++],T-=3;while(T>2);T&&(A[a++]=A[C++],T>1&&(A[a++]=A[C++]))}break}}break}}while(o<u&&a<l);T=g>>3,o-=T,g-=T<<3,m&=(1<<g)-1,t.next_in=o,t.next_out=a,t.avail_in=o<u?5+(u-o):5-(o-u),t.avail_out=a<l?257+(l-a):257-(a-l),s.hold=m,s.bits=g;return}},{}],35:[function(e,t,n){"use strict";function it(e){return(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24)}function st(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ot(e){var t;return!e||!e.state?g:(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=t.wrap&1),t.mode=S,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new r.Buf32(et),t.distcode=t.distdyn=new r.Buf32(tt),t.sane=1,t.back=-1,d)}function ut(e){var t;return!e||!e.state?g:(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,ot(e))}function at(e,t){var n,r;return!e||!e.state?g:(r=e.state,t<0?(n=0,t=-t):(n=(t>>4)+1,t<48&&(t&=15)),t&&(t<8||t>15)?g:(r.window!==null&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,ut(e)))}function ft(e,t){var n,r;return e?(r=new st,e.state=r,r.window=null,n=at(e,t),n!==d&&(e.state=null),n):g}function lt(e){return ft(e,rt)}function dt(e){if(ct){var t;ht=new r.Buf32(512),pt=new r.Buf32(32),t=0;while(t<144)e.lens[t++]=8;while(t<256)e.lens[t++]=9;while(t<280)e.lens[t++]=7;while(t<288)e.lens[t++]=8;u(f,e.lens,0,288,ht,0,e.work,{bits:9}),t=0;while(t<32)e.lens[t++]=5;u(l,e.lens,0,32,pt,0,e.work,{bits:5}),ct=!1}e.lencode=ht,e.lenbits=9,e.distcode=pt,e.distbits=5}function vt(e,t,n,i){var s,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new r.Buf8(o.wsize)),i>=o.wsize?(r.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>i&&(s=i),r.arraySet(o.window,t,n-i,s,o.wnext),i-=s,i?(r.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0}function mt(e,t){var n,et,tt,nt,rt,st,ot,ut,at,ft,lt,ct,ht,pt,mt=0,gt,yt,bt,wt,Et,St,xt,Tt,Nt=new r.Buf8(4),Ct,kt,Lt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return g;n=e.state,n.mode===D&&(n.mode=P),rt=e.next_out,tt=e.output,ot=e.avail_out,nt=e.next_in,et=e.input,st=e.avail_in,ut=n.hold,at=n.bits,ft=st,lt=ot,Tt=d;e:for(;;)switch(n.mode){case S:if(n.wrap===0){n.mode=P;break}while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(n.wrap&2&&ut===35615){n.check=0,Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0),ut=0,at=0,n.mode=x;break}n.flags=0,n.head&&(n.head.done=!1);if(!(n.wrap&1)||(((ut&255)<<8)+(ut>>8))%31){e.msg="incorrect header check",n.mode=G;break}if((ut&15)!==E){e.msg="unknown compression method",n.mode=G;break}ut>>>=4,at-=4,xt=(ut&15)+8;if(n.wbits===0)n.wbits=xt;else if(xt>n.wbits){e.msg="invalid window size",n.mode=G;break}n.dmax=1<<xt,e.adler=n.check=1,n.mode=ut&512?M:D,ut=0,at=0;break;case x:while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.flags=ut;if((n.flags&255)!==E){e.msg="unknown compression method",n.mode=G;break}if(n.flags&57344){e.msg="unknown header flags set",n.mode=G;break}n.head&&(n.head.text=ut>>8&1),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0,n.mode=T;case T:while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.head&&(n.head.time=ut),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,Nt[2]=ut>>>16&255,Nt[3]=ut>>>24&255,n.check=s(n.check,Nt,4,0)),ut=0,at=0,n.mode=N;case N:while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.head&&(n.head.xflags=ut&255,n.head.os=ut>>8),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0,n.mode=C;case C:if(n.flags&1024){while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.length=ut,n.head&&(n.head.extra_len=ut),n.flags&512&&(Nt[0]=ut&255,Nt[1]=ut>>>8&255,n.check=s(n.check,Nt,2,0)),ut=0,at=0}else n.head&&(n.head.extra=null);n.mode=k;case k:if(n.flags&1024){ct=n.length,ct>st&&(ct=st),ct&&(n.head&&(xt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,et,nt,ct,xt)),n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct,n.length-=ct);if(n.length)break e}n.length=0,n.mode=L;case L:if(n.flags&2048){if(st===0)break e;ct=0;do xt=et[nt+ct++],n.head&&xt&&n.length<65536&&(n.head.name+=String.fromCharCode(xt));while(xt&&ct<st);n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct;if(xt)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=A;case A:if(n.flags&4096){if(st===0)break e;ct=0;do xt=et[nt+ct++],n.head&&xt&&n.length<65536&&(n.head.comment+=String.fromCharCode(xt));while(xt&&ct<st);n.flags&512&&(n.check=s(n.check,et,ct,nt)),st-=ct,nt+=ct;if(xt)break e}else n.head&&(n.head.comment=null);n.mode=O;case O:if(n.flags&512){while(at<16){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(ut!==(n.check&65535)){e.msg="header crc mismatch",n.mode=G;break}ut=0,at=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=D;break;case M:while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}e.adler=n.check=it(ut),ut=0,at=0,n.mode=_;case _:if(n.havedict===0)return e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at,m;e.adler=n.check=1,n.mode=D;case D:if(t===h||t===p)break e;case P:if(n.last){ut>>>=at&7,at-=at&7,n.mode=J;break}while(at<3){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.last=ut&1,ut>>>=1,at-=1;switch(ut&3){case 0:n.mode=H;break;case 1:dt(n),n.mode=R;if(t===p){ut>>>=2,at-=2;break e}break;case 2:n.mode=F;break;case 3:e.msg="invalid block type",n.mode=G}ut>>>=2,at-=2;break;case H:ut>>>=at&7,at-=at&7;while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if((ut&65535)!==(ut>>>16^65535)){e.msg="invalid stored block lengths",n.mode=G;break}n.length=ut&65535,ut=0,at=0,n.mode=B;if(t===p)break e;case B:n.mode=j;case j:ct=n.length;if(ct){ct>st&&(ct=st),ct>ot&&(ct=ot);if(ct===0)break e;r.arraySet(tt,et,nt,ct,rt),st-=ct,nt+=ct,ot-=ct,rt+=ct,n.length-=ct;break}n.mode=D;break;case F:while(at<14){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.nlen=(ut&31)+257,ut>>>=5,at-=5,n.ndist=(ut&31)+1,ut>>>=5,at-=5,n.ncode=(ut&15)+4,ut>>>=4,at-=4;if(n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=G;break}n.have=0,n.mode=I;case I:while(n.have<n.ncode){while(at<3){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.lens[Lt[n.have++]]=ut&7,ut>>>=3,at-=3}while(n.have<19)n.lens[Lt[n.have++]]=0;n.lencode=n.lendyn,n.lenbits=7,Ct={bits:n.lenbits},Tt=u(a,n.lens,0,19,n.lencode,0,n.work,Ct),n.lenbits=Ct.bits;if(Tt){e.msg="invalid code lengths set",n.mode=G;break}n.have=0,n.mode=q;case q:while(n.have<n.nlen+n.ndist){for(;;){mt=n.lencode[ut&(1<<n.lenbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(bt<16)ut>>>=gt,at-=gt,n.lens[n.have++]=bt;else{if(bt===16){kt=gt+2;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt;if(n.have===0){e.msg="invalid bit length repeat",n.mode=G;break}xt=n.lens[n.have-1],ct=3+(ut&3),ut>>>=2,at-=2}else if(bt===17){kt=gt+3;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt,xt=0,ct=3+(ut&7),ut>>>=3,at-=3}else{kt=gt+7;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=gt,at-=gt,xt=0,ct=11+(ut&127),ut>>>=7,at-=7}if(n.have+ct>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=G;break}while(ct--)n.lens[n.have++]=xt}}if(n.mode===G)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=G;break}n.lenbits=9,Ct={bits:n.lenbits},Tt=u(f,n.lens,0,n.nlen,n.lencode,0,n.work,Ct),n.lenbits=Ct.bits;if(Tt){e.msg="invalid literal/lengths set",n.mode=G;break}n.distbits=6,n.distcode=n.distdyn,Ct={bits:n.distbits},Tt=u(l,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ct),n.distbits=Ct.bits;if(Tt){e.msg="invalid distances set",n.mode=G;break}n.mode=R;if(t===p)break e;case R:n.mode=U;case U:if(st>=6&&ot>=258){e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at,o(e,lt),rt=e.next_out,tt=e.output,ot=e.avail_out,nt=e.next_in,et=e.input,st=e.avail_in,ut=n.hold,at=n.bits,n.mode===D&&(n.back=-1);break}n.back=0;for(;;){mt=n.lencode[ut&(1<<n.lenbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(yt&&(yt&240)===0){wt=gt,Et=yt,St=bt;for(;;){mt=n.lencode[St+((ut&(1<<wt+Et)-1)>>wt)],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(wt+gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=wt,at-=wt,n.back+=wt}ut>>>=gt,at-=gt,n.back+=gt,n.length=bt;if(yt===0){n.mode=$;break}if(yt&32){n.back=-1,n.mode=D;break}if(yt&64){e.msg="invalid literal/length code",n.mode=G;break}n.extra=yt&15,n.mode=z;case z:if(n.extra){kt=n.extra;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.length+=ut&(1<<n.extra)-1,ut>>>=n.extra,at-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=W;case W:for(;;){mt=n.distcode[ut&(1<<n.distbits)-1],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if((yt&240)===0){wt=gt,Et=yt,St=bt;for(;;){mt=n.distcode[St+((ut&(1<<wt+Et)-1)>>wt)],gt=mt>>>24,yt=mt>>>16&255,bt=mt&65535;if(wt+gt<=at)break;if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}ut>>>=wt,at-=wt,n.back+=wt}ut>>>=gt,at-=gt,n.back+=gt;if(yt&64){e.msg="invalid distance code",n.mode=G;break}n.offset=bt,n.extra=yt&15,n.mode=X;case X:if(n.extra){kt=n.extra;while(at<kt){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}n.offset+=ut&(1<<n.extra)-1,ut>>>=n.extra,at-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=G;break}n.mode=V;case V:if(ot===0)break e;ct=lt-ot;if(n.offset>ct){ct=n.offset-ct;if(ct>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=G;break}ct>n.wnext?(ct-=n.wnext,ht=n.wsize-ct):ht=n.wnext-ct,ct>n.length&&(ct=n.length),pt=n.window}else pt=tt,ht=rt-n.offset,ct=n.length;ct>ot&&(ct=ot),ot-=ct,n.length-=ct;do tt[rt++]=pt[ht++];while(--ct);n.length===0&&(n.mode=U);break;case $:if(ot===0)break e;tt[rt++]=n.length,ot--,n.mode=U;break;case J:if(n.wrap){while(at<32){if(st===0)break e;st--,ut|=et[nt++]<<at,at+=8}lt-=ot,e.total_out+=lt,n.total+=lt,lt&&(e.adler=n.check=n.flags?s(n.check,tt,lt,rt-lt):i(n.check,tt,lt,rt-lt)),lt=ot;if((n.flags?ut:it(ut))!==n.check){e.msg="incorrect data check",n.mode=G;break}ut=0,at=0}n.mode=K;case K:if(n.wrap&&n.flags){while(at<32){if(st===0)break e;st--,ut+=et[nt++]<<at,at+=8}if(ut!==(n.total&4294967295)){e.msg="incorrect length check",n.mode=G;break}ut=0,at=0}n.mode=Q;case Q:Tt=v;break e;case G:Tt=y;break e;case Y:return b;case Z:default:return g}e.next_out=rt,e.avail_out=ot,e.next_in=nt,e.avail_in=st,n.hold=ut,n.bits=at;if(n.wsize||lt!==e.avail_out&&n.mode<G&&(n.mode<J||t!==c))if(vt(e,e.output,e.next_out,lt-e.avail_out))return n.mode=Y,b;return ft-=e.avail_in,lt-=e.avail_out,e.total_in+=ft,e.total_out+=lt,n.total+=lt,n.wrap&&lt&&(e.adler=n.check=n.flags?s(n.check,tt,lt,e.next_out-lt):i(n.check,tt,lt,e.next_out-lt)),e.data_type=n.bits+(n.last?64:0)+(n.mode===D?128:0)+(n.mode===R||n.mode===B?256:0),(ft===0&&lt===0||t===c)&&Tt===d&&(Tt=w),Tt}function gt(e){if(!e||!e.state)return g;var t=e.state;return t.window&&(t.window=null),e.state=null,d}function yt(e,t){var n;return!e||!e.state?g:(n=e.state,(n.wrap&2)===0?g:(n.head=t,t.done=!1,d))}var r=e("../utils/common"),i=e("./adler32"),s=e("./crc32"),o=e("./inffast"),u=e("./inftrees"),a=0,f=1,l=2,c=4,h=5,p=6,d=0,v=1,m=2,g=-2,y=-3,b=-4,w=-5,E=8,S=1,x=2,T=3,N=4,C=5,k=6,L=7,A=8,O=9,M=10,_=11,D=12,P=13,H=14,B=15,j=16,F=17,I=18,q=19,R=20,U=21,z=22,W=23,X=24,V=25,$=26,J=27,K=28,Q=29,G=30,Y=31,Z=32,et=852,tt=592,nt=15,rt=nt,ct=!0,ht,pt;n.inflateReset=ut,n.inflateReset2=at,n.inflateResetKeep=ot,n.inflateInit=lt,n.inflateInit2=ft,n.inflate=mt,n.inflateEnd=gt,n.inflateGetHeader=yt,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t,n){"use strict";var r=e("../utils/common"),i=15,s=852,o=592,u=0,a=1,f=2,l=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],p=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(t,n,d,v,m,g,y,b){var w=b.bits,E=0,S=0,x=0,T=0,N=0,C=0,k=0,L=0,A=0,O=0,M,_,D,P,H,B=null,j=0,F,I=new r.Buf16(i+1),q=new r.Buf16(i+1),R=null,U=0,z,W,X;for(E=0;E<=i;E++)I[E]=0;for(S=0;S<v;S++)I[n[d+S]]++;N=w;for(T=i;T>=1;T--)if(I[T]!==0)break;N>T&&(N=T);if(T===0)return m[g++]=20971520,m[g++]=20971520,b.bits=1,0;for(x=1;x<T;x++)if(I[x]!==0)break;N<x&&(N=x),L=1;for(E=1;E<=i;E++){L<<=1,L-=I[E];if(L<0)return-1}if(L>0&&(t===u||T!==1))return-1;q[1]=0;for(E=1;E<i;E++)q[E+1]=q[E]+I[E];for(S=0;S<v;S++)n[d+S]!==0&&(y[q[n[d+S]]++]=S);t===u?(B=R=y,F=19):t===a?(B=l,j-=257,R=c,U-=257,F=256):(B=h,R=p,F=-1),O=0,S=0,E=x,H=g,C=N,k=0,D=-1,A=1<<N,P=A-1;if(t===a&&A>s||t===f&&A>o)return 1;var V=0;for(;;){V++,z=E-k,y[S]<F?(W=0,X=y[S]):y[S]>F?(W=R[U+y[S]],X=B[j+y[S]]):(W=96,X=0),M=1<<E-k,_=1<<C,x=_;do _-=M,m[H+(O>>k)+_]=z<<24|W<<16|X|0;while(_!==0);M=1<<E-1;while(O&M)M>>=1;M!==0?(O&=M-1,O+=M):O=0,S++;if(--I[E]===0){if(E===T)break;E=n[d+y[S]]}if(E>N&&(O&P)!==D){k===0&&(k=N),H+=x,C=E-k,L=1<<C;while(C+k<T){L-=I[C+k];if(L<=0)break;C++,L<<=1}A+=1<<C;if(t===a&&A>s||t===f&&A>o)return 1;D=O&P,m[D]=N<<24|C<<16|H-g|0}}return O!==0&&(m[H+O]=E-k<<24|64<<16|0),b.bits=N,0}},{"../utils/common":27}],37:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,n){"use strict";function a(e){var t=e.length;while(--t>=0)e[t]=0}function z(e){return e<256?P[e]:P[256+(e>>>7)]}function W(e,t){e.pending_buf[e.pending++]=t&255,e.pending_buf[e.pending++]=t>>>8&255}function X(e,t,n){e.bi_valid>E-n?(e.bi_buf|=t<<e.bi_valid&65535,W(e,e.bi_buf),e.bi_buf=t>>E-e.bi_valid,e.bi_valid+=n-E):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function V(e,t,n){X(e,n[t*2],n[t*2+1])}function $(e,t){var n=0;do n|=e&1,e>>>=1,n<<=1;while(--t>0);return n>>>1}function J(e){e.bi_valid===16?(W(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)}function K(e,t){var n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,u=t.stat_desc.extra_base,a=t.stat_desc.max_length,f,l,c,h,p,d,v=0;for(h=0;h<=w;h++)e.bl_count[h]=0;n[e.heap[e.heap_max]*2+1]=0;for(f=e.heap_max+1;f<b;f++){l=e.heap[f],h=n[n[l*2+1]*2+1]+1,h>a&&(h=a,v++),n[l*2+1]=h;if(l>r)continue;e.bl_count[h]++,p=0,l>=u&&(p=o[l-u]),d=n[l*2],e.opt_len+=d*(h+p),s&&(e.static_len+=d*(i[l*2+1]+p))}if(v===0)return;do{h=a-1;while(e.bl_count[h]===0)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[a]--,v-=2}while(v>0);for(h=a;h!==0;h--){l=e.bl_count[h];while(l!==0){c=e.heap[--f];if(c>r)continue;n[c*2+1]!==h&&(e.opt_len+=(h-n[c*2+1])*n[c*2],n[c*2+1]=h),l--}}}function Q(e,t,n){var r=new Array(w+1),i=0,s,o;for(s=1;s<=w;s++)r[s]=i=i+n[s-1]<<1;for(o=0;o<=t;o++){var u=e[o*2+1];if(u===0)continue;e[o*2]=$(r[u]++,u)}}function G(){var e,t,n,r,i,s=new Array(w+1);n=0;for(r=0;r<d-1;r++){B[r]=n;for(e=0;e<1<<k[r];e++)H[n++]=r}H[n-1]=r,i=0;for(r=0;r<16;r++){j[r]=i;for(e=0;e<1<<L[r];e++)P[i++]=r}i>>=7;for(;r<g;r++){j[r]=i<<7;for(e=0;e<1<<L[r]-7;e++)P[256+i++]=r}for(t=0;t<=w;t++)s[t]=0;e=0;while(e<=143)_[e*2+1]=8,e++,s[8]++;while(e<=255)_[e*2+1]=9,e++,s[9]++;while(e<=279)_[e*2+1]=7,e++,s[7]++;while(e<=287)_[e*2+1]=8,e++,s[8]++;Q(_,m+1,s);for(e=0;e<g;e++)D[e*2+1]=5,D[e*2]=$(e,5);I=new F(_,k,v+1,m,w),q=new F(D,L,0,g,w),R=new F(new Array(0),A,0,y,S)}function Y(e){var t;for(t=0;t<m;t++)e.dyn_ltree[t*2]=0;for(t=0;t<g;t++)e.dyn_dtree[t*2]=0;for(t=0;t<y;t++)e.bl_tree[t*2]=0;e.dyn_ltree[x*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){e.bi_valid>8?W(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function et(e,t,n,i){Z(e),i&&(W(e,n),W(e,~n)),r.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function tt(e,t,n,r){var i=t*2,s=n*2;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]}function nt(e,t,n){var r=e.heap[n],i=n<<1;while(i<=e.heap_len){i<e.heap_len&&tt(t,e.heap[i+1],e.heap[i],e.depth)&&i++;if(tt(t,r,e.heap[i],e.depth))break;e.heap[n]=e.heap[i],n=i,i<<=1}e.heap[n]=r}function rt(e,t,n){var r,i,s=0,o,u;if(e.last_lit!==0)do r=e.pending_buf[e.d_buf+s*2]<<8|e.pending_buf[e.d_buf+s*2+1],i=e.pending_buf[e.l_buf+s],s++,r===0?V(e,i,t):(o=H[i],V(e,o+v+1,t),u=k[o],u!==0&&(i-=B[o],X(e,i,u)),r--,o=z(r),V(e,o,n),u=L[o],u!==0&&(r-=j[o],X(e,r,u)));while(s<e.last_lit);V(e,x,t)}function it(e,t){var n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,s=t.stat_desc.elems,o,u,a=-1,f;e.heap_len=0,e.heap_max=b;for(o=0;o<s;o++)n[o*2]!==0?(e.heap[++e.heap_len]=a=o,e.depth[o]=0):n[o*2+1]=0;while(e.heap_len<2)f=e.heap[++e.heap_len]=a<2?++a:0,n[f*2]=1,e.depth[f]=0,e.opt_len--,i&&(e.static_len-=r[f*2+1]);t.max_code=a;for(o=e.heap_len>>1;o>=1;o--)nt(e,n,o);f=s;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],nt(e,n,1),u=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=u,n[f*2]=n[o*2]+n[u*2],e.depth[f]=(e.depth[o]>=e.depth[u]?e.depth[o]:e.depth[u])+1,n[o*2+1]=n[u*2+1]=f,e.heap[1]=f++,nt(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],K(e,t),Q(n,a,e.bl_count)}function st(e,t,n){var r,i=-1,s,o=t[1],u=0,a=7,f=4;o===0&&(a=138,f=3),t[(n+1)*2+1]=65535;for(r=0;r<=n;r++){s=o,o=t[(r+1)*2+1];if(++u<a&&s===o)continue;u<f?e.bl_tree[s*2]+=u:s!==0?(s!==i&&e.bl_tree[s*2]++,e.bl_tree[T*2]++):u<=10?e.bl_tree[N*2]++:e.bl_tree[C*2]++,u=0,i=s,o===0?(a=138,f=3):s===o?(a=6,f=3):(a=7,f=4)}}function ot(e,t,n){var r,i=-1,s,o=t[1],u=0,a=7,f=4;o===0&&(a=138,f=3);for(r=0;r<=n;r++){s=o,o=t[(r+1)*2+1];if(++u<a&&s===o)continue;if(u<f){do V(e,s,e.bl_tree);while(--u!==0)}else s!==0?(s!==i&&(V(e,s,e.bl_tree),u--),V(e,T,e.bl_tree),X(e,u-3,2)):u<=10?(V(e,N,e.bl_tree),X(e,u-3,3)):(V(e,C,e.bl_tree),X(e,u-11,7));u=0,i=s,o===0?(a=138,f=3):s===o?(a=6,f=3):(a=7,f=4)}}function ut(e){var t;st(e,e.dyn_ltree,e.l_desc.max_code),st(e,e.dyn_dtree,e.d_desc.max_code),it(e,e.bl_desc);for(t=y-1;t>=3;t--)if(e.bl_tree[O[t]*2+1]!==0)break;return e.opt_len+=3*(t+1)+5+5+4,t}function at(e,t,n,r){var i;X(e,t-257,5),X(e,n-1,5),X(e,r-4,4);for(i=0;i<r;i++)X(e,e.bl_tree[O[i]*2+1],3);ot(e,e.dyn_ltree,t-1),ot(e,e.dyn_dtree,n-1)}function ft(e){var t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(t&1&&e.dyn_ltree[n*2]!==0)return s;if(e.dyn_ltree[18]!==0||e.dyn_ltree[20]!==0||e.dyn_ltree[26]!==0)return o;for(n=32;n<v;n++)if(e.dyn_ltree[n*2]!==0)return o;return s}function ct(e){lt||(G(),lt=!0),e.l_desc=new U(e.dyn_ltree,I),e.d_desc=new U(e.dyn_dtree,q),e.bl_desc=new U(e.bl_tree,R),e.bi_buf=0,e.bi_valid=0,Y(e)}function ht(e,t,n,r){X(e,(f<<1)+(r?1:0),3),et(e,t,n,!0)}function pt(e){X(e,l<<1,3),V(e,x,_),J(e)}function dt(e,t,n,r){var s,o,a=0;e.level>0?(e.strm.data_type===u&&(e.strm.data_type=ft(e)),it(e,e.l_desc),it(e,e.d_desc),a=ut(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=n+5,n+4<=s&&t!==-1?ht(e,t,n,r):e.strategy===i||o===s?(X(e,(l<<1)+(r?1:0),3),rt(e,_,D)):(X(e,(c<<1)+(r?1:0),3),at(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),rt(e,e.dyn_ltree,e.dyn_dtree)),Y(e),r&&Z(e)}function vt(e,t,n){return e.pending_buf[e.d_buf+e.last_lit*2]=t>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=t&255,e.pending_buf[e.l_buf+e.last_lit]=n&255,e.last_lit++,t===0?e.dyn_ltree[n*2]++:(e.matches++,t--,e.dyn_ltree[(H[n]+v+1)*2]++,e.dyn_dtree[z(t)*2]++),e.last_lit===e.lit_bufsize-1}var r=e("../utils/common"),i=4,s=0,o=1,u=2,f=0,l=1,c=2,h=3,p=258,d=29,v=256,m=v+1+d,g=30,y=19,b=2*m+1,w=15,E=16,S=7,x=256,T=16,N=17,C=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],M=512,_=new Array((m+2)*2);a(_);var D=new Array(g*2);a(D);var P=new Array(M);a(P);var H=new Array(p-h+1);a(H);var B=new Array(d);a(B);var j=new Array(g);a(j);var F=function(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length},I,q,R,U=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t},lt=!1;n._tr_init=ct,n._tr_stored_block=ht,n._tr_flush_block=dt,n._tr_tally=vt,n._tr_align=pt},{"../utils/common":27}],39:[function(e,t,n){"use strict";function r(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=r},{}]},{},[9])(9)});var p=void 0,q=!0,t=null,u=!1,w,ca=this,ra="closure_uid_"+(1e9*Math.random()>>>0),sa=0,xa=Date.now||function(){return+(new Date)};ya.prototype={l:function(){return new ya(this.Xa,this.Ya,this.Za)},cc:function(e){return this.Xa*e.x()+this.Ya*e.y()+this.Za*e.d()},ue:function(e,t){return za(this,Aa(Ca(e,this),t))},length:function(){return Math.sqrt(this.cc(this))},xc:function(e){return new ya(this.Ya*e.d()-this.Za*e.y(),this.Za*e.x()-this.Xa*e.d(),this.Xa*e.y()-this.Ya*e.x())},x:v("Xa"),y:v("Ya"),d:v("Za")};var C=C||{};C.Ek=q,C.Ha=function(a){eval("X.DEV === undefined")||window.console.time(a)},C.Ca=function(a){eval("X.DEV === undefined")||window.console.timeEnd(a)},window["X.counter"]=new function(){this.ai=0,this.vk=function(){return this.ai++}};var Ha=window.Qh;Function.prototype.bind||(Function.prototype.bind=function(e){function t(){return s.apply(this instanceof n?this:e||window,i.concat(r.call(arguments)))}function n(){}"function"!=typeof this&&m(new TypeError("Function.prototype.bind - what is trying to be bound is not callable"));var r=Array.prototype.slice,i=r.call(arguments,1),s=this;return n.prototype=this.prototype,t.prototype=new n,t});for(var Ia=0,Ja=["ms","moz","webkit","o"],Ka=0;Ka<Ja.length&&!window.requestAnimationFrame;++Ka)window.requestAnimationFrame=window[Ja[Ka]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Ja[Ka]+"CancelAnimationFrame"]||window[Ja[Ka]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(0,16-(t-Ia)),r=window.setTimeout(function(){e(t+n)},n);return Ia=t+n,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),"slice"in ArrayBuffer.prototype||(ArrayBuffer.prototype.slice=function(e,t){e===p&&m(Error("Not enough arguments."));var n=t||this.byteLength;0>e&&(e=this.byteLength+e),0>n&&(n=this.byteLength+n),n<e&&(n=e=0),0>e&&(e=0),0>n&&(n=0),e>this.byteLength&&(e=this.byteLength),n>this.byteLength&&(n=this.byteLength);for(var r=new ArrayBuffer(n-e),i=new Uint8Array(this),s=new Uint8Array(r),o=e,u=0;o<n;++o,++u)s[u]=i[o];return r}),x("$",Ha),x("Function.prototype.bind",Function.prototype.bind),x("window.requestAnimationFrame",window.requestAnimationFrame),x("window.cancelAnimationFrame",window.cancelAnimationFrame);var La=0;w=Ma.prototype,w.key=0,w.Cc=u,w.ke=u,w.Ba=function(e,t,n,r,i,s){oa(e)?this.Zg=q:e&&e.handleEvent&&oa(e.handleEvent)?this.Zg=u:m(Error("Invalid listener argument")),this.dc=e,this.th=t,this.src=n,this.type=r,this.capture=!!i,this.yf=s,this.ke=u,this.key=++La,this.Cc=u},w.handleEvent=function(e){return this.Zg?this.dc.call(this.yf||this.src,e):this.dc.handleEvent.call(this.dc,e)};var Pa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Ta=/&/g,Ua=/</g,Va=/>/g,Wa=/\"/g,Sa=/[&<>\"]/,Xa,Ya,Za,$a,ab,bb,db;$a=Za=Ya=Xa=u;var gb;if(gb=eb()){var hb=fb();Xa=0==gb.indexOf("Opera"),Ya=!Xa&&-1!=gb.indexOf("MSIE"),Za=!Xa&&-1!=gb.indexOf("WebKit"),$a=!Xa&&!Za&&"Gecko"==hb.product}var ib=Xa,jb=Ya,lb=$a,mb=Za,pb,qb=fb();pb=qb&&qb.platform||"",ab=-1!=pb.indexOf("Mac"),bb=-1!=pb.indexOf("Win"),db=-1!=pb.indexOf("Linux");var rb=!!fb()&&-1!=(fb().appVersion||"").indexOf("X11"),wb;e:{var xb="",yb;if(ib&&ca.opera)var zb=ca.opera.version,xb="function"==typeof zb?zb():zb;else if(lb?yb=/rv\:([^\);]+)(\)|;)/:jb?yb=/MSIE\s+([^\);]+)(\)|;)/:mb&&(yb=/WebKit\/(\S+)/),yb)var Ab=yb.exec(eb()),xb=Ab?Ab[1]:"";if(jb){var Bb=sb();if(Bb>parseFloat(xb)){wb=String(Bb);break e}}wb=xb}var Cb={},Eb=ca.document,Fb=!Eb||!jb?p:sb()||("CSS1Compat"==Eb.compatMode?parseInt(wb,10):5),Gb=!jb||jb&&9<=Fb,Hb=jb&&!Db("9");!mb||Db("528"),lb&&Db("1.9b")||jb&&Db("8")||ib&&Db("9.5")||mb&&Db("528"),lb&&!Db("8")||jb&&Db("9");var Ib=Array.prototype,Jb=Ib.indexOf?function(e,t,n){return Ib.indexOf.call(e,t,n)}:function(e,n,r){r=r==t?0:0>r?Math.max(0,e.length+r):r;if(ma(e))return!ma(n)||1!=n.length?-1:e.indexOf(n,r);for(;r<e.length;r++)if(r in e&&e[r]===n)return r;return-1},Lb=Ib.forEach?function(e,t,n){Ib.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=ma(e)?e.split(""):e,s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)},Mb=Ib.map?function(e,t,n){return Ib.map.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=Array(r),s=ma(e)?e.split(""):e,o=0;o<r;o++)o in s&&(i[o]=t.call(n,s[o],o,e));return i},Nb=Ib.some?function(e,t,n){return Ib.some.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=ma(e)?e.split(""):e,s=0;s<r;s++)if(s in i&&t.call(n,i[s],s,e))return q;return u},Rb=0;w=Sb.prototype,w.Bc=u,w.defaultPrevented=u,w.ze=q,w.stopPropagation=function(){this.Bc=q},w.preventDefault=function(){this.defaultPrevented=q,this.ze=u},Tb[" "]=ga,A(Ub,Sb),w=Ub.prototype,w.target=t,w.relatedTarget=t,w.offsetX=0,w.offsetY=0,w.clientX=0,w.clientY=0,w.screenX=0,w.screenY=0,w.button=0,w.keyCode=0,w.charCode=0,w.ctrlKey=u,w.altKey=u,w.shiftKey=u,w.metaKey=u,w.ak=u,w.vb=t,w.Ba=function(e,n){var r=this.type=e.type;Sb.call(this,r),this.target=e.target||e.srcElement,this.currentTarget=n;var i=e.relatedTarget;if(i){if(lb){var s;e:{try{Tb(i.nodeName),s=q;break e}catch(o){}s=u}s||(i=t)}}else"mouseover"==r?i=e.fromElement:"mouseout"==r&&(i=e.toElement);this.relatedTarget=i,this.offsetX=mb||e.offsetX!==p?e.offsetX:e.layerX,this.offsetY=mb||e.offsetY!==p?e.offsetY:e.layerY,this.clientX=e.clientX!==p?e.clientX:e.pageX,this.clientY=e.clientY!==p?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0,this.button=e.button,this.keyCode=e.keyCode||0,this.charCode=e.charCode||("keypress"==r?e.keyCode:0),this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.ak=ab?e.metaKey:e.ctrlKey,this.state=e.state,this.vb=e,e.defaultPrevented&&this.preventDefault(),delete this.Bc},w.stopPropagation=function(){Ub.u.stopPropagation.call(this),this.vb.stopPropagation?this.vb.stopPropagation():this.vb.cancelBubble=q},w.preventDefault=function(){Ub.u.preventDefault.call(this);var e=this.vb;if(e.preventDefault)e.preventDefault();else if(e.returnValue=u,Hb)try{if(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)e.keyCode=-1}catch(t){}},w.Li=v("vb");var Vb={},Wb={},Xb={},Yb={},ic=0;A(kc,Qb),kc.prototype.customEvent_=q,w=kc.prototype,w.Qf=t,w.Vf=ba("Qf"),w.addEventListener=function(e,t,n,r){D(this,e,t,n,r)},w.removeEventListener=function(e,t,n,r){bc(this,e,t,n,r)},w.dispatchEvent=function(e){var t=e.type||e,n=Wb;if(t in n){if(ma(e))e=new Sb(e,this);else if(e instanceof Sb)e.target=e.target||this;else{var r=e;e=new Sb(t,this),Qa(e,r)}var r=1,i,n=n[t],t=q in n,s;if(t){i=[];for(s=this;s;s=s.Qf)i.push(s);s=n[q],s.Na=s.ma;for(var o=i.length-1;!e.Bc&&0<=o&&s.Na;o--)e.currentTarget=i[o],r&=gc(s,i[o],e.type,q,e)&&e.ze!=u}if(u in n)if(s=n[u],s.Na=s.ma,t)for(o=0;!e.Bc&&o<i.length&&s.Na;o++)e.currentTarget=i[o],r&=gc(s,i[o],e.type,u,e)&&e.ze!=u;else for(i=this;!e.Bc&&i&&s.Na;i=i.Qf)e.currentTarget=i,r&=gc(s,i,e.type,u,e)&&e.ze!=u;e=Boolean(r)}else e=q;return e},A(M,kc),M.prototype.__defineGetter__("classname",v("f")),M.prototype.__defineGetter__("id",v("pa")),x("X.base",M),lc.prototype={l:function(){return new lc(this.Wa.l(),this.ta.l())},zc:function(){this.ta=Fa(this.ta)}},mc.prototype={l:function(){return new mc(this.ta.l(),this.Qd)},zc:function(){this.ta=Fa(this.ta),this.Qd=-this.Qd}},nc.prototype={l:function(){var e=this.Mb.map(function(e){return e.l()});return new nc(e,this.Fe)},zc:function(){this.Mb.reverse().map(function(e){e.zc()}),this.Va.zc()}},pc.prototype={l:function(){var e=new pc,t=this.Va&&this.Va.l();return e.Va=t,t=this.Aa&&this.Aa.l(),e.Aa=t,t=this.za&&this.za.l(),e.za=t,e.Ee(this.X.map(function(e){return e.l()})),e},W:function(){for(var e=0;e<this.X.length;e++)this.X[e].zc();this.Va.zc(),this.Aa&&this.Aa.W(),this.za&&this.za.W(),e=this.Aa,this.Aa=this.za,this.za=e},Ee:ba("X")},uc.prototype={l:function(){var e=new uc;return e.Ee(this.X.map(function(e){return e.l()})),e},bg:function(e){var t=new pc(this.l().X);return e=new pc(e.l().X),sc(t,e),sc(e,t),e.W(),sc(e,t),e.W(),qc(t,rc(e)),vc(rc(t))},ua:function(e){var t=new pc(this.l().X);return e=new pc(e.l().X),t.W(),sc(t,e),sc(e,t),e.W(),sc(e,t),e.W(),qc(t,rc(e)),t.W(),vc(rc(t))},Af:function(e){var t=new pc(this.l().X);return e=new pc(e.l().X),t.W(),sc(e,t),e.W(),sc(t,e),sc(e,t),qc(t,rc(e)),t.W(),vc(rc(t))},inverse:function(){var e=this.l();return e.X.map(function(e){e.zc()}),e},Ee:ba("X")},A(wc,M),wc.prototype.add=function(e){e==t&&m(Error("Invalid object."));var n=window.JSON.stringify(e);return n in this.Ia||(this.Ia[n]=this.gf.length,this.gf.push(e)),this.Ia[n]},wc.prototype.unique=v("gf"),A(xc,M),yc.prototype.__defineSetter__("file",function(e){if(e==t||ja(e)&&0==e.length)this.r=t;else{if(ja(e)){if(1==e.length){this.r=new xc(e[0]);return}this.r=Mb(e,function(e){var t=new N;return t.r=new xc(e),t})}else this.r=new xc(e);this.$a=t}}),yc.prototype.__defineGetter__("file",function(){return this.r?ja(this.r)?this.r.map(function(e){return e.r.be}):this.r.be:""}),yc.prototype.__defineGetter__("filedata",function(){return ja(this.r)?this.r.map(function(e){return e.$a}):this.$a}),yc.prototype.__defineSetter__("filedata",function(e){if(e==t||ja(e)&&0==e.length)this.$a=t;if(ja(e))if(1==e.length)this.$a=e[0];else{var n=this.r.length,r;for(r=0;r<n;r++)this.r[r].$a=e[r]}else this.$a=e}),w=Ac.prototype,w.ma=0,w.dg=0,w.xf=v("ma"),w.Ed=function(){Bc(this);for(var e=[],t=0;t<this.S.length;t++)e.push(this.da[this.S[t]]);return e},w.clear=function(){this.da={},this.dg=this.ma=this.S.length=0},w.remove=function(e){return Dc(this.da,e)?(delete this.da[e],this.ma--,this.dg++,this.S.length>2*this.ma&&Bc(this),q):u},w.get=function(e,t){return Dc(this.da,e)?this.da[e]:t},w.set=function(e,t){Dc(this.da,e)||(this.ma++,this.S.push(e),this.dg++),this.da[e]=t},w.jf=function(e){var t;if(e instanceof Ac)Bc(e),t=e.S.concat(),e=e.Ed();else{t=[];var n=0,r;for(r in e)t[n++]=r;e=Oa(e)}for(n=0;n<t.length;n++)this.set(t[n],e[n])},w.l=function(){return new Ac(this)},w.ag=function(){for(var e=new Ac,t=0;t<this.S.length;t++){var n=this.S[t];e.set(this.da[n],n)}return e},A(Ec,M),Ec.prototype.add=function(e,t,n,r,i,s){(!na(e)||!na(n)||!na(r)||!na(i)||!na(s))&&m(Error("Invalid color table entry.")),this.Ia.set(e,[t,n,r,i,s]),this.j=q},Ec.prototype.get=function(e){return this.Ia.get(e)},x("X.colortable.prototype.get",Ec.prototype.get),Fc.prototype.l=function(){return new Fc(this.x,this.y,this.d)},A(O,Fc),w=O.prototype,w.l=function(){return new O(this.x,this.y,this.d)},w.Jb=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.d*this.d)},w.scale=function(e){return this.x*=e,this.y*=e,this.d*=e,this},w.W=function(){return this.x=-this.x,this.y=-this.y,this.d=-this.d,this},w.normalize=function(){return this.scale(1/this.Jb())},w.add=function(e){return this.x+=e.x,this.y+=e.y,this.d+=e.d,this},w.ua=function(e){return this.x-=e.x,this.y-=e.y,this.d-=e.d,this},C.m=O,w=C.m.prototype,w.l=O.prototype.l,w.Jb=O.prototype.Jb,w.scale=O.prototype.scale,w.W=O.prototype.W,w.add=O.prototype.add,w.ua=O.prototype.ua,w.normalize=function(){var e=this.Jb();return 0==e?this.scale(0):this.scale(1/e)},C.m.cc=function(e,t){return e.x*t.x+e.y*t.y+e.d*t.d},C.m.xc=Jc,C.m.wf=Gc,C.m.ue=function(e,t,n){return new O(e.x+n*(t.x-e.x),e.y+n*(t.y-e.y),e.d+n*(t.d-e.d))},C.m.prototype.__defineGetter__("xx",v("x")),C.m.prototype.__defineGetter__("yy",v("y")),C.m.prototype.__defineGetter__("zz",v("d")),x("X.vector",C.m),x("X.vector.prototype.clone",C.m.prototype.l),x("X.vector.prototype.magnitude",C.m.prototype.Jb),x("X.vector.prototype.scale",C.m.prototype.scale),x("X.vector.prototype.invert",C.m.prototype.W),x("X.vector.prototype.normalize",C.m.prototype.normalize),x("X.vector.prototype.add",C.m.prototype.add),x("X.vector.prototype.subtract",C.m.prototype.ua),x("X.vector.dot",C.m.cc),x("X.vector.cross",C.m.xc),x("X.vector.distance",C.m.wf),x("X.vector.lerp",C.m.ue),Kc.prototype.BYTES_PER_ELEMENT=8,Kc.prototype.set=function(e,t){t=t||0;for(var n=0;n<e.length&&t+n<this.length;n++)this[t+n]=e[n]},Kc.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{Kc.BYTES_PER_ELEMENT=8}catch(Lc){}Kc.prototype.BYTES_PER_ELEMENT=Kc.prototype.BYTES_PER_ELEMENT,Kc.prototype.set=Kc.prototype.set,Kc.prototype.toString=Kc.prototype.toString,x("Float64Array",Kc)}Mc.prototype.BYTES_PER_ELEMENT=4,Mc.prototype.set=function(e,t){t=t||0;for(var n=0;n<e.length&&t+n<this.length;n++)this[t+n]=e[n]},Mc.prototype.toString=Array.prototype.join,"undefined"==typeof Float32Array&&(Mc.BYTES_PER_ELEMENT=4,Mc.prototype.BYTES_PER_ELEMENT=Mc.prototype.BYTES_PER_ELEMENT,Mc.prototype.set=Mc.prototype.set,Mc.prototype.toString=Mc.prototype.toString,x("Float32Array",Mc)),new Float64Array(3),new Float64Array(3),new Float64Array(4),new Float64Array(4),new Float64Array(4),new Float64Array(16),C.g={},C.g.bh=function(e,t,n,r){n=n.ua(t),n.normalize(),r=C.m.xc(n,r),r.normalize();var i=C.m.xc(r,n);return i.normalize(),n.W(),Q(e,0,r.x,r.y,r.d,0),Q(e,1,i.x,i.y,i.d,0),Q(e,2,n.x,n.y,n.d,0),ed(e,-t.x,-t.y,-t.d),e},C.g.Z=function(e,t,n,r){var i=1/(t*e[3]+n*e[7]+r*e[11]+e[15]);return new C.m((t*e[0]+n*e[4]+r*e[8]+e[12])*i,(t*e[1]+n*e[5]+r*e[9]+e[13])*i,(t*e[2]+n*e[6]+r*e[10]+e[14])*i)},C.g.sk=function(e,t,n){var r=new Float32Array(4),i=new Float32Array(4);return $c(e,t,r),$c(e,n,i),Yc(e,t,i),Yc(e,n,r),e},C.g.rk=function(e,t,n){var r=new Float32Array(4),i=new Float32Array(4);return Xc(e,t,r),Xc(e,n,i),Wc(e,t,i),Wc(e,n,r),e},C.g.Fd=Tc,C.g.l=function(e){var t=Sc();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},C.g.ag=function(e,t){if(t==e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},C.g.yi=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=e[8],l=e[9],c=e[10],h=e[11],p=e[12],d=e[13],v=e[14];return e=e[15],(t*o-n*s)*(c*e-h*v)-(t*u-r*s)*(l*e-h*d)+(t*a-i*s)*(l*v-c*d)+(n*u-r*o)*(f*e-h*p)-(n*a-i*o)*(f*v-c*p)+(r*a-i*u)*(f*d-l*p)},C.g.W=bd,C.g.Df=function(e,t,n,r,i){var s=t/2;t=i-r;var o=Math.sin(s);return 0==t||0==o||0==n?e:(s=Math.cos(s)/o,Uc(e,s/n,0,0,0,0,s,0,0,0,0,-(i+r)/t,-1,0,0,-(2*r*i)/t,0))},C.g.ij=function(e,t,n,r,i,s,o){return Uc(e,2*s/(n-t),0,0,0,0,2*s/(i-r),0,0,(n+t)/(n-t),(i+r)/(i-r),-(o+s)/(o-s),-1,0,0,-(2*o*s)/(o-s),0)},C.g.jj=function(e,t,n,r,i,s,o){return Uc(e,2/(n-t),0,0,0,0,2/(i-r),0,0,0,0,-2/(o-s),0,-(n+t)/(n-t),-(i+r)/(i-r),-(o+s)/(o-s),1)},C.g.multiply=ad,C.g.gh=dd,C.g.translate=ed,C.g.scale=function(e,t,n,r){return Uc(e,e[0]*t,e[1]*t,e[2]*t,e[3]*t,e[4]*n,e[5]*n,e[6]*n,e[7]*n,e[8]*r,e[9]*r,e[10]*r,e[11]*r,e[12],e[13],e[14],e[15])},C.g.rotate=function(e,t,n,r,i){var s=e[0],o=e[1],u=e[2],a=e[3],f=e[4],l=e[5],c=e[6],h=e[7],p=e[8],d=e[9],v=e[10],m=e[11],g=Math.cos(t),y=Math.sin(t),b=1-g;t=n*n*b+g;var w=n*r*b+i*y,E=n*i*b-r*y,S=n*r*b-i*y,x=r*r*b+g,T=r*i*b+n*y,N=n*i*b+r*y;return n=r*i*b-n*y,i=i*i*b+g,Uc(e,s*t+f*w+p*E,o*t+l*w+d*E,u*t+c*w+v*E,a*t+h*w+m*E,s*S+f*x+p*T,o*S+l*x+d*T,u*S+c*x+v*T,a*S+h*x+m*T,s*N+f*n+p*i,o*N+l*n+d*i,u*N+c*n+v*i,a*N+h*n+m*i,e[12],e[13],e[14],e[15])},C.g.Ae=function(e,t){var n=e[4],r=e[5],i=e[6],s=e[7],o=e[8],u=e[9],a=e[10],f=e[11],l=Math.cos(t),c=Math.sin(t);return e[4]=n*l+o*c,e[5]=r*l+u*c,e[6]=i*l+a*c,e[7]=s*l+f*c,e[8]=n*-c+o*l,e[9]=r*-c+u*l,e[10]=i*-c+a*l,e[11]=s*-c+f*l,e},C.g.Be=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[8],u=e[9],a=e[10],f=e[11],l=Math.cos(t),c=Math.sin(t);return e[0]=n*l+o*-c,e[1]=r*l+u*-c,e[2]=i*l+a*-c,e[3]=s*l+f*-c,e[8]=n*c+o*l,e[9]=r*c+u*l,e[10]=i*c+a*l,e[11]=s*c+f*l,e},C.g.Ce=function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7],l=Math.cos(t),c=Math.sin(t);return e[0]=n*l+o*c,e[1]=r*l+u*c,e[2]=i*l+a*c,e[3]=s*l+f*c,e[4]=n*-c+o*l,e[5]=r*-c+u*l,e[6]=i*-c+a*l,e[7]=s*-c+f*l,e},x("X.matrix.identity",C.g.Fd),x("X.matrix.clone",C.g.l),x("X.matrix.transpose",C.g.ag),x("X.matrix.determinant",C.g.yi),x("X.matrix.invert",C.g.W),x("X.matrix.multiply",C.g.multiply),x("X.matrix.multiplyByVector",C.g.Z),x("X.matrix.multiplyByVec4",C.g.gh),x("X.matrix.makePerspective",C.g.Df),x("X.matrix.makeFrustum",C.g.ij),x("X.matrix.makeOrtho",C.g.jj),x("X.matrix.makeLookAt",C.g.bh),x("X.matrix.translate",C.g.translate),x("X.matrix.scale",C.g.scale),x("X.matrix.rotate",C.g.rotate),x("X.matrix.rotateX",C.g.Ae),x("X.matrix.rotateY",C.g.Be),x("X.matrix.rotateZ",C.g.Ce),x("X.matrix.swapRows",C.g.sk),x("X.matrix.swapCols",C.g.rk),A(fd,M),fd.prototype.__defineGetter__("matrix",v("P")),fd.prototype.__defineSetter__("matrix",function(e){(e==t||!(e instanceof Float32Array))&&m(Error("Invalid matrix.")),this.P=e,this.q()}),w=fd.prototype,w.Ae=function(e){(!na(e)||-360>e||360<e)&&m(Error("Invalid angle.")),C.g.Ae(this.P,e*Math.PI/180),this.q()},w.Be=function(e){(!na(e)||-360>e||360<e)&&m(Error("Invalid angle.")),C.g.Be(this.P,e*Math.PI/180),this.q()},w.Ce=function(e){(!na(e)||-360>e||360<e)&&m(Error("Invalid angle.")),C.g.Ce(this.P,e*Math.PI/180),this.q()},w.Ih=function(e){na(e)||m(Error("Invalid distance.")),C.g.translate(this.P,e,0,0),this.q()},w.Jh=function(e){na(e)||m(Error("Invalid distance.")),C.g.translate(this.P,0,e,0),this.q()},w.Kh=function(e){na(e)||m(Error("Invalid distance.")),C.g.translate(this.P,0,0,e),this.q()},w.Gi=function(){gd(this,0,0)},w.Hi=function(){gd(this,1,1)},w.Ii=function(){gd(this,2,2)},w.q=function(){this.j=q},x("X.transform",fd),x("X.transform.prototype.rotateX",fd.prototype.Ae),x("X.transform.prototype.rotateY",fd.prototype.Be),x("X.transform.prototype.rotateZ",fd.prototype.Ce),x("X.transform.prototype.translateX",fd.prototype.Ih),x("X.transform.prototype.translateY",fd.prototype.Jh),x("X.transform.prototype.translateZ",fd.prototype.Kh),x("X.transform.prototype.flipX",fd.prototype.Gi),x("X.transform.prototype.flipY",fd.prototype.Hi),x("X.transform.prototype.flipZ",fd.prototype.Ii),x("X.transform.prototype.modified",fd.prototype.q),A(hd,M),hd.prototype.__defineSetter__("rawData",function(e){this.Wb=e,this.j=q}),hd.prototype.__defineSetter__("rawDataHeight",function(e){this.af=e,this.j=q}),hd.prototype.__defineSetter__("rawDataWidth",function(e){this.bf=e,this.j=q}),hd.prototype.__defineSetter__("grayscale",function(e){this.mg=e,this.j=q}),x("X.texture",hd),A(S,M),w=S.prototype,w.add=function(e,t,n){return this.pb=Math.min(this.pb,e),this.mb=Math.max(this.mb,e),this.qb=Math.min(this.qb,t),this.nb=Math.max(this.nb,t),this.rb=Math.min(this.rb,n),this.ob=Math.max(this.ob,n),this.Sd=[(this.pb+this.mb)/2,(this.qb+this.nb)/2,(this.rb+this.ob)/2],this.lg=u,this.j=q,this.aa[this.C++]=e,this.aa[this.C++]=t,this.aa[this.C++]=n,this.C/3},w.Kb=function(){if(this.C!=this.aa.length){var e=new Float32Array(this.C);e.set(this.aa.subarray(0,this.C)),this.aa=e}},w.get=function(e){return e*=3,[this.aa[e],this.aa[e+1],this.aa[e+2]]},w.remove=function(){m(Error("Not implemented."))},w.clear=function(){this.aa=new Float32Array(this.aa.length),this.j=q},S.prototype.__defineGetter__("count",function(){return this.Kb(),this.aa.length/3}),S.prototype.__defineGetter__("length",function(){return this.Kb(),this.aa.length}),x("X.triplets",S),x("X.triplets.prototype.add",S.prototype.add),x("X.triplets.prototype.resize",S.prototype.Kb),x("X.triplets.prototype.get",S.prototype.get),x("X.triplets.prototype.remove",S.prototype.remove),x("X.triplets.prototype.clear",S.prototype.clear);var jd="TRIANGLES";id.prototype.__defineSetter__("type",function(e){return this.Ga=e}),id.prototype.__defineGetter__("type",v("Ga")),id.prototype.__defineGetter__("texture",function(){return this.G||(this.G=new hd),this.G}),id.prototype.__defineGetter__("transform",v("ga")),id.prototype.__defineGetter__("points",v("h")),id.prototype.__defineSetter__("points",ba("h")),id.prototype.__defineGetter__("normals",v("n")),id.prototype.__defineSetter__("normals",ba("n")),id.prototype.__defineGetter__("colors",v("oa")),id.prototype.__defineSetter__("colors",ba("oa")),id.prototype.__defineGetter__("color",v("w")),id.prototype.__defineSetter__("color",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid color."));for(var n=this.c,r=n.length,i=0,i=0;i<r;i++)n[i].color=e;this.w=e,this.j=q}),id.prototype.__defineGetter__("opacity",v("xa")),id.prototype.__defineSetter__("opacity",function(e){(!na(e)||1<e||0>e)&&m(Error("Invalid opacity."));for(var n=this.c,r=n.length,i=0,i=0;i<r;i++)n[i]!=t&&(n[i].opacity=e);this.xa=e,this.j=q}),id.prototype.__defineGetter__("caption",v("Ic")),id.prototype.__defineSetter__("caption",function(e){this.Ic=e,this.j=q}),id.prototype.__defineGetter__("visible",v("N")),id.prototype.__defineSetter__("visible",function(e){for(var n=this.c,r=n.length,i=0,i=0;i<r;i++)n[i]!=t&&(n[i].visible=e);this.N=e,this.j=q}),id.prototype.__defineGetter__("pointsize",v("td")),id.prototype.__defineSetter__("pointsize",function(e){na(e)||m(Error("Invalid point size.")),this.td=e,this.j=q}),id.prototype.__defineGetter__("magicmode",v("jd")),id.prototype.__defineSetter__("magicmode",function(e){"boolean"!=typeof e&&m(Error("Invalid magic mode setting.")),this.jd=e,this.j=q}),id.prototype.__defineGetter__("linewidth",v("Pc")),id.prototype.__defineSetter__("linewidth",function(e){na(e)||m(Error("Invalid line width.")),this.Pc=e,this.j=q}),id.prototype.__defineGetter__("pickable",v("sd")),id.prototype.__defineSetter__("pickable",function(e){"boolean"!=typeof e&&m(Error("Invalid pickable setting.")),this.sd=e,this.j=q}),id.prototype.__defineGetter__("textureCoordinateMap",v("sc")),id.prototype.__defineSetter__("textureCoordinateMap",ba("yl")),kd.prototype.__defineGetter__("lowerThreshold",v("T")),kd.prototype.__defineSetter__("lowerThreshold",ba("T")),kd.prototype.__defineGetter__("upperThreshold",v("U")),kd.prototype.__defineSetter__("upperThreshold",ba("U")),kd.prototype.__defineGetter__("min",v("qa")),kd.prototype.__defineGetter__("max",v("fa")),kd.prototype.__defineGetter__("minColor",v("Sb")),kd.prototype.__defineSetter__("minColor",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid min. color.")),this.Sb=e}),kd.prototype.__defineGetter__("maxColor",v("Qb")),kd.prototype.__defineSetter__("maxColor",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid max. color.")),this.Qb=e}),A(ld,M),ld.prototype.__defineGetter__("array",v("I")),ld.prototype.__defineSetter__("array",function(e){this.dd=this.I=e,this.j=q}),ld.prototype.__defineGetter__("interpolation",v("Pe")),ld.prototype.__defineSetter__("interpolation",ba("Pe")),x("X.scalars",ld),A(T,M),T.prototype.wc=function(e){this.Ga=e.Ga,this.ga=new fd,this.ga.P=new Float32Array(e.ga.P),this.w=e.w.slice(),e.h&&(this.h=new S(e.h.length,e.h)),e.n&&(this.n=new S(e.n.length,e.n)),e.oa&&(this.oa=new S(e.oa.length,e.oa)),this.G=e.G,this.sc=e.sc,e.r&&(this.r=new xc((new String(e.r.be)).toString())),this.xa=e.xa,this.c.length=0;var t=e.c;if(t)for(var n=t.length,r=0,r=0;r<n;r++)this.c.push(new C[t[r].f](t[r]));this.N=e.N,this.td=e.td,this.Pc=e.Pc,e.Ic&&(this.Ic=(new String(e.Ic)).toString()),this.jd=e.jd,this.sd=e.sd,this.Sc=e.Sc.slice(),this.j=q},T.prototype.__defineGetter__("colortable",function(){return this.va||(this.va=new Ec),this.va}),T.prototype.__defineGetter__("scalars",function(){return this.F||(this.F=new ld),this.F}),T.prototype.__defineGetter__("children",v("c")),T.prototype.q=function(){var e=new md;e.D=this,this.dispatchEvent(e)},T.prototype.remove=function(){var e=new nd;e.D=this,this.dispatchEvent(e)},T.prototype.Ta=function(){ec(this);if(0<this.c.length)for(var e=this.c,n=e.length,r=0,r=0;r<n;r++)"undefined"!=typeof e[r]&&this.c[r].Ta();this.c.length=0,this.F=this.va=t},x("X.object",T),x("X.object.prototype.modified",T.prototype.q),x("X.object.prototype.remove",T.prototype.remove),x("X.object.prototype.destroy",T.prototype.Ta),pd.prototype.bg=function(e){(e==t||!(e instanceof uc)&&!(e instanceof T))&&m(Error("Invalid object."));var n=e;return e instanceof T&&(n=qd(n)),e=new T,Ga(e,new pd),rd(e,qd(this).bg(n)),e},pd.prototype.ua=function(e){(e==t||!(e instanceof uc)&&!(e instanceof T))&&m(Error("Invalid object."));var n=e;return e instanceof T&&(n=qd(n)),e=new T,Ga(e,new pd),rd(e,qd(this).ua(n)),e},pd.prototype.Af=function(e){(e==t||!(e instanceof uc)&&!(e instanceof T))&&m(Error("Invalid object."));var n=e;return e instanceof T&&(n=qd(n)),e=new T,Ga(e,new pd),rd(e,qd(this).Af(n)),e},pd.prototype.inverse=function(){var e=new T;return Ga(e,new pd),rd(e,qd(this).inverse()),e},x("X.constructable",pd),x("X.constructable.prototype.intersect",pd.prototype.Af),x("X.constructable.prototype.inverse",pd.prototype.inverse),x("X.constructable.prototype.subtract",pd.prototype.ua),x("X.constructable.prototype.union",pd.prototype.bg),A(sd,Sb);var td=jc("pan"),ud=jc("rotate"),vd=jc("zoom"),wd=jc("scroll");jc("render");var xd=jc("resetview"),yd=jc("windowlevel"),zd=jc("modified"),Ad=jc("remove"),Bd=jc("progress"),Cd=jc("hover"),Dd=jc("hover_end"),Ed=jc("computing"),Fd=jc("computing_end"),Gd=jc("computing_progress");A(Hd,sd),A(Id,sd),A(Jd,sd),A(Kd,sd),A(Ld,sd),A(Md,sd),A(Nd,sd),A(Od,sd),A(md,sd),A(nd,sd),A(Pd,sd),A(Qd,sd),A(Rd,sd),A(Sd,sd),x("X.event.events.PAN",td),x("X.event.events.ROTATE",ud),x("X.event.events.ZOOM",vd),x("X.event.events.SCROLL",wd),A(Td,M);var Ud;w=Wd.prototype,w.l=function(){return new Wd(this.width,this.height)},w.ceil=function(){return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},w.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},w.round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},w.scale=function(e,t){var n=na(t)?t:e;return this.width*=e,this.height*=n,this};var Xd=!jb||jb&&9<=Fb;!lb&&!jb||jb&&jb&&9<=Fb||lb&&Db("1.9.1"),jb&&Db("9"),w=Yd.prototype,w.l=function(){return new Yd(this.x,this.y)},w.ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},w.floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},w.round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},w.translate=function(e,t){return e instanceof Yd?(this.x+=e.x,this.y+=e.y):(this.x+=e,na(t)&&(this.y+=t)),this},w.scale=function(e,t){var n=na(t)?t:e;return this.x*=e,this.y*=n,this};var de={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};w=ae.prototype,w.pe=$d,w.t=function(e){return ma(e)?this.ia.getElementById(e):e},w.Qh=ae.prototype.t,w.Xc=function(e,t,n){return fe(this.ia,arguments)},w.createElement=function(e){return this.ia.createElement(e)},w.createTextNode=function(e){return this.ia.createTextNode(String(e))},w.appendChild=function(e,t){e.appendChild(t)},w.contains=je,w=me.prototype,w.l=function(){return new me(this.top,this.right,this.bottom,this.left)},w.contains=function(e){return!this||!e?u:e instanceof me?e.left>=this.left&&e.right<=this.right&&e.top>=this.top&&e.bottom<=this.bottom:e.x>=this.left&&e.x<=this.right&&e.y>=this.top&&e.y<=this.bottom},w.ceil=function(){return this.top=Math.ceil(this.top),this.right=Math.ceil(this.right),this.bottom=Math.ceil(this.bottom),this.left=Math.ceil(this.left),this},w.floor=function(){return this.top=Math.floor(this.top),this.right=Math.floor(this.right),this.bottom=Math.floor(this.bottom),this.left=Math.floor(this.left),this},w.round=function(){return this.top=Math.round(this.top),this.right=Math.round(this.right),this.bottom=Math.round(this.bottom),this.left=Math.round(this.left),this},w.translate=function(e,t){return e instanceof Yd?(this.left+=e.x,this.right+=e.x,this.top+=e.y,this.bottom+=e.y):(this.left+=e,this.right+=e,na(t)&&(this.top+=t,this.bottom+=t)),this},w.scale=function(e,t){var n=na(t)?t:e;return this.left*=e,this.right*=e,this.top*=n,this.bottom*=n,this},w=ne.prototype,w.l=function(){return new ne(this.left,this.top,this.width,this.height)},w.Yg=function(e){var t=Math.max(this.left,e.left),n=Math.min(this.left+this.width,e.left+e.width);if(t<=n){var r=Math.max(this.top,e.top);e=Math.min(this.top+this.height,e.top+e.height);if(r<=e)return this.left=t,this.top=r,this.width=n-t,this.height=e-r,q}return u},w.contains=function(e){return e instanceof ne?this.left<=e.left&&this.left+this.width>=e.left+e.width&&this.top<=e.top&&this.top+this.height>=e.top+e.height:e.x>=this.left&&e.x<=this.left+this.width&&e.y>=this.top&&e.y<=this.top+this.height},w.wf=function(e){return Math.sqrt(oe(this,e))},w.ceil=function(){return this.left=Math.ceil(this.left),this.top=Math.ceil(this.top),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},w.floor=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},w.round=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.width=Math.round(this.width),this.height=Math.round(this.height),this},w.translate=function(e,t){return e instanceof Yd?(this.left+=e.x,this.top+=e.y):(this.left+=e,na(t)&&(this.top+=t)),this},w.scale=function(e,t){var n=na(t)?t:e;return this.left*=e,this.width*=e,this.top*=n,this.height*=n,this};var Fe={thin:2,medium:4,thick:6},ye=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;A(He,kc),He.prototype.handleEvent=function(e){var t=0,n=0,r=0;e=e.vb;if("mousewheel"==e.type){n=1;if(jb||mb&&(bb||Db("532.0")))n=40;r=Ie(-e.wheelDelta,n),ia(e.wheelDeltaX)?(t=Ie(-e.wheelDeltaX,n),n=Ie(-e.wheelDeltaY,n)):n=r}else r=e.detail,100<r?r=3:-100>r&&(r=-3),ia(e.axis)&&e.axis===e.HORIZONTAL_AXIS?t=r:n=r;na(this.dh)&&(t=Math.min(Math.max(t,-this.dh),this.dh)),na(this.eh)&&(n=Math.min(Math.max(n,-this.eh),this.eh)),this.fj&&(t=-t),t=new Je(r,e,t,n),this.dispatchEvent(t)},A(Je,Ub),jb||mb&&Db("525"),A(Ke,M),Ke.prototype.__defineGetter__("config",v("R")),Ke.prototype.__defineGetter__("leftButtonDown",v("lb")),Ke.prototype.__defineGetter__("middleButtonDown",v("Rb")),Ke.prototype.__defineGetter__("rightButtonDown",v("Xb")),Ke.prototype.Ba=function(){this.R.MOUSEWHEEL_ENABLED?(this.We=new He(this.Oa),this.vg=D(this.We,"mousewheel",this.Ld.bind(this))):(cc(this.vg),this.We=t),this.R.MOUSECLICKS_ENABLED?(this.rg=D(this.Oa,"mousedown",this.Aj.bind(this)),this.ug=D(this.Oa,"mouseup",this.Fj.bind(this))):(cc(this.rg),cc(this.ug)),this.Oa.oncontextmenu=this.R.CONTEXTMENU_ENABLED?t:function(){return u},window.onkeydown=this.R.KEYBOARD_ENABLED?this.nh.bind(this):t,this.R.TOUCH_ENABLED?(this.R.TOUCH_BOUNCING_ENABLED||document.body.addEventListener("touchmove",function(e){e.preventDefault()},u),this.hi=D(this.Oa,"touchstart",this.Uj.bind(this)),this.gi=D(this.Oa,"touchmove",this.Sj.bind(this)),this.fi=D(this.Oa,"touchend",this.Oj.bind(this))):(cc(this.hi),cc(this.gi),cc(this.fi)),cc(this.sg),cc(this.tg),this.sg=D(this.Oa,"mousemove",this.Cj.bind(this)),this.tg=D(this.Oa,"mouseout",this.Dj.bind(this))},Ke.prototype.Aj=function(a){0==a.button?this.lb=q:1==a.button?this.Rb=q:2==a.button&&(this.Xb=q),eval("this.onMouseDown("+this.lb+","+this.Rb+","+this.Xb+")"),Le(this),a.preventDefault()},Ke.prototype.zj=aa(),Ke.prototype.Fj=function(a){0==a.button?this.lb=u:1==a.button?this.Rb=u:2==a.button&&(this.Xb=u);if(Math.abs(this.ib.x)>Math.abs(this.ib.y)){var b=new CustomEvent("flipColumns");this.dispatchEvent(b)}else Math.abs(this.ib.y)>Math.abs(this.ib.x)&&(b=new CustomEvent("flipRows"),this.dispatchEvent(b));this.ib={x:0,y:0,d:0},eval("this.onMouseUp("+this.lb+","+this.Rb+","+this.Xb+")"),Le(this),a.preventDefault()},Ke.prototype.__defineGetter__("mousePosition",v("qd")),w=Ke.prototype,w.Ej=aa(),w.Dj=function(e){this.$d=u,this.R.KEYBOARD_ENABLED&&(window.onkeydown=t),this.Xb=this.Rb=this.lb=u,Le(this),this.Re=new C.m(0,0,0),e.preventDefault()},w.Bj=aa(),w.Uj=function(a){a.preventDefault(),a.Ba(a.vb.targetTouches[0],a.currentTarget),eval("this.onTouchStart("+a.clientX+","+a.clientY+")"),this.gd=new C.m(a.clientX,a.clientY,0),this.Cg=setTimeout(this.Qj.bind(this,a),500)},w.Tj=aa(),w.Qj=function(a){eval("this.onTouchHover("+a.clientX+","+a.clientY+")"),a=new Kd,a.yb=q,a.hb=this instanceof Me,this.dispatchEvent(a),this.de=q},w.Pj=aa(),w.Oj=function(a){a.preventDefault(),eval("this.onTouchEnd()"),Ne(this)},w.Nj=aa(),w.Sj=function(a){a.preventDefault(),this.de||Ne(this),this.touchmoveEvent=a=a.vb,eval("this.onTouchMove(this['touchmoveEvent'])");var b=a.targetTouches;if(1==b.length){a=b[0];var c=[a.clientX,a.clientY];a=new C.m(c[0],c[1],0);var b=c[0]>3*this.Oa.clientWidth/4,e=c[0]<this.Oa.clientWidth/4,d=c[1]<this.Oa.clientHeight/4,c=c[1]>3*this.Oa.clientHeight/4,c=!b&&!e&&!d&&!c,d=this.gd.ua(a);this.gd=a.l();if(this.de)a=new Id,5<d.x?d.x=1:-5>d.x&&(d.x=-1),5<d.y?d.y=1:-5>d.y&&(d.y=-1),a.wa=d,this.dispatchEvent(a);else if(this instanceof Oe&&(b||e))a=new Ld,a.ha=0>d.y,this.dispatchEvent(a);else if(this instanceof Me||c)d.scale(3),a=new Jd,a.wa=d,this.dispatchEvent(a)}else 2==b.length&&(a=b[0],b=b[1],a=[a.clientX,a.clientY],b=[b.clientX,b.clientY],a=new C.m(a[0],a[1],0),b=new C.m(b[0],b[1],0),d=Hc(a,b),b=d-this.$g,this.$g=d,this.gd.ua(a),this.gd=a.l(),10<Math.abs(b)&&(a=new Kd,a.yb=0<b,a.hb=this instanceof Me,this.dispatchEvent(a)))},w.Rj=aa(),w.Cj=function(a){this.mousemoveEvent=a,eval("this.onMouseMove(this['mousemoveEvent'])"),this.$d=q,this.R.KEYBOARD_ENABLED&&window.onkeydown==t&&(window.onkeydown=this.nh.bind(this)),a.preventDefault();var b=a.shiftKey,c=a.ctrlKey;this.Bg=b,this.qd=[a.offsetX,a.offsetY];var e=new C.m(this.qd[0],this.qd[1],0);a=this.Re.ua(e),this.Re=e.l(),this.R.HOVERING_ENABLED&&((0<Math.abs(a.x)||0<Math.abs(a.y)||this.Rb||this.lb||this.Xb)&&Le(this),this.Yd=setTimeout(function(){Le(this);var n=new Md;n.he=e.x,n.ie=e.y,this.dispatchEvent(n),this.Yd=t}.bind(this),300)),0!=a.Jb()&&(this.lb&&!b&&!c?(b=new Jd,a.scale(3),b.wa=a,this.dispatchEvent(b)):this.Rb||this.lb&&b?(b=new Id,b.wa=a,this.dispatchEvent(b)):this.Xb?(b=new Kd,b.yb=0<a.y,b.hb=u,this.dispatchEvent(b)):this.lb&&c&&(this.ib.x+=a.x,this.ib.y+=a.y,this.ib.d+=a.d))},w.Gj=aa(),w.Ld=function(a){this.mouseWheelEvent=a,eval("this.onMouseWheel(this['mouseWheelEvent'])"),Le(this),a.preventDefault()},w.xj=aa(),w.nh=function(a){if(this.$d){this.keyEvent=a,eval("this.onKey(this['keyEvent'])"),Le(this);var b=a.altKey,c=a.ctrlKey,e=a.metaKey,d=a.shiftKey,f=a.keyCode;82==f&&!b&&!c&&!e&&!d?(a=new Od,this.dispatchEvent(a)):81==f&&!b&&!c&&!e&&!d?(a=new CustomEvent("flipRows"),this.dispatchEvent(a)):87==f&&!b&&!c&&!e&&!d?(a=new CustomEvent("flipColumns"),this.dispatchEvent(a)):37<=f&&40>=f&&(a.preventDefault(),d?a=new Id:b?a=new Kd:(a=new Jd,this instanceof Oe&&(a=new Ld)),a&&(c=new C.m(0,0,0),37==f?(c.x=5,a.ha=u,b&&(a.ha=q,a.yb=q,a.hb=u)):39==f?(c.x=-5,a.ha=q,b&&(a.yb=u,a.hb=u)):38==f?(c.y=5,a.ha=q,b&&(a.yb=q,a.hb=q)):40==f&&(c.y=-5,a.ha=u,b&&(a.yb=u,a.hb=q)),a.wa=c,this.dispatchEvent(a)))}},x("X.interactor",Ke),x("X.interactor.prototype.init",Ke.prototype.Ba),x("X.interactor.prototype.onMouseDown",Ke.prototype.zj),x("X.interactor.prototype.onMouseUp",Ke.prototype.Ej),x("X.interactor.prototype.onMouseMove",Ke.prototype.Bj),x("X.interactor.prototype.onMouseWheel",Ke.prototype.Gj),x("X.interactor.prototype.onKey",Ke.prototype.xj),x("X.interactor.prototype.onTouchStart",Ke.prototype.Tj),x("X.interactor.prototype.onTouchMove",Ke.prototype.Rj),x("X.interactor.prototype.onTouchEnd",Ke.prototype.Nj),x("X.interactor.prototype.onTouchHover",Ke.prototype.Pj),A(Oe,Ke),Oe.prototype.Ld=function(e){Oe.u.Ld.call(this,e);var n=new Ld;e.Yc==t&&(e.Yc=0),n.up=0>e.Yc,this.dispatchEvent(n)},A(Pe,M),Pe.prototype.observe=function(e){(e==t||!(e instanceof Ke))&&m(Error("Could not observe the interactor.")),D(e,ud,this.Kj.bind(this)),D(e,td,this.Hj.bind(this)),D(e,vd,this.Xj.bind(this))},Pe.prototype.Kj=function(e){e instanceof Jd||m(Error("Received no valid rotate event.")),this.rotate(e.wa)},Pe.prototype.Xj=function(e){e instanceof Kd||m(Error("Received no valid zoom event.")),e.yb?this.eg(e.hb):this.fg(e.hb)},Pe.prototype.Hj=function(e){e instanceof Id||m(Error("Received no valid pan event.")),this.Pf(e.wa)},Pe.prototype.__defineGetter__("view",v("o")),Pe.prototype.__defineSetter__("view",function(e){(e==t||!(e instanceof Float32Array))&&m(Error("Invalid view matrix.")),this.o=e}),Pe.prototype.__defineGetter__("position",function(){return[this.lc.x,this.lc.y,this.lc.d]}),Pe.prototype.__defineSetter__("position",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid position.")),this.lc=new C.m(e[0],e[1],e[2]),this.reset()}),Pe.prototype.__defineGetter__("focus",function(){return[this.Kc.x,this.Kc.y,this.Kc.d]}),Pe.prototype.__defineSetter__("focus",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid focus")),this.Kc=new C.m(e[0],e[1],e[2]),this.reset()}),Pe.prototype.__defineGetter__("up",function(){return[this.ha.x,this.ha.y,this.ha.d]}),Pe.prototype.__defineSetter__("up",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid up vector.")),this.ha=new C.m(e[0],e[1],e[2]),this.reset()}),w=Pe.prototype,w.reset=function(){this.o=this.we(this.lc,this.Kc)},w.rotate=function(e){return ja(e)&&2==e.length?e=new C.m(e[0],e[1],0):e instanceof C.m||m(Error("Invalid distance vector for rotate operation.")),e},w.Pf=function(e){ja(e)&&2==e.length?e=new C.m(e[0],e[1],0):e instanceof C.m||m(Error("Invalid distance vector for pan operation.")),this.o[12]-=e.x,this.o[13]+=e.y},w.eg=function(e){var n=20;e!=t&&!e&&(n=1),this.o[14]+=n},w.fg=function(e){var n=20;e!=t&&!e&&(n=1),this.o[14]-=n},w.we=function(e,t){return(!(e instanceof C.m)||!(t instanceof C.m))&&m(Error("3D vectors required for calculating the view.")),C.g.Fd()},x("X.camera",Pe),x("X.camera.prototype.pan",Pe.prototype.Pf),x("X.camera.prototype.rotate",Pe.prototype.rotate),x("X.camera.prototype.zoomIn",Pe.prototype.eg),x("X.camera.prototype.zoomOut",Pe.prototype.fg),A(Qe,Pe),Qe.prototype.rotate=function(e){e=Qe.u.rotate.call(this,e);var t=-e.x/5*Math.PI/180;e=-e.y/5*Math.PI/180;var n=new C.m(this.o[1],this.o[5],this.o[9]),r=new C.m(this.o[0],this.o[4],this.o[8]);n.normalize(),r.normalize(),C.g.rotate(this.o,t,n.x,n.y,n.d),C.g.rotate(this.o,e,r.x,r.y,r.d)},Qe.prototype.we=function(e,t){var n=Qe.u.we.call(this,e,t);return C.g.bh(n,e,t,this.ha),n},x("X.camera3D",Qe),A(Se,M),Se.prototype.parse=function(){m(Error("The function parse() should be overloaded."))},A(cf,Se),cf.prototype.parse=function(e,t,n,r){n instanceof ArrayBuffer||m(Error());for(var i=new Uint8Array(n),s=i.length,o=Array(s);s--;)o[s]=String.fromCharCode(i[s]);i=window.btoa(o.join("")),s=new Image,ac(s,"load",this.Zj.bind(this,s,e,t,n,r)),s.src="data:image/"+r+";base64,"+i},cf.prototype.Zj=function(e,n,r){n.jb=e,n.Wb=t,e=new md,e.D=r,e.v=n,this.dispatchEvent(e)},x("X.parserIMAGE",cf),x("X.parserIMAGE.prototype.parse",cf.prototype.parse),A(df,Pe),df.prototype.rotate=function(e){e=df.u.rotate.call(this,e);var t=new Hd;0<e.x?t.hf--:0>e.x&&t.hf++,0<e.y?t.Ve++:0>e.y&&t.Ve--,this.dispatchEvent(t)},df.prototype.eg=function(e){var n=20;e!=t&&!e&&(n=.02),this.o[14]+=n},df.prototype.fg=function(e){var n=20;e!=t&&!e&&(n=.02),this.o[14]-=n},df.prototype.Pf=function(e){ja(e)&&2==e.length?e=new C.m(e[0],e[1],0):e instanceof C.m||m(Error("Invalid distance vector for pan operation.")),this.o[12]-=e.x/this.o[14],this.o[13]+=e.y/this.o[14]},A(ef,M);var ff={el:"vertexPosition",dl:"vertexNormal",cl:"vertexColor",gl:"vertexTexturePos",fl:"vertexScalar"},gf={hl:"view",Mk:"perspective",Dk:"center",Lk:"objectTransform",Zk:"useObjectColor",Jk:"objectColor",al:"useScalars",Vk:"scalarsReplaceMode",Sk:"scalarsMin",Pk:"scalarsMax",Tk:"scalarsMinColor",Qk:"scalarsMaxColor",Uk:"scalarsMinThreshold",Rk:"scalarsMaxThreshold",Ok:"scalarsInterpolation",Nk:"pointSize",Kk:"objectOpacity",Ik:"normal",$k:"usePicking",bl:"useTexture",Yk:"useLabelMapTexture",Gk:"labelmapOpacity",Fk:"labelmapColor",Wk:"textureSampler",Xk:"textureSampler2",il:"volumeLowerThreshold",ol:"volumeUpperThreshold",ll:"volumeScalarMin",jl:"volumeScalarMax",ml:"volumeScalarMinColor",kl:"volumeScalarMaxColor",ql:"volumeWindowLow",pl:"volumeWindowHigh",nl:"volumeTexture"};A(Ye,T),Ye.prototype.wc=function(e){this.z=e.z.slice(),this.ic=e.ic.slice(),this.ha=e.ha.slice(),this.K=e.K,this.A=e.A,this.zb=e.zb,this.e=e.e,this.Cb=e.Cb,this.gc=e.gc,this.bi=e.bi,Ye.u.wc.call(this,e)},Ye.prototype.__defineSetter__("height",ba("A")),Ye.prototype.__defineSetter__("width",ba("K")),Ye.prototype.__defineGetter__("up",v("ha")),Ye.prototype.__defineGetter__("right",v("Tc")),Ye.prototype.create=function(){this.Hb()},Ye.prototype.Ta=function(){Ye.u.Ta.call(this),this.z.length=0,this.ic.length=0,this.ha.length=0,this.Tc.length=0,this.sc.length=0,this.e=this.zb=t,this.gc.length=0},Ye.prototype.Hb=function(){var e=(new O(this.ic[0],this.ic[1],this.ic[2])).normalize(),t=new O(this.ha[0],this.ha[1],this.ha[2]),n=new O(this.Tc[0],this.Tc[1],this.Tc[2]),r=new O(this.z[0],this.z[1],this.z[2]),i=Ic(n.l().W().scale(this.K/2),t.l().W().scale(this.A/2)),s=new O(i.x+r.x,i.y+r.y,i.d+r.d),i=Ic(n.l().W().scale(this.K/2),t.l().scale(this.A/2)),o=new O(i.x+r.x,i.y+r.y,i.d+r.d),i=Ic(n.l().scale(this.K/2),t.l().W().scale(this.A/2)),u=new O(i.x+r.x,i.y+r.y,i.d+r.d),i=Ic(n.l().scale(this.K/2),t.l().scale(this.A/2)),t=new O(i.x+r.x,i.y+r.y,i.d+r.d);this.h=new S(18),this.n=new S(18),this.h.add(s.x,s.y,s.d),this.h.add(o.x,o.y,o.d),this.h.add(u.x,u.y,u.d),this.h.add(u.x,u.y,u.d),this.h.add(t.x,t.y,t.d),this.h.add(o.x,o.y,o.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.n.add(e.x,e.y,e.d),this.Cb&&(e=new T,e.h=new S(24),e.n=new S(24),e.h.add(s.x,s.y,s.d),e.h.add(o.x,o.y,o.d),e.h.add(o.x,o.y,o.d),e.h.add(t.x,t.y,t.d),e.h.add(t.x,t.y,t.d),e.h.add(u.x,u.y,u.d),e.h.add(u.x,u.y,u.d),e.h.add(s.x,s.y,s.d),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.n.add(0,0,0),e.w=[this.gc[0],this.gc[1],this.gc[2]],e.Ga="LINES",e.Pc=2,this.c.push(e))},x("X.slice",Ye),x("X.slice.prototype.create",Ye.prototype.create),x("X.slice.prototype.destroy",Ye.prototype.Ta),A(N,T),N.prototype.wc=function(e){this.z=e.z.slice(),this.$=e.$.slice(),this.tb=e.tb.slice(),this.Db=e.Db,this.Mc=e.Mc,this.Eb=e.Eb,this.Nc=e.Nc,this.Fb=e.Fb,this.Oc=e.Oc,this.ig=e.ig.slice(),this.pc=new T(e.pc),this.qc=new T(e.qc),this.rc=new T(e.rc),this.fa=e.fa,this.J=e.J,this.Ra=e.Ra,this.ge=e.ge,this.V=e.V,this.e=e.e,this.Cb=e.Cb,N.u.wc.call(this,e)},N.prototype.Hb=function(e){this.c.length=0,this.pc.c.length=0,this.qc.c.length=0,this.rc.c.length=0,this.c.push(this.pc),this.c.push(this.qc),this.c.push(this.rc),this.Da=e.Fc,this.bd=e.Gc,this.gb=e.Ec,this.Hc=e.cb,this.Vh=e.fb,this.fa=e.max,this.J=e.data,this.j=q},N.prototype.Ta=function(){N.u.Ta.call(this),this.jb.length=0,this.c.length=0,this.pc.c.length=0,this.pc.length=0,this.qc.c.length=0,this.qc.length=0,this.rc.c.length=0,this.rc.length=0,this.J=t,this.ka.length=0,this.b.length=0,this.s.length=0,this.gb.length=0,this.bd.length=0,this.na.length=0,this.gg.length=0,this.$a=t},N.prototype.q=function(e){e="undefined"!=typeof e?e:q;if(0<this.c.length){this.Ra!=this.ge&&(!this.Ra&&-1!=this.V&&(this.c[this.V].visible=u),this.j=q,this.ge=this.Ra);if(!this.N)return;for(var n=0,n=0;3>n;n++){var r=this.c[n],i=0,s=0;0==n?(i=this.Db,s=this.Mc,this.Mc=this.Db):1==n?(i=this.Eb,s=this.Nc,this.Nc=this.Eb):2==n&&(i=this.Fb,s=this.Oc,this.Oc=this.Fb);if(this.c[n].c[parseInt(i,10)]==t){var o=Nc();o[0]=this.b[n].k[0][0][0]+this.b[n].B[0]*parseInt(i,10),o[1]=this.b[n].k[0][0][1]+this.b[n].B[1]*parseInt(i,10),o[2]=this.b[n].k[0][0][2]+this.b[n].B[2]*parseInt(i,10);if(this.Q){var a=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.e.na,this.e,this.e.Q,this.e.va.Ia);this.e.c[n].c[parseInt(i,10)]=a,this.e.c[n].q(q)}o=Xe(o,this.b[n].Ea,this.b[n].i,this.b[n].w,this.ka,this.na,this,q,t),this.Q&&(o.e=o.G,o.e=this.e.c[n].c[parseInt(i,10)].G),r.c[parseInt(i,10)]=o,this.c[n].q(q)}s=r.c[parseInt(s,10)],this.Ra||(s.visible=u),r=r.c[parseInt(i,10)],r.visible=q,r.xa=1,this.Ra&&(r.c[0].N=u,n!=this.V&&(r.visible=u,r.xa=0))}this.Ra&&-1!=this.V&&hf(this,this.V)}e&&N.u.q.call(this)},N.prototype.__defineGetter__("dimensions",v("$")),N.prototype.__defineSetter__("dimensions",ba("$")),N.prototype.__defineGetter__("spacing",v("tb")),N.prototype.__defineSetter__("spacing",ba("tb")),N.prototype.__defineGetter__("bbox",v("ka")),N.prototype.__defineGetter__("range",v("vd")),N.prototype.__defineGetter__("dimensionsRAS",v("ig")),N.prototype.__defineGetter__("volumeRendering",v("Ra")),N.prototype.__defineSetter__("volumeRendering",function(e){this.Ra=e,this.q(u)}),N.prototype.__defineGetter__("visible",v("N")),N.prototype.__defineSetter__("visible",function(e){if(e)this.N=e,this.q(u);else{for(var t=this.c,n=t.length,r=0,r=0;r<n;r++)t[r].visible=e;this.N=e,this.j=q}}),N.prototype.__defineGetter__("center",v("z")),N.prototype.__defineSetter__("center",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid center.")),this.z=e}),N.prototype.__defineGetter__("volumeRenderingCache",v("fe")),N.prototype.__defineSetter__("volumeRenderingCache",function(e){(e==t||!ja(e)||!(3>=e.length))&&m(Error("Invalid volumeRederingCache.")),this.fe=e}),N.prototype.__defineGetter__("image",v("jb")),N.prototype.__defineGetter__("labelmap",function(){return this.e||(this.e=new jf(this)),this.e}),N.prototype.__defineGetter__("indexX",v("Db")),N.prototype.__defineSetter__("indexX",function(e){na(e)&&0<=e&&e<this.pc.c.length&&(this.Db=e,this.q(u))}),N.prototype.__defineGetter__("indexY",v("Eb")),N.prototype.__defineSetter__("indexY",function(e){na(e)&&0<=e&&e<this.qc.c.length&&(this.Eb=e,this.q(u))}),N.prototype.__defineGetter__("indexZ",v("Fb")),N.prototype.__defineSetter__("indexZ",function(e){na(e)&&0<=e&&e<this.rc.c.length&&(this.Fb=e,this.q(u))}),N.prototype.__defineGetter__("windowLow",v("ca")),N.prototype.__defineSetter__("windowLow",ba("ca")),N.prototype.__defineGetter__("windowHigh",v("ba")),N.prototype.__defineSetter__("windowHigh",ba("ba")),N.prototype.__defineGetter__("borders",v("Cb")),N.prototype.__defineSetter__("borders",ba("Cb")),N.prototype.__defineGetter__("reslicing",v("Ag")),N.prototype.__defineSetter__("reslicing",ba("Ag")),N.prototype.__defineGetter__("resolutionFactor",v("ce")),N.prototype.__defineSetter__("resolutionFactor",ba("ce")),N.prototype.__defineSetter__("xNormX",function(e){this.b[0].i[0]=e}),N.prototype.__defineGetter__("xNormX",function(){return this.b[0].i[0]}),N.prototype.__defineSetter__("xNormY",function(e){this.b[0].i[1]=e}),N.prototype.__defineGetter__("xNormY",function(){return this.b[0].i[1]}),N.prototype.__defineSetter__("xNormZ",function(e){this.b[0].i[2]=e}),N.prototype.__defineGetter__("xNormZ",function(){return this.b[0].i[2]}),N.prototype.__defineSetter__("xColor",function(e){this.b[0].w=e}),N.prototype.__defineGetter__("xColor",function(){return this.b[0].w}),N.prototype.__defineSetter__("yNormX",function(e){this.b[1].i[0]=e}),N.prototype.__defineGetter__("yNormX",function(){return this.b[1].i[0]}),N.prototype.__defineSetter__("yNormY",function(e){this.b[1].i[1]=e}),N.prototype.__defineGetter__("yNormY",function(){return this.b[1].i[1]}),N.prototype.__defineSetter__("yNormZ",function(e){this.b[1].i[2]=e}),N.prototype.__defineGetter__("yNormZ",function(){return this.b[1].i[2]}),N.prototype.__defineSetter__("yColor",function(e){this.b[1].w=e}),N.prototype.__defineGetter__("yColor",function(){return this.b[1].w}),N.prototype.__defineSetter__("zNormX",function(e){this.b[2].i[0]=e}),N.prototype.__defineGetter__("zNormX",function(){return this.b[2].i[0]}),N.prototype.__defineSetter__("zNormY",function(e){this.b[2].i[1]=e}),N.prototype.__defineGetter__("zNormY",function(){return this.b[2].i[1]}),N.prototype.__defineSetter__("zNormZ",function(e){this.b[2].i[2]=e}),N.prototype.__defineGetter__("zNormZ",function(){return this.b[2].i[2]}),N.prototype.__defineSetter__("zColor",function(e){this.b[2].w=e}),N.prototype.__defineGetter__("zColor",function(){return this.b[2].w}),N.prototype.lk=function(e){this.c[e].visible=u;for(var n=0;n<this.c[e].c.length;n++)"undefined"!=typeof this.c[e].c[n]&&(this.Q&&(this.e.c[e].c[n].remove(),this.e.c[e].c[n]=t),this.c[e].c[n].remove(),this.c[e].c[n]=t);Pc(this.b[e].i,this.b[e].i),af(e,this.b[e].wd,this.b[e].i,this),this.c[e].c=[],this.c[e].c=Array(this.b[e].p),this.Q&&(n=Xe(this.b[e].wd,this.b[e].Ea,this.b[e].i,this.b[e].w,this.ka,this.e.na,this.e,this.e.Q,this.e.va.Ia),this.e.c[e].c=[],this.e.c[e].c=Array(this.b[e].p),this.e.c[e].c[Math.floor(this.b[e].p/2)]=n,this.e.c[e].q()),n=Xe(this.b[e].wd,this.b[e].Ea,this.b[e].i,this.b[e].w,this.ka,this.na,this,q,t),window.console.log("modified!"),this.Q&&(n.e=n.G,n.e=this.e.c[e].c[Math.floor(this.b[e].p/2)].G),this.c[e].c[Math.floor(this.b[e].p/2)]=n,0==e?(this.Db=Math.floor(this.b[e].p/2),this.Mc=Math.floor(this.b[e].p/2)):1==e?(this.Eb=Math.floor(this.b[e].p/2),this.Nc=Math.floor(this.b[e].p/2)):(this.Fb=Math.floor(this.b[e].p/2),this.Oc=Math.floor(this.b[e].p/2)),this.c[e].q(),this.c[e].c[Math.floor(this.b[e].p/2)].N=q},N.prototype.Jf=aa(),N.prototype.Lf=aa(),N.prototype.Kf=aa(),x("X.volume",N),x("X.volume.prototype.modified",N.prototype.q),x("X.volume.prototype.destroy",N.prototype.Ta),x("X.volume.prototype.sliceInfoChanged",N.prototype.lk),x("X.volume.prototype.onComputing",N.prototype.Jf),x("X.volume.prototype.onComputingProgress",N.prototype.Lf),x("X.volume.prototype.onComputingEnd",N.prototype.Kf),A(lf,Se),lf.prototype.parse=function(e,t,n){function r(){a===i&&m(Error("End of file reached unexpectedly."));for(var e=a;e<i;++e)if(10===s[e]){var t=Ue(s,a,e);return a=e+1,t}return a=i,Ue(s,a,i-1)}C.Ha(this.f+".parse"),this.J=n;var i=n.byteLength,s=V(this,"uchar",i);n=[],t.h=new S(i),t.n=new S(i);for(var o=t.h,u=t.n,a=0,f=r(),f=("OFF"===f?r():f).split(" "),l=f[0],f=f[1];l--;){var c=r(),c=c.split(" ");n.push([parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2])])}for(;f--;){var c=r(),c=c.split(" "),h=n[parseInt(c[1],10)],l=n[parseInt(c[2],10)],c=n[parseInt(c[3],10)];o.add(h[0],h[1],h[2]),o.add(l[0],l[1],l[2]),o.add(c[0],c[1],c[2]),h=new O(h[0],h[1],h[2]),c=new O(c[0],c[1],c[2]),l=Jc((new O(l[0],l[1],l[2])).ua(h),c.ua(h)),l.normalize(),u.add(l.x,l.y,l.d),u.add(l.x,l.y,l.d),u.add(l.x,l.y,l.d)}C.Ca(this.f+".parse"),n=new md,n.D=t,n.v=e,this.dispatchEvent(n)},x("X.parserOFF",lf),x("X.parserOFF.prototype.parse",lf.prototype.parse),A(mf,Se),mf.prototype.parse=function(e,n,r){n.Dc={},n.Dc.Cf=0,this.Ac(r,n);if(n.r.length==t||n.sa.length==n.r.length){n.Dc.Cf=n.r.length;var i={};r={};for(var s=0;s<n.sa.length;s++)i.hasOwnProperty(n.sa[s].series_instance_uid)||(i[n.sa[s].series_instance_uid]=[],r[n.sa[s].series_instance_uid]={}),r[n.sa[s].series_instance_uid].hasOwnProperty(n.sa[s].sop_instance_uid)||(r[n.sa[s].series_instance_uid][n.sa[s].sop_instance_uid]=q,i[n.sa[s].series_instance_uid].push(n.sa[s]));var o=Object.keys(i)[0],s=i[o],a=s.length;r={};var f="image_position_patient";1==a?(f="image_position_patient",i[o][0].dist=0):s[0].image_position_patient[0]!=s[1].image_position_patient[0]||s[0].image_position_patient[1]!=s[1].image_position_patient[1]||s[0].image_position_patient[2]!=s[1].image_position_patient[2]?(f="image_position_patient",i=new O(s[0].image_orientation_patient[0],s[0].image_orientation_patient[1],s[0].image_orientation_patient[2]),o=new O(s[0].image_orientation_patient[3],s[0].image_orientation_patient[4],s[0].image_orientation_patient[5]),i=Jc(i,o),s.map(function(e,t){return t.dist=t.image_position_patient[0]*e.x+t.image_position_patient[1]*e.y+t.image_position_patient[2]*e.d,t}.bind(t,i)),s.sort(function(e,t){return e.dist-t.dist})):s[0].instance_number!=s[1].instance_number?(f="instance_number",s.sort(function(e,t){return e.instance_number-t.instance_number})):m(Error("Unsupported DICOM data type: Could not resolve the ordering mode")),isNaN(s[0].pixel_spacing[0])&&(s[0].pixel_spacing[0]=1),isNaN(s[0].pixel_spacing[1])&&(s[0].pixel_spacing[1]=1);if(1<a)switch(f){case"image_position_patient":var l=s[0].image_position_patient,i=s[1].image_position_patient,o=i[0]-l[0],c=i[1]-l[1],h=i[2]-l[2];s[0].pixel_spacing[2]=Math.sqrt(o*o+c*c+h*h);break;case"instance_number":s[0].pixel_spacing[2]=1;break;default:window.console.log("Unkown ordering mode - returning: "+f)}else s[0].pixel_spacing[2]=1;i=1;switch(f){case"image_position_patient":var l=s[0].image_position_patient,p=s[a-1].image_position_patient,o=p[0]-l[0],c=p[1]-l[1],h=p[2]-l[2],o=Math.sqrt(o*o+c*c+h*h),i=i+Math.round(o/s[0].pixel_spacing[2]);break;case"instance_number":i+=Math.abs(s[a-1].instance_number-s[0].instance_number);break;default:window.console.log("Unkown ordering mode - returning: "+f)}l=s[0].columns*s[0].rows,o=l*i,p=t;switch(s[0].lf){case 8:p=new Uint8Array(o);break;case 16:p=new Uint16Array(o);break;case 32:p=new Uint32Array(o);default:window.console.log("Unknown number of bits allocated - using default: 32 bits")}n.tb=s[0].pixel_spacing;for(var d=0;d<a;d++){var v=s[d].data,o=0;switch(f){case"image_position_patient":o=s[d].image_position_patient[0]-s[0].image_position_patient[0],c=s[d].image_position_patient[1]-s[0].image_position_patient[1],h=s[d].image_position_patient[2]-s[0].image_position_patient[2],o=Math.round(Math.sqrt(o*o+c*c+h*h)/s[0].pixel_spacing[2]);break;case"instance_number":o=s[d].instance_number-s[0].instance_number;break;default:window.console.log("Unkown ordering mode - returning: "+f)}p.set(v,o*l)}r.data=p,n.J=p,n.$=[s[0].columns,s[0].rows,i],r.Fl=n.$,i=Te(p),a=i[0],i=i[1],r.min=n.qa=n.ca=a,r.max=n.fa=n.ba=i,-Infinity==n.T&&(n.T=a),Infinity==n.U&&(n.U=i),c=s[0].image_position_patient,a=Sc();if("false"==n.reslicing||n.reslicing==u)Q(a,0,s[0].pixel_spacing[0],0,0,0),Q(a,1,0,s[0].pixel_spacing[1],0,0),Q(a,2,0,0,s[0].pixel_spacing[2],0),Q(a,3,0,0,0,1);else switch(f){case"image_position_patient":i=new O(s[0].image_orientation_patient[0],s[0].image_orientation_patient[1],s[0].image_orientation_patient[2]),o=new O(s[0].image_orientation_patient[3],s[0].image_orientation_patient[4],s[0].image_orientation_patient[5]),i=Jc(i,o),Q(a,0,-s[0].image_orientation_patient[0]*s[0].pixel_spacing[0],-s[0].image_orientation_patient[3]*s[0].pixel_spacing[1],-i.x*s[0].pixel_spacing[2],-c[0]),Q(a,1,-s[0].image_orientation_patient[1]*s[0].pixel_spacing[0],-s[0].image_orientation_patient[4]*s[0].pixel_spacing[1],-i.y*s[0].pixel_spacing[2],-c[1]),Q(a,2,s[0].image_orientation_patient[2]*s[0].pixel_spacing[0],s[0].image_orientation_patient[5]*s[0].pixel_spacing[1],i.d*s[0].pixel_spacing[2],c[2]),Q(a,3,0,0,0,1);break;case"instance_number":Q(a,0,-1,0,0,-c[0]),Q(a,1,0,-1,0,-c[1]),Q(a,2,0,0,1,c[2]),Q(a,3,0,0,0,1);break;default:window.console.log("Unkown ordering mode - returning: "+f)}r.cb=a,r.fb=Sc(),bd(r.cb,r.fb),f=Rc(0,0,0,1),s=Qc(),dd(a,f,s),f=Rc(1,1,1,1),i=Qc(),dd(a,f,i),r.Gc=[i[0]-s[0],i[1]-s[1],i[2]-s[2]],s=Ve(a,[n.$[0],n.$[1],n.$[2]]),r.Ec=[s[1]-s[0]+1,s[3]-s[2]+1,s[5]-s[4]+1],r.Fc=[s[0],s[2],s[4]],n.Hb(r),n.jb=bf(this,n)}r=new md,r.D=n,r.v=e,this.dispatchEvent(r)},mf.prototype.Ac=function(e,n){this.J=e;if("undefined"==typeof n.sa||n.sa==t)n.sa=[];for(var r={pixel_spacing:[.1,.1,Infinity],image_orientation_patient:[1,0,0,0,1,0],image_position_patient:[0,0,0],transfer_syntax_uid:"no_transfer_syntax_uid"},i=V(this,"ushort",this.J.byteLength),s=66,o=t,u=t,a=t,f=t;s<i.length;)switch(o=i[s++],u=i[s++],a=i[s++],f=i[s++],"1.2.840.10008.1.2"==r.transfer_syntax_uid&&0==f&&(f=a),o){case 2:switch(u){case 16:for(var l="",o=o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);r.transfer_syntax_uid=l.replace(/\0/g,"");break;default:s=nf(i,s,a,f)}break;case 40:switch(u){case 16:r.rows=i[s],s+=f/2;break;case 17:r.columns=i[s],s+=f/2;break;case 256:r.lf=i[s],s+=f/2;break;case 257:r.bits_stored=i[s],s+=f/2;break;case 2:r.number_of_images=i[s],s+=f/2;break;case 48:l="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);l=l.split("\\"),r.pixel_spacing=[parseFloat(l[0]),parseFloat(l[1]),Infinity];break;default:s=nf(i,s,a,f)}break;case 32:switch(u){case 14:r.series_instance_uid="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,r.series_instance_uid+=String.fromCharCode(u),r.series_instance_uid+=String.fromCharCode(a);break;case 19:l="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);r.instance_number=parseInt(l,10);break;case 50:l="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);l=l.split("\\"),r.image_position_patient=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2])];break;case 55:l="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,l+=String.fromCharCode(u),l+=String.fromCharCode(a);l=l.split("\\"),r.image_orientation_patient=[parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]),parseFloat(l[4]),parseFloat(l[5])];break;default:s=nf(i,s,a,f)}break;case 65534:switch(u){default:f=0,s+=f/2}break;case 8:switch(u){case 24:r.sop_instance_uid="";for(o=0;o<f/2;o++)a=i[s++],u=a&255,a=(a&65280)>>8,r.sop_instance_uid+=String.fromCharCode(u),r.sop_instance_uid+=String.fromCharCode(a);break;default:s=nf(i,s,a,f)}break;case 16:switch(u){case 8720:for(o=0;o<f/2;o++)s++;break;default:s=nf(i,s,a,f)}break;default:s=nf(i,s,a,f)}switch(r.lf){case 8:r.data=new Uint8Array(r.columns*r.rows);break;case 16:r.data=new Uint16Array(r.columns*r.rows);break;case 32:r.data=new Uint32Array(r.columns*r.rows)}this.C=this.J.byteLength-2*r.columns*r.rows,i=t;switch(r.lf){case 8:i=V(this,"uchar",r.columns*r.rows);break;case 16:i=V(this,"ushort",r.columns*r.rows);break;case 32:i=V(this,"uint",r.columns*r.rows)}return r.data=i,n.sa.push(r),n},x("X.parserDCM",mf),x("X.parserDCM.prototype.parse",mf.prototype.parse),A(of,Se),of.prototype.parse=function(e,n,r){C.Ha(this.f+".parse");var i=n.h,s=n.n,o=new Uint8Array(r),a="";n.h=i=new S(r.byteLength),n.n=s=new S(r.byteLength),r=0;for(var f=o.length;r<f;r+=32768)a+=Ue(o,r,Math.min(r+32768,f));o=a.split("\n"),a=o.length,this.zd=this.Ad=t,this.jc=[],this.Pa=jd,this.Xe=this.Tb=this.Ob=this.Ub=u,r=0;for(f=a%8;f--;)pf(this,o[r]),r++;for(f=.125*a^0;f--;)pf(this,o[r]),r++,pf(this,o[r]),r++,pf(this,o[r]),r++,pf(this,o[r]),r++,pf(this,o[r]),r++,pf(this,o[r]),r++,pf(this,o[r]),r++,pf(this,o[r]),r++;r=this.Ad;var o=this.zd,a=o.length,l=f=this.jc.length;do{var c=this.jc[f-l],h=c.length,p;for(p=0;p<h&&!("LINES"==this.Pa&&p+1>=h);p++){var d=parseInt(c[p],10),v=r.get(d);i.add(v[0],v[1],v[2]);var m=d,g=v;"LINES"==this.Pa?(m=parseInt(c[p+1],10),g=r.get(m),i.add(g[0],g[1],g[2])):"TRIANGLE_STRIPS"==this.Pa&&(0==p||p==h-1)&&i.add(v[0],v[1],v[2]),d<a?(g=o.get(d),s.add(g[0],g[1],g[2]),"LINES"==this.Pa?(m=o.get(m),s.add(m[0],m[1],m[2])):"TRIANGLE_STRIPS"==this.Pa&&(0==p||p==h-1)&&s.add(g[0],g[1],g[2])):(m=new O(v[0],v[1],v[2]),m.normalize(),s.add(m.x,m.y,m.d),"LINES"==this.Pa?(m=new O(g[0],g[1],g[2]),m.normalize(),s.add(m.x,m.y,m.d)):"TRIANGLE_STRIPS"==this.Pa&&(0==p||p==h-1)&&s.add(m.x,m.y,m.d))}l--}while(0<l);n.Ga=this.Pa,C.Ca(this.f+".parse"),i=new md,i.D=n,i.v=e,this.dispatchEvent(i)},x("X.parserVTK",of),x("X.parserVTK.prototype.parse",of.prototype.parse),A(qf,Se),qf.prototype.parse=function(e,n,r){C.Ha(this.f+".parse"),this.J=r;var i=n.h,s=n.n;n.Sc=[];var o=n.Sc;r=0;var u;do u=V(this,"uchar"),r++;while(200>r&&10!=u);V(this,"uchar"),s=V(this,"uint"),r=V(this,"uint");var a=V(this,"float",3*s);u=V(this,"uint",3*r);var f=new Uint32Array(s),l=new Float32Array(9*r);n.h=i=new S(9*r),n.n=s=new S(9*r);var c;for(c=0;c<r;c++){var h=3*c,p=u[h],d=u[h+1],v=u[h+2];o.push(p),o.push(d),o.push(v),f[p]+=1,f[d]+=1,f[v]+=1;var h=3*p,m=3*d,g=3*v,y=a[h],b=a[h+1],w=a[h+2],d=a[m],v=a[m+1],p=a[m+2],E=a[g],x=a[g+1],T=a[g+2];i.add(y,b,w),i.add(d,v,p),i.add(E,x,T),y=new O(y,b,w),E=new O(E,x,T),d=(new O(d,v,p)).l().ua(y),v=E.l().ua(y),d=Jc(d,v).normalize(),l[h]+=d.x,l[h+1]+=d.y,l[h+2]+=d.d,l[m]+=d.x,l[m+1]+=d.y,l[m+2]+=d.d,l[g]+=d.x,l[g+1]+=d.y,l[g+2]+=d.d}for(c=0;c<r;c++)h=3*c,p=u[h],d=u[h+1],v=u[h+2],h=3*p,m=3*d,g=3*v,o=new O(l[m],l[m+1],l[m+2]),a=new O(l[g],l[g+1],l[g+2]),h=(new O(l[h],l[h+1],l[h+2])).scale(1/f[p]).normalize(),o=o.scale(1/f[d]).normalize(),a=a.scale(1/f[v]).normalize(),s.add(h.x,h.y,h.d),s.add(o.x,o.y,o.d),s.add(a.x,a.y,a.d);r=V(this,"uchar",this.J.byteLength-this.C),u=t;for(h=0;h<r.length;h++)if(99==r[h]&&114==r[h+1]&&97==r[h+2]&&115==r[h+3]){for(s=u=h+9;10!=r[h]&&h<r.length;)s++,h++;u=Ue(r.subarray(u,s)).split(" ");break}u&&(n.ga.Ih(parseFloat(u[0])),n.ga.Jh(parseFloat(u[1])),n.ga.Kh(parseFloat(u[2]))),n.Ga=jd,C.Ca(this.f+".parse"),r=new md,r.D=n,r.v=e,this.dispatchEvent(r)},x("X.parserFSM",qf),x("X.parserFSM.prototype.parse",qf.prototype.parse);var rf={pf:function(e,t,n){return rf.update(e,0,t,n)},update:function(e,t,n,r){var i=rf.Rh,s="number"==typeof n?n:n=0;r="number"==typeof r?r:e.length,t^=4294967295;for(s=r&7;s--;++n)t=t>>>8^i[(t^e[n])&255];for(s=r>>3;s--;n+=8)t=t>>>8^i[(t^e[n])&255],t=t>>>8^i[(t^e[n+1])&255],t=t>>>8^i[(t^e[n+2])&255],t=t>>>8^i[(t^e[n+3])&255],t=t>>>8^i[(t^e[n+4])&255],t=t>>>8^i[(t^e[n+5])&255],t=t>>>8^i[(t^e[n+6])&255],t=t>>>8^i[(t^e[n+7])&255];return(t^4294967295)>>>0}};rf.Rh=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);var vf=0,uf=1;tf.prototype.$b=function(){for(;!this.Fg;){var e=wf(this,3);e&1&&(this.Fg=q),e>>>=1;switch(e){case 0:var e=this.input,t=this.L,n=this.Ua,r=this.ja,i=p,s=p,o=p,u=n.length,i=p;this.ub=this.Cd=0,i=e[t++],i===p&&m(Error("invalid uncompressed block header: LEN (first byte)")),s=i,i=e[t++],i===p&&m(Error("invalid uncompressed block header: LEN (second byte)")),s|=i<<8,i=e[t++],i===p&&m(Error("invalid uncompressed block header: NLEN (first byte)")),o=i,i=e[t++],i===p&&m(Error("invalid uncompressed block header: NLEN (second byte)")),o|=i<<8,s===~o&&m(Error("invalid uncompressed block header: length verify")),t+s>e.length&&m(Error("input buffer is broken"));switch(this.of){case vf:for(;r+s>n.length;)i=u-r,s-=i,n.set(e.subarray(t,t+i),r),r+=i,t+=i,this.ja=r,n=this.yc(),r=this.ja;break;case uf:for(;r+s>n.length;)n=this.yc({Og:2});break;default:m(Error("invalid inflate mode"))}n.set(e.subarray(t,t+s),r),r+=s,this.L=t+=s,this.ja=r,this.Ua=n;break;case 1:this.vf(xf,yf);break;case 2:zf(this);break;default:m(Error("unknown BTYPE: "+e))}}return this.Ig()};var Af=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bf=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Cf=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),Df=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Ef=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ff=new Uint8Array(288),Gf,Hf;Gf=0;for(Hf=Ff.length;Gf<Hf;++Gf)Ff[Gf]=143>=Gf?8:255>=Gf?9:279>=Gf?7:8;var xf=sf(Ff),If=new Uint8Array(30),Jf,Kf;Jf=0;for(Kf=If.length;Jf<Kf;++Jf)If[Jf]=5;var yf=sf(If);w=tf.prototype,w.vf=function(e,t){var n=this.Ua,r=this.ja;this.Lg=e;for(var i=n.length-258,s,o,u;256!==(s=Lf(this,e));)if(256>s)r>=i&&(this.ja=r,n=this.yc(),r=this.ja),n[r++]=s;else{s-=257,u=Bf[s],0<Cf[s]&&(u+=wf(this,Cf[s])),s=Lf(this,t),o=Df[s],0<Ef[s]&&(o+=wf(this,Ef[s])),r>=i&&(this.ja=r,n=this.yc(),r=this.ja);for(;u--;)n[r]=n[r++ -o]}for(;8<=this.ub;)this.ub-=8,this.L--;this.ja=r},w.wi=function(e,t){var n=this.Ua,r=this.ja;this.Lg=e;for(var i=n.length,s,o,u;256!==(s=Lf(this,e));)if(256>s)r>=i&&(n=this.yc(),i=n.length),n[r++]=s;else{s-=257,u=Bf[s],0<Cf[s]&&(u+=wf(this,Cf[s])),s=Lf(this,t),o=Df[s],0<Ef[s]&&(o+=wf(this,Ef[s])),r+u>i&&(n=this.yc(),i=n.length);for(;u--;)n[r]=n[r++ -o]}for(;8<=this.ub;)this.ub-=8,this.L--;this.ja=r},w.yc=function(){var e=new Uint8Array(this.ja-32768),t=this.ja-32768,n=this.Ua;return e.set(n.subarray(32768,e.length)),this.mf.push(e),this.$f+=e.length,n.set(n.subarray(t,t+32768)),this.ja=32768,n},w.Ci=function(e){var t=this.input.length/this.L+1|0,n=this.input,r=this.Ua;return e&&("number"==typeof e.Og&&(t=e.Og),"number"==typeof e.ki&&(t+=e.ki)),2>t?(e=(n.length-this.L)/this.Lg[2],e=258*(e/2)|0,e=e<r.length?r.length+e:r.length<<1):e=r.length*t,e=new Uint8Array(e),e.set(r),this.Ua=e},w.Ig=function(){var e=0,t=this.Ua,n=this.mf,r,i=new Uint8Array(this.$f+(this.ja-32768)),s,o,u,a;if(0===n.length)return this.Ua.subarray(32768,this.ja);s=0;for(o=n.length;s<o;++s){r=n[s],u=0;for(a=r.length;u<a;++u)i[e++]=r[u]}s=32768;for(o=this.ja;s<o;++s)i[e++]=t[s];return this.mf=[],this.buffer=i},w.ri=function(){var e,t=this.ja;return this.Kb?(e=new Uint8Array(t),e.set(this.Ua.subarray(0,t))):e=this.Ua.subarray(0,t),this.buffer=e},new Uint8Array(256);var Mf;for(Mf=0;256>Mf;++Mf)for(var Nf=Mf,Of=7,Nf=Nf>>>1;Nf;Nf>>>=1)--Of;var Pf=[],Qf;for(Qf=0;288>Qf;Qf++)switch(q){case 143>=Qf:Pf.push([Qf+48,8]);break;case 255>=Qf:Pf.push([Qf-144+400,9]);break;case 279>=Qf:Pf.push([Qf-256+0,7]);break;case 287>=Qf:Pf.push([Qf-280+192,8]);break;default:m("invalid literal: "+Qf)}var Tf=[],Sf,Uf;for(Sf=3;258>=Sf;Sf++)Uf=Rf(),Tf[Sf]=Uf[2]<<24|Uf[1]<<16|Uf[0];new Uint32Array(Tf),Wf.prototype.$b=function(){for(var e=this.input.length;this.L<e;){var t=new Vf,n=p,r=p,i=p,s=n=i=p,o=p,n=n=p,u=this.input,r=this.L;t.Ug=u[r++],t.Vg=u[r++],(31!==t.Ug||139!==t.Vg)&&m(Error("invalid file signature:",t.Ug,t.Vg)),t.Hg=u[r++];switch(t.Hg){case 8:break;default:m(Error("unknown compression method: "+t.Hg))}t.oe=u[r++],n=u[r++]|u[r++]<<8|u[r++]<<16|u[r++]<<24,t.Sl=new Date(1e3*n),t.cm=u[r++],t.Xl=u[r++],0<(t.oe&4)&&(t.Ie=u[r++]|u[r++]<<8,r+=t.Ie);if(0<(t.oe&8)){o=[];for(s=0;0<(n=u[r++]);)o[s++]=String.fromCharCode(n);t.name=o.join("")}if(0<(t.oe&16)){o=[];for(s=0;0<(n=u[r++]);)o[s++]=String.fromCharCode(n);t.comment=o.join("")}0<(t.oe&2)&&(t.si=rf.pf(u,0,r)&65535,t.si!==(u[r++]|u[r++]<<8)&&m(Error("invalid header crc16"))),n=u[u.length-4]|u[u.length-3]<<8|u[u.length-2]<<16|u[u.length-1]<<24,u.length-r-4-4<512*n&&(i=n),r=new tf(u,{index:r,bufferSize:i}),t.data=i=r.$b(),r=r.L,t.Cl=n=(u[r++]|u[r++]<<8|u[r++]<<16|u[r++]<<24)>>>0,rf.pf(i)!==n&&m(Error("invalid CRC-32 checksum: 0x"+rf.pf(i).toString(16)+" / 0x"+n.toString(16))),t.Ll=n=(u[r++]|u[r++]<<8|u[r++]<<16|u[r++]<<24)>>>0,(i.length&4294967295)!==n&&m(Error("invalid input size: "+(i.length&4294967295)+" / "+n)),this.member.push(t),this.L=r}e=this.member,t=i=r=0;for(u=e.length;t<u;++t)i+=e[t].data.length;i=new Uint8Array(i);for(t=0;t<u;++t)i.set(e[t].data,r),r+=e[t].data.length;return i},A(Xf,Se),Xf.prototype.parse=function(e,t,n,r){C.Ha(this.f+".parse"),window.console.log(t),r&&(n=(new Wf(new Uint8Array(n))).$b(),n=n.buffer),r=this.Ac(n);var i=[r.Ff,r.Gf,r.Hf];t.$=i;var s=r.Lh;t.tb=s,n=r.min;var o=r.max;t.qa=t.ca=n,t.fa=t.ba=o,-Infinity==t.T&&(t.T=n),Infinity==t.U&&(t.U=o),n=Sc();if("false"==t.reslicing||t.reslicing==u)Q(n,0,t.tb[0],0,0,0),Q(n,1,0,t.tb[1],0,0),Q(n,2,0,0,t.tb[2],0),Q(n,3,0,0,0,1),Vc(n,0,0,0,1);else{Q(n,0,r.eb[0][0],r.eb[1][0],r.eb[2][0],0),Q(n,1,r.eb[0][1],r.eb[1][1],r.eb[2][1],0),Q(n,2,r.eb[0][2],r.eb[1][2],r.eb[2][2],0),Q(n,3,0,0,0,1);for(var o=i[0]/2,a=i[1]/2,i=i[2]/2,f=[0,0,0],l=0;3>l;++l)f[l]=r.eb[3][l]-(n[l+0]*s[0]*o+n[l+4]*s[1]*a+n[l+8]*s[2]*i);Vc(n,f[0],f[1],f[2],1)}r.cb=n,r.fb=Sc(),bd(r.cb,r.fb),o=Rc(0,0,0,1),s=Qc(),dd(n,o,s),a=Rc(1,1,1,1),o=Qc(),dd(n,a,o),n=Ve(n,t.$),r.Gc=[o[0]-s[0],o[1]-s[1],o[2]-s[2]],r.Ec=[n[1]-n[0]+1,n[3]-n[2]+1,n[5]-n[4]+1],r.Fc=[n[0],n[2],n[4]],t.Hb(r),C.Ca(this.f+".parse"),t.jb=bf(this,t),r=new md,r.D=t,r.v=e,this.dispatchEvent(r)},Xf.prototype.Ac=function(e){this.J=e,e={version:0,Uh:0,Sh:0,Ji:0,Th:0,Ff:0,Gf:0,Hf:0,sj:0,type:0,Ai:0,Ah:0,Hk:t,eb:t,Lh:t,data:t,min:Infinity,max:-Infinity},e.version=V(this,"uint"),e.Ff=V(this,"uint"),e.Gf=V(this,"uint"),e.Hf=V(this,"uint"),e.sj=V(this,"uint"),e.type=V(this,"uint"),e.Ai=V(this,"uint"),e.Ah=V(this,"ushort");if(0<e.Ah){e.Lh=V(this,"float",3);var n=[];n.push(V(this,"float",3)),n.push(V(this,"float",3)),n.push(V(this,"float",3)),n.push(V(this,"float",3)),e.eb=n}this.C=284,n=e.Ff*e.Gf*e.Hf;switch(e.type){case 0:e.data=V(this,"uchar",n);break;case 1:e.data=V(this,"uint",n);break;case 3:e.data=V(this,"float",n);break;case 4:e.data=V(this,"ushort",n);break;default:m(Error("Unsupported MGH/MGZ data type: "+e.type))}return n=Te(e.data),e.min=n[0],e.max=n[1],this.C+16<this.J.byteLength&&(e.Uh=V(this,"float"),e.Ji=V(this,"float"),e.Sh=V(this,"float"),e.Th=V(this,"float")),e},x("X.parserMGZ",Xf),x("X.parserMGZ.prototype.parse",Xf.prototype.parse),A(Yf,Se),Yf.prototype.parse=function(e,t,n){C.Ha(this.f+".parse");var r=t.Sc,i=r.length;0==i&&m(Error("No _pointIndices defined on the X.object.")),this.J=n;var s=[],o=V(this,"uchar",n.byteLength),a=o.length,f=u,l=0;for(n=1;n<a;n++)10==o[n-1]?(l=n,f=q):f&&32==o[n]&&(s.push(parseInt(Ue(o,l,n),10)),f=u);o=t.F.I?t.F.I:new Float32Array(i),a=s.length;for(n=0;n<a;n++)o[s[n]]=1;s=new Float32Array(3*i);for(n=a=0;n<i;n++)f=r[n],f>i&&m(Error("Could not find scalar for vertex.")),f=o[f],s[a++]=f,s[a++]=f,s[a++]=f;t.F.I=o,t.F.dd=s,t.F.j=q,C.Ca(this.f+".parse"),r=new md,r.D=t,r.v=e,this.dispatchEvent(r)},x("X.parserLBL",Yf),x("X.parserLBL.prototype.parse",Yf.prototype.parse),A(Zf,Se),Zf.prototype.parse=function(e,t,n){C.Ha(this.f+".parse");var r=t.Sc;0==r.length&&m(Error("No _pointIndices defined on the X.object.")),this.J=n,this.C=3;var i=V(this,"uint");V(this,"uint"),V(this,"uint");var s=0,o=0,u=0,a=0,f=0,l=0,c=0,h=0,p=0,d=0,v=0;n=Array(2);var g=Array(2),y=V(this,"float",i),b;for(b=0;b<i;b++){var w=y[b];0==b&&(n[0]=g[0]=w),0<=w?(s++,a+=w):(o++,u+=w),p+=w,v++,g[0]=Math.max(w,g[0]),n[0]=Math.min(w,n[0]),y[b]=w}0!=s&&(f=a/s),0!=o&&(l=u/o),0!=v&&(d=p/v);for(v=p=u=a=0;v<i;v++)w=y[v],b=0,0<=w?(b=Math.pow(w-f,2),a+=b):(b=Math.pow(w-l,2),u+=b),b=Math.pow(w-d,2),p+=b;1<s&&(c=Math.sqrt(a/(s-1))),1<o&&(h=Math.sqrt(u/(o-1))),n[1]=l-2.5*h,g[1]=f+2.5*c,i=r.length,s=new Float32Array(3*i);for(v=0;v<i;v++)o=y[r[v]],u=3*v,s[u]=o,s[u+1]=o,s[u+2]=o;t.F.qa=n[1],t.F.fa=g[1],-Infinity==t.F.T&&(t.F.T=n[1]),Infinity==t.F.U&&(t.F.U=g[1]),t.F.I=y,t.F.dd=s,t.F.j=q,C.Ca(this.f+".parse"),r=new md,r.D=t,r.v=e,this.dispatchEvent(r)},x("X.parserCRV",Zf),x("X.parserCRV.prototype.parse",Zf.prototype.parse),$f.prototype.$b=function(){var e=this.input,t;t=this.Bh.$b(),this.L=this.Bh.L;if(this.yk){var e=(e[this.L++]<<24|e[this.L++]<<16|e[this.L++]<<8|e[this.L++])>>>0,n=t;if("string"==typeof n){var n=n.split(""),r,i;r=0;for(i=n.length;r<i;r++)n[r]=(n[r].charCodeAt(0)&255)>>>0}r=1,i=0;for(var s=n.length,o,u=0;0<s;){o=1024<s?1024:s,s-=o;do r+=n[u++],i+=r;while(--o);r%=65521,i%=65521}e!==(i<<16|r)>>>0&&m(Error("invalid adler-32 checksum"))}return t},A(ag,Se),ag.prototype.parse=function(e,t,n,r){C.Ha(this.f+".parse"),r&&(n=(new $f(new Uint8Array(n))).$b(),n=n.buffer),r={},r.data=new Uint8Array(n);var i=Te(r.data);n=i[0],i=i[1],r.min=t.qa=t.ca=n,r.max=t.fa=t.ba=i,-Infinity==t.T&&(t.T=n),Infinity==t.U&&(t.U=i),i=Tc(),r.cb=i,r.fb=Tc();var s=Rc(0,0,0,1);n=Qc(),dd(i,s,n);var o=Rc(1,1,1,1),s=Qc();dd(i,o,s),i=Ve(i,t.$),r.Gc=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],r.Ec=[i[1]-i[0]+1,i[3]-i[2]+1,i[5]-i[4]+1],r.Fc=[i[0],i[2],i[4]],t.Hb(r),C.Ca(this.f+".parse"),t.jb=bf(this,t),r=new md,r.D=t,r.v=e,this.dispatchEvent(r)},x("X.parserRAW",ag),x("X.parserRAW.prototype.parse",ag.prototype.parse),A(bg,Se),bg.prototype.parse=function(e,t,n){C.Ha(this.f+".parse"),this.J=n,n=V(this,"uchar",n.byteLength);var r=n.length,i=0,s;for(s=0;s<r;s++)if(10==n[s]){var o=Ue(n,i,s),i=s+1,o=o.replace(/^\s+|\s+$/g,"");"#"!=o[0]&&(o=o.split(" "),o=o.filter(function(e){return""!=e}),6==o.length&&(o[2]=parseInt(o[2],10)/255,o[3]=parseInt(o[3],10)/255,o[4]=parseInt(o[4],10)/255,o[5]=parseInt(o[5],10)/255,e.add(parseInt(o[0],10),o[1],o[2],o[3],o[4],o[5],10)))}C.Ca(this.f+".parse"),n=new md,n.D=t,n.v=e,this.dispatchEvent(n)},x("X.parserLUT",bg),x("X.parserLUT.prototype.parse",bg.prototype.parse),A(cg,Se),cg.prototype.parse=function(e,t,n){C.Ha(this.f+".parse"),n=this.Ac(n);var r=n.min,i=n.max;t.$=[n.Id,n.Jd,n.Kd],t.tb=[n.Ie/n.hh,n.Oh/n.ih,n.Ph/n.jh],t.qa=t.ca=r,t.fa=t.ba=i,-Infinity==t.T&&(t.T=r),Infinity==t.U&&(t.U=i),i=Sc(),Q(i,3,0,0,0,1),Q(i,0,-1,0,0,n.Id),Q(i,1,0,0,-1,n.Jd),Q(i,2,0,-1,0,n.Kd),n.cb=i,n.fb=Sc(),bd(n.cb,n.fb);var s=Rc(0,0,0,1),r=Qc();dd(i,s,r);var o=Rc(1,1,1,1),s=Qc();dd(i,o,s),o=[n.Id,n.Jd,n.Kd],i=Ve(i,o),n.Gc=[s[0]-r[0],s[1]-r[1],s[2]-r[2]],n.Ec=[i[1]+i[0]+1,i[3]-i[2]+1,i[5]-i[4]+1],n.Fc=[i[0],i[2],i[4]],t.$=o,t.Hb(n),t.jb=bf(this,t),C.Ca(this.f+".parse"),n=new md,n.D=t,n.v=e,this.dispatchEvent(n)},cg.prototype.Ac=function(e){this.J=e,e={Id:0,Jd:0,Kd:0,mode:0,Ul:0,Vl:0,Wl:0,hh:0,ih:0,jh:0,Ie:0,Oh:0,Ph:0,alpha:0,ni:0,Ki:0,kj:0,lj:0,mj:0,kf:0,je:0,vc:0,Nl:0,next:0,ti:0,Ei:t,tj:0,vj:0,Ei:t,Yi:0,Kl:0,Wi:0,gj:0,pj:0,qj:0,wk:0,xk:0,tk:t,zk:0,Bk:0,Ck:0,Bl:0,bm:0,fk:0,uj:0,data:t,min:Infinity,max:-Infinity,Rl:0,Eh:t,am:t,Zl:t,orientation:t,Tl:t},this.C=0,e.Id=V(this,"sint"),e.Jd=V(this,"sint"),e.Kd=V(this,"sint"),e.mode=V(this,"sint");var n=e.Id*e.Jd*e.Kd;this.C=1024;switch(e.mode){case 0:e.data=V(this,"schar",n);break;case 1:e.data=V(this,"sshort",n);break;case 2:e.data=V(this,"float",n);break;case 3:e.data=V(this,"uint",n);break;case 4:e.data=V(this,"double",n);break;case 6:e.data=V(this,"ushort",n);break;case 16:e.data=V(this,"uchar",n);break;default:m(Error("Unsupported MRC data type: "+e.mode))}this.C=28,e.hh=V(this,"sint"),e.ih=V(this,"sint"),e.jh=V(this,"sint"),e.Ie=V(this,"float"),e.Oh=V(this,"float"),e.Ph=V(this,"float"),e.alpha=V(this,"float"),e.ni=V(this,"float"),e.Ki=V(this,"float"),e.kj=V(this,"sint"),e.lj=V(this,"sint"),e.mj=V(this,"sint"),e.kf=V(this,"float"),e.je=V(this,"float"),e.vc=V(this,"float"),e.Ml=V(this,"sint"),e.next=V(this,"sint"),e.ti=V(this,"short"),e.tj=V(this,"short"),e.vj=V(this,"short"),e.Yi=V(this,"sint"),e.Jl=V(this,"sint"),e.Wi=V(this,"short"),e.gj=V(this,"short"),e.pj=V(this,"short"),e.qj=V(this,"short"),e.wk=V(this,"short"),e.xk=V(this,"short"),e.tk=V(this,"float",6),this.C=196,e.zk=V(this,"float"),e.Bk=V(this,"float"),e.Ck=V(this,"float"),this.C=216,e.fk=V(this,"float"),e.uj=V(this,"sint"),e.Ol=V(this,"schar",10);if(0!=e.next)switch(this.C=parseInt(e.next+1024,10),e.mode){case 0:e.data=V(this,"schar",n);break;case 1:e.data=V(this,"sshort",n);break;case 2:e.data=V(this,"float",n);break;case 3:e.data=V(this,"uint",n);break;case 4:e.data=V(this,"double",n);break;case 6:e.data=V(this,"ushort",n);break;case 16:e.data=V(this,"uchar",n);break;default:m(Error("Unsupported MRC data type: "+e.mode))}return 0>e.vc-(e.je-e.vc)?(e.min=e.kf,e.max=e.vc+(e.vc-e.kf)):(e.min=e.vc-(e.je-e.vc),e.max=e.je),e},x("X.parserMRC",cg),x("X.parserMRC.prototype.parse",cg.prototype.parse),A(dg,Se),dg.prototype.parse=function(e,n,r){C.Ha(this.f+".parse"),this.J=r,r=V(this,"uchar",r.byteLength);var i=r.length,s=t,o=0,a;for(a=1;a<i;a++)if(10==r[a-1]&&10==r[a]){s=Ue(r,0,a-2),o=a+1;break}var f,l,c,h,i=s.split(/\r?\n/),s=0;for(a=i.length;s<a;s++)(f=i[s],f.match(/NRRD\d+/))?this.ej=q:!f.match(/^#/)&&(h=f.match(/(.*):(.*)/))&&(l=h[1].trim(),f=h[2].trim(),(c=this.Fi[l])?c.call(this,f):this[l]=f);this.ej||m(Error("Not an NRRD file")),"raw"!==this.encoding&&"gzip"!==this.encoding&&"gz"!==this.encoding&&m(Error("Only raw or gz/gzip encoding is allowed"));if(!this.ea&&(this.ea=[new O(1,0,0),new O(0,1,0),new O(0,0,1)],this.Yf)){i=[];for(h=0;2>=h;h++)i.push(isNaN(this.Yf[h])?p:this.ea[h].scale(this.Yf[h]))}o=r.subarray(o);if("gzip"==this.encoding||"gz"==this.encoding)o=(new Wf(new Uint8Array(o))).$b();o=o.buffer,r={data:t,min:Infinity,max:-Infinity},r.data=new this.Nb(o),h=Te(r.data),o=r.min=h[0],h=r.max=h[1],n.qa=n.ca=o,n.fa=n.ba=h,n.$=[this.Wf[0],this.Wf[1],this.Wf[2]],i=(new O(this.ea[0][0],this.ea[0][1],this.ea[0][2])).Jb(),s=(new O(this.ea[1][0],this.ea[1][1],this.ea[1][2])).Jb(),a=(new O(this.ea[2][0],this.ea[2][1],this.ea[2][2])).Jb(),n.tb=[i,s,a],-Infinity==n.T&&(n.T=o),Infinity==n.U&&(n.U=h),i=h=1,"left-posterior-superior"==this.Eh&&(i=h=-1),o=Tc(),"false"==n.reslicing||n.reslicing==u?(Q(o,0,h,0,0,0),Q(o,1,0,i,0,0),Q(o,2,0,0,1,0)):(Q(o,0,h*this.ea[0][0],h*this.ea[1][0],h*this.ea[2][0],h*this.Xf[0]),Q(o,1,i*this.ea[0][1],i*this.ea[1][1],i*this.ea[2][1],i*this.Xf[1]),Q(o,2,1*this.ea[0][2],1*this.ea[1][2],1*this.ea[2][2],1*this.Xf[2])),Q(o,3,0,0,0,1),r.cb=o,r.fb=Sc(),bd(r.cb,r.fb),i=Rc(0,0,0,1),h=Qc(),dd(o,i,h),s=Rc(1,1,1,1),i=Qc(),dd(o,s,i),o=Ve(o,n.$),r.Gc=[i[0]-h[0],i[1]-h[1],i[2]-h[2]],r.Ec=[o[1]-o[0]+1,o[3]-o[2]+1,o[5]-o[4]+1],r.Fc=[o[0],o[2],o[4]],n.Hb(r),C.Ca(this.f+".parse"),n.jb=bf(this,n),r=new md,r.D=n,r.v=e,this.dispatchEvent(r)},dg.prototype.Fi={type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.Nb=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.Nb=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.Nb=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.Nb=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.Nb=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.Nb=Uint32Array;break;case"float":this.Nb=Float32Array;break;case"double":this.Nb=Float64Array;break;default:m(Error("Unsupported NRRD data type: "+e))}return this.type=e},endian:function(e){return this.Gl=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.ac=parseInt(e,10)},sizes:function(e){var t,n,r,i;r=e.split(/\s+/),i=[],t=0;for(n=r.length;t<n;t++)e=r[t],i.push(parseInt(e,10));return this.Wf=i},space:function(e){return this.Eh=e},"space origin":function(e){return this.Xf=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){var t,n;e=e.match(/\(.*?\)/g);var r,i,s;s=[],r=0;for(i=e.length;r<i;r++)n=e[r],s.push(function(){var e,r,i,s;i=n.slice(1,-1).split(/,/),s=[],e=0;for(r=i.length;e<r;e++)t=i[e],s.push(parseFloat(t));return s}());return this.ea=s},spacings:function(e){var t;t=e.split(/\s+/);var n,r,i;i=[],n=0;for(r=t.length;n<r;n++)e=t[n],i.push(parseFloat(e));return this.Yf=i}},x("X.parserNRRD",dg),x("X.parserNRRD.prototype.parse",dg.prototype.parse),A(eg,Se),eg.prototype.parse=function(e,t,n){C.Ha(this.f+".parse"),this.J=n;var r=t.h,i=t.n;if("solid"==Ue(V(this,"uchar",5))){t.h=r=new S(n.byteLength),t.n=i=new S(n.byteLength);var s=r,r=i,i=V(this,"uchar",n.byteLength-5);n=i.length;var o=u,a=u,f=0,l;for(l=0;l<n;l++)if(10==i[l]){if(o||a){var c=Ue(i,f,l).split(" "),a=parseFloat(c[0]),h=parseFloat(c[1]),c=parseFloat(c[2]);o?(r.add(a,h,c),r.add(a,h,c),r.add(a,h,c)):s.add(a,h,c),a=o=u}}else 32==i[l-1]&&(102==i[l]?(f=l+=13,o=q):118==i[l]&&(f=l+=7,a=q))}else{this.C=80,s=V(this,"uint"),t.h=r=new S(9*s),t.n=i=new S(9*s);for(n=n=0;n<s;n++)o=V(this,"float",12),f=o[0],l=o[1],a=o[2],i.add(f,l,a),i.add(f,l,a),i.add(f,l,a),r.add(o[3],o[4],o[5]),r.add(o[6],o[7],o[8]),r.add(o[9],o[10],o[11]),this.C+=2}C.Ca(this.f+".parse"),s=new md,s.D=t,s.v=e,this.dispatchEvent(s)},x("X.parserSTL",eg),x("X.parserSTL.prototype.parse",eg.prototype.parse),A(fg,Se),fg.prototype.parse=function(e,t,n){if(!gg(n))try{n=(new Wf(new Uint8Array(n))).$b().buffer,gg(n)||(this.Qc=u)}catch(r){this.Qc=u}n=this.Ac(n);var i=n.min,s=n.max;t.qa=t.ca=i,t.fa=t.ba=s,-Infinity==t.T&&(t.T=i),Infinity==t.U&&(t.U=s),i=Sc(),Q(i,3,0,0,0,1);if("false"==t.reslicing||t.reslicing==u){var o=s=1,a=1;0<n.ra[1]&&(s=n.ra[1]),0<n.ra[2]&&(o=n.ra[2]),0<n.ra[2]&&(a=n.ra[3]),0>n.ra[0]&&(a=-a),Q(i,0,s,0,0,0),Q(i,1,0,o,0,0),Q(i,2,0,0,a,0)}else if(0<n.Sf){var f=0,l=n.xh,c=n.yh,h=n.zh,a=o=s=1,p=n.uh,d=n.vh,v=n.wh,f=1-(l*l+c*c+h*h);1e-7>f?(f=1/Math.sqrt(l*l+c*c+h*h),l*=f,c*=f,h*=f,f=0):f=Math.sqrt(f),0<n.ra[1]&&(s=n.ra[1]),0<n.ra[2]&&(o=n.ra[2]),0<n.ra[2]&&(a=n.ra[3]),0>n.ra[0]&&(a=-a),Q(i,0,(f*f+l*l-c*c-h*h)*s,2*(l*c-f*h)*o,2*(l*h+f*c)*a,p),Q(i,1,2*(l*c+f*h)*s,(f*f+c*c-l*l-h*h)*o,2*(c*h-f*l)*a,d),Q(i,2,2*(l*h-f*c)*s,2*(c*h+f*l)*o,(f*f+h*h-c*c-l*l)*a,v)}else 0<n.Ch?(s=n.Fh,o=n.Gh,a=n.Hh,Q(i,0,s[0],s[1],s[2],s[3]),Q(i,1,o[0],o[1],o[2],o[3]),Q(i,2,a[0],a[1],a[2],a[3])):0==n.Sf?(Q(i,0,n.ra[1],0,0,0),Q(i,1,0,n.ra[2],0,0),Q(i,2,0,0,n.ra[3],0)):window.console.log("UNKNOWN METHOD IN PARSER NII");n.cb=i,n.fb=Sc(),bd(n.cb,n.fb),o=Rc(0,0,0,1),s=Qc(),dd(i,o,s),a=Rc(1,1,1,1),o=Qc(),dd(i,a,o),a=[n.ac[1],n.ac[2],n.ac[3]],i=Ve(i,a),n.Gc=[o[0]-s[0],o[1]-s[1],o[2]-s[2]],n.Ec=[i[1]-i[0]+1,i[3]-i[2]+1,i[5]-i[4]+1],n.Fc=[i[0],i[2],i[4]],t.$=a,t.Hb(n),t.jb=bf(this,t),n=new md,n.D=t,n.v=e,this.dispatchEvent(n)},fg.prototype.Ac=function(e){this.J=e,e={kk:0,ui:t,vi:t,Di:0,ik:0,ck:0,zi:t,ac:t,aj:0,bj:0,cj:0,Zi:0,uf:0,oi:0,pk:0,ra:t,Mh:0,hk:0,gk:0,ok:0,mk:t,Ak:t,pi:0,qi:0,nk:0,uk:0,Mi:0,Ni:0,xi:t,mi:t,Sf:0,Ch:0,xh:0,yh:0,zh:0,uh:0,vh:0,wh:0,Fh:t,Gh:t,Hh:t,$i:t,hj:t,data:t,min:Infinity,max:-Infinity},e.kk=V(this,"uint"),e.ui=V(this,"uchar",10),e.vi=V(this,"uchar",18),e.Di=V(this,"uint"),e.ik=V(this,"ushort"),e.ck=V(this,"uchar"),e.zi=V(this,"uchar"),e.ac=V(this,"ushort",8),e.aj=V(this,"float"),e.bj=V(this,"float"),e.cj=V(this,"float"),e.Zi=V(this,"ushort"),e.uf=V(this,"ushort"),e.oi=V(this,"ushort"),e.pk=V(this,"ushort"),e.ra=V(this,"float",8),e.Mh=V(this,"float"),e.hk=V(this,"float"),e.gk=V(this,"float"),e.ok=V(this,"ushort"),e.mk=V(this,"uchar"),e.Ak=V(this,"uchar"),e.pi=V(this,"float"),e.qi=V(this,"float"),e.nk=V(this,"float"),e.uk=V(this,"float"),e.Mi=V(this,"uint",1),e.Ni=V(this,"uint",1),e.xi=V(this,"uchar",80),e.mi=V(this,"uchar",24),e.Sf=V(this,"ushort"),e.Ch=V(this,"ushort"),e.xh=V(this,"float"),e.yh=V(this,"float"),e.zh=V(this,"float"),e.uh=V(this,"float"),e.vh=V(this,"float"),e.wh=V(this,"float"),e.Fh=V(this,"float",4),e.Gh=V(this,"float",4),e.Hh=V(this,"float",4),e.$i=V(this,"uchar",16),e.hj=V(this,"uchar",4),this.C=parseInt(e.Mh,10);var n=e.ac[1]*e.ac[2]*e.ac[3];switch(e.uf){case 2:e.data=V(this,"uchar",n);break;case 4:e.data=V(this,"sshort",n);break;case 8:e.data=V(this,"sint",n);break;case 16:e.data=V(this,"float",n);break;case 32:e.data=V(this,"complex",n);break;case 64:e.data=V(this,"double",n);break;case 256:e.data=V(this,"schar",n);break;case 512:e.data=V(this,"ushort",n);break;case 768:e.data=V(this,"uint",n);break;default:m(Error("Unsupported NII data type: "+e.uf))}return n=Te(e.data),e.min=n[0],e.max=n[1],e},x("X.parserNII",fg),x("X.parserNII.prototype.parse",fg.prototype.parse),A(hg,Se),hg.prototype.parse=function(e,n,r){C.Ha(this.f+".parse");var i=n.h,s=n.n,o=n.oa;this.J=r,V(this,"uchar",6),V(this,"ushort",3);var a=V(this,"float",3);V(this,"float",3);var f=V(this,"ushort");V(this,"uchar",200),V(this,"ushort"),V(this,"uchar",200),r=V(this,"float",16),V(this,"uchar",444),V(this,"uchar",4),V(this,"uchar",4),V(this,"float",6),V(this,"uchar",2),V(this,"uchar"),V(this,"uchar"),V(this,"uchar"),V(this,"uchar"),V(this,"uchar"),V(this,"uchar");var l=V(this,"uint");V(this,"uint");var c=V(this,"uint"),h=0===l?Infinity:l,p=[],d=[],l=Infinity,v=-Infinity,m=t,g=t,y=t,b=t,s=i=t,w=V(this,"uint",(this.J.byteLength-1e3)/4);this.C=c;for(var E=V(this,"float",(this.J.byteLength-1e3)/4),x=0,c=o=0;c<h;c++){if("undefined"==typeof w[x]){h=c;break}for(var T=w[x],N=new S(3*T),k=0,L=0;L<T;L++){var A=E[x+3*L+L*f+1],O=E[x+3*L+L*f+2],M=E[x+3*L+L*f+3],A=A/a[0],O=O/a[1],M=M/a[2];N.add(A,O,M);if(0<L)var _=N.get(L-1),k=k+Math.sqrt(Math.pow(A-_[0],2)+Math.pow(O-_[1],2)+Math.pow(M-_[2],2));L<T-1&&(o+=6)}x+=3*T+T*f+1,L=N.pb,T=N.mb,A=N.qb,O=N.nb,M=N.rb,_=N.ob;if(!m||L<m)m=L;if(!g||T>g)g=T;if(!y||A<y)y=A;if(!b||O>b)b=O;if(!i||M<i)i=M;if(!s||_>s)s=_;p.push(N),d.push(k)}a=(m+g)/2,f=(y+b)/2,b=(i+s)/2,y=new Float32Array(o),n.h=i=new S(o),n.n=s=new S(o),n.oa=o=new S(o);for(c=m=0;c<h;c++){g=p[c],w=g.count,k=d[c],l=Math.min(l,k),v=Math.max(v,k);for(L=0;L<w-1;L++){x=g.get(L),E=g.get(L+1),i.add(x[0],x[1],x[2]),i.add(E[0],E[1],E[2]);var N=x[0]-a,T=x[1]-f,A=x[2]-b,O=Math.sqrt(N*N+T*T+A*A),M=E[0]-a,_=E[1]-f,D=E[2]-b,P=Math.sqrt(M*M+_*_+D*D);s.add(N/O,T/O,A/O),s.add(M/P,_/P,D/P),E=[Math.abs(E[0]-x[0]),Math.abs(E[1]-x[1]),Math.abs(E[2]-x[2])],x=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),E[0]/=x,E[1]/=x,E[2]/=x,o.add(E[0],E[1],E[2]),o.add(E[0],E[1],E[2]),y[m++]=k,y[m++]=k,y[m++]=k,y[m++]=k,y[m++]=k,y[m++]=k}}n.Ga="LINES",h=new ld,h.qa=l,h.fa=v,h.T=l,h.U=v,h.dd=y,h.zg=u,h.j=q,n.F=h,l=u;for(c=0;16>c;c++)if(0!=r[c]){l=q;break}l==u&&(r[0]=r[5]=r[10]=r[15]=1),C.Ca(this.f+".parse"),C.g.ag(r,n.ga.P),r=new md,r.D=n,r.v=e,this.dispatchEvent(r)},x("X.parserTRK",hg),x("X.parserTRK.prototype.parse",hg.prototype.parse),A(ig,Se),ig.prototype.parse=function(e,t,n){C.Ha(this.f+".parse"),this.J=n,n=n.byteLength;var r=V(this,"uchar",n),i=[];t.h=new S(n),t.n=new S(n);var s=t.h,o=t.n,u=0,a;for(a=0;a<n;++a)if(10==r[a]){var f=Ue(r,u,a).replace(/\s{2,}/g," ").split(" ");if("v"==f[0])i.push([parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])]);else if("f"==f[0]){var l=i[parseInt(f[1],10)-1],u=i[parseInt(f[2],10)-1],f=i[parseInt(f[3],10)-1];s.add(l[0],l[1],l[2]),s.add(u[0],u[1],u[2]),s.add(f[0],f[1],f[2]),l=new O(l[0],l[1],l[2]),f=new O(f[0],f[1],f[2]),u=Jc((new O(u[0],u[1],u[2])).ua(l),f.ua(l)),u.normalize(),o.add(u.x,u.y,u.d),o.add(u.x,u.y,u.d),o.add(u.x,u.y,u.d)}u=a+1}C.Ca(this.f+".parse"),n=new md,n.D=t,n.v=e,this.dispatchEvent(n)},x("X.parserOBJ",ig),x("X.parserOBJ.prototype.parse",ig.prototype.parse),A(jg,M),jg.prototype.load=function(e,n){(!e||!n)&&m(Error("No container or object to load."));if(!Dc(this.kc.da,e.pa)||this.kc.get(e.pa)){this.kc.set(e.pa,u);var r=lg(e)[0];if(e.$a!=t)this.parse(t,e,n);else{var i=new XMLHttpRequest;D(i,"abort",this.Ng.bind(this,i,e,n)),D(i,"error",this.Ng.bind(this,i,e,n)),D(i,"load",this.parse.bind(this,i,e,n)),i.open("GET",r,q),i.responseType="arraybuffer",i.send(t)}}},jg.prototype.parse=function(e,n,r){kg(this,1),setTimeout(function(){var i=lg(n),s=i[3],i=new i[2];ac(i,zd,this.complete.bind(this));var o=n.$a;o==t&&(o=e.response,n.$a=o);try{i.parse(n,r,o,s)}catch(u){window.console.log(u),window.console.log("Could not parse object:"),window.console.log(r),r.status="INVALID",this.kc=new Ac,s=new CustomEvent("parseError"),r.dispatchEvent(s)}}.bind(this),100)},jg.prototype.complete=function(e){kg(this,1),setTimeout(function(){var t=e.v,n=e.D;t.r.j=u,t.j=q,n.q(),this.kc.set(t.pa,q)}.bind(this),100)},jg.prototype.Ng=function(e,t,n){m(Error("Loading failed: ",t,n))};var mg={OBJ:[ig,t],OFF:[lf,t],STL:[eg,t],VTK:[of,t],TRK:[hg,t],MRC:[cg,t],ST:[cg,t],FSM:[qf,t],INFLATED:[qf,t],SMOOTHWM:[qf,t],SPHERE:[qf,t],PIAL:[qf,t],ORIG:[qf,t],NRRD:[dg,t],NII:[fg,t],GZ:[fg,t],DCM:[mf,t],DICOM:[mf,t],"":[mf,t],IMA:[mf,t],CRV:[Zf,t],LABEL:[Yf,t],MGH:[Xf,u],MGZ:[Xf,q],RAW:[ag,u],RZ:[ag,q],TXT:[bg,t],LUT:[bg,t],PNG:[cf,"png"],JPG:[cf,"jpeg"],JPEG:[cf,"jpeg"],GIF:[cf,"gif"]};A(ng,uc),A(og,T),og.prototype.__defineGetter__("start",v("ff")),og.prototype.__defineSetter__("start",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid start")),this.ff=e}),og.prototype.__defineGetter__("end",v("Ne")),og.prototype.__defineSetter__("end",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid end")),this.Ne=e}),og.prototype.__defineGetter__("radius",v("mc")),og.prototype.__defineSetter__("radius",function(e){na(e)||m(Error("Invalid radius.")),this.mc=e}),og.prototype.q=function(){rd(this,new ng({start:this.ff,end:this.Ne,Ab:this.mc,sa:this.bb})),og.u.q.call(this)},x("X.cylinder",og),x("X.cylinder.prototype.modified",og.prototype.q),A(pg,uc),A(qg,T),qg.prototype.__defineGetter__("center",v("z")),qg.prototype.__defineSetter__("center",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid center")),this.z=e}),qg.prototype.__defineGetter__("radius",v("mc")),qg.prototype.__defineSetter__("radius",function(e){na(e)||m(Error("Invalid radius.")),this.mc=e}),qg.prototype.q=function(){rd(this,new pg({qf:this.z,Ab:this.mc,sa:this.bb,qk:this.ei})),qg.u.q.call(this)},x("X.sphere",qg),x("X.sphere.prototype.modified",qg.prototype.q),A(jf,N),jf.prototype.q=function(){var e=new md;e.D=this,this.dispatchEvent(e),this.zb.q()},jf.prototype.__defineSetter__("showOnly",function(e){var n=[-1,-1,-1,-1];e!=t&&(ja(e)&&4==e.length?n=e:(this.va||m(Error("No colortable assigned.")),n=this.va.Ia.get(e).slice(1,5))),this.ef=new Float32Array([Math.floor(255*n[0]),Math.floor(255*n[1]),Math.floor(255*n[2]),Math.floor(255*n[3])])}),x("X.labelmap",jf),A(rg,uc),A(sg,T),sg.prototype.__defineGetter__("center",v("z")),sg.prototype.__defineSetter__("center",function(e){(e==t||!ja(e)||3!=e.length)&&m(Error("Invalid center")),this.z=e}),sg.prototype.__defineGetter__("lengthX",v("Se")),sg.prototype.__defineSetter__("lengthX",function(e){na(e)||m(Error("Invalid lengthX.")),this.Se=e}),sg.prototype.__defineGetter__("lengthY",v("Te")),sg.prototype.__defineSetter__("lengthY",function(e){na(e)||m(Error("Invalid lengthY.")),this.Te=e}),sg.prototype.__defineGetter__("lengthZ",v("Ue")),sg.prototype.__defineSetter__("lengthZ",function(e){na(e)||m(Error("Invalid lengthZ.")),this.Ue=e}),sg.prototype.q=function(){rd(this,new rg({qf:this.z,Ab:[this.Se/2,this.Te/2,this.Ue/2]})),sg.u.q.call(this)},x("X.cube",sg),x("X.cube.prototype.modified",sg.prototype.q),A(Me,Ke),Me.prototype.Ld=function(e){Me.u.Ld.call(this,e);var n=new Kd;e.Yc==t&&(e.Yc=0),n.yb=0>e.Yc,n.hb=q,this.dispatchEvent(n)},A(tg,M),tg.prototype.add=function(e){return this.I.push(e),q},tg.prototype.remove=function(e){return e=this.I.indexOf(e),-1<e&&this.I.splice(e,1),q},tg.prototype.clear=function(){this.I.length=0},tg.prototype.sort=function(){vg(this,0,this.I.length)},A(wg,Qb);var xg=[];wg.prototype.Tf=function(){Lb(this.S,cc),this.S.length=0},wg.prototype.handleEvent=function(){m(Error("EventHandler.handleEvent not implemented"))},zg.Pg=function(){return zg.Xg?zg.Xg:zg.Xg=new zg},zg.prototype.rj=0,zg.Pg(),A(Ag,kc),Ag.prototype.Vi=zg.Pg();var Cg=t;w=Ag.prototype,w.Wg=t,w.$c=u,w.H=t,w.ek=t,w.Md=t,w.Dd=t,w.rf=t,w.t=v("H"),w.Vf=function(e){this.Md&&this.Md!=e&&m(Error("Method not supported")),Ag.u.Vf.call(this,e)},w.pe=v("bc"),w.Xc=function(){this.H=this.bc.createElement("div")},w.ec=function(e){this.fc(e)},w.fc=function(e,n){this.$c&&m(Error("Component already rendered")),this.H||this.Xc(),e?e.insertBefore(this.H,n||t):this.bc.ia.body.appendChild(this.H),(!this.Md||this.Md.$c)&&this.me()},w.me=function(){function e(e){!e.$c&&e.t()&&e.me()}this.$c=q,this.Dd&&Lb(this.Dd,e,p)},w.ne=function(){function e(e){e.$c&&e.ne()}this.Dd&&Lb(this.Dd,e,p),this.Oi&&this.Oi.Tf(),this.$c=u},w.removeChild=function(e,n){if(e){var r=ma(e)?e:e.Wg||(e.Wg=":"+(e.Vi.rj++).toString(36)),i;this.rf&&r?(i=this.rf,i=(r in i?i[r]:p)||t):i=t,e=i,r&&e&&(i=this.rf,r in i&&delete i[r],Ob(this.Dd,e),n&&(e.ne(),e.H&&he(e.H)),r=e,r==t&&m(Error("Unable to set parent component")),r.Md=t,Ag.u.Vf.call(r,t))}return e||m(Error("Child is not in parent component")),e},A(Dg,kc),w=Dg.prototype,w.cg=0,w.Hd=0,w.Ef=100,w.Mg=0,w.Zf=1,w.dj=u,w.oj=u,w.Pd=function(e){e=Eg(this,e),this.cg!=e&&(this.cg=e+this.Mg>this.Ef?this.Ef-this.Mg:e<this.Hd?this.Hd:e,!this.dj&&!this.oj&&this.dispatchEvent("change"))},w.se=function(){return Eg(this,this.cg)},w.re=function(){return Eg(this,this.Hd)},w.qe=function(){return Eg(this,this.Ef)},A(Fg,Ag);var Gg={vertical:"progress-bar-vertical",horizontal:"progress-bar-horizontal"};w=Fg.prototype,w.Xc=function(){this.Bb=this.pe().Xc("div","progress-bar-thumb");var e=Gg[this.rh];this.H=this.pe().Xc("div",e,this.Bb),Hg(this),e=this.re(),this.t().setAttribute("aria-valuemin",e),e=this.qe(),this.t().setAttribute("aria-valuemax",e)},w.me=function(){Fg.u.me.call(this),jb&&7>wb&&D(this.t(),"resize",this.He,u,this),this.He();var e=this.t();e.setAttribute("role","progressbar"),e.setAttribute("aria-live","polite")},w.ne=function(){Fg.u.ne.call(this),jb&&7>wb&&bc(this.t(),"resize",this.He,u,this)},w.se=function(){return this.Nd.se()},w.Pd=function(e){this.Nd.Pd(e),this.t()&&Hg(this)},w.re=function(){return this.Nd.re()},w.qe=function(){return this.Nd.qe()},w.rh="horizontal",w.Pi=function(){this.He(),this.dispatchEvent("change")},w.He=function(){if(this.Bb){var e=this.re(),t=this.qe(),e=(this.se()-e)/(t-e),t=Math.round(100*e);"vertical"==this.rh?jb&&7>wb?(this.Bb.style.top=0,this.Bb.style.height="100%",t=this.Bb.offsetHeight,e=Math.round(e*t),this.Bb.style.top=t-e+"px",this.Bb.style.height=e+"px"):(this.Bb.style.top=100-t+"%",this.Bb.style.height=t+"%"):this.Bb.style.width=t+"%"}},A(Ig,Fg),Ig.prototype.zf=function(){var e=pe(this.ab,"position");if("static"==e||""==e)this.Ze=this.ab.style.position,this.ab.style.position="relative";var e=document.getElementsByTagName("head")[0],t=ee("style");t.type="text/css",t.media="screen";var n=document.createTextNode(String(this.hc[0])),r=document.createTextNode(String(this.hc[1])),i=document.createTextNode(String(this.hc[2]));e.appendChild(t),t.appendChild(n),t.appendChild(r),t.appendChild(i),this.Gb=t,this.ec(this.ab),e=this.t(),e.style.position="absolute",e.style.top=(this.ab.clientHeight-5)/2+"px",e.style.left=(this.ab.clientWidth-100)/2+"px",e.classList.add("xtk-progress-bar")},Ig.prototype.Gd=function(){this.Gb&&he(this.Gb),this.t()&&he(this.t()),this.Ud&&he(this.Ud.t()),this.Ud=this.Gb=t,this.Ze&&(this.ab.style.position=this.Ze)},A(Lg,M),w=Lg.prototype,w.Jf=function(){window.cancelAnimationFrame(this.Je),this.R.PROGRESSBAR_ENABLED&&(this.Vb=new Ig(this.v,3))},w.Kf=function(){this.R.PROGRESSBAR_ENABLED&&this.Vb&&(Jg(this.Vb),this.Rd=Kg(function(){this.Rd=t,this.Vb&&(this.Vb.Gd(),this.Vb=t),this.hd=this.ae=q,this.ec()}.bind(this),700))},w.Lf=function(e){this.Vb&&this.Vb.Pd(100*e.Bd)},w.Ij=function(e){this.La&&this.La.Pd(100*e.Bd)},w.yj=function(e){e!=t&&e instanceof md&&e.D&&this.xb(e.D)},w.Jj=function(e){e!=t&&e instanceof nd&&e.D&&this.remove(e.D)},w.Nf=function(e){(e==t||!(e instanceof Md))&&m(Error("Invalid hover event."))},w.xe=function(){var e=ce(this.v);this.K=e.clientWidth,this.A=e.clientHeight,e=ce(this.la),e.width=this.K,e.height=this.A,"renderer3D"==this.f&&(this.a.viewport(0,0,this.K,this.A),this.M.$e=C.g.Df(C.g.Fd(),this.M.jg,this.la.width/this.la.height,1,1e4))},w.Of=function(e){(e==t||!(e instanceof Ld))&&m(Error("Invalid scroll event."))},Lg.prototype.__defineGetter__("config",v("R")),Lg.prototype.__defineGetter__("interactor",v("kb")),Lg.prototype.__defineGetter__("camera",v("M")),Lg.prototype.__defineGetter__("loadingCompleted",v("hd")),Lg.prototype.__defineGetter__("container",v("v")),Lg.prototype.__defineSetter__("container",function(e){e==t&&m(Error("An ID to a valid container (<div>..) is required."));var n=e;ma(n)&&(n=ce(e)),pa(n)&&1==n.nodeType||m(Error("Could not find the given container.")),this.v=n}),w=Lg.prototype,w.Od=function(){this.M.reset()},w.Ba=function(e){var t=ee("canvas");this.v.appendChild(t),this.K=this.v.clientWidth,this.A=this.v.clientHeight,t.width=this.K,t.height=this.A;try{var n=t.getContext(e);n||m(Error())}catch(r){var i="Sorry, "+e+' context is <strong>not supported</strong> on this machine! See <a href="http://crash.goXTK.com" target="_blank">http://crash.goXTK.com</a> for requirements..';this.v.innerHTML='<h3 style="color:red;font-family:sans-serif;">Oooops..</h3><p style="color:red;font-family:sans-serif;">'+i+"</p>",m(Error(i))}this.Y=new jg,D(this.Y,Bd,this.Ij.bind(this)),this.la=t,this.a=n,t=new Me(this.la),"2d"==e&&(t=new Oe(this.la)),t.Ba(),D(t,xd,this.Od.bind(this)),D(t,Cd,this.Nf.bind(this)),D(t,wd,this.Of.bind(this)),this.kb=t,t=new Qe(this.K,this.A),"2d"==e&&(t=new df(this.K,this.A)),t.observe(this.kb),this.M=t,D(window,"resize",this.xe,u,this)},w.add=function(e){(e instanceof sg||e instanceof qg||e instanceof og)&&e.q(),this.Fa.push(e),this.xb(e)},w.remove=function(e){(!this.la||!this.a)&&m(Error("The renderer was not initialized properly."));if(e!=t){ec(e);var n=this.Fa.length,r;for(r=0;r<n;r++)if(this.Fa[r].pa==e.pa)return this.Fa[r]=t,this.Fa.splice(r,1),q}return u},w.xb=function(e){(!this.la||!this.a)&&m(Error("The renderer was not initialized properly.")),e!=t&&(fc(e,zd)||D(e,zd,this.yj.bind(this)),fc(e,Ad)||D(e,Ad,this.Jj.bind(this)),fc(e,Ed)||D(e,Ed,this.Jf.bind(this)),fc(e,Gd)||D(e,Gd,this.Lf.bind(this)),fc(e,Fd)||D(e,Fd,this.Kf.bind(this)))},w.get=function(e){e==t&&m(Error("Invalid object id."));for(var n=this.sb.I,r=n.length,i=0,i=0;i<r;i++)if(n[i].pa==e)return n[i];return t},w.ec=function(){(!this.la||!this.a)&&m(Error("The renderer was not initialized properly."));if(this.yg==t){if(Cc(this.Y.kc)){if(this.R.PROGRESSBAR_ENABLED&&!this.La&&(this.La=new Ig(this.v,3)),this.ae=this.hd=u,this.yg=Kg(function(){this.yg=t,this.ec()}.bind(this),100),!this.R.INTERMEDIATE_RENDERING)return}else if(!this.hd&&!this.ae&&(this.ae=q,eval("this.onShowtime()"),this.hd=q),this.La){this.R.PROGRESSBAR_ENABLED&&this.La&&!this.Rd&&(Jg(this.La),this.Rd=Kg(function(){this.Rd=t,this.La&&(this.La.Gd(),this.La=t),this.ec()}.bind(this),700));return}this.Je=window.requestAnimationFrame(this.ec.bind(this)),eval("this.onRender()"),this.fc(u,q),eval("this.afterRender()")}},w.qh=aa(),w.oh=aa(),w.Dg=aa(),w.fc=aa(),w.Ta=function(){ec(this),bc(window,"resize",this.xe,u,this),window.cancelAnimationFrame(this.Je),this.Y&&(delete this.Y,this.Y=t),this.La&&(this.La.Gd(),delete this.La,this.La=t),this.sb.clear(),delete this.sb,this.Fa.length=0,delete this.Fa,delete this.Y,this.Y=t,delete this.M,this.M=t,delete this.kb,this.kb=t,delete this.a,this.a=t,he(this.la),delete this.la,this.la=t},Og.prototype.wb=aa(),A(Pg,Og),Pg.prototype.wb=function(e,n,r,i){Mg(re(e),0,e,n,this.sf,r,t,i)},A(Qg,Og),Qg.prototype.wb=function(e,t,n){Mg(this.element,this.Kg,e,t,p,n,this.Yj)},A(Rg,kc),w=Rg.prototype,w.H=t,w.li=q,w.Eg=t,w.Ma=u,w.jk=u,w.Bf=-1,w.ah=-1,w.Ui=u,w.Bi=q,w.ad="toggle_display",w.t=v("H"),w.Uf=function(e){this.Ma&&m(Error("Can not change this state of the popup while showing.")),this.H=e},w.wb=ga,w.Jg=function(e){"toggle_display"==this.ad?this.jk?Kg(this.Tg,0,this):this.Tg():"move_offscreen"==this.ad&&(this.H.style.top="-10000px"),this.Mf(e)},w.Tg=function(){this.H.style.visibility="hidden",Ce(this.H,u)},w.If=function(){return this.dispatchEvent("beforeshow")},w.ph=function(){this.Bf=xa(),this.ah=-1,this.dispatchEvent("show")},w.Mf=function(e){this.dispatchEvent({type:"hide",target:e})},w.mh=function(e){e=e.target,!je(this.H,e)&&(!this.Eg||je(this.Eg,e))&&!(150>xa()-this.Bf)&&Tg(this,e)},w.wj=function(e){27==e.keyCode&&Tg(this,e.target)&&(e.preventDefault(),e.stopPropagation())},w.lh=function(e){if(this.Bi){var t=be(this.H);if(jb||ib){if(e=t.activeElement,!e||je(this.H,e)||"BODY"==e.tagName)return}else if(e.target!=t)return;150>xa()-this.Bf||Tg(this)}},A(Ug,Rg),Ug.prototype.wb=function(){if(this.ye){var e=!this.Ma&&"move_offscreen"!=this.ad,t=this.t();e&&(t.style.visibility="hidden",Ce(t,q)),this.ye.wb(t,this.bk,this.Ql),e&&Ce(t,u)}},w=Vg.prototype,w.xf=function(){return this.da.xf()},w.add=function(e){this.da.set(Wg(e),e)},w.jf=function(e){e=zc(e);for(var t=e.length,n=0;n<t;n++)this.add(e[n])},w.Tf=function(e){e=zc(e);for(var t=e.length,n=0;n<t;n++)this.remove(e[n])},w.remove=function(e){return this.da.remove(Wg(e))},w.clear=function(){this.da.clear()},w.contains=function(e){return e=Wg(e),Dc(this.da.da,e)},w.Yg=function(e){var t=new Vg;e=zc(e);for(var n=0;n<e.length;n++){var r=e[n];this.contains(r)&&t.add(r)}return t},w.Ed=function(){return this.da.Ed()},w.l=function(){return new Vg(this)},A(Xg,Ug);var Zg=[];w=Xg.prototype,w.Sa=t,w.className="goog-tooltip",w.Dh=500,w.Ti=0,w.pe=v("bc"),w.Uf=function(e){var t=this.t();t&&he(t),Xg.u.Uf.call(this,e),e&&(t=this.bc.ia.body,t.insertBefore(e,t.lastChild))},w.If=function(){if(!Rg.prototype.If.call(this))return u;if(this.anchor)for(var e,t=0;e=Zg[t];t++)je(e.t(),this.anchor)||Sg(e,u);return 0<=Jb(Zg,this)||Zg.push(this),e=this.t(),e.className=this.className,$g(this),D(e,"mouseover",this.Sg,u,this),D(e,"mouseout",this.Rg,u,this),ah(this),q},w.Mf=function(){Ob(Zg,this);for(var e=this.t(),t,n=0;t=Zg[n];n++)t.anchor&&je(e,t.anchor)&&Sg(t,u);this.sh&&bh(this.sh),bc(e,"mouseover",this.Sg,u,this),bc(e,"mouseout",this.Rg,u,this),this.anchor=p,0==(this.Lb?this.Ma?4:1:this.Zc?3:this.Ma?2:0)&&(this.De=u),Rg.prototype.Mf.call(this)},w.fh=function(e,t){this.anchor==e&&this.le.contains(this.anchor)&&(this.De||!this.$l?(Sg(this,u),this.Ma||(this.anchor=e,this.ye=t||ch(this,0)||p,this.Ma&&this.wb(),Sg(this,q))):this.anchor=p),this.Lb=p},w.nj=function(e){this.Zc=p,e==this.anchor&&(this.Sa==t||this.Sa!=this.t()&&!this.le.contains(this.Sa))&&(!this.Gg||!this.Gg.Sa)&&Sg(this,u)},w.Si=function(e){var t=eh(this,e.target);this.Sa=t,$g(this),t!=this.anchor&&(this.anchor=t,this.Lb||(this.Lb=Kg(va(this.fh,this,t,p),this.Dh)),fh(this),dh(this,e))},w.Ri=function(e){dh(this,e),this.De=q},w.Qi=function(e){this.Sa=e=eh(this,e.target),this.De=q;if(this.anchor!=e){this.anchor=e;var t=ch(this,1);$g(this),this.Lb||(this.Lb=Kg(va(this.fh,this,e,t),this.Dh)),fh(this)}},w.Qg=function(e){var n=eh(this,e.target),r=eh(this,e.relatedTarget);n!=r&&(n==this.Sa&&(this.Sa=t),ah(this),this.De=u,this.Ma&&(!e.relatedTarget||!je(this.t(),e.relatedTarget))?bh(this):this.anchor=p)},w.Sg=function(){var e=this.t();this.Sa!=e&&($g(this),this.Sa=e)},w.Rg=function(e){var n=this.t();this.Sa==n&&(!e.relatedTarget||!je(n,e.relatedTarget))&&(this.Sa=t,bh(this))},A(gh,Pg),gh.prototype.wb=function(e,t,n){t=re(e),t=ue(t),n=n?new me(n.top+10,n.right,n.bottom,n.left+10):new me(10,0,0,10),Ng(this.sf,e,4,n,t,9)&496&&Ng(this.sf,e,4,n,t,5)},A(hh,Qg),hh.prototype.wb=function(e,t,n){var r=new Yd(10,0);Mg(this.element,this.Kg,e,t,r,n,9)&496&&Mg(this.element,2,e,1,r,n,5)},A(ih,Xg),ih.prototype.zf=function(){var e=pe(this.ab,"position");if("static"==e||""==e)this.ab.style.position="relative";var e=document.getElementsByTagName("head")[0],t=ee("style");t.type="text/css",t.media="screen";var n=document.createTextNode(String(this.hc[0]));e.appendChild(t),t.appendChild(n),this.Gb=t,this.ye=new Pg(this.he,this.ie)||p,this.Ma&&this.wb(),Sg(this,q),Yg(this,this.ab),this.t().classList.add("x-tooltip")},ih.prototype.Gd=function(){Sg(this,u),this.Gb&&he(this.Gb),this.t()&&he(this.t()),this.Gb=t},A(jh,Lg),jh.prototype.__defineGetter__("config",v("R")),w=jh.prototype,w.dk=function(){this.md=this.pd=this.ld=this.od=this.kd=this.nd=t,this.z=[0,0,0]},w.Nf=function(e){jh.u.Nf.call(this,e);var t=e.he;e=e.ie;var n=this.Rf(t,e);if(n=this.get(n))if(n=n.Ic){var r=xe(this.v);(new ih(this.v,r.x+t+10,r.y+e+10,this.kb)).t().innerHTML=n}},w.Ba=function(){jh.u.Ba.call(this,"experimental-webgl");try{if(this.a.viewport(0,0,this.K,this.A),this.a.clearColor(this.cd[0],this.cd[1],this.cd[2],0),this.a.enable(this.a.BLEND),this.a.blendEquation(this.a.FUNC_ADD),this.a.blendFunc(this.a.SRC_ALPHA,this.a.ONE_MINUS_SRC_ALPHA),this.a.enable(this.a.DEPTH_TEST),this.a.depthFunc(this.a.LEQUAL),this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT),this.R.PICKING_ENABLED){var e=this.a.createFramebuffer(),n=this.a.createRenderbuffer(),r=this.a.createTexture();this.a.bindTexture(this.a.TEXTURE_2D,r),this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGB,this.K,this.A,0,this.a.RGB,this.a.UNSIGNED_BYTE,t),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST),this.a.bindFramebuffer(this.a.FRAMEBUFFER,e),this.a.bindRenderbuffer(this.a.RENDERBUFFER,n),this.a.renderbufferStorage(this.a.RENDERBUFFER,this.a.DEPTH_COMPONENT16,this.K,this.A),this.a.bindRenderbuffer(this.a.RENDERBUFFER,t),this.a.framebufferTexture2D(this.a.FRAMEBUFFER,this.a.COLOR_ATTACHMENT0,this.a.TEXTURE_2D,r,0),this.a.framebufferRenderbuffer(this.a.FRAMEBUFFER,this.a.DEPTH_ATTACHMENT,this.a.RENDERBUFFER,n),this.a.bindFramebuffer(this.a.FRAMEBUFFER,t),this.wg=e}}catch(i){m(Error("Exception while accessing GL Context!\n"+i))}e=new ef,(this.la==t||this.a==t||this.M==t)&&m(Error("Renderer was not initialized properly.")),(e==t||!(e instanceof ef))&&m(Error("Could not add shaders.")),n=Object.keys(gf),Object.keys(ff).every(function(e){return e=ff[e],-1!=this.ee.search(e)||-1!=this.Wd.search(e)}.bind(e))||m(Error("Could not find all attributes in the shader sources.")),n.every(function(e){return e=gf[e],-1!=this.ee.search(e)||-1!=this.Wd.search(e)}.bind(e))||m(Error("Could not find all uniforms in the shader sources.")),n=this.a.createShader(this.a.FRAGMENT_SHADER),r=this.a.createShader(this.a.VERTEX_SHADER),this.a.shaderSource(n,e.Wd),this.a.shaderSource(r,e.ee),this.a.compileShader(n),this.a.compileShader(r),this.a.getShaderParameter(n,this.a.COMPILE_STATUS)||m(Error("Fragement Shader compilation failed!\n"+this.a.getShaderInfoLog(n))),this.a.getShaderParameter(r,this.a.COMPILE_STATUS)||m(Error("Vertex Shader compilation failed!\n"+this.a.getShaderInfoLog(r)));var s=this.a.createProgram();this.a.attachShader(s,r),this.a.attachShader(s,n),this.a.linkProgram(s),this.a.getProgramParameter(s,this.a.LINK_STATUS)||m(Error("Could not create shader program!\n"+this.a.getShaderInfoLog(n)+"\n"+this.a.getShaderInfoLog(r)+"\n"+this.a.getProgramInfoLog(s))),this.a.useProgram(s),this.cf=s,Object.keys(ff).forEach(function(e){e=ff[e],this.Ke.set(e,this.a.getAttribLocation(this.cf,e)),this.a.enableVertexAttribArray(this.Ke.get(e))}.bind(this)),Object.keys(gf).forEach(function(e){e=gf[e],this.yd.set(e,this.a.getUniformLocation(this.cf,e))}.bind(this)),this.df=e},w.xb=function(e){jh.u.xb.call(this,e);var n=u;if(e!=t){this.get(e.pa)&&(n=q);var r=e.pa,i=e.h,s=e.n,o=e.oa,a=e.G,f=e.r,l=e.ga,c=e.va,h=e.e,p=e.F;if(h!=t&&h.r!=t&&h.r.j)this.xb(h);else if(h!=t&&h.j&&this.xb(h),c!=t&&c.r!=t&&c.r.j)this.Y.load(c,e);else if(a!=t&&a.r!=t&&a.r.j)this.Y.load(a,e);else{if(f!=t&&ja(f)){if(e.Dc==t){n=0,r=f.length;for(n=0;n<r;n++)this.Y.load(f[n],e);return}if(e.Dc.Cf!=f.length||!e.j)return}else{if(f!=t&&f.j){this.Y.load(e,e);return}if(p!=t&&p.r!=t&&p.r.j){this.Y.load(p,e);return}}if(0<e.c.length){f=e.c,c=f.length;for(h=h=0;h<c;h++)this.xb(f[h])}if(i){for(f=0;this.Zd;)f++,window.console.log("Possible thread lock avoided: "+f);this.Zd=q,c=e instanceof Ye&&e.zb instanceof jf,n&&a!=t&&a.j&&(f=this.tc.get(r),f!=t&&this.a.isBuffer(f.O)&&this.a.deleteBuffer(f.O)),f=t,a!=t&&(!n||a.j?(f=e.sc,f==t&&m(Error("Can not add an object and texture without valid coordinate mapping! Set the textureCoordinateMap!")),h=u,a.Wb&&(h=q),this.a.pixelStorei(this.a.UNPACK_FLIP_Y_WEBGL,h),h=this.a.createTexture(),h.Xi=a.jb,this.xd.set(a.pa,h),this.a.bindTexture(this.a.TEXTURE_2D,h),a.Wb?(h=this.a.RGBA,a.mg&&(h=this.a.LUMINANCE,this.a.pixelStorei(this.a.UNPACK_ALIGNMENT,1)),this.a.texImage2D(this.a.TEXTURE_2D,0,h,a.bf,a.af,0,h,this.a.UNSIGNED_BYTE,a.Wb)):this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGBA,this.a.RGBA,this.a.UNSIGNED_BYTE,h.Xi),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,this.a.CLAMP_TO_EDGE),c?(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST)):(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.LINEAR),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.LINEAR)),this.a.bindTexture(this.a.TEXTURE_2D,t),h=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,h),this.a.bufferData(this.a.ARRAY_BUFFER,new Float32Array(f),this.a.STATIC_DRAW),f=new Td(h,f.length,2),this.tc.set(r,f),a.j=u):f=this.tc.get(r)),kg(this.Y,.1);if(c)this.Zd=u,C.Ca(this.f+".update"),kg(this.Y,.9);else{if(!n||i.j||l.j){c=l.P,a=C.g.Z(c,i.pb,i.qb,i.rb),c=C.g.Z(c,i.mb,i.nb,i.ob);if(this.nd===t||a.x<this.nd)this.nd=a.x;if(this.kd===t||c.x>this.kd)this.kd=c.x;if(this.od===t||a.y<this.od)this.od=a.y;if(this.ld===t||c.y>this.ld)this.ld=c.y;if(this.pd===t||a.d<this.pd)this.pd=a.d;if(this.md===t||c.d>this.md)this.md=c.d;this.z=[(this.nd+this.kd)/2,(this.od+this.ld)/2,(this.pd+this.md)/2],l.j=u}n&&i.j&&(l=this.uc.get(r),l!=t&&this.a.isBuffer(l.O)&&this.a.deleteBuffer(l.O)),l=t,!n||i.j?(l=this.a.createBuffer(),i.Kb(),this.a.bindBuffer(this.a.ARRAY_BUFFER,l),this.a.bufferData(this.a.ARRAY_BUFFER,i.aa,this.a.STATIC_DRAW),l=new Td(l,i.count,3),i.j=u):l=this.uc.get(r),kg(this.Y,.3),n&&s.j&&(a=this.uc.get(r),a!=t&&this.a.isBuffer(a.O)&&this.a.deleteBuffer(a.O)),a=t,!n||s.j?(a=this.a.createBuffer(),s.Kb(),this.a.bindBuffer(this.a.ARRAY_BUFFER,a),this.a.bufferData(this.a.ARRAY_BUFFER,s.aa,this.a.STATIC_DRAW),a=new Td(a,s.count,3),s.j=u):a=this.rd.get(r),kg(this.Y,.3),n&&o&&o.j&&(s=this.Jc.get(r),s!=t&&this.a.isBuffer(s.O)&&this.a.deleteBuffer(s.O)),s=t,o&&(!n||o.j?(o.length!=i.length&&m(Error("Mismatch between points and point colors.")),s=this.a.createBuffer(),o.Kb(),this.a.bindBuffer(this.a.ARRAY_BUFFER,s),this.a.bufferData(this.a.ARRAY_BUFFER,o.aa,this.a.STATIC_DRAW),s=new Td(s,o.count,3),o.j=u):s=this.Jc.get(r)),kg(this.Y,.2),n&&p&&p.j&&(o=this.Uc.get(r),o!=t&&this.a.isBuffer(o.O)&&this.a.deleteBuffer(o.O)),o=t,p&&(o=p.dd,!n||p.j?(o.length!=i.length&&m(Error("Mismatch between points and scalars.")),i=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,i),this.a.bufferData(this.a.ARRAY_BUFFER,o,this.a.STATIC_DRAW),o=new Td(i,o.length,3),p.j=u):o=this.Uc.get(r)),kg(this.Y,.1),n||this.sb.add(e),this.uc.set(r,l),this.rd.set(r,a),this.Jc.set(r,s),this.tc.set(r,f),this.Uc.set(r,o),this.Zd=e.j=u}}else e.j=u}}},w.Rf=function(e,t){if(this.R.PICKING_ENABLED){this.fc(q,u);var n=new Uint8Array(4);return this.a.readPixels(e,this.A-t,1,1,this.a.RGBA,this.a.UNSIGNED_BYTE,n),n[0]+255*n[1]+65025*n[2]}return-1},w.fc=function(e,n){jh.u.fc.call(this,e,n),this.a.viewport(0,0,this.K,this.A),this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT);var r=this.sb.I,i=r.length;if(0!=i){e?this.a.bindFramebuffer(this.a.FRAMEBUFFER,this.wg):this.a.bindFramebuffer(this.a.FRAMEBUFFER,t);var s=this.M.$e,o=this.M.o;this.a.uniformMatrix4fv(this.yd.get("perspective"),u,s),this.a.uniformMatrix4fv(this.yd.get("view"),u,o),s=this.z,this.a.uniform3f(this.yd.get("center"),parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2])),o=this.Fa.length;for(s=0;s<o;++s){var a=this.Fa[s];if(a instanceof N){var f=C.g.Z(this.M.o,a.s[0]+a.b[0].i[0],a.s[1]+a.b[0].i[1],a.s[2]+a.b[0].i[2]),l=C.g.Z(this.M.o,a.s[0]-a.b[0].i[0],a.s[1]-a.b[0].i[1],a.s[2]-a.b[0].i[2]),c=Math.abs(f.d-l.d),f=C.g.Z(this.M.o,a.s[0]+a.b[1].i[0],a.s[1]+a.b[1].i[1],a.s[2]+a.b[1].i[2]),l=C.g.Z(this.M.o,a.s[0]-a.b[1].i[0],a.s[1]-a.b[1].i[1],a.s[2]+ -a.b[1].i[2]),h=Math.abs(f.d-l.d),f=C.g.Z(this.M.o,a.s[0]+a.b[2].i[0],a.s[1]+a.b[2].i[1],a.s[2]+a.b[2].i[2]),l=C.g.Z(this.M.o,a.s[0]-a.b[2].i[0],a.s[1]-a.b[2].i[1],a.s[2]-a.b[2].i[2]),f=Math.max(c,h,Math.abs(f.d-l.d));f==c?hf(a,0):f==h?hf(a,1):hf(a,2)}}if(this.R.ORDERING_ENABLED){c=u,o=this.Fa,a=o.length-1;do if(s=o[a],s instanceof N&&s.Ra&&-1!=s.V){var c=s.c[s.V].c,h=s.V,f=C.g.Z(this.M.o,s.s[0]+s.b[h].B[0],s.s[1]+s.b[h].B[1],s.s[2]+s.b[h].B[2]),l=C.g.Z(this.M.o,s.s[0]-s.b[h].B[0],s.s[1]-s.b[h].B[1],s.s[2]-s.b[h].B[2]),f=f.d-l.d,l=Math.max(s.Hc[s.V],Math.max(s.Hc[s.V+4],s.Hc[s.V+8])),p=Math.min(s.Hc[s.V],Math.min(s.Hc[s.V+4],s.Hc[s.V+8]));if(0>f*(l+p))for(f=f=0;f<s.vd[h]-1;f++)c[f]&&(c[f].xa=s.xa,c[f].wa=s.b[h].Vc*f);else for(f=s.vd[h]-1;0<=f;f--)c[f]&&(c[f].xa=s.xa,c[f].wa=(s.vd[h]-1)*s.b[h].Vc-s.b[h].Vc*f);c=q}while(a--);o=this.sb.I,a=o.length-1;do if(s=o[a],s.N&&!(1==s.xa||s instanceof Ye))c=s,h=s.h.Sd,s=C.g.Z(s.ga.P,h[0],h[1],h[2]),s=C.g.Z(this.M.o,s.x,s.y,s.d),s=C.m.wf(this.M.lc,s),s=Math.round(1e3*s)/1e3,c.wa=s,c=q;while(a--);c&&this.sb.sort()}if(o=!e&&n!=t&&n&&this.R.STATISTICS_ENABLED)var d=0;var s=this.Ke,a=s.get("vertexPosition"),c=s.get("vertexNormal"),h=s.get("vertexColor"),f=s.get("vertexTexturePos"),l=s.get("vertexScalar"),s=this.yd,p=s.get("usePicking"),v=s.get("useObjectColor"),m=s.get("objectColor"),g=s.get("useScalars"),y=s.get("scalarsReplaceMode"),b=s.get("scalarsMin"),w=s.get("scalarsMax"),E=s.get("scalarsMinColor"),S=s.get("scalarsMaxColor"),x=s.get("scalarsInterpolation"),T=s.get("scalarsMinThreshold"),k=s.get("scalarsMaxThreshold"),L=s.get("objectOpacity"),A=s.get("labelmapOpacity"),O=s.get("labelmapColor"),M=s.get("useTexture"),_=s.get("useLabelMapTexture"),D=s.get("textureSampler"),P=s.get("textureSampler2"),H=s.get("volumeLowerThreshold"),B=s.get("volumeUpperThreshold"),j=s.get("volumeScalarMin"),F=s.get("volumeScalarMax"),I=s.get("volumeWindowLow"),R=s.get("volumeWindowHigh"),U=s.get("volumeScalarMinColor"),z=s.get("volumeScalarMaxColor"),W=s.get("volumeTexture"),X=s.get("objectTransform"),V=s.get("pointSize"),s=i;do{var $=r[i-s];if($){var J=t;$ instanceof Ye&&$.zb&&(J=$.zb);if($.N&&(!J||J.N)&&(!e||$.sd)){var K=$.pa,Q=$.jd,G=this.uc.get(K),Y=this.rd.get(K),Z=this.Jc.get(K),et=this.Uc.get(K),tt=this.tc.get(K);this.a.bindBuffer(this.a.ARRAY_BUFFER,G.O),this.a.vertexAttribPointer(a,G.Pb,this.a.FLOAT,u,0,0),this.a.bindBuffer(this.a.ARRAY_BUFFER,Y.O),this.a.vertexAttribPointer(c,Y.Pb,this.a.FLOAT,u,0,0),e?this.a.uniform1i(p,q):this.a.uniform1i(p,u),Z&&!e&&!Q?(this.a.uniform1i(v,u),this.a.bindBuffer(this.a.ARRAY_BUFFER,Z.O),this.a.vertexAttribPointer(h,Z.Pb,this.a.FLOAT,u,0,0)):(Y=1,Q&&!e&&(Y=0),this.a.uniform1i(v,Y),Y=$.w,e&&(Y=[Math.floor(K%65025%255)/255,Math.floor(K%65025/255)/255,Math.floor(K/65025)/255]),this.a.uniform3f(m,parseFloat(Y[0]),parseFloat(Y[1]),parseFloat(Y[2])),this.a.vertexAttribPointer(h,G.Pb,this.a.FLOAT,u,0,0)),et&&!e&&!Q?(this.a.uniform1i(g,q),this.a.uniform1i(y,$.F.zg),K=$.F.Sb,Q=$.F.Qb,this.a.uniform3f(E,parseFloat(K[0]),parseFloat(K[1]),parseFloat(K[2])),this.a.uniform3f(S,parseFloat(Q[0]),parseFloat(Q[1]),parseFloat(Q[2])),this.a.uniform1f(T,parseFloat($.F.T)),this.a.uniform1f(k,parseFloat($.F.U)),this.a.uniform1f(b,parseFloat($.F.qa)),this.a.uniform1f(w,parseFloat($.F.fa)),this.a.uniform1i(x,parseInt($.F.Pe,10)),this.a.bindBuffer(this.a.ARRAY_BUFFER,et.O),this.a.vertexAttribPointer(l,et.Pb,this.a.FLOAT,u,0,0)):(this.a.uniform1i(g,u),this.a.vertexAttribPointer(l,G.Pb,this.a.FLOAT,u,0,0)),this.a.uniform1f(L,parseFloat($.xa)),$.G&&tt&&!e?(this.a.uniform1i(M,q),this.a.activeTexture(this.a.TEXTURE0),this.a.bindTexture(this.a.TEXTURE_2D,this.xd.get($.G.pa)),this.a.uniform1i(D,0),this.a.bindBuffer(this.a.ARRAY_BUFFER,tt.O),this.a.vertexAttribPointer(f,tt.Pb,this.a.FLOAT,u,0,0),this.a.uniform1i(W,u)):(this.a.uniform1i(M,u),this.a.vertexAttribPointer(f,G.Pb,this.a.FLOAT,u,0,0)),J&&(this.a.uniform1i(W,q),this.a.uniform1f(H,J.T),this.a.uniform1f(B,J.U),this.a.uniform1f(j,J.qa),this.a.uniform1f(F,J.fa),K=J.Sb,Q=J.Qb,this.a.uniform3f(U,parseFloat(K[0]),parseFloat(K[1]),parseFloat(K[2])),this.a.uniform3f(z,parseFloat(Q[0]),parseFloat(Q[1]),parseFloat(Q[2])),this.a.uniform1f(I,J.ca),this.a.uniform1f(R,J.ba),et=J.e,this.a.uniform1i(_,u),J.Ra?this.a.uniform1f(L,parseFloat(J.xa)):et&&et.N&&(J=$.e.pa,this.a.uniform1i(_,q),this.a.activeTexture(this.a.TEXTURE1),this.a.bindTexture(this.a.TEXTURE_2D,this.xd.get(J)),this.a.uniform1i(P,1),this.a.uniform1f(A,et.xa),this.a.uniform4fv(O,et.ef))),this.a.uniformMatrix4fv(X,u,$.ga.P),J=1,"POINTS"==$.Ga&&(J=$.td),this.a.uniform1f(V,J),J=-1,$.Ga==jd?(J=this.a.TRIANGLES,o&&(d+=G.ed/3)):"LINES"==$.Ga?(this.a.lineWidth($.Pc),J=this.a.LINES):"POINTS"==$.Ga?J=this.a.POINTS:"TRIANGLE_STRIPS"==$.Ga?(J=this.a.TRIANGLE_STRIP,o&&(d+=G.ed/3)):"POLYGONS"==$.Ga&&(J=0==G.ed%3?this.a.TRIANGLES:this.a.TRIANGLE_FAN,o&&(d+=G.ed/3)),this.a.drawArrays(J,0,G.ed)}}}while(--s);o&&Math.round(d)}},w.remove=function(e){jh.u.remove.call(this,e);if(0<e.c.length)for(var n=e.c,r=n.length,i=0,i=0;i<r;i++)"undefined"!=typeof n[i]&&this.remove(n[i]);return n=e.pa,r=this.tc.get(n),r!=t&&this.a.isBuffer(r.O)&&this.a.deleteBuffer(r.O),e.G&&(r=this.xd.get(e.G.pa))&&(this.a.deleteTexture(r),this.xd.remove(e.G.pa)),r=this.uc.get(n),r!=t&&this.a.isBuffer(r.O)&&this.a.deleteBuffer(r.O),r=this.rd.get(n),r!=t&&this.a.isBuffer(r.O)&&this.a.deleteBuffer(r.O),r=this.Jc.get(n),r!=t&&this.a.isBuffer(r.O)&&this.a.deleteBuffer(r.O),r=this.Uc.get(n),r!=t&&this.a.isBuffer(r.O)&&this.a.deleteBuffer(r.O),this.uc.remove(n),this.rd.remove(n),this.Jc.remove(n),this.tc.remove(n),this.Uc.remove(n),this.sb.remove(e),q},w.Ta=function(){this.df=t,delete this.df,this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT),jh.u.Ta.call(this)},jh.prototype.__defineGetter__("bgColor",v("cd")),jh.prototype.__defineSetter__("bgColor",ba("cd")),jh.prototype.$j=function(e,n,r,i,s){r!=t||(r=4),i!=t||(i=2);if(s==t){s=this.Rf(e,n);if(-1==s)return t;s=this.get(s);if(!s)return t}var o=Re(this.M,2*(e/this.K)-1,2*((this.A-n)/this.A)-1,0);e=Re(this.M,2*(e/this.K)-1,2*((this.A-n)/this.A)-1,1),o[0]+=this.z[0],o[1]+=this.z[1],o[2]+=this.z[2],e[0]+=this.z[0],e[1]+=this.z[1],e[2]+=this.z[2],n=[s.h.pb,s.h.qb,s.h.rb];var u=[s.h.mb,s.h.qb,s.h.rb],a=[s.h.mb,s.h.nb,s.h.rb],f=[s.h.pb,s.h.nb,s.h.rb],l=[s.h.pb,s.h.nb,s.h.ob],c=[s.h.pb,s.h.qb,s.h.ob],h=[s.h.mb,s.h.nb,s.h.ob],p=[s.h.mb,s.h.qb,s.h.ob];n=[C.g.Z(s.ga.P,n[0],n[1],n[2]),C.g.Z(s.ga.P,u[0],u[1],u[2]),C.g.Z(s.ga.P,a[0],a[1],a[2]),C.g.Z(s.ga.P,f[0],f[1],f[2]),C.g.Z(s.ga.P,l[0],l[1],l[2]),C.g.Z(s.ga.P,c[0],c[1],c[2]),C.g.Z(s.ga.P,h[0],h[1],h[2]),C.g.Z(s.ga.P,p[0],p[1],p[2])];var u=[Infinity,-Infinity,Infinity,-Infinity,Infinity,-Infinity],d;for(d in n)d=n[d],u=[Math.min(u[0],d.x),Math.max(u[1],d.x),Math.min(u[2],d.y),Math.max(u[3],d.y),Math.min(u[4],d.d),Math.max(u[5],d.d)];d=u,n=[],u=[];for(a=0;6>a;a++){var f=Math.floor(a/2),l=(f+1)%3,c=(f+2)%3,p=(2+2*f)%6,v=(4+2*f)%6,m=(d[a]-o[f])*(1/e[f]);Infinity!=m&&-Infinity!=m&&(h=o[l]+e[l]*m,m=o[c]+e[c]*m,h>=d[p]&&h<=d[p+1]&&m>=d[v]&&m<=d[v+1]?(p=[],p[f]=d[a],p[l]=h,p[c]=m,n.push(p)):(p=[],p[f]=d[a],p[l]=h,p[c]=m,u.push(p)))}e=[n,u],e=e[0];if(0==e.length)return t;u=Array(2);for(d=0;2>d;d++)n=e[d],u[d]=Math.sqrt((n[0]-o[0])*(n[0]-o[0])+(n[1]-o[1])*(n[1]-o[1])+(n[2]-o[2])*(n[2]-o[2]));o=n=d=t,u[0]<u[1]?(d=e[0],n=e[1]):(d=e[1],n=e[0]),o=Math.sqrt((d[0]-n[0])*(d[0]-n[0])+(d[1]-n[1])*(d[1]-n[1])+(d[2]-n[2])*(d[2]-n[2])),o/=r,e=d,d=[n[0]-d[0],n[1]-d[1],n[2]-d[2]],n=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]),u=[d[0]/n,d[1]/n,d[2]/n],a=s.h.aa,f=a.length;for(d=0;d<o;d+=r){e=[e[0]+r*u[0],e[1]+r*u[1],e[2]+r*u[2]];for(n=0;n<f;n+=3)if(l=a[n],c=a[n+1],h=a[n+2],p=new C.m(l,c,h),p=C.g.Z(s.ga.P,l,c,h),Math.sqrt((e[0]-p.x)*(e[0]-p.x)+(e[1]-p.y)*(e[1]-p.y)+(e[2]-p.d)*(e[2]-p.d))<=i)return[p.x,p.y,p.d]}return t},x("X.renderer3D",jh),x("X.renderer3D.prototype.init",jh.prototype.Ba),x("X.renderer3D.prototype.add",jh.prototype.add),x("X.renderer3D.prototype.onShowtime",jh.prototype.qh),x("X.renderer3D.prototype.onRender",jh.prototype.oh),x("X.renderer3D.prototype.get",jh.prototype.get),x("X.renderer3D.prototype.render",jh.prototype.ec),x("X.renderer3D.prototype.destroy",jh.prototype.Ta),x("X.renderer3D.prototype.remove",jh.prototype.remove),x("X.renderer3D.prototype.resetBoundingBox",jh.prototype.dk),x("X.renderer3D.prototype.resetViewAndRender",jh.prototype.Od),x("X.renderer3D.prototype.pick",jh.prototype.Rf),x("X.renderer3D.prototype.pick3d",jh.prototype.$j),x("X.renderer3D.prototype.afterRender",jh.prototype.Dg),A(kh,T),x("X.mesh",kh),A(lh,T),x("X.fibers",lh),A(Y,Lg),w=Y.prototype,w.remove=function(e){return Y.u.remove.call(this,e),this.sb.remove(e),q},w.Lj=aa(),w.Vj=aa(),w.Of=function(a){Y.u.Of.call(this,a);var b=this.Fa[0];if(b){var c="",c=0==this.ya?"indexX":1==this.ya?"indexY":"indexZ";b[c]=a.up?b[c]+1:b[c]-1,eval("this.onScroll();")}},w.Wj=function(a){var b=this.Fa[0];if(b){var c=b.ba-b.ca,e=c/2,d=parseInt(c+c/15*-a.hf,10);a=parseInt(e+e/15*a.Ve,10),c==d&&d++,e==a&&a++,b.ca-=parseInt(e-a,10),b.ca-=parseInt(c-d,10),b.ca=Math.max(b.ca,b.qa),b.ba-=parseInt(e-a,10),b.ba+=parseInt(c-d,10),b.ba=Math.min(b.ba,b.fa),eval("this.onWindowLevel();")}},Y.prototype.__defineGetter__("orientation",v("Qa")),Y.prototype.__defineSetter__("orientation",function(e){e=e.toUpperCase(),"AXIAL"==e?(e="Z",this.ya=2):"SAGITTAL"==e?(e="X",this.ya=0):"CORONAL"==e&&(e="Y",this.ya=1),"X"!=e&&"Y"!=e&&"Z"!=e&&m(Error("Invalid orientation.")),this.Qa=e}),Y.prototype.__defineGetter__("radiological",v("xg")),Y.prototype.__defineGetter__("normalizedScale",v("Ja")),Y.prototype.__defineGetter__("canvasWidth",function(){return this.la.width}),Y.prototype.__defineGetter__("canvasHeight",function(){return this.la.height}),Y.prototype.__defineGetter__("sliceWidth",v("Zb")),Y.prototype.__defineGetter__("sliceHeight",v("Yb")),Y.prototype.__defineSetter__("radiological",ba("xg")),w=Y.prototype,w.Ba=function(){this.Qa||m(Error("No 2D orientation set.")),Y.u.Ba.call(this,"2d"),this.a.fillStyle="rgba(50,50,50,0)",this.a.fillRect(0,0,this.la.width,this.la.height),this.Xd=ee("canvas"),this.fd=ee("canvas"),this.fd.style.Il="pixelated",D(this.M,yd,this.Wj.bind(this))},w.xe=function(){Y.u.xe.call(this),ph(this)},w.Od=function(){Y.u.Od.call(this),ph(this);var e=this.Fa[0];e&&(e.ba=e.fa,e.ca=e.qa)},w.update=function(e){this.xb(e),this.Me=-1},w.xb=function(e){Y.u.xb.call(this,e);var n=u;this.get(e.pa)&&(n=q);if(e instanceof N){var r=e.r,i=e.e,s=e.va;if(i!=t&&i.r!=t&&i.r.j)this.xb(i);else if(s!=t&&s.r!=t&&s.r.j)this.Y.load(s,e);else{if(r!=t&&ja(r)){if(e.Dc==t){n=0,i=r.length;for(n=0;n<i;n++)this.Y.load(r[n],e);return}if(e.Dc.Cf!=r.length)return}else if(r!=t&&r.j){this.Y.load(e,e);return}this.ya="X"==this.Qa?0:"Y"==this.Qa?1:2;if(e.c[this.ya]){this.bb=e.c[this.ya].c,s=t,s=0==this.ya?e.indexX:1==this.ya?e.indexY:e.indexZ,r=e.c[this.ya].c[s].og,i=e.c[this.ya].c[s].ng,this.oc=e.c[this.ya].c[s].Wc,this.nc=e.c[this.ya].c[s].Lc,this.Zb=r,this.Yb=i,s=this.Xd,s.width=r,s.height=i;var o=this.fd;o.width=r,o.height=i,this.kg=s.getContext("2d"),this.pg=o.getContext("2d"),n||(this.sb.add(e),ph(this))}}}},w.Mj=aa(),w.Nh=function(e,n){var r=this.Fa[0],i=this.M.o,s=t,o=this.Zb,u=this.Yb,a=t,f=t;if("Y"==this.Qa)s=this.bb[parseInt(r.indexY,10)],a=s.Wc,f=s.Lc,this.Rc[0]="rgba(255,0,0,.3)",this.Rc[1]="rgba(0,0,255,.3)";else if("Z"==this.Qa)s=this.bb[parseInt(r.indexZ,10)],a=s.Wc,f=s.Lc,this.Rc[0]="rgba(255,0,0,.3)",this.Rc[1]="rgba(0,255,0,.3)";else{s=this.bb[parseInt(r.indexX,10)],a=s.Lc,f=s.Wc,this.Rc[0]="rgba(0,255,0,.3)",this.Rc[1]="rgba(0,0,255,.3)";var l=o,o=u,u=l}var c=1*i[12],i=-1*i[13],l=[this.K/2,this.A/2],a=o*a*this.Ja,f=u*f*this.Ja,h=l[0]-a/2,l=l[1]-f/2,h=h+c*this.Ja,l=l+i*this.Ja;return e>h&&e<h+a&&n>l&&n<l+f?(c=(e-h)/a*o,i=(n-l)/f*u,f=s.ji[4],"X"==this.Qa?(l=o-c,c=i,i=l):"Y"==this.Qa?c=o-c:"Z"==this.Qa&&(c=o-c,i=u-i),c=s.ii+c*s.Wc,i=s.ci+i*s.Lc,c=Rc(c,i,f,1),o=Sc(),dd(s.Wh,c,o),o=[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2])],u=Sc(),dd(s.Xh,c,u),s=Math.round((r.b[0].i[0]*u[0]+r.b[0].i[1]*u[1]+r.b[0].i[2]*u[2]+r.b[0].Ye)/r.b[0].Vc),s>=r.b[0].p?s=r.b[0].p-1:0>s&&(s=0),c=Math.round((r.b[1].i[0]*u[0]+r.b[1].i[1]*u[1]+r.b[1].i[2]*u[2]+r.b[1].Ye)/r.b[1].Vc),c>=r.b[1].p?c=r.b[1].p-1:0>c&&(c=0),i=Math.round((r.b[2].i[0]*u[0]+r.b[2].i[1]*u[1]+r.b[2].i[2]*u[2]+r.b[2].Ye)/r.b[2].Vc),i>=r.b[2].p?i=r.b[2].p-1:0>i&&(i=0),[[s,c,i],[o[0],o[1],o[2]],[u[0],u[1],u[2]]]):t},w.fc=function(e,n){Y.u.fc.call(this,e,n);if(0!=this.sb.I.length){var r=this.Fa[0],i=t,i=0==this.ya?r.indexX:1==this.ya?r.indexY:r.indexZ,s=this.bb[parseInt(i,10)].og,o=this.bb[parseInt(i,10)].ng;this.oc=this.bb[parseInt(i,10)].Wc,this.nc=this.bb[parseInt(i,10)].Lc,this.Zb=s,this.Yb=o;var a=this.K,f=this.A,l=this.M.o;this.a.save(),this.a.clearRect(-a,-f,2*a,2*f),this.a.restore(),this.Ja=Math.max(l[14],1e-4),this.a.setTransform(this.Ja,0,0,this.Ja,0,0);var c=1*l[12],h=-1*l[13],p=t;r.e&&(p=r.e.ef);var d=this.bb[parseInt(i,10)],v=d.G.Wb,d=d.e,m=t;d&&(m=d.Wb);var g=this.Zb,y=this.Yb,b=this.kg,w=this.pg,E=b.getImageData(0,0,g,y),S=w.getImageData(0,0,g,y),x=E.data,T=S.data,N=x.length,C=r.T,k=r.U,L=r.ca,A=r.ba;if(this.Qe||this.Me!=i||this.T!=C||this.U!=k||this.ca!=L||this.ba!=A||p&&!ug(p,this.qg,0)){var M=this.Xd;M.width=s,M.height=o,M=this.fd,M.width=s,M.height=o,s=0;do{var M=[0,0,0,0],o=[0,0,0,0],_=v[s]/255*(r.fa-r.qa)+r.qa,D=A-L,P=D/2+L,H=0,H=_<P-D/2?0:_>P+D/2?255:255*(_-(P-D/2))/D;_>=C&&_<=k&&(M=new O(r.Sb[0],r.Sb[1],r.Sb[2]),M=(new O(r.Qb[0],r.Qb[1],r.Qb[2])).scale(H).add(M.scale(255-H)),M=[Math.floor(M.x),Math.floor(M.y),Math.floor(M.d),255],d&&(-255==p[3]?o=[m[s],m[s+1],m[s+2],m[s+3]]:ug(p,m,s)&&(o=[m[s],m[s+1],m[s+2],m[s+3]]))),"X"==this.Qa?(x[s]=M[0],x[s+1]=M[1],x[s+2]=M[2],x[s+3]=M[3],T[s]=o[0],T[s+1]=o[1],T[s+2]=o[2],T[s+3]=o[3]):"Y"==this.Qa?(H=Math.floor(s/(4*g)),_=s-4*H*g,_=4*(g-1)-_,H=4*H*g+_,x[H]=M[0],x[H+1]=M[1],x[H+2]=M[2],x[H+3]=M[3],T[H]=o[0],T[H+1]=o[1],T[H+2]=o[2],T[H+3]=o[3]):this.Oe?this.Vd?(H=N-1-s,x[H-3]=M[0],x[H-2]=M[1],x[H-1]=M[2],x[H]=M[3],T[H-3]=o[0],T[H-2]=o[1],T[H-1]=o[2],T[H]=o[3]):(H=Math.floor(s/(4*g)),_=s-4*H*g,H=4*(y-1-H)*g+_,x[H]=M[0],x[H+1]=M[1],x[H+2]=M[2],x[H+3]=M[3],T[H]=o[0],T[H+1]=o[1],T[H+2]=o[2],T[H+3]=o[3]):this.Vd?(H=Math.floor(s/(4*g)),_=s-4*H*g,_=4*(g-1)-_,H=4*H*g+_,x[H]=M[0],x[H+1]=M[1],x[H+2]=M[2],x[H+3]=M[3],T[H]=o[0],T[H+1]=o[1],T[H+2]=o[2],T[H+3]=o[3]):(x[s]=M[0],x[s+1]=M[1],x[s+2]=M[2],x[s+3]=M[3],T[s]=o[0],T[s+1]=o[1],T[s+2]=o[2],T[s+3]=o[3]),s+=4}while(s<N);this.Qe=u,b.putImageData(E,0,0),w.putImageData(S,0,0),this.Me=i,this.T=C,this.U=k,this.ca=L,this.ba=A,d&&(this.qg=p)}this.a.globalAlpha=1,this.a.translate(a/2/this.Ja,f/2/this.Ja),"X"==this.Qa&&(this.a.rotate(.5*Math.PI),a=c,c=h,h=-a),c=-g*this.oc/2+c,h=-y*this.nc/2+h,this.a.drawImage(this.Xd,c,h,g*this.oc,y*this.nc),d&&r.e.N&&(this.a.globalAlpha=1,this.a.drawImage(this.fd,c,h,g*this.oc,y*this.nc));if(this.R.SLICENAVIGATORS)if(this.la.style.cursor="none",this.kb.$d&&this.kb.Bg&&!this.kb.lb){h=this.kb.qd;if(h=this.Nh(h[0],h[1]))r.Db=h[0][0],r.Eb=h[0][1],r.Fb=h[0][2],r.q(u),this.onSliceNavigation(),this.Ka=[h[1][0].toFixed(0),h[1][1].toFixed(0),h[1][2].toFixed(0),h[2][0].toFixed(0),h[2][1].toFixed(0),h[2][2].toFixed(0),h[1][0].toFixed(0)];r=new CustomEvent("onPoint"),this.dispatchEvent(r)}else this.la.style.cursor="default";-1!==this.Ka[0]&&(i!=this.Ka[2]?this.Ka=[-1,-1,-1,-1,-1,-1,-1]:(h=1-this.Ka[0]/this.Zb,i=1-this.Ka[1]/this.Yb,d=-1*l[13],c=[this.K/2,this.A/2],g=this.Zb*this.oc*this.Ja,r=this.Yb*this.nc*this.Ja,y=c[0]-g/2,c=c[1]-r/2,y+=1*l[12]*this.Ja,c+=d*this.Ja,l=h*g+y,i=i*r+c,this.a.setTransform(1,0,0,1,0,0),this.a.lineWidth=2,this.a.strokeStyle="rgba(33,150,243,1)",this.a.beginPath(),this.a.moveTo(l-10,i+10),this.a.lineTo(l,i+1),this.a.lineTo(l+10,i+10),this.a.stroke(),this.a.closePath()))}},Y.prototype.__defineGetter__("pointer",v("Ka")),Y.prototype.__defineSetter__("pointer",function(e){this.Ka[0]=e[0],this.Ka[1]=e[1],this.Ka[2]=e[2],this.Ka[3]=e[3],this.Ka[4]=e[4],this.Ka[5]=e[5],this.Ka[6]=e[6]}),Y.prototype.__defineGetter__("flipRows",v("Oe")),Y.prototype.__defineSetter__("flipRows",function(e){this.Oe=e,this.Qe=q}),Y.prototype.__defineGetter__("flipColumns",v("Vd")),Y.prototype.__defineSetter__("flipColumns",function(e){this.Vd=e,this.Qe=q}),x("X.renderer2D",Y),x("X.renderer2D.prototype.init",Y.prototype.Ba),x("X.renderer2D.prototype.add",Y.prototype.add),x("X.renderer2D.prototype.onShowtime",Y.prototype.qh),x("X.renderer2D.prototype.onRender",Y.prototype.oh),x("X.renderer2D.prototype.onScroll",Y.prototype.Lj),x("X.renderer2D.prototype.onWindowLevel",Y.prototype.Vj),x("X.renderer2D.prototype.get",Y.prototype.get),x("X.renderer2D.prototype.resetViewAndRender",Y.prototype.Od),x("X.renderer2D.prototype.xy2ijk",Y.prototype.Nh),x("X.renderer2D.prototype.render",Y.prototype.ec),x("X.renderer2D.prototype.destroy",Y.prototype.Ta),x("X.renderer2D.prototype.onSliceNavigation",Y.prototype.Mj),x("X.renderer2D.prototype.afterRender",Y.prototype.Dg),define("xtk",function(){}),!function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define("dicomParser",[],t):(void 0===dicomParser&&(dicomParser={},"undefined"!=typeof Package&&(e.dicomParser=dicomParser)),dicomParser=t())}(this,function(){function e(e,t){function n(){l.seek(128);var e=l.readFixedString(4);if("DICM"!==e)throw"dicomParser.parseDicom: DICM prefix not found at location 132"}function r(){n();for(var e=[],t={};l.position<l.byteArray.length;){var r=l.position,i=dicomParser.readDicomElementExplicit(l,e);if(i.tag>"x0002ffff"){l.position=r;break}i.parser=dicomParser.littleEndianByteArrayParser,t[i.tag]=i}var s=new dicomParser.DataSet(l.byteArrayParser,l.byteArray,t);return s.warnings=l.warnings,s}function i(e){if(void 0===e.elements.x00020010)throw"dicomParser.parseDicom: missing required meta header attribute 0002,0010";var t=e.elements.x00020010;return dicomParser.readFixedString(l.byteArray,t.dataOffset,t.length)}function s(e){return"1.2.840.10008.1.2"===e?!1:!0}function o(t){return"1.2.840.10008.1.2.2"===t?new dicomParser.ByteStream(dicomParser.bigEndianByteArrayParser,e,l.position):new dicomParser.ByteStream(dicomParser.littleEndianByteArrayParser,e,l.position)}function u(e,t){for(var n in e.elements)e.elements.hasOwnProperty(n)&&(t.elements[n]=e.elements[n]);return void 0!==e.warnings&&(t.warnings=e.warnings.concat(t.warnings)),t}function a(e){var n=i(e),r=s(n),u=o(n),a={},f=new dicomParser.DataSet(u.byteArrayParser,u.byteArray,a);f.warnings=u.warnings;try{r?dicomParser.parseDicomDataSetExplicit(f,u,u.byteArray.length,t):dicomParser.parseDicomDataSetImplicit(f,u,u.byteArray.length,t)}catch(l){var c={exception:l,dataSet:f};throw c}return f}function f(){var e=r(),t=a(e);return u(e,t)}if(void 0===e)throw"dicomParser.parseDicom: missing required parameter 'byteArray'";var l=new dicomParser.ByteStream(dicomParser.littleEndianByteArrayParser,e);return f()}return void 0===dicomParser?{parseDicom:e}:(dicomParser.parseDicom=e,dicomParser)});var dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.bigEndianByteArrayParser={readUint16:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readUint16: attempt to read past end of buffer";return(e[t]<<8)+e[t+1]},readInt16:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"bigEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=(e[t]<<8)+e[t+1];return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=256*(256*(256*e[t]+e[t+1])+e[t+2])+e[t+3];return n},readInt32:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=(e[t]<<24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];return n},readFloat:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"bigEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[3]=e[t],n[2]=e[t+1],n[1]=e[t+2],n[0]=e[t+3];var r=new Float32Array(n.buffer);return r[0]},readDouble:function(e,t){if(0>t)throw"bigEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"bigEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[7]=e[t],n[6]=e[t+1],n[5]=e[t+2],n[4]=e[t+3],n[3]=e[t+4],n[2]=e[t+5],n[1]=e[t+6],n[0]=e[t+7];var r=new Float64Array(n.buffer);return r[0]}},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.readFixedString=function(e,t,n){if(0>n)throw"readFixedString - length cannot be less than 0";if(t+n>e.length)throw"dicomParser.readFixedString: attempt to read past end of buffer";for(var r="",i=0;n>i;i++){var s=e[t+i];if(0===s)return t+=n,r;r+=String.fromCharCode(s)}return r},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.ByteStream=function(e,t,n){if(void 0===e)throw"dicomParser.ByteStream: missing required parameter 'byteArrayParser'";if(void 0===t)throw"dicomParser.ByteStream: missing required parameter 'byteArray'";if(t instanceof Uint8Array==0)throw"dicomParser.ByteStream: parameter byteArray is not of type Uint8Array";if(0>n)throw"dicomParser.ByteStream: parameter 'position' cannot be less than 0";if(n>=t.length)throw"dicomParser.ByteStream: parameter 'position' cannot be greater than or equal to 'byteArray' length";this.byteArrayParser=e,this.byteArray=t,this.position=n?n:0,this.warnings=[]},e.ByteStream.prototype.seek=function(e){if(this.position+e<0)throw"cannot seek to position < 0";this.position+=e},e.ByteStream.prototype.readByteStream=function(t){if(this.position+t>this.byteArray.length)throw"readByteStream - buffer overread";var n=new Uint8Array(this.byteArray.buffer,this.position,t);return this.position+=t,new e.ByteStream(this.byteArrayParser,n)},e.ByteStream.prototype.readUint16=function(){var e=this.byteArrayParser.readUint16(this.byteArray,this.position);return this.position+=2,e},e.ByteStream.prototype.readUint32=function(){var e=this.byteArrayParser.readUint32(this.byteArray,this.position);return this.position+=4,e},e.ByteStream.prototype.readFixedString=function(t){var n=e.readFixedString(this.byteArray,this.position,t);return this.position+=t,n},e}(dicomParser),dicomParser=function(e){"use strict";function t(e,t){return void 0!==e.parser?e.parser:t}return void 0===e&&(e={}),e.DataSet=function(e,t,n){this.byteArrayParser=e,this.byteArray=t,this.elements=n},e.DataSet.prototype.uint16=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readUint16(this.byteArray,r.dataOffset+2*n):void 0},e.DataSet.prototype.int16=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readInt16(this.byteArray,r.dataOffset+2*n):void 0},e.DataSet.prototype.uint32=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readUint32(this.byteArray,r.dataOffset+4*n):void 0},e.DataSet.prototype.int32=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readInt32(this.byteArray,r.dataOffset+4*n):void 0},e.DataSet.prototype["float"]=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readFloat(this.byteArray,r.dataOffset+4*n):void 0},e.DataSet.prototype["double"]=function(e,n){var r=this.elements[e];return n=void 0!==n?n:0,r&&0!==r.length?t(r,this.byteArrayParser).readDouble(this.byteArray,r.dataOffset+8*n):void 0},e.DataSet.prototype.numStringValues=function(t){var n=this.elements[t];if(n&&n.length>0){var r=e.readFixedString(this.byteArray,n.dataOffset,n.length),i=r.match(/\\/g);return null===i?1:i.length+1}return void 0},e.DataSet.prototype.string=function(t,n){var r=this.elements[t];if(r&&r.length>0){var i=e.readFixedString(this.byteArray,r.dataOffset,r.length);if(n>=0){var s=i.split("\\");return s[n].trim()}return i.trim()}return void 0},e.DataSet.prototype.text=function(t,n){var r=this.elements[t];if(r&&r.length>0){var i=e.readFixedString(this.byteArray,r.dataOffset,r.length);if(n>=0){var s=i.split("\\");return s[n].replace(/ +$/,"")}return i.replace(/ +$/,"")}return void 0},e.DataSet.prototype.floatString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var r=this.string(e,t);if(void 0!==r)return parseFloat(r)}return void 0},e.DataSet.prototype.intString=function(e,t){var n=this.elements[e];if(n&&n.length>0){t=void 0!==t?t:0;var r=this.string(e,t);if(void 0!==r)return parseInt(r)}return void 0},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.findEndOfEncapsulatedElement=function(t,n,r){if(void 0===t)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'byteStream'";if(void 0===n)throw"dicomParser.findEndOfEncapsulatedElement: missing required parameter 'element'";n.encapsulatedPixelData=!0,n.basicOffsetTable=[],n.fragments=[];var i=e.readTag(t);if("xfffee000"!==i)throw"dicomParser.findEndOfEncapsulatedElement: basic offset table not found";for(var s=t.readUint32(),o=s/4,u=0;o>u;u++){var f=t.readUint32();n.basicOffsetTable.push(f)}for(var l=t.position;t.position<t.byteArray.length;){var c=e.readTag(t),h=t.readUint32();if("xfffee0dd"===c)return t.seek(h),void (n.length=t.position-n.dataOffset);if("xfffee000"!==c)return r&&r.push("unexpected tag "+c+" while searching for end of pixel data element with undefined length"),h>t.byteArray.length-t.position&&(h=t.byteArray.length-t.position),n.fragments.push({offset:t.position-l-8,position:t.position,length:h}),t.seek(h),void (n.length=t.position-n.dataOffset);n.fragments.push({offset:t.position-l-8,position:t.position,length:h}),t.seek(h)}r&&r.push("pixel data element "+n.tag+" missing sequence delimiter tag xfffee0dd")},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.findItemDelimitationItemAndSetElementLength=function(e,t){if(void 0===e)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";for(var n=8,r=e.byteArray.length-n;e.position<=r;){var i=e.readUint16();if(65534===i){var s=e.readUint16();if(57357===s){var o=e.readUint32();return 0!==o&&e.warnings("encountered non zero length following item delimiter at position"+e.position-4+" while reading element of undefined length with tag ' + element.tag"),void (t.length=e.position-t.dataOffset)}}}t.length=e.byteArray.length-t.dataOffset,e.seek(e.byteArray.length-e.position)},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.littleEndianByteArrayParser={readUint16:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readUint16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readUint16: attempt to read past end of buffer";return e[t]+256*e[t+1]},readInt16:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readInt16: position cannot be less than 0";if(t+2>e.length)throw"littleEndianByteArrayParser.readInt16: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8);return 32768&n&&(n=n-65535-1),n},readUint32:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readUint32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readUint32: attempt to read past end of buffer";var n=e[t]+256*e[t+1]+256*e[t+2]*256+256*e[t+3]*256*256;return n},readInt32:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readInt32: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readInt32: attempt to read past end of buffer";var n=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},readFloat:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readFloat: position cannot be less than 0";if(t+4>e.length)throw"littleEndianByteArrayParser.readFloat: attempt to read past end of buffer";var n=new Uint8Array(4);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3];var r=new Float32Array(n.buffer);return r[0]},readDouble:function(e,t){if(0>t)throw"littleEndianByteArrayParser.readDouble: position cannot be less than 0";if(t+8>e.length)throw"littleEndianByteArrayParser.readDouble: attempt to read past end of buffer";var n=new Uint8Array(8);n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],n[3]=e[t+3],n[4]=e[t+4],n[5]=e[t+5],n[6]=e[t+6],n[7]=e[t+7];var r=new Float64Array(n.buffer);return r[0]}},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.parseDicomDataSetExplicit=function(t,n,r,i){if(r=void 0===r?n.byteArray.length:r,i=i||{},void 0===n)throw"dicomParser.parseDicomDataSetExplicit: missing required parameter 'byteStream'";if(r<n.position||r>n.byteArray.length)throw"dicomParser.parseDicomDataSetExplicit: invalid value for parameter 'maxPosition'";for(var s=t.elements;n.position<r;){var o=e.readDicomElementExplicit(n,t.warnings,i.untilTag);if(s[o.tag]=o,o.tag===i.untilTag)return}if(n.position>r)throw"dicomParser:parseDicomDataSetExplicit: buffer overrun"},e.parseDicomDataSetImplicit=function(t,n,r,i){if(r=void 0===r?t.byteArray.length:r,i=i||{},void 0===n)throw"dicomParser.parseDicomDataSetImplicit: missing required parameter 'byteStream'";if(r<n.position||r>n.byteArray.length)throw"dicomParser.parseDicomDataSetImplicit: invalid value for parameter 'maxPosition'";for(var s=t.elements;n.position<r;){var o=e.readDicomElementImplicit(n,i.untilTag);if(s[o.tag]=o,o.tag===i.untilTag)return}},e}(dicomParser),dicomParser=function(e){"use strict";function t(e){return"OB"===e||"OW"===e||"SQ"===e||"OF"===e||"UT"===e||"UN"===e?4:2}return void 0===e&&(e={}),e.readDicomElementExplicit=function(n,r,i){if(void 0===n)throw"dicomParser.readDicomElementExplicit: missing required parameter 'byteStream'";var s={tag:e.readTag(n),vr:n.readFixedString(2)},o=t(s.vr);return 2===o?(s.length=n.readUint16(),s.dataOffset=n.position):(n.seek(2),s.length=n.readUint32(),s.dataOffset=n.position),4294967295===s.length&&(s.hadUndefinedLength=!0),s.tag===i?s:"SQ"===s.vr?(e.readSequenceItemsExplicit(n,s,r),s):4294967295===s.length?"x7fe00010"===s.tag?(e.findEndOfEncapsulatedElement(n,s,r),s):(e.findItemDelimitationItemAndSetElementLength(n,s),s):(n.seek(s.length),s)},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.readDicomElementImplicit=function(t,n){if(void 0===t)throw"dicomParser.readDicomElementImplicit: missing required parameter 'byteStream'";var r={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};if(4294967295===r.length&&(r.hadUndefinedLength=!0),r.tag===n)return r;if(t.position+4<=t.byteArray.length){var i=e.readTag(t);if(t.seek(-4),"xfffee000"===i)return e.readSequenceItemsImplicit(t,r),r}return 4294967295===r.length?(e.findItemDelimitationItemAndSetElementLength(t,r),r):(t.seek(r.length),r)},e}(dicomParser),dicomParser=function(e){"use strict";function t(e,t,n){if(1===t.length)return new Uint8Array(e.byteArray.buffer,t[0].dataOffset,t[0].length);for(var r=new Uint8Array(n),i=0,s=0;s<t.length;s++)for(var o=t[s].dataOffset,u=0;u<t[s].length;u++)r[i++]=e.byteArray[o++];return r}function n(n,r){for(var i=[],s=0;n.position<r&&n.position<n.byteArray.length;){var o=e.readSequenceItem(n);if("xfffee0dd"===o.tag)break;i.push(o),n.seek(o.length),s+=o.length}var u=t(n,i,s);return u}function r(e,t,r){var i=e.basicOffsetTable.length;if(r>i)throw"dicomParser.readEncapsulatedPixelData: parameter frame exceeds number of frames in basic offset table";var s=e.basicOffsetTable[r];t.seek(s);var o=e.basicOffsetTable[r+1];void 0===o&&(o=t.position+e.length);var u=n(t,o);return u}function i(e,t,r){if(0!==r)throw"dicomParser.readEncapsulatedPixelData: non zero frame specified for single frame encapsulated pixel data";var i=t.position+e.length,s=n(t,i);return s}return void 0===e&&(e={}),e.readEncapsulatedPixelData=function(t,n,s){if(void 0===t)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'dataSet'";if(void 0===n)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'element'";if(void 0===s)throw"dicomParser.readEncapsulatedPixelData: missing required parameter 'frame'";if("x7fe00010"!==n.tag)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to non pixel data tag (expected tag = x7fe00010'";if(n.encapsulatedPixelData!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(n.hadUndefinedLength!==!0)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.basicOffsetTable)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(void 0===n.fragments)throw"dicomParser.readEncapsulatedPixelData: parameter 'element' refers to pixel data element that does not have encapsulated pixel data";if(0>s)throw"dicomParser.readEncapsulatedPixelData: parameter 'frame' must be >= 0";var o=new e.ByteStream(t.byteArrayParser,t.byteArray,n.dataOffset),u=e.readSequenceItem(o);if("xfffee000"!==u.tag)throw"dicomParser.readEncapsulatedPixelData: missing basic offset table xfffee000";return o.seek(u.length),0!==n.basicOffsetTable.length?r(n,o,s):i(n,o,s)},e}(dicomParser),dicomParser=function(e){"use strict";function t(t,n){for(var r={};t.position<t.byteArray.length;){var i=e.readDicomElementExplicit(t,n);if(r[i.tag]=i,"xfffee00d"===i.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,r)}return t.warnings.push("eof encountered before finding sequence delimitation item while reading sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,r)}function n(n,r){var i=e.readSequenceItem(n);return 4294967295===i.length?(i.hadUndefinedLength=!0,i.dataSet=t(n,r),i.length=n.position-i.dataOffset):(i.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetExplicit(i.dataSet,n,n.position+i.length)),i}function r(e,t,r){for(;e.position<e.byteArray.length;){var i=n(e,r);if(t.items.push(i),"xfffee0dd"===i.tag)return void (t.length=e.position-t.dataOffset)}e.warnings.push("eof encountered before finding sequence delimitation item in sequence element of undefined length with tag "+t.tag),t.length=e.byteArray.length-t.dataOffset}function i(e,t,r){for(var i=t.dataOffset+t.length;e.position<i;){var s=n(e,r);t.items.push(s)}}return void 0===e&&(e={}),e.readSequenceItemsExplicit=function(e,t,n){if(void 0===e)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsExplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?r(e,t):i(e,t,n)},e}(dicomParser),dicomParser=function(e){"use strict";function t(t){for(var n={};t.position<t.byteArray.length;){var r=e.readDicomElementImplicit(t);if(n[r.tag]=r,"xfffee00d"===r.tag)return new e.DataSet(t.byteArrayParser,t.byteArray,n)}return t.warnings.push("eof encountered before finding sequence item delimiter in sequence item of undefined length"),new e.DataSet(t.byteArrayParser,t.byteArray,n)}function n(n){var r=e.readSequenceItem(n);return 4294967295===r.length?(r.hadUndefinedLength=!0,r.dataSet=t(n),r.length=n.position-r.dataOffset):(r.dataSet=new e.DataSet(n.byteArrayParser,n.byteArray,{}),e.parseDicomDataSetImplicit(r.dataSet,n,n.position+r.length)),r}function r(e,t){for(;e.position<e.byteArray.length;){var r=n(e);if(t.items.push(r),"xfffee0dd"===r.tag)return void (t.length=e.position-t.dataOffset)}e.warnings.push("eof encountered before finding sequence delimitation item in sequence of undefined length"),t.length=e.byteArray.length-t.dataOffset}function i(e,t){for(var r=t.dataOffset+t.length;e.position<r;){var i=n(e);t.items.push(i)}}return void 0===e&&(e={}),e.readSequenceItemsImplicit=function(e,t){if(void 0===e)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'byteStream'";if(void 0===t)throw"dicomParser.readSequenceItemsImplicit: missing required parameter 'element'";t.items=[],4294967295===t.length?r(e,t):i(e,t)},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.readSequenceItem=function(t){if(void 0===t)throw"dicomParser.readSequenceItem: missing required parameter 'byteStream'";var n={tag:e.readTag(t),length:t.readUint32(),dataOffset:t.position};return n},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.readTag=function(e){if(void 0===e)throw"dicomParser.readTag: missing required parameter 'byteStream'";var t=256*e.readUint16()*256,n=e.readUint16(),r="x"+("00000000"+(t+n).toString(16)).substr(-8);return r},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.explicitDataSetToJS=function(t,n){if(void 0===t)throw"dicomParser.explicitDataSetToJS: missing required parameter dataSet";n=n||{omitPrivateAttibutes:!0,maxElementLength:128};var r={};for(var i in t.elements){var s=t.elements[i];if(n.omitPrivateAttibutes!==!0||!e.isPrivateTag(i))if(s.items){for(var o=[],u=0;u<s.items.length;u++)o.push(e.explicitDataSetToJS(s.items[u].dataSet,n));r[i]=o}else{var f;f=void 0,s.length<n.maxElementLength&&(f=e.explicitElementToString(t,s)),void 0!==f?r[i]=f:r[i]={dataOffset:s.dataOffset,length:s.length}}}return r},e}(dicomParser),dicomParser=function(e){"use strict";return void 0===e&&(e={}),e.explicitElementToString=function(t,n){function r(e,n){for(var r="",i=0;e>i;i++)0!==i&&(r+="/"),r+=n.call(t,o).toString();return r}if(void 0===t||void 0===n)throw"dicomParser.explicitElementToString: missing required parameters";if(void 0===n.vr)throw"dicomParser.explicitElementToString: cannot convert implicit element to string";var i,s=n.vr,o=n.tag;if(e.isStringVr(s)===!0)i=t.string(o);else{if("AT"==s){var u=t.uint32(o);return void 0===u?void 0:(0>u&&(u=4294967295+u+1),"x"+u.toString(16).toUpperCase())}"US"==s?i=r(n.length/2,t.uint16):"SS"===s?i=r(n.length/2,t.int16):"UL"==s?i=r(n.length/4,t.uint32):"SL"===s?i=r(n.length/4,t.int32):"FD"==s?i=r(n.length/8,t.int32):"FL"==s&&(i=r(n.length/4,t["float"]))}return i},e}(dicomParser),dicomParser=function(e){"use strict";void 0===e&&(e={});var t={AE:!0,AS:!0,AT:!1,CS:!0,DA:!0,DS:!0,DT:!0,FL:!1,FD:!1,IS:!0,LO:!0,LT:!0,OB:!1,OD:!1,OF:!1,OW:!1,PN:!0,SH:!0,SL:!1,SQ:!1,SS:!1,ST:!0,TM:!0,UI:!0,UL:!1,UN:void 0,UR:!0,US:!1,UT:!0};return e.isStringVr=function(e){return t[e]},e.isPrivateTag=function(e){var t=parseInt(e[4]),n=t%2===1;return n},e.parsePN=function(e){if(void 0===e)return void 0;var t=e.split("^");return{familyName:t[0],givenName:t[1],middleName:t[2],prefix:t[3],suffix:t[4]}},e.parseDA=function(e){if(e&&8===e.length){var t=parseInt(e.substring(0,4),10),n=parseInt(e.substring(4,6),10),r=parseInt(e.substring(6,8),10);return{year:t,month:n,day:r}}return void 0},e.parseTM=function(e){if(e.length>=2){var t=parseInt(e.substring(0,2),10),n=e.length>=4?parseInt(e.substring(2,4),10):void 0,r=e.length>=6?parseInt(e.substring(4,6),10):void 0,i=e.length>=8?parseInt(e.substring(7,13),10):void 0;return{hours:t,minutes:n,seconds:r,fractionalSeconds:i}}return void 0},e}(dicomParser);define("rendererjs",["utiljs","jszip","jquery_ui","xtk","dicomParser"],function(e,t){var n=n||{};return n.Renderer=function(e,t){this.version=0,typeof e.container=="string"?this.container=$("#"+e.container):this.container=$(e.container),this.rendererId=e.rendererId,this.orientation="Z",e.orientation&&(this.orientation=e.orientation),this.renderer=null,this.volume=null,this.maximized=!1,this.fileManager=null,t&&(this.fileManager=t),this.imgFileObj=null,this.error=!1},n.Renderer.prototype.init=function(e,t){var n=this;n.imgFileObj=e,n.createUI(),n.createRenderer(),n.createVolume(),n.readVolumeFiles(function(){n.renderVolume(function(){t&&t()})})},n.Renderer.prototype.createUI=function(){var e=this,t=e.imgFileObj.baseUrl+e.imgFileObj.files[0].name;e.container.addClass("view-renderer"),e.container.append('<div class="view-renderer-titlebar ui-dialog-titlebar ui-widget-header ui-corner-all"><span class="view-renderer-titlebar-title">'+t+"</span>"+'<div class="view-renderer-titlebar-buttonpane">'+'<button type="button" class="view-renderer-titlebar-buttonpane-close ui-dialog-titlebar-close" role="button" title="Close">'+'<span class="ui-icon-closethick"></span>'+"</button>"+'<button type="button" class="view-renderer-titlebar-buttonpane-maximize ui-dialog-titlebar-maximize" role="button" title="Maximize">'+'<span class="ui-icon-extlink"></span>'+"</button>"+"</div>"+"</div>"+'<div id="'+e.rendererId+'" class="view-renderer-content">'+'<div class="view-renderer-info view-renderer-info-topleft"></div>'+'<div class="view-renderer-info view-renderer-info-topright"></div>'+'<div class="view-renderer-info view-renderer-info-bottomright"></div>'+'<div class="view-renderer-info view-renderer-info-bottomleft"></div>'+"</div>");var n=$("button",e.container);n.addClass("ui-button ui-widget ui-state-default ui-corner-all"),$("span",n).addClass("ui-button-icon-primary ui-icon"),n.mouseover(function(){return $(this).addClass("ui-state-hover")}).mouseout(function(){return $(this).removeClass("ui-state-hover")}).focus(function(){return $(this).addClass("ui-state-focus")}).blur(function(){return $(this).removeClass("ui-state-focus")}),n.click(function(t){var n=$(this);n.hasClass("view-renderer-titlebar-buttonpane-close")?e.onRendererClose(t):n.hasClass("view-renderer-titlebar-buttonpane-maximize")&&(e.maximized?e.restore():e.maximize(),e.onRendererChange(t))})},n.Renderer.prototype.maximize=function(){var t=$(".view-renderer-titlebar-buttonpane-maximize",this.container);t.attr("title","Restore"),t.removeClass("ui-dialog-titlebar-maximize").addClass("ui-dialog-titlebar-restore"),t.find("span").removeClass("ui-icon-extlink").addClass("ui-icon-newwin"),this.height=this.container.css("height"),this.width=this.container.css("width"),this.container.css({display:"block",height:"100%",width:"100%"}),e.documentRepaint(),this.maximized=!0},n.Renderer.prototype.restore=function(){var t=$(".view-renderer-titlebar-buttonpane-maximize",this.container);t.attr("title","Maximize"),t.removeClass("ui-dialog-titlebar-restore").addClass("ui-dialog-titlebar-maximize"),t.find("span").removeClass("ui-icon-newwin").addClass("ui-icon-extlink"),this.container.css({display:"block",height:this.height,width:this.width}),e.documentRepaint(),this.maximized=!1},n.Renderer.prototype.onRendererChange=function(e){console.log("onRendererChange not overwritten!"),console.log("event obj: ",e)},n.Renderer.prototype.onRendererClose=function(e){this.container.css({display:"none"}),console.log("onRendererClose not overwritten!"),console.log("event obj: ",e)},n.Renderer.prototype.createRenderer=function(){var e=this;if(e.renderer)return;var t=new X.renderer2D;t.container=e.rendererId,t.bgColor=[.2,.2,.2],t.orientation=e.orientation,t.init(),this.onRenderer2DScroll=function(t){e.updateUISliceInfo(),e.onRendererChange(t)},this.onRenderer2DZoom=function(t){e.onRendererChange(t)},this.onRenderer2DPan=function(t){e.onRendererChange(t)},this.onRenderer2DRotate=function(t){e.onRendererChange(t)},this.onRenderer2DFlipColumns=function(n){t.flipColumns=!t.flipColumns,e.onRendererChange(n)},this.onRenderer2DFlipRows=function(n){t.flipRows=!t.flipRows,e.onRendererChange(n)},this.onRenderer2DPoint=function(t){e.onRendererChange(t)},t.interactor.addEventListener(X.event.events.SCROLL,this.onRenderer2DScroll),t.interactor.addEventListener(X.event.events.ZOOM,this.onRenderer2DZoom),t.interactor.addEventListener(X.event.events.PAN,this.onRenderer2DPan),t.interactor.addEventListener(X.event.events.ROTATE,this.onRenderer2DRotate),t.interactor.addEventListener("flipColumns",this.onRenderer2DFlipColumns),t.interactor.addEventListener("flipRows",this.onRenderer2DFlipRows),t.addEventListener("onPoint",this.onRenderer2DPoint),e.renderer=t},n.Renderer.prototype.createVolume=function(){var e=[],t=this.imgFileObj;if(this.volume)return;if(t.imgType==="dicomzip")for(var n=0;n<t.files.length;n++)e[n]=t.files[n].name.replace(".zip","");else for(var r=0;r<t.files.length;r++)e[r]=t.files[r].name;var i=new X.volume;i.reslicing="false",i.file=e.sort().map(function(e){return t.baseUrl+e}),this.volume=i},n.Renderer.prototype.getVolProps=function(e){var t={};t.index="index"+e;switch(e){case"X":t.rangeInd=0;break;case"Y":t.rangeInd=1;break;case"Z":t.rangeInd=2}return t},n.Renderer.prototype.renderVolume=function(t){var n=this,r=n.renderer,i=n.volume;r.afterRender=function(){i.status==="INVALID"?(n.error=!0,console.error("Could not render volume "+n.imgFileObj.baseUrl),t&&t()):n.setUIMriInfo(function(){t&&t()}),r.afterRender=function(){}};try{r.add(i)}catch(s){n.error=!0,console.error("Could not render volume "+n.imgFileObj.baseUrl+" - "+s),t&&t();return}r.render(),e.documentRepaint()},n.Renderer.prototype.updateUISliceInfo=function(){var e=this.getVolProps(this.orientation),t=this.volume;$(".view-renderer-info-bottomleft",this.container).html("slice: "+(t[e.index]+1)+"/"+t.range[e.rangeInd])},n.Renderer.prototype.setUIMriInfo=function(e){function i(n){var r=t.container,i="",s="",o="";n.patientAge&&(i="AGE: "+n.patientAge+"<br>"),$(".view-renderer-info-topleft",r).html(n.patientName+"<br>"+n.patientId+"<br>"+"BIRTHDATE: "+n.patientBirthDate+"<br>"+i+"SEX: "+n.patientSex),$(".view-renderer-info-topright",r).html("SERIES: "+n.seriesDescription+"<br>"+n.manufacturer+"<br>"+n.studyDate+"<br>"+n.dimensions+"<br>"+n.voxelSizes),n.orientation&&(s=n.orientation+"<br>"),n.primarySliceDirection&&(o=n.primarySliceDirection),$(".view-renderer-info-bottomright",r).html(s+o),t.updateUISliceInfo(),e&&e()}var t=this,n=t.imgFileObj,r=t.volume;if(n.json)t.readJSONFile(n.json,function(e){var t={patientName:e.PatientName,patientId:e.PatientID,patientBirthDate:e.PatientBirthDate,patientSex:e.PatientSex,seriesDescription:e.SeriesDescription,manufacturer:e.Manufacturer,studyDate:e.StudyDate,orientation:e.mri_info.orientation,primarySliceDirection:e.mri_info.primarySliceDirection,dimensions:e.mri_info.dimensions,voxelSizes:e.mri_info.voxelSizes};i(t)});else if(n.dicomInfo){var s=n.dicomInfo;s.dimensions=r.range[0]+" x "+r.range[1]+" x "+r.range[2],s.voxelSizes=r.spacing[0].toPrecision(4)+", "+r.spacing[1].toPrecision(4)+", "+r.spacing[2].toPrecision(4),i(s)}else t.updateUISliceInfo(),e&&e()},n.Renderer.prototype.getThumbnail=function(t){var n=this,r=n.renderer,i=function(){var r=$("canvas",n.container)[0];n.readFile(e.dataURItoJPGBlob(r.toDataURL("image/jpeg")),"readAsDataURL",function(e){t(e)})};r.afterRender=function(){n.renderedOnce||(n.renderedOnce=!0,i())},n.renderedOnce?i():(r.render(),e.documentRepaint())},n.Renderer.prototype.destroy=function(){var e=this.renderer;e.remove(this.volume),this.volume.destroy(),e.interactor.removeEventListener(X.event.events.SCROLL,this.onRenderer2DScroll),e.interactor.removeEventListener(X.event.events.ZOOM,this.onRenderer2DZoom),e.interactor.removeEventListener(X.event.events.PAN,this.onRenderer2DPan),e.interactor.removeEventListener(X.event.events.ROTATE,this.onRenderer2DRotate),e.interactor.removeEventListener("flipColumns",this.onRenderer2DFlipColumns),e.interactor.removeEventListener("flipRows",this.onRenderer2DFlipRows),e.removeEventListener("onPoint",this.onRenderer2DPoint),e.destroy(),this.container.empty(),this.renderer=null,this.volume=null,this.maximized=!1,this.fileManager=null,this.imgFileObj=null},n.Renderer.prototype.readVolumeFiles=function(t){function a(a,f){r.readFile(a,"readAsArrayBuffer",function(a){u[f]=a,++o;if(o===i.files.length){if(i.imgType==="dicom"||i.imgType==="dicomzip"){if(i.imgType==="dicomzip"){var l=[];for(var c=0;c<u.length;c++)l=l.concat(r.unzipFileData(u[c]));l=e.sortObjArr(l,"name"),u=[];var h=[];for(c=0;c<l.length;c++)u.push(l[c].data),h.push(i.baseUrl+l[c].name);s.file=h}try{i.dicomInfo=n.Renderer.parseDicom(u[0])}catch(p){console.log("Could not parse dicom "+i.baseUrl+" Error - "+p)}}s.filedata=u,t()}})}var r=this,i=r.imgFileObj,s=r.volume,o=0,u=[];for(var f=0;f<i.files.length;f++)a(i.files[f],f)},n.Renderer.prototype.readJSONFile=function(e,t){this.readFile(e,"readAsText",function(e){t(JSON.parse(e))})},n.Renderer.prototype.readFile=function(t,n,r){var i=this,s=new FileReader;s.onload=function(){r(s.result)},t.remote?t.cloudId?i.fileManager?i.fileManager.getFileBlob(t.cloudId,function(e){s[n](e)}):console.error("No file manager found. Reading files from cloud was not enabled"):e.urlToBlob(t.url,function(e){s[n](e)}):s[n](t)},n.Renderer.prototype.zipFiles=function(e,n){function o(){var e=t(),n=[],r,i=0;for(var o=0;o<s.length;o++)i+s[o].data.byteLength<=20971520?(i+=s[o].data.byteLength,e.file(s[o].name,s[o].data)):(r=e.generate({type:"arraybuffer"}),n.push(r),e=t(),i=s[o].data.byteLength,e.file(s[o].name,s[o].data)),o+1>=s.length&&(r=e.generate({type:"arraybuffer"}),n.push(r));return n}function u(t,r){s.push({name:t,data:r}),s.length===e.length&&n(o())}var r,i,s=[];for(var a=0;a<e.length;a++)e[a].remote?(r=e[a].url,i=r.substring(r.lastIndexOf("/")+1)):i=e[a].name,this.readFile(e[a],"readAsArrayBuffer",u.bind(null,i))},n.Renderer.prototype.unzipFileData=function(e){var n=t(e),r=[];for(var i in n.files)r.push({name:i,data:n.file(i).asArrayBuffer()});return r},n.Renderer.imgType=function(t){var n={},r,i=t.name;n.DICOM=[".dcm",".ima",".DCM",".IMA"],n.DICOMZIP=[".dcm.zip",".DCM.zip",".ima.zip",".IMA.zip"],n.VOL=[".mgh",".mgz",".nrrd",".nii",".nii.gz"],n.FIBERS=[".trk"],n.MESH=[".obj",".vtk",".stl"],n.THUMBNAIL=[".png",".gif",".jpg"],n.JSON=[".json"];if(i.indexOf(".")===-1||e.strEndsWith(i,n.DICOM)||/^\d+$/.test(i.split(".").pop()))r="dicom";else if(e.strEndsWith(i,[".zip"])){r="dicomzip";if(!e.strEndsWith(i,n.DICOMZIP)&&i.slice(0,i.lastIndexOf(".")).indexOf(".")!==-1){var s=i.split(".");s.pop(),/^\d+$/.test(s.pop())||(r="unsupported")}}else e.strEndsWith(i,n.VOL)?r="vol":e.strEndsWith(i,n.FIBERS)?r="fibers":e.strEndsWith(i,n.MESH)?r="mesh":e.strEndsWith(i,n.THUMBNAIL)?r="thumbnail":e.strEndsWith(i,n.JSON)?r="json":r="unsupported";return r},n.Renderer.parseDicom=function(e){var t=new Uint8Array(e),n=dicomParser.parseDicom(t);return{patientName:n.string("x00100010"),patientId:n.string("x00100020"),patientBirthDate:n.string("x00100030"),patientAge:n.string("x00101010"),patientSex:n.string("x00100040"),seriesDescription:n.string("x0008103e"),manufacturer:n.string("x00080070"),studyDate:n.string("x00080020")}},n}),define("rboxjs",["utiljs","rendererjs","jquery_ui"],function(e,t){var n=n||{};return n.RenderersBox=function(e,t){this.version=0,typeof e.container=="string"?this.container=$("#"+e.container):this.container=$(e.container),e.position?this.position=e.position:this.position={},this.renderersIdPrefix=e.renderersIdPrefix,this.renderers=[],this.renderersLinked=!1,this.maxNumOfRenderers=4,this.numOfRenderers=0,this.fileManager=null,t&&(this.fileManager=t)},n.RenderersBox.prototype.init=function(){var e=this,t=e.container;t.addClass("view-renderers");var n={cursor:"move",cursorAt:{left:20,top:20},handle:".view-renderer-titlebar",containment:t.parent(),dropOnEmpty:!0,helper:function(t,n){return e.computeMovingHelper(t,n)},start:function(t,n){e.onStart(t,n)},beforeStop:function(t,n){e.onBeforeStop(t,n)}};t.sortable(n),e.setPosition(e.position)},n.RenderersBox.prototype.setPosition=function(e){var t=this.container,n="",r="",i="",s="";e&&(e.top&&(this.position.top=e.top,t.css({top:e.top}),n=" - "+e.top),e.right&&(this.position.right=e.right,t.css({right:e.right}),r=" - "+e.right),e.bottom&&(this.position.bottom=e.bottom,t.css({bottom:e.bottom}),i=" - "+e.bottom),e.left&&(this.position.left=e.left,t.css({left:e.left}),s=" - "+e.left),(n||i)&&t.css({height:"calc(100%"+n+i+")"}),(r||s)&&t.css({width:"calc(100%"+r+s+")"}))},n.RenderersBox.prototype.computeMovingHelper=function(e,t){return console.log("computeMovingHelper not overwritten!"),console.log("event obj: ",e),console.log("target obj: ",t),t.clone()},n.RenderersBox.prototype.onStart=function(e,t){console.log("onStart not overwritten!"),console.log("event obj: ",e),console.log("ui obj: ",t)},n.RenderersBox.prototype.onBeforeStop=function(e,t){console.log("onBefore not overwritten!"),console.log("event obj: ",e),console.log("ui obj: ",t)},n.RenderersBox.prototype.onRendererChange=function(e){console.log("onRendererChange not overwritten!"),console.log("event obj: ",e)},n.RenderersBox.prototype.onRendererRemove=function(e){console.log("onRendererRemove not overwritten!"),console.log("renderer integer id: ",e)},n.RenderersBox.prototype.setComplementarySortableElems=function(e){this.container.sortable("option","appendTo",e),this.container.sortable("option","connectWith",e)},n.RenderersBox.prototype.addRenderer=function(e,n,r){var i=this,s=i.renderers.filter(function(t){return t.id===e.id});if(s.length){r&&r(s[0]);return}if(i.numOfRenderers===i.maxNumOfRenderers){r&&r(null);return}var o=$("<div></div>");i.container.append(o);var u={container:o[0],rendererId:i.getRendererContId(e.id),orientation:n},a=new t.Renderer(u,i.fileManager);a.id=e.id,a.onRendererClose=function(){i.removeRenderer(a)},a.onRendererChange=function(e){var t=this;e.type==="click"&&$(e.currentTarget).hasClass("view-renderer-titlebar-buttonpane-maximize")&&(t.maximized?i.renderers.forEach(function(e){t.id!==e.id&&e.container.css({display:"none"})}):i.positionRenderers());if(e.type==="scroll_3"&&i.renderersLinked){var n=t.getVolProps(t.orientation);i.renderers.forEach(function(r){t.id!==r.id&&t.orientation===r.orientation&&(e.up?r.volume[n.index]++:r.volume[n.index]--,r.updateUISliceInfo())})}i.onRendererChange(e)},i.renderers.push(a),++i.numOfRenderers,a.init(e,function(){a.error?(i.removeRenderer(a),r&&r(null)):r&&r(a)}),i.numOfRenderers===1?$(".view-renderer-titlebar-buttonpane-maximize",o).css({display:"none"}):$(".view-renderer-titlebar-buttonpane-maximize",i.container).css({display:"block"}),i.positionRenderers()},n.RenderersBox.prototype.removeRenderer=function(e){var t=e.id;for(var n=0;n<this.renderers.length;n++)if(this.renderers[n].id===t){this.renderers.splice(n,1),e.destroy(),e.container.remove(),--this.numOfRenderers,this.positionRenderers(),this.numOfRenderers===1&&$(".view-renderer-titlebar-buttonpane-maximize",this.container).css({display:"none"}),this.onRendererRemove(t);break}},n.RenderersBox.prototype.positionRenderers=function(){var t=$("div.view-renderer",this.container).css({display:"block"});switch(this.numOfRenderers){case 1:t.css({width:"100%",height:"100%"});break;case 2:t.css({width:"50%",height:"100%","float":"left"});break;default:t.css({width:"50%",height:"50%","float":"left"})}e.documentRepaint()},n.RenderersBox.prototype.getRendererContId=function(e){return this.renderersIdPrefix+e},n.RenderersBox.prototype.getRendererId=function(e){return parseInt(e.replace(this.renderersIdPrefix,""))},n.RenderersBox.prototype.destroy=function(){for(var e=this.renderers.length-1;e>=0;e--)this.removeRenderer(this.renderers[e]);this.container.empty(),this.container=null},n}),define("toolbarjs",["jquery_ui"],function(){var e=e||{};return e.ToolBar=function(e){this.version=0,typeof e.container=="string"?this.container=$("#"+e.container):this.container=$(e.container),e.position?this.position=e.position:this.position={},this.eventHandlers=null},e.ToolBar.prototype.init=function(){this.container.addClass("view-toolbar"),this.eventHandlers={},this.setPosition(this.position)},e.ToolBar.prototype.setPosition=function(e){var t=this.container,n="",r="",i="",s="";e&&(e.top&&(this.position.top=e.top,t.css({top:e.top}),n=" - "+e.top),e.right&&(this.position.right=e.right,t.css({right:e.right}),r=" - "+e.right),e.bottom&&(this.position.bottom=e.bottom,t.css({bottom:e.bottom}),i=" - "+e.bottom),e.left&&(this.position.left=e.left,t.css({left:e.left}),s=" - "+e.left),(r||s)&&t.css({width:"calc(100%"+r+s+")"}))},e.ToolBar.prototype.addButton=function(e){this.container.append('<button id="'+e.id+'" class="view-toolbar-button" type="button" title="'+e.title+'">'+e.caption+"</button>"),this.eventHandlers[e.id]={},e.onclick&&this.setButtonClickHandler(e.id,e.onclick)},e.ToolBar.prototype.setButtonClickHandler=function(e,t){e&&e in this.eventHandlers&&t&&(this.eventHandlers[e].onclick=t,$("#"+e).click(t))},e.ToolBar.prototype.hideButton=function(e){$("#"+e).css({display:"none"})},e.ToolBar.prototype.showButton=function(e){$("#"+e).css({display:""})},e.ToolBar.prototype.destroy=function(){this.eventHandlers=null,this.container.empty(),this.container=null},e}),define("thbarjs",["utiljs","rendererjs","jquery_ui"],function(e,t){var n=n||{};return n.ThumbnailsBar=function(e,t){this.version=0,typeof e.container=="string"?this.container=$("#"+e.container):this.container=$(e.container),e.position?this.position=e.position:this.position={},this.layout="vertical",e.layout&&(this.layout=e.layout),this.thumbnailsIdPrefix=e.thumbnailsIdPrefix,this.jqSortable=null,this.numThumbnails=0,this.numOfLoadedThumbnails=0,this.fileManager=null,t&&(this.fileManager=t)},n.ThumbnailsBar.prototype.init=function(e,t){var n=this;n.container.append('<div class="view-thumbnailsbar-handle">...</div>'),n.jqSortable=$('<div class="view-thumbnailsbar-sortable"></div>'),n.container.append(n.jqSortable),n.container.addClass("view-thumbnailsbar");var r={cursor:"move",containment:n.container.parent(),helper:"clone",dropOnEmpty:!0,beforeStop:function(e,t){n.onBeforeStop(e,t)}};n.jqSortable.sortable(r);var i=function(){++n.numOfLoadedThumbnails===n.numThumbnails&&t&&t()};n.numThumbnails=e.length;for(var s=0;s<n.numThumbnails;s++)n.addThumbnail(e[s],i);n.setLayout(n.layout)},n.ThumbnailsBar.prototype.setLayout=function(e){var t=this.container,n=$(".view-thumbnail",t);this.layout=e,e==="vertical"?(t.removeClass("view-thumbnailsbar-x"),t.addClass("view-thumbnailsbar-y"),n.removeClass("view-thumbnail-x"),n.addClass("view-thumbnail-y")):e==="horizontal"?(t.removeClass("view-thumbnailsbar-y"),t.addClass("view-thumbnailsbar-x"),n.removeClass("view-thumbnail-y"),n.addClass("view-thumbnail-x")):e==="grid"&&(t.removeClass("view-thumbnailsbar-y view-thumbnailsbar-x"),n.removeClass("view-thumbnail-y"),n.addClass("view-thumbnail-x")),this.setPosition(this.position)},n.ThumbnailsBar.prototype.setPosition=function(e){var t=this.container,n=this.layout,r="",i="",s="",o="";e&&(e.top&&(this.position.top=e.top,t.css({top:e.top}),r=" - "+e.top),e.right&&(this.position.right=e.right,t.css({right:e.right}),i=" - "+e.right),e.bottom&&(this.position.bottom=e.bottom,t.css({bottom:e.bottom}),s=" - "+e.bottom),e.left&&(this.position.left=e.left,t.css({left:e.left}),o=" - "+e.left),n==="vertical"&&(r||s)?t.css({height:"calc(100%"+r+s+")"}):n==="horizontal"&&(i||o)?t.css({width:"calc(100%"+i+o+")"}):n==="grid"&&((r||s)&&t.css({height:"calc(100%"+r+s+")"}),(i||o)&&t.css({width:"calc(100%"+i+o+")"})))},n.ThumbnailsBar.prototype.onBeforeStop=function(e,t){console.log("onBeforeStop not overwritten!"),console.log("event obj: ",e),console.log("ui obj: ",t)},n.ThumbnailsBar.prototype.setComplementarySortableElems=function(e){this.jqSortable.sortable("option","appendTo",e),this.jqSortable.sortable("option","connectWith",e)},n.ThumbnailsBar.prototype.getThumbnailContId=function(e){return this.thumbnailsIdPrefix+e},n.ThumbnailsBar.prototype.getThumbnailId=function(e){return parseInt(e.replace(this.thumbnailsIdPrefix,""))},n.ThumbnailsBar.prototype.addThumbnail=function(e,t){var n,r,i,s=e.id,o=this;e.thumbnail?n=e.thumbnail.name:e.imgType!=="dicom"&&(n=e.files[0].name),n?n.lastIndexOf("-")!==-1?(i=n.substring(0,n.lastIndexOf(".")),i=i.substring(i.lastIndexOf("-")+1),r=i.substr(0,10)):(i=n,r=n.substring(0,n.lastIndexOf(".")).substr(-10)):(i=e.files[0].name,r=i.substr(-10));var u=$('<div id="'+o.getThumbnailContId(s)+'" class="view-thumbnail">'+'<img class="view-thumbnail-img" title="'+i+'">'+'<div class="view-thumbnail-info">'+r+"</div>"+"</div>");o.jqSortable.append(u),e.thumbnail?o.loadThumbnail(e.thumbnail,u,function(){t&&t()}):o.createThumbnail(e,u,function(){t&&t()})},n.ThumbnailsBar.prototype.loadThumbnail=function(e,n,r){var i=$(".view-thumbnail-img",n),s={container:null,rendererId:""},o=new t.Renderer(s,this.fileManager);o.readFile(e,"readAsDataURL",function(e){i.attr("src",e),r&&r()})},n.ThumbnailsBar.prototype.createThumbnail=function(e,n,r){var i=this,s=$(".view-thumbnail-img",n),o=$(".view-thumbnail-info",n),u=$("<div></div>");i.container.append(u);var a={container:u[0],rendererId:i.thumbnailsIdPrefix+"_tmprenderer"+e.id};u.append('<div id="'+a.rendererId+'"></div>');var f=s.css("width"),l=s.css("height");$("#"+a.rendererId).css({width:f,height:l});var c=new t.Renderer(a,i.fileManager);c.imgFileObj=e,c.createRenderer(),c.createVolume(),c.readVolumeFiles(function(){if(c.imgFileObj.dicomInfo){var e=c.imgFileObj.dicomInfo.seriesDescription,t=e.substr(0,10);s.attr("title",e),o.text(t)}c.renderVolume(function(){c.error?(s.hide(),$('<div class="badData"> <i class="fa fa-times"></i> Invalid data <div/>').prependTo(s.parent()),c.destroy(),u.remove(),r&&r()):c.getThumbnail(function(e){s.attr("src",e),c.destroy(),u.remove(),r&&r()})})})},n.ThumbnailsBar.prototype.destroy=function(){this.numThumbnails=0,this.numOfLoadedThumbnails=0,this.container.empty(),this.container=null},n}),define("jqdlgext",["jquery_ui"],function(){(function(){var e;e=jQuery,e.widget("ui.dialogExtend",{version:"2.0.0",modes:{},options:{closable:!0,dblclick:!1,titlebar:!1,icons:{close:"ui-icon-closethick",restore:"ui-icon-newwin"},load:null,beforeRestore:null,restore:null},_create:function(){return this._state="normal",e(this.element[0]).data("ui-dialog")||e.error("jQuery.dialogExtend Error : Only jQuery UI Dialog element is accepted"),this._verifyOptions(),this._initStyles(),this._initButtons(),this._initTitleBar(),this._setState("normal"),this._on("load",function(e){return console.log("test",e)}),this._trigger("load")},_setState:function(t){return e(this.element[0]).removeClass("ui-dialog-"+this._state).addClass("ui-dialog-"+t),this._state=t},_verifyOptions:function(){var t,n,r;this.options.dblclick&&!(this.options.dblclick in this.modes)&&(e.error("jQuery.dialogExtend Error : Invalid <dblclick> value '"+this.options.dblclick+"'"),this.options.dblclick=!1),this.options.titlebar&&(n=this.options.titlebar)!=="none"&&n!=="transparent"&&(e.error("jQuery.dialogExtend Error : Invalid <titlebar> value '"+this.options.titlebar+"'"),this.options.titlebar=!1),r=[];for(t in this.modes)this["_verifyOptions_"+t]?r.push(this["_verifyOptions_"+t]()):r.push(void 0);return r},_initStyles:function(){var t,n,r;e(".dialog-extend-css").length||(n="",n+='<style class="dialog-extend-css" type="text/css">',n+=".ui-dialog .ui-dialog-titlebar-buttonpane>a { float: right; }",n+=".ui-dialog .ui-dialog-titlebar-restore { width: 19px; height: 18px; }",n+=".ui-dialog .ui-dialog-titlebar-restore span { display: block; margin: 1px; }",n+=".ui-dialog .ui-dialog-titlebar-restore:hover,",n+=".ui-dialog .ui-dialog-titlebar-restore:focus { padding: 0; }",n+=".ui-dialog .ui-dialog-titlebar ::selection { background-color: transparent; }",n+="</style>",e(n).appendTo("body")),r=[];for(t in this.modes)r.push(this["_initStyles_"+t]());return r},_initButtons:function(){var t,n,r,i,s,o=this;i=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar"),t=e('<div class="ui-dialog-titlebar-buttonpane"></div>').appendTo(i),t.css({position:"absolute",top:"50%",right:"0.3em","margin-top":"-10px",height:"18px"}),i.find(".ui-dialog-titlebar-close").css({position:"relative","float":"right",top:"auto",right:"auto",margin:0}).find(".ui-icon").removeClass("ui-icon-closethick").addClass(this.options.icons.close).end().appendTo(t).end(),t.append('<a class="ui-dialog-titlebar-restore ui-corner-all ui-state-default" href="#"><span class="ui-icon '+this.options.icons.restore+'" title="restore">restore</span></a>').find(".ui-dialog-titlebar-restore").attr("role","button").mouseover(function(){return e(this).addClass("ui-state-hover")}).mouseout(function(){return e(this).removeClass("ui-state-hover")}).focus(function(){return e(this).addClass("ui-state-focus")}).blur(function(){return e(this).removeClass("ui-state-focus")}).end().find(".ui-dialog-titlebar-close").toggle(this.options.closable).end().find(".ui-dialog-titlebar-restore").hide().click(function(e){return e.preventDefault(),o.restore()}).end(),s=this.modes;for(r in s)n=s[r],this._initModuleButton(r,n);return i.dblclick(function(){if(o.options.dblclick)return o._state!=="normal"?o.restore():o[o.options.dblclick]()}).select(function(){return!1})},_initModuleButton:function(t,n){var r,i=this;return r=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-buttonpane"),r.append('<a class="ui-dialog-titlebar-'+t+' ui-corner-all ui-state-default" href="#" title="'+t+'"><span class="ui-icon '+this.options.icons[t]+'">'+t+"</span></a>").find(".ui-dialog-titlebar-"+t).attr("role","button").mouseover(function(){return e(this).addClass("ui-state-hover")}).mouseout(function(){return e(this).removeClass("ui-state-hover")}).focus(function(){return e(this).addClass("ui-state-focus")}).blur(function(){return e(this).removeClass("ui-state-focus")}).end().find(".ui-dialog-titlebar-"+t).toggle(this.options[n.option]).click(function(e){return e.preventDefault(),i[t]()}).end()},_initTitleBar:function(){var t;switch(this.options.titlebar){case!1:return 0;case"none":return e(this.element[0]).dialog("option","draggable")&&(t=e("<div />").addClass("ui-dialog-draggable-handle").css("cursor","move").height(5),e(this.element[0]).dialog("widget").prepend(t).draggable("option","handle",t)),e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").find(".ui-dialog-title").html("&nbsp;").end().css({"background-color":"transparent","background-image":"none",border:0,position:"absolute",right:0,top:0,"z-index":9999}).end();case"transparent":return e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").css({"background-color":"transparent","background-image":"none",border:0});default:return e.error("jQuery.dialogExtend Error : Invalid <titlebar> value '"+this.options.titlebar+"'")}},state:function(){return this._state},restore:function(){return this._trigger("beforeRestore"),this._restore(),this._toggleButtons(),this._trigger("restore")},_restore:function(){if(this._state!=="normal")return this["_restore_"+this._state](),this._setState("normal"),e(this.element[0]).dialog("widget").focus()},_saveSnapshot:function(){if(this._state==="normal")return this.original_config_resizable=e(this.element[0]).dialog("option","resizable"),this.original_config_draggable=e(this.element[0]).dialog("option","draggable"),this.original_size_height=e(this.element[0]).dialog("widget").outerHeight(),this.original_size_width=e(this.element[0]).dialog("option","width"),this.original_size_maxHeight=e(this.element[0]).dialog("option","maxHeight"),this.original_position_mode=e(this.element[0]).dialog("widget").css("position"),this.original_position_left=e(this.element[0]).dialog("widget").offset().left-e("body").scrollLeft(),this.original_position_top=e(this.element[0]).dialog("widget").offset().top-e("body").scrollTop(),this.original_titlebar_wrap=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").css("white-space")},_loadSnapshot:function(){return{config:{resizable:this.original_config_resizable,draggable:this.original_config_draggable},size:{height:this.original_size_height,width:this.original_size_width,maxHeight:this.original_size_maxHeight},position:{mode:this.original_position_mode,left:this.original_position_left,top:this.original_position_top},titlebar:{wrap:this.original_titlebar_wrap}}},_toggleButtons:function(t){var n,r,i,s,o,u;i=t||this._state,e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-restore").toggle(i!=="normal").css({right:"1.4em"}).end(),s=this.modes;for(r in s)n=s[r],e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-"+r).toggle(i!==n.state&&this.options[n.option]);o=this.modes,u=[];for(r in o)n=o[r],n.state===i?u.push(e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-restore").insertAfter(e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-"+r)).end()):u.push(void 0);return u}})}).call(this),function(){var e;e=jQuery,e.extend(!0,e.ui.dialogExtend.prototype,{modes:{collapse:{option:"collapsable",state:"collapsed"}},options:{collapsable:!1,icons:{collapse:"ui-icon-triangle-1-s"},beforeCollapse:null,collapse:null},collapse:function(){var t,n;return t=e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").height()+15,this._trigger("beforeCollapse"),this._state!=="normal"&&this._restore(),this._saveSnapshot(),n=e(this.element[0]).dialog("widget").position(),e(this.element[0]).dialog("option",{resizable:!1,height:t,maxHeight:t,position:[n.left-e(document).scrollLeft(),n.top-e(document).scrollTop()]}).on("dialogclose",this._collapse_restore).hide().dialog("widget").find(".ui-dialog-buttonpane:visible").hide().end().find(".ui-dialog-titlebar").css("white-space","nowrap").end().find(".ui-dialog-content"),this._setState("collapsed"),this._toggleButtons(),this._trigger("collapse")},_restore_collapsed:function(){var t;return t=this._loadSnapshot(),e(this.element[0]).show().dialog("widget").find(".ui-dialog-buttonpane:hidden").show().end().find(".ui-dialog-titlebar").css("white-space",t.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:t.config.resizable,height:t.size.height,maxHeight:t.size.maxHeight}).off("dialogclose",this._collapse_restore)},_initStyles_collapse:function(){var t;if(!e(".dialog-extend-collapse-css").length)return t="",t+='<style class="dialog-extend-collapse-css" type="text/css">',t+=".ui-dialog .ui-dialog-titlebar-collapse { width: 19px; height: 18px; }",t+=".ui-dialog .ui-dialog-titlebar-collapse span { display: block; margin: 1px; }",t+=".ui-dialog .ui-dialog-titlebar-collapse:hover,",t+=".ui-dialog .ui-dialog-titlebar-collapse:focus { padding: 0; }",t+="</style>",e(t).appendTo("body")},_collapse_restore:function(){return e(this).dialogExtend("restore")}})}.call(this),function(){var e;e=jQuery,e.extend(!0,e.ui.dialogExtend.prototype,{modes:{maximize:{option:"maximizable",state:"maximized"}},options:{maximizable:!1,icons:{maximize:"ui-icon-extlink"},beforeMaximize:null,maximize:null},maximize:function(){var t,n;return t=e(window).height()-11,n=e(window).width()-11,this._trigger("beforeMaximize"),this._state!=="normal"&&this._restore(),this._saveSnapshot(),e(this.element[0]).dialog("option","draggable")&&e(this.element[0]).dialog("widget").draggable("option","handle",null).find(".ui-dialog-draggable-handle").css("cursor","text").end(),e(this.element[0]).dialog("widget").css("position","fixed").find(".ui-dialog-content").show().dialog("widget").find(".ui-dialog-buttonpane").show().end().find(".ui-dialog-content").dialog("option",{resizable:!1,draggable:!1,height:t,width:n,position:{my:"left top",at:"left top",of:window}}),this._setState("maximized"),this._toggleButtons(),this._trigger("maximize")},_restore_maximized:function(){var t;t=this._loadSnapshot(),e(this.element[0]).dialog("widget").css("position",t.position.mode).find(".ui-dialog-titlebar").css("white-space",t.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:t.config.resizable,draggable:t.config.draggable,height:t.size.height,width:t.size.width,maxHeight:t.size.maxHeight,position:{my:"left top",at:"left+"+t.position.left+" top+"+t.position.top,of:window}});if(e(this.element[0]).dialog("option","draggable"))return e(this.element[0]).dialog("widget").draggable("option","handle",e(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle").length?e(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle"):".ui-dialog-titlebar").find(".ui-dialog-draggable-handle").css("cursor","move")},_initStyles_maximize:function(){var t;if(!e(".dialog-extend-maximize-css").length)return t="",t+='<style class="dialog-extend-maximize-css" type="text/css">',t+=".ui-dialog .ui-dialog-titlebar-maximize { width: 19px; height: 18px; }",t+=".ui-dialog .ui-dialog-titlebar-maximize span { display: block; margin: 1px; }",t+=".ui-dialog .ui-dialog-titlebar-maximize:hover,",t+=".ui-dialog .ui-dialog-titlebar-maximize:focus { padding: 0; }",t+="</style>",e(t).appendTo("body")}})}.call(this),function(){var e;e=jQuery,e.extend(!0,e.ui.dialogExtend.prototype,{modes:{minimize:{option:"minimizable",state:"minimized"}},options:{minimizable:!1,minimizeLocation:"left",icons:{minimize:"ui-icon-minus"},beforeMinimize:null,minimize:null},minimize:function(){var t,n,r;return this._trigger("beforeMinimize"),this._state!=="normal"&&this._restore(),r=200,e("#dialog-extend-fixed-container").length?n=e("#dialog-extend-fixed-container"):(n=e('<div id="dialog-extend-fixed-container"></div>').appendTo("body"),n.css({position:"fixed",bottom:1,left:1,right:1,"z-index":9999})),this._toggleButtons("minimized"),t=e(this.element[0]).dialog("widget").clone().children().remove().end(),e(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").clone(!0,!0).appendTo(t),t.css({"float":this.options.minimizeLocation,margin:1}),n.append(t),e(this.element[0]).data("dialog-extend-minimize-controls",t),e(this.element[0]).dialog("option","draggable")&&t.removeClass("ui-draggable"),t.css({height:"auto",width:r,position:"static"}),e(this.element[0]).on("dialogbeforeclose",this._minimize_restoreOnClose).dialog("widget").hide(),this._setState("minimized"),this._trigger("minimize")},_restore_minimized:function(){return e(this.element[0]).dialog("widget").show(),e(this.element[0]).off("dialogbeforeclose",this._minimize_restoreOnClose),e(this.element[0]).data("dialog-extend-minimize-controls").remove(),e(this.element[0]).removeData("dialog-extend-minimize-controls")},_initStyles_minimize:function(){var t;if(!e(".dialog-extend-minimize-css").length)return t="",t+='<style class="dialog-extend-minimize-css" type="text/css">',t+=".ui-dialog .ui-dialog-titlebar-minimize { width: 19px; height: 18px; }",t+=".ui-dialog .ui-dialog-titlebar-minimize span { display: block; margin: 1px; }",t+=".ui-dialog .ui-dialog-titlebar-minimize:hover,",t+=".ui-dialog .ui-dialog-titlebar-minimize:focus { padding: 0; }",t+="</style>",e(t).appendTo("body")},_verifyOptions_minimize:function(){var t;if(!this.options.minimizeLocation||(t=this.options.minimizeLocation)!=="left"&&t!=="right")return e.error("jQuery.dialogExtend Error : Invalid <minimizeLocation> value '"+this.options.minimizeLocation+"'"),this.options.minimizeLocation="left"},_minimize_restoreOnClose:function(){return e(this).dialogExtend("restore")}})}.call(this)}),define("chatjs",["jqdlgext"],function(){var e=e||{};return e.Chat=function(e){this.version=0,this.container=null,this.jqPreferences=null,this.jqMail=null,this.collab=e},e.Chat.prototype.init=function(){this.initChatWindow(),this.initPreferencesWindow(),this.initMailWindow(),this.collab.sendChatMsg("I have connected!"),this.updateCollaboratorList()},e.Chat.prototype.initChatWindow=function(){var e=this,t=$("<div></div>");e.container=t,t.dialog({title:"Chat",closeOnEscape:!1,minHeight:400,height:500,minWidth:700,width:800}).dialogExtend({closable:!1,maximizable:!0,minimizable:!0,collapsable:!0,dblclick:"collapse",icons:{maximize:"ui-icon-arrow-4-diag"}}),$(".ui-dialog-titlebar-buttonpane",t.parent()).append('<a class="ui-dialog-titlebar-preferences ui-corner-all ui-state-default" href="#" role="button"><span class="ui-icon ui-icon-gear" title="preferences">preferences</span></a>'),t.append('<div class="view-chat-usersarea view-chat-usersarea-theme1"><ul></ul></div><div class="view-chat-msgarea view-chat-theme1"><div class="view-chat-msgarea-header view-chat-msgarea-header-theme1"><button class="view-chat-msgarea-button view-chat-msgarea-button-theme1" type="button" title="Mail roomd id to collaborators">Email Collaborators</button><span>Room id: '+e.collab.realtimeFileId+"</span>"+"</div>"+'<textarea class="view-chat-msgarea-text view-chat-theme1" disabled>You are connected!</textarea>'+'<div class="view-chat-msgarea-input view-chat-theme1">'+'<input class="view-chat-msgarea-input-input view-chat-theme1" type="text">'+'<button class="view-chat-msgarea-input-button view-chat-msgarea-input-button-theme1"'+'type="button">Send msg</button>'+"</div>"+"</div>");var n=$(".view-chat-msgarea-header .view-chat-msgarea-button",t);e.collab.collabOwner||n.css("display","none"),$(e.container.parent()).css("borderColor",$(".ui-dialog-titlebar",e.container).css("color")),e.layoutChatWindow();var r=$(".ui-dialog-titlebar-preferences",t.parent()),i=$(".view-chat-msgarea-input-button",t),s=$(".view-chat-msgarea-input-input",t);r.mouseover(function(){return $(this).addClass("ui-state-hover")}).mouseout(function(){return $(this).removeClass("ui-state-hover")}).focus(function(){return $(this).addClass("ui-state-focus")}).blur(function(){return $(this).removeClass("ui-state-focus")}).click(function(){e.jqPreferences.dialog("open")}),i.click(function(){var t=s[0].value;if(t){s[0].value="";var n={user:e.collab.collaboratorInfo.name,msg:t};e.updateTextArea(n),e.collab.sendChatMsg(t)}}),n.click(function(){var t=$(".view-chat-mail-text",e.jqMail)[0];t.value="Enter a collaborator's email address per line:\n\n",e.jqMail.dialog("open")}),s.keyup(function(e){e.keyCode===13&&i.click()})},e.Chat.prototype.layoutChatWindow=function(){var e=$(".view-chat-msgarea",this.container),t=parseInt($(".view-chat-msgarea-header",e).css("height")),n=parseInt($(".view-chat-msgarea-input",e).css("height"));$(".view-chat-msgarea-text",e).css({top:t+"px",height:"calc(100% - "+(n+t)+"px)"})},e.Chat.prototype.initPreferencesWindow=function(){var e=this,t=$("<div></div>");e.jqPreferences=t,t.dialog({title:"Preferences",modal:!0,autoOpen:!1,minHeight:400,height:450,minWidth:400,width:450}),t.append('<div class="view-chat-preferences"><h3>Message style</h3><div><input class="view-chat-preferences-msgstyle" type="radio" name="msgstyle" value="headerbefore" checked="checked">Msg header on same line<br><input class="view-chat-preferences-msgstyle" type="radio" name="msgstyle" value="headerabove">Msg header on previous line</div><h3>Message header info</h3><div><input class="view-chat-preferences-msgstyle" type="radio" name="msgheaderinfo" value="name" checked="checked">Name<br><input class="view-chat-preferences-msgstyle" type="radio" name="msgheaderinfo" value="timename">[hh:mm] Name</div><h3>Font size</h3><div><span class="view-chat-preferences-fontsize" title="decrease">-</span><span class="view-chat-preferences-fontsize" title="increase">+</span></div><h3>Font family</h3><div><input class="view-chat-preferences-fontfamily" type="radio" name="fontfamily" value="standard" checked="checked">Standard<br><input class="view-chat-preferences-fontfamily" type="radio" name="fontfamily" value="fixedwidth">Fixed width</div><h3>Themes</h3><div><input class="view-chat-preferences-theme" type="radio" name="theme" value="darkbackground" checked="checked">Dark<br><input class="view-chat-preferences-theme" type="radio" name="theme" value="lightbackground">Light</div></div>'),t.data("preferences",{msgStyle:"headerbefore",msgHeaderInfo:"name",fontSize:$(".view-chat-msgarea-text",e.container).css("fontSize"),fontFamily:{standard:"sans-serif",fixedwidth:"monospace"},currentTheme:"darkbackground",themes:{darkbackground:{generalTheme:"view-chat-theme1",headerAreaTheme:"view-chat-msgarea-header-theme1",userAreaTheme:"view-chat-usersarea-theme1",buttonTheme:"view-chat-msgarea-button-theme1"},lightbackground:{generalTheme:"view-chat-theme2",headerAreaTheme:"view-chat-msgarea-header-theme2",userAreaTheme:"view-chat-usersarea-theme2",buttonTheme:"view-chat-msgarea-button-theme2"}}}),$(".view-chat-preferences-msgstyle",t).click(function(){var e=t.data("preferences"),n=$(this).attr("name"),r=$(this).attr("value");n==="msgstyle"?e.msgStyle=r:e.msgHeaderInfo=r,t.data("preferences",e)}),$(".view-chat-preferences-fontsize",t).click(function(){var n=t.data("preferences"),r=$(this).attr("title"),i=n.fontSize,s=parseInt(n.fontSize),o=i.slice(-2),u=0;r==="increase"?o==="px"&&s<22?u=1:o==="em"&&s<1.5&&(u=.1):o==="px"&&s>10?u=-1:o==="em"&&s>.8&&(u=-0.1),n.fontSize=s+u+o,t.data("preferences",n),$(".view-chat-msgarea-text",e.container).css({fontSize:n.fontSize}),$(".view-chat-msgarea-input-input",e.container).css({fontSize:n.fontSize}),e.layoutChatWindow()}),$(".view-chat-preferences-fontfamily",t).click(function(){var n=t.data("preferences"),r=$(this).attr("value");$(".view-chat-msgarea-text",e.container).css("fontFamily",n.fontFamily[r]),$(".view-chat-msgarea-input-input",e.container).css("fontFamily",n.fontFamily[r]),e.layoutChatWindow()}),$(".view-chat-preferences-theme",t).click(function(){var n=t.data("preferences"),r=$(this).attr("value"),i=n.themes[n.currentTheme],s=n.themes[r];n.currentTheme=r,$(".view-chat-usersarea",e.container).removeClass(i.userAreaTheme).addClass(s.userAreaTheme),$(".view-chat-msgarea",e.container).removeClass(i.generalTheme).addClass(s.generalTheme),$(".view-chat-msgarea-header",e.container).removeClass(i.headerAreaTheme).addClass(s.headerAreaTheme),$(".view-chat-msgarea-text",e.container).removeClass(i.generalTheme).addClass(s.generalTheme),$(".view-chat-msgarea-input",e.container).removeClass(i.generalTheme).addClass(s.generalTheme),$(".view-chat-msgarea-input-input",e.container).removeClass(i.generalTheme).addClass(s.generalTheme),$(".view-chat-msgarea-button",e.container).removeClass(i.buttonTheme).addClass(s.buttonTheme),$(e.container.parent()).css("borderColor",$(".view-chat-msgarea",e.container).css("borderColor"))})},e.Chat.prototype.initMailWindow=function(){var e=this,t=$("<div></div>");e.jqMail=t,t.dialog({title:"Mail room id to collaborators",modal:!0,autoOpen:!1,minHeight:400,height:450,minWidth:400,width:450}),t.append('<div class="view-chat-mail"><textarea class="view-chat-mail-text view-chat-theme1"></textarea><button class="view-chat-msgarea-button-theme1" type="button">Send mail</button></div>'),$("button",t).click(function(){function n(e){var t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}var r=$(".view-chat-mail-text",t)[0],i=[],s=r.value.split("\n");for(var o=0;o<s.length;o++)n(s[o])&&i.push(s[o]);e.collab.sendRealtimeFileId(i,function(e){e.error?r.value+="\n\nCould not send mail!":r.value+="\n\nMail has been sent!"})})},e.Chat.prototype.updateTextArea=function(e){var t=$(".view-chat-msgarea-text",this.container)[0],n=this.jqPreferences.data("preferences"),r="";if(n.msgHeaderInfo==="timename"){var i=new Date,s=(i.getHours()<10?"0":"")+i.getHours(),o=(i.getMinutes()<10?"0":"")+i.getMinutes();r="["+s+":"+o+"] "}n.msgStyle==="headerbefore"?t.innerHTML+="&#xA;"+r+e.user+": "+e.msg:t.innerHTML+="&#xA;"+r+e.user+":"+"&#xA;"+e.msg,t.scrollTop=t.scrollHeight},e.Chat.prototype.updateCollaboratorList=function(){var e=this.collab.getCollaboratorList(),t=$(".view-chat-usersarea",this.container),n=$("ul",t).empty();for(var r=0;r<e.length;r++)e[r].id===this.collab.collaboratorInfo.id?n.prepend("<li>"+this.collab.collaboratorInfo.name+" (me)</li>"):n.append("<li>"+e[r].name+"</li>")},e.Chat.prototype.close=function(){this.container.dialog("close")},e.Chat.prototype.open=function(){this.container.dialog("open")},e.Chat.prototype.isOpen=function(){return this.container.dialog("isOpen")},e.Chat.prototype.destroy=function(){this.container.dialogExtend("restore"),this.container.dialog("destroy"),this.jqPreferences.dialog("destroy"),this.container.empty()},e}),define("viewerjs",["utiljs","rendererjs","rboxjs","toolbarjs","thbarjs","chatjs"],function(e,t,n,r,i,s){var o=o||{};return o.Viewer=function(e,t){this.version=0,this.containerId=e,this.container=$("#"+e),this.toolBar=null,this.toolBarBtnsIdPrefix=e+"_tbarbtn",this.rBox=null,this.renderersIdPrefix=e+"_renderer",this.thBars=[],this.thumbnailsIdPrefix=e+"_thumbnail",this.componentsX=[],this.imgFileArr=[];if(t){this.collab=t,this.chat=null;var n=this;this.collab.onConnect=function(e){n.handleOnConnect(e)},this.collab.onDataFilesShared=function(e,t){n.handleOnDataFilesShared(e,t)},this.collab.onCollabObjChanged=function(){n.handleOnCollabObjChanged()},this.collab.onNewChatMessage=function(e){n.handleOnNewChatMessage(e)},this.collab.onDisconnect=function(e){n.handleOnDisconnect(e)}}},o.Viewer.prototype.init=function(){var t=this;t.container.css({position:"relative",margin:0,"-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}).sortable({cursor:"move",containment:"parent",distance:"150",axis:"x",beforeStop:function(e,n){for(var r=0;r<t.componentsX.length;r++)if(t.componentsX[r].container[0]===n.item[0]){var i=t.componentsX.splice(r,1);n.offset.left>n.originalPosition.left?t.componentsX=t.componentsX.concat(i):t.componentsX=i.concat(t.componentsX),t.layoutComponentsX();break}}}),t.addRenderersBox(),t.addToolBar(),e.setDropzone(t.containerId,function(e){t.addData(e)})},o.Viewer.prototype.addData=function(e,t){var n=this;if(n.collab&&n.collab.collabIsOn)t&&t();else if(e.length){var r=n.buildImgFileArr(e);n.addThumbnailsBar(r,function(){t&&t()})}else t&&t()},o.Viewer.prototype.buildImgFileArr=function(n){function h(e){var n=e.url,r=n.substring(0,n.lastIndexOf("/")+1),i,l,c;e.file?i=e.file:(i={name:n.substring(n.lastIndexOf("/")+1),url:n,remote:!0},e.cloudId&&(i.cloudId=e.cloudId)),l=t.Renderer.imgType(i),l==="dicom"?(u[r]||(u[r]=[]),u[r].push(i)):l==="dicomzip"?(a[r]||(a[r]=[]),a[r].push(i)):l==="thumbnail"?(c=n.indexOf("-",n.lastIndexOf("/")),c===-1?s[n.substring(0,n.lastIndexOf("."))]=i:s[n.substring(0,c)]=i):l==="json"?o[n.substring(0,n.lastIndexOf("."))]=i:l!=="unsupported"&&f.push({baseUrl:r,imgType:l,files:[i]})}function p(e,t){for(var n in e)for(var r=0;r<i.length;r++){var s=0;do l=i[r].baseUrl+i[r].files[s].name,c=l.substring(0,l.lastIndexOf("."));while(++s<i[r].files.length&&n!==c);if(n===c){i[r][t]=e[n];break}}}var r=this,i=[],s={},o={},u={},a={},f=[],l,c;for(var d=0;d<n.length;d++)h(n[d]);for(var v in u)i.push({baseUrl:v,imgType:"dicom",files:e.sortObjArr(u[v],"name")});for(v in a)i.push({baseUrl:v,imgType:"dicomzip",files:e.sortObjArr(a[v],"name")});for(d=0;d<f.length;d++)i.push(f[d]);p(s,"thumbnail"),p(o,"json"),i.sort(function(e,t){var n=e.baseUrl+e.files[0].name.replace(/.zip$/,""),r=t.baseUrl+t.files[0].name.replace(/.zip$/,""),i=[n,r].sort();return i[0]===i[1]?0:i[0]===n?-1:1});var m=r.imgFileArr.length;for(d=0;d<i.length;d++)i[d].id=d+m;return i},o.Viewer.prototype.addRenderersBox=function(){var e=this;if(e.rBox)return;var t=$("<div></div>");e.container.append(t);var r={container:t[0],position:{bottom:0,left:0},renderersIdPrefix:e.renderersIdPrefix},i=null;e.collab&&(i=e.collab.fileManager),e.rBox=new n.RenderersBox(r,i),e.rBox.init(),e.container.sortable("option","cancel",".view-renderers"),e.componentsX.push(e.rBox),this.rBox.computeMovingHelper=function(t,n){var r=$(".view-thumbnail").css("width"),i=$(".view-thumbnail").css("height"),s=e.rBox.getRendererId(n.find(".view-renderer-content").attr("id")),o=e.getThumbnailsBarObject(s).getThumbnailContId(s);return $("#"+o).clone().css({display:"block",width:r,height:i})},this.rBox.onStart=function(){e.thBars.forEach(function(e){e.container.css({overflow:"visible"})})},this.rBox.onBeforeStop=function(t,n){var r=e.rBox.getRendererId(n.item.find(".view-renderer-content").attr("id"));if(n.placeholder.parent().parent()[0]===e.getThumbnailsBarObject(r).container[0]){$(t.target).sortable("cancel");var i=e.rBox.renderers.filter(function(e){return e.id===r});e.rBox.removeRenderer(i[0])}else n.placeholder.parent()[0]!==t.target&&$(t.target).sortable("cancel");e.thBars.forEach(function(e){e.container.css({overflow:"auto"})})},this.rBox.onRendererChange=function(){e.updateCollabScene()},this.rBox.onRendererRemove=function(t){e.handleOnRendererRemove(t),e.updateCollabScene()}},o.Viewer.prototype.addRenderer=function(e,t){var n=this,r=n.getThumbnailsBarObject(e.id);$("#"+r.getThumbnailContId(e.id)).css({display:"none"}),n.rBox.addRenderer(e,"Z",function(i){i?n.rBox.numOfRenderers===2&&$("#"+n.toolBarBtnsIdPrefix+"link").css({display:""}):$("#"+r.getThumbnailContId(e.id)).css({display:""}),t&&t(i)})},o.Viewer.prototype.handleOnRendererRemove=function(e){var t=this.getThumbnailsBarObject(e).getThumbnailContId(e);$("#"+t).css({display:"block"}),this.rBox.numOfRenderers===1&&($("#"+this.toolBarBtnsIdPrefix+"link").css({display:"none"}),this.rBox.renderersLinked&&this.handleToolBarButtonLinkClick())},o.Viewer.prototype.addToolBar=function(){var e=this;if(e.toolBar)return;var t=$("<div></div>");e.container.append(t),e.container.sortable("option","cancel",".view-toolbar");var n={container:t[0],position:{top:"5px",left:0}};e.toolBar=new r.ToolBar(n),e.toolBar.init();var i=e.toolBarBtnsIdPrefix;e.toolBar.addButton({id:i+"link",title:"Link views",caption:'<i class="fa fa-link"></i>',onclick:function(){e.handleToolBarButtonLinkClick(),e.updateCollabScene()}}),e.toolBar.hideButton(i+"link"),e.toolBar.addButton({id:i+"collab",title:"Start collaboration",caption:'<i class="fa fa-users"></i>',onclick:function(){e.collab.collabIsOn?e.leaveCollaboration():e.startCollaboration()}}),e.toolBar.addButton({id:i+"auth",title:"Authorize",caption:'<i class="fa fa-certificate"></i>'}),e.toolBar.hideButton(i+"auth"),e.toolBar.addButton({id:i+"help",title:"Wiki help",caption:'<i class="fa fa-question"></i>',onclick:function(){window.open("https://github.com/FNNDSC/viewerjs/wiki")}}),this.handleToolBarButtonLinkClick=function(){var t=$("#"+i+"link");e.rBox.renderersLinked?(e.rBox.renderersLinked=!1,t.html('<i class="fa fa-link"></i>'),t.attr("title","Link views")):(e.rBox.renderersLinked=!0,t.html('<i class="fa fa-chain-broken"></i>'),t.attr("title","Unlink views"))};var s=parseInt(e.toolBar.container.css("top"))+parseInt(e.toolBar.container.css("height"))+5;e.rBox.container.css({top:s+"px"}),e.rBox.container.css({height:"calc(100% - "+s+"px)"})},o.Viewer.prototype.addThumbnailsBar=function(e,t){var n=this;if(!e.length){t&&t();return}var r=$("<div></div>");n.container.append(r);var s={container:r[0],position:{top:"5px",left:"5px"},layout:"vertical",thumbnailsIdPrefix:n.thumbnailsIdPrefix},o=null;n.collab&&(o=n.collab.fileManager);var u=new i.ThumbnailsBar(s,o);u.init(e,function(){for(var e=0;e<n.rBox.renderers.length;e++){var r=n.rBox.renderers[e].id,i=u.getThumbnailContId(r);$("#"+i).css({display:"none"})}t&&t()}),n.rBox.setComplementarySortableElems("#"+n.container.attr("id")+" .view-thumbnailsbar-sortable"),u.setComplementarySortableElems("#"+n.container.attr("id")+" .view-renderers"),u.onBeforeStop=function(e,t){if(t.placeholder.parent()[0]===n.rBox.container[0]){$(e.target).sortable("cancel");var r=u.getThumbnailId(t.item.attr("id"));n.addRenderer(n.getImgFileObject(r),function(e){e&&n.updateCollabScene()})}};for(var a=0;a<e.length;a++)e[a].thBarId=n.thBars.length;n.imgFileArr=n.imgFileArr.concat(e),n.thBars.push(u),n.componentsX.unshift(u);var f=parseInt(u.container.css("left"))+parseInt(u.container.css("width"))+5,l="calc(100% - "+f*n.thBars.length+"px)";n.rBox.container.css({width:l}),n.toolBar.container.css({width:l}),n.layoutComponentsX()},o.Viewer.prototype.layoutComponentsX=function(){var e=this,t=5,n=0,r;for(var i=0;i<e.componentsX.length;i++)if(e.componentsX[i].renderers){r=i;break}var s=e.componentsX.slice(0,r+1);s.forEach(function(n,i){e.toolBar&&i===r&&e.toolBar.container.css({left:t+"px",right:"auto"}),n.container.css({left:t+"px",right:"auto"}),t+=parseInt(n.container.css("width"))+5}),s=e.componentsX.slice(r+1),s.reverse().forEach(function(e){e.container.css({left:"auto",right:n+"px"}),n+=parseInt(e.container.css("width"))+5})},o.Viewer.prototype.getImgFileObject=function(e){return e<0||e>=this.imgFileArr.length?null:this.imgFileArr[e]},o.Viewer.prototype.getThumbnailsBarObject=function(e){return e<0||e>=this.imgFileArr.length?null:this.thBars[this.getImgFileObject(e).thBarId]},o.Viewer.prototype.renderScene=function(){function n(){var n,r=[],i=[],s=function(e){var t=r.indexOf(e.id);e.volume.lowerThreshold=i[t].volume.lowerThreshold,e.volume.upperThreshold=i[t].volume.upperThreshold,e.volume.windowLow=i[t].volume.lowerWindowLevel,e.volume.windowHigh=i[t].volume.upperWindowLevel,e.volume.indexX=i[t].volume.indexX,e.volume.indexY=i[t].volume.indexY,e.volume.indexZ=i[t].volume.indexZ;var n=JSON.parse(i[t].renderer.viewMatrix),s=$.map(n,function(e){return e});e.renderer.camera.view=new Float32Array(s),e.renderer.flipColumns=i[t].renderer.flipColumns,e.renderer.flipRows=i[t].renderer.flipRows,e.renderer.pointer=i[t].renderer.pointer,e.updateUISliceInfo()};for(var o=0;o<t.renderers.length;o++)if(t.renderers[o].general.type="2D")r.push(t.renderers[o].general.id),i.push(t.renderers[o]);for(o=0;o<e.rBox.renderers.length;o++){n=e.rBox.renderers[o].id;if(r.indexOf(n)===-1){var u=e.getThumbnailsBarObject(n).getThumbnailContId(n);$("#"+u).css({display:"block"}),e.rBox.removeRenderer(e.rBox.renderers[o])}}for(o=0;o<r.length;o++)n=r[o],$("#"+e.getThumbnailsBarObject(n).getThumbnailContId(n)).css({display:"none"}),e.addRenderer(e.getImgFileObject(n),s)}var e=this,t;e.collab&&e.collab.collabIsOn&&(t=e.getCollabScene(),e.rBox.renderersLinked!==t.toolBar.renderersLinked&&e.handleToolBarButtonLinkClick(),n())},o.Viewer.prototype.getLocalScene=function(){var e={},t=this.rBox.renderers;e.toolBar={},e.toolBar.renderersLinked=this.rBox.renderersLinked,e.renderers=[];for(var n=0;n<t.length;n++){var r={};r.general={},r.general.id=t[n].id,r.general.type="2D",r.renderer={},r.renderer.viewMatrix=JSON.stringify(t[n].renderer.camera.view),r.renderer.flipColumns=t[n].renderer.flipColumns,r.renderer.flipRows=t[n].renderer.flipRows,r.renderer.pointer=t[n].renderer.pointer,r.volume={},r.volume.file=t[n].volume.file,r.volume.lowerThreshold=t[n].volume.lowerThreshold,r.volume.upperThreshold=t[n].volume.upperThreshold,r.volume.lowerWindowLevel=t[n].volume.windowLow,r.volume.upperWindowLevel=t[n].volume.windowHigh,r.volume.indexX=t[n].volume.indexX,r.volume.indexY=t[n].volume.indexY,r.volume.indexZ=t[n].volume.indexZ,r.interactor={},r.camera={},r.pointer={},e.renderers.push(r)}return e},o.Viewer.prototype.getCollabScene=function(){if(this.collab&&this.collab.collabIsOn)return this.collab.getCollabObj()},o.Viewer.prototype.updateCollabScene=function(){if(this.collab&&this.collab.collabIsOn){var e=this.getLocalScene();this.collab.setCollabObj(e)}},o.Viewer.prototype.startCollaboration=function(){var e=this;if(e.collab){var t=document.getElementById(e.toolBarBtnsIdPrefix+"collab"),n=document.getElementById(e.toolBarBtnsIdPrefix+"auth");e.collab.authorizeAndLoadApi(!0,function(r){r?e.collab.startRealtimeCollaboration(e.getLocalScene()):(t.style.display="none",n.style.display="",n.onclick=function(){e.collab.authorizeAndLoadApi(!1,function(t){t&&e.collab.startRealtimeCollaboration(e.getLocalScene())})})})}else console.error("Collaboration was not enabled for this viewer instance")},o.Viewer.prototype.startCollaborationChat=function(){this.collab&&this.collab.collabIsOn&&(this.chat=new s.Chat(this.collab),this.chat.init())},o.Viewer.prototype.leaveCollaboration=function(){if(this.collab&&this.collab.collabIsOn){this.collab.leaveRealtimeCollaboration();var e=document.getElementById(this.toolBarBtnsIdPrefix+"collab");e.innerHTML='<i class="fa fa-users"></i>',e.title="Start collaboration",this.chat.destroy(),this.chat=null}},o.Viewer.prototype.handleOnConnect=function(e){function s(e,t){function s(e,t){var s=e.url.substring(e.url.lastIndexOf("/")+1);n.collab.fileManager.writeFile(n.collab.dataFilesBaseDir+"/"+s,t,function(t){i.push({id:t.id,url:e.url,thBarId:e.thBarId}),i.length===r&&n.collab.setDataFileList(i)})}if(e.url.search(/.dcm.zip$|.ima.zip$|.zip$/i)!==-1){r+=t.length-1,s(e,t[0]);for(var o=1;o<t.length;o++)e.url=e.url.replace(/.dcm.zip$|.ima.zip$|.zip$/i,o+"$&"),s(e,t[o])}else s(e,t)}var n=this,r=function(){var e=0;for(var t=0;t<n.imgFileArr.length;t++)++e,n.imgFileArr[t].json&&++e;return e}(),i=[];if(n.collab.collaboratorInfo.id===e.id){if(n.collab.collabOwner){var o=document.getElementById(n.toolBarBtnsIdPrefix+"collab");o.style.display="",o.innerHTML='<i class="fa fa-user-times"></i>',o.title="End collaboration";var u=document.getElementById(n.toolBarBtnsIdPrefix+"auth");u.style.display="none",n.collab.fileManager.createPath(n.collab.dataFilesBaseDir,function(){var e=new t.Renderer({container:null,rendererId:""},n.collab);for(var r=0;r<n.imgFileArr.length;r++){var i=n.imgFileArr[r],o=i.thBarId,u;i.json&&(u=i.baseUrl+i.json.name,e.readFile(i.json,"readAsArrayBuffer",s.bind(null,{url:u,thBarId:o}))),i.files.length>1?(u=i.baseUrl+i.files[0].name+".zip",e.zipFiles(i.files,s.bind(null,{url:u,thBarId:o}))):(u=i.baseUrl+i.files[0].name,e.readFile(i.files[0],"readAsArrayBuffer",s.bind(null,{url:u,thBarId:o})))}})}else n.container.append('<div class="view-initialwaittext">Please wait while loading the viewer...</div>'),$(".view-initialwaittext",n.container).css({color:"white"});n.startCollaborationChat()}else n.chat.updateCollaboratorList()},o.Viewer.prototype.handleOnDataFilesShared=function(e,t){var n=this;if(n.collab.collaboratorInfo.id===e.id){var r=[];for(var i=0;i<t.length;i++)r[t[i].thBarId]||(r[t[i].thBarId]=[]),r[t[i].thBarId].push({url:t[i].url,cloudId:t[i].id});$(".view-initialwaittext",n.container).remove(),n.init();var s=document.getElementById(this.toolBarBtnsIdPrefix+"collab");s.innerHTML='<i class="fa fa-user-times"></i>',s.title="End collaboration";var o=0,u=function(){++o===r.length&&n.onViewerReady()};for(i=0;i<r.length;i++){var a=n.buildImgFileArr(r[i]);n.addThumbnailsBar(a,u)}n.renderScene()}},o.Viewer.prototype.handleOnCollabObjChanged=function(){this.renderScene()},o.Viewer.prototype.handleOnNewChatMessage=function(e){this.chat&&this.chat.updateTextArea(e)},o.Viewer.prototype.handleOnDisconnect=function(e){if(this.chat){var t={user:e.name,msg:"I have disconnected."};this.chat.updateTextArea(t),this.chat.updateCollaboratorList()}},o.Viewer.prototype.onViewerReady=function(){console.log("onViewerReady not overwritten!")},o.Viewer.prototype.destroy=function(){this.collab&&this.collab.collabIsOn&&this.leaveCollaboration(),this.rBox.destroy(),this.rBox=null,this.toolBar.destroy(),this.toolBar=null;for(var e=this.thBars.length-1;e>=0;e--)this.thBars[e].destroy(),this.thBars.splice(e,1);this.imgFileArr=[],this.container.empty()},o}),define("medview",["utiljs","gcjs","viewerjs"],function(e,t,n){var r=r||{};return r.App=function(){this.CLIENT_ID="1050768372633-ap5v43nedv10gagid9l70a2vae8p9nah.apps.googleusercontent.com",this._fObjArr=[],this.views=[],this.nviews=0},r.App.prototype.init=function(){var n=this;n.tabs=$("#tabs").tabs({beforeActivate:function(){for(var e=0;e<n.views.length;e++)n.views[e]&&n.views[e].chat&&n.views[e].chat.isOpen()&&n.views[e].chat.close()}}),n.tabs=$("#tabs").tabs({activate:function(t,r){var i=r.newPanel.attr("id");if(i!=="tabload"){var s=parseInt(i.replace("tabviewer",""));n.views[s].chat&&n.views[s].chat.open()}e.documentRepaint()}}),n.tabs.delegate("span.ui-icon-close","click",function(){var e=$(this).closest("li").remove().attr("aria-controls"),t=e.length,r=parseInt(parseInt(e.charAt(t-2))?e.substr(t-2):e.charAt(t-1));n.views[r].destroy(),n.views[r]=null,n.nviews--,$("#"+e).remove(),n.tabs.tabs("refresh")}),$("#collabbutton").click(function(){$(".collab > .collab-input").slideToggle("fast");if($(this).text()==="Hide room ID")$(this).text("Join collaboration");else{$(this).text("Hide room ID"),$("#roomId").focus();var e=new t.GDriveCollab(n.CLIENT_ID);e.authorizeAndLoadApi(!0,function(t){var r=document.getElementById("gobutton"),i=document.getElementById("roomId");t&&i.value?r.onclick=function(){n.localData=!1;var t=n.addView(e);t.collab.joinRealtimeCollaboration(i.value)}:r.onclick=function(){e.authorizeAndLoadApi(!1,function(t){if(t&&i.value){n.localData=!1;var r=n.addView(e);r.collab.joinRealtimeCollaboration(i.value)}})}})}}),$("#READMEbutton").click(function(){window.open("https://github.com/FNNDSC/mi2b2/blob/master/README.md")});var r=document.getElementById("dirbtn");r.onchange=function(e){n.localData=!0;var r=e.target.files,i;n._fObjArr=[];for(var s=0;s<r.length;s++)i=r[s],"webkitRelativePath"in i?i.fullPath=i.webkitRelativePath:"fullPath"in i||(i.fullPath=i.name),n._fObjArr.push({url:r[s].fullPath,file:r[s]});if(n._fObjArr.length){var o=new t.GDriveCollab(n.CLIENT_ID);n.addView(o)}},e.setDropzone("tabload",function(e){n.localData=!0;if(e.length){n._fObjArr=e;var r=new t.GDriveCollab(n.CLIENT_ID);n.addView(r)}})},r.App.prototype.addView=function(e){var t=this;$("#tabs").tabs("disable");var r=t.views.length,i="viewer"+r,s="tabviewer"+r;$("div#tabs ul").append('<li><a href="#'+s+'">'+"Viewer"+(r+1)+'</a><span class="ui-icon ui-icon-close" role=presentation>Remove Tab</span></li>'),$("div#tabs").append('<div id="'+s+'"></div>'),$("div#tabs").tabs("refresh"),$("#"+s).append('<div id="'+i+'" class="viewer-container">');var o=new n.Viewer(i,e);return o.onViewerReady=function(){$("#tabs").tabs("enable")},t.localData&&(o.init(),o.addData(t._fObjArr,function(){$("#tabs").tabs("enable")})),t.views.push(o),++t.nviews,$("#tabs").tabs("option","active",t.nviews),o},r});